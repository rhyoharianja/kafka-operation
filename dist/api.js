"use strict";var e,t,r,s=require("url"),n=require("util"),i=require("events"),o=require("zlib"),a=require("crypto"),c=require("assert"),u=require("net"),l=require("tls");!function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.REVERT="revert",e.COMMENT="comment",e.UPLOAD="upload",e.LOGIN="login",e.RUN="run"}(e||(e={})),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(const e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(t||(t={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(r||(r={}));const d=t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),p=e=>{switch(typeof e){case"undefined":return d.undefined;case"string":return d.string;case"number":return isNaN(e)?d.nan:d.number;case"boolean":return d.boolean;case"function":return d.function;case"bigint":return d.bigint;case"symbol":return d.symbol;case"object":return Array.isArray(e)?d.array:null===e?d.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?d.promise:"undefined"!=typeof Map&&e instanceof Map?d.map:"undefined"!=typeof Set&&e instanceof Set?d.set:"undefined"!=typeof Date&&e instanceof Date?d.date:d.object;default:return d.unknown}},f=t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class h extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(s);else if("invalid_return_type"===n.code)s(n.returnTypeError);else if("invalid_arguments"===n.code)s(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,s=0;for(;s<n.path.length;){const r=n.path[s];s===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,t.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}h.create=e=>new h(e);const m=(e,r)=>{let s;switch(e.code){case f.invalid_type:s=e.received===d.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case f.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,t.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:s=`Unrecognized key(s) in object: ${t.joinValues(e.keys,", ")}`;break;case f.invalid_union:s="Invalid input";break;case f.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${t.joinValues(e.options)}`;break;case f.invalid_enum_value:s=`Invalid enum value. Expected ${t.joinValues(e.options)}, received '${e.received}'`;break;case f.invalid_arguments:s="Invalid function arguments";break;case f.invalid_return_type:s="Invalid function return type";break;case f.invalid_date:s="Invalid date";break;case f.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:t.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case f.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case f.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case f.custom:s="Invalid input";break;case f.invalid_intersection_types:s="Intersection results could not be merged";break;case f.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case f.not_finite:s="Number must be finite";break;default:s=r.defaultError,t.assertNever(e)}return{message:s}};let g=m;function y(){return g}const I=e=>{const{data:t,path:r,errorMaps:s,issueData:n}=e,i=[...r,...n.path||[]],o={...n,path:i};let a="";const c=s.filter(e=>!!e).slice().reverse();for(const e of c)a=e(o,{data:t,defaultError:a}).message;return{...n,path:i,message:n.message||a}};function b(e,t){const r=I({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,y(),m].filter(e=>!!e)});e.common.issues.push(r)}class w{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if("aborted"===s.status)return v;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return w.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:t,value:n}=s;if("aborted"===t.status)return v;if("aborted"===n.status)return v;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),(void 0!==n.value||s.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}const v=Object.freeze({status:"aborted"}),T=e=>({status:"dirty",value:e}),E=e=>({status:"valid",value:e}),_=e=>"aborted"===e.status,A=e=>"dirty"===e.status,S=e=>"valid"===e.status,O=e=>"undefined"!=typeof Promise&&e instanceof Promise;var N;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(N||(N={}));class R{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const C=(e,t)=>{if(S(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new h(e.common.issues);return this._error=t,this._error}}};function k(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:n}=e;if(t&&(r||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=s?s:t.defaultError}:{message:null!=r?r:t.defaultError},description:n}}class x{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return p(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:p(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new w,ctx:{common:e.parent.common,data:e.data,parsedType:p(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(O(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:p(e)},n=this._parseSync({data:e,path:s.path,parent:s});return C(s,n)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:p(e)},s=this._parse({data:e,path:r.path,parent:r}),n=await(O(s)?s:Promise.resolve(s));return C(r,n)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{const n=e(t),i=()=>s.addIssue({code:f.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(i(),!1)):!!n||(i(),!1)})}refinement(e,t){return this._refinement((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1))}_refinement(e){return new ve({schema:this,typeName:xe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Te.create(this,this._def)}nullable(){return Ee.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return re.create(this,this._def)}promise(){return we.create(this,this._def)}or(e){return ie.create([this,e],this._def)}and(e){return ue.create(this,e,this._def)}transform(e){return new ve({...k(this._def),schema:this,typeName:xe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new _e({...k(this._def),innerType:this,defaultValue:t,typeName:xe.ZodDefault})}brand(){return new Ne({typeName:xe.ZodBranded,type:this,...k(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Ae({...k(this._def),innerType:this,catchValue:t,typeName:xe.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Re.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const L=/^c[^\s-]{8,}$/i,B=/^[a-z][a-z0-9]*$/,P=/[0-9A-HJKMNP-TV-Z]{26}/,M=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,D=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,$=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,U=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,j=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,G=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function F(e,t){return!("v4"!==t&&t||!U.test(e))||!("v6"!==t&&t||!j.test(e))}class V extends x{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(t=>e.test(t),{validation:t,code:f.invalid_string,...N.errToObj(r)}),this.nonempty=e=>this.min(1,N.errToObj(e)),this.trim=()=>new V({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new V({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new V({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==d.string){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.string,received:t.parsedType}),v}const r=new w;let s;for(const n of this._def.checks)if("min"===n.kind)e.data.length<n.value&&(s=this._getOrReturnCtx(e,s),b(s,{code:f.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),r.dirty());else if("max"===n.kind)e.data.length>n.value&&(s=this._getOrReturnCtx(e,s),b(s,{code:f.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),r.dirty());else if("length"===n.kind){const t=e.data.length>n.value,i=e.data.length<n.value;(t||i)&&(s=this._getOrReturnCtx(e,s),t?b(s,{code:f.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):i&&b(s,{code:f.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),r.dirty())}else if("email"===n.kind)D.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"email",code:f.invalid_string,message:n.message}),r.dirty());else if("emoji"===n.kind)$.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"emoji",code:f.invalid_string,message:n.message}),r.dirty());else if("uuid"===n.kind)M.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"uuid",code:f.invalid_string,message:n.message}),r.dirty());else if("cuid"===n.kind)L.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"cuid",code:f.invalid_string,message:n.message}),r.dirty());else if("cuid2"===n.kind)B.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"cuid2",code:f.invalid_string,message:n.message}),r.dirty());else if("ulid"===n.kind)P.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"ulid",code:f.invalid_string,message:n.message}),r.dirty());else if("url"===n.kind)try{new URL(e.data)}catch(t){s=this._getOrReturnCtx(e,s),b(s,{validation:"url",code:f.invalid_string,message:n.message}),r.dirty()}else if("regex"===n.kind){n.regex.lastIndex=0;n.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"regex",code:f.invalid_string,message:n.message}),r.dirty())}else if("trim"===n.kind)e.data=e.data.trim();else if("includes"===n.kind)e.data.includes(n.value,n.position)||(s=this._getOrReturnCtx(e,s),b(s,{code:f.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),r.dirty());else if("toLowerCase"===n.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===n.kind)e.data=e.data.toUpperCase();else if("startsWith"===n.kind)e.data.startsWith(n.value)||(s=this._getOrReturnCtx(e,s),b(s,{code:f.invalid_string,validation:{startsWith:n.value},message:n.message}),r.dirty());else if("endsWith"===n.kind)e.data.endsWith(n.value)||(s=this._getOrReturnCtx(e,s),b(s,{code:f.invalid_string,validation:{endsWith:n.value},message:n.message}),r.dirty());else if("datetime"===n.kind){G(n).test(e.data)||(s=this._getOrReturnCtx(e,s),b(s,{code:f.invalid_string,validation:"datetime",message:n.message}),r.dirty())}else"ip"===n.kind?F(e.data,n.version)||(s=this._getOrReturnCtx(e,s),b(s,{validation:"ip",code:f.invalid_string,message:n.message}),r.dirty()):t.assertNever(n);return{status:r.value,value:e.data}}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...N.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...N.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...N.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...N.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...N.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...N.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function K(e,t){const r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,n=r>s?r:s;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}V.create=e=>{var t;return new V({checks:[],typeName:xe.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...k(e)})};class q extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==d.number){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.number,received:t.parsedType}),v}let r;const s=new w;for(const n of this._def.checks)if("int"===n.kind)t.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.invalid_type,expected:"integer",received:"float",message:n.message}),s.dirty());else if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty())}else"multipleOf"===n.kind?0!==K(e.data,n.value)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),b(r,{code:f.not_finite,message:n.message}),s.dirty()):t.assertNever(n);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,s){return new q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&t.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}q.create=e=>new q({checks:[],typeName:xe.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...k(e)});class W extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==d.bigint){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.bigint,received:t.parsedType}),v}let r;const s=new w;for(const n of this._def.checks)if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),b(r,{code:f.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):t.assertNever(n);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,s){return new W({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}W.create=e=>{var t;return new W({checks:[],typeName:xe.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...k(e)})};class H extends x{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==d.boolean){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.boolean,received:t.parsedType}),v}return E(e.data)}}H.create=e=>new H({typeName:xe.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...k(e)});class Z extends x{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==d.date){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.date,received:t.parsedType}),v}if(isNaN(e.data.getTime())){return b(this._getOrReturnCtx(e),{code:f.invalid_date}),v}const r=new w;let s;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(s=this._getOrReturnCtx(e,s),b(s,{code:f.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(s=this._getOrReturnCtx(e,s),b(s,{code:f.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):t.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Z({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Z.create=e=>new Z({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:xe.ZodDate,...k(e)});class J extends x{_parse(e){if(this._getType(e)!==d.symbol){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.symbol,received:t.parsedType}),v}return E(e.data)}}J.create=e=>new J({typeName:xe.ZodSymbol,...k(e)});class X extends x{_parse(e){if(this._getType(e)!==d.undefined){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.undefined,received:t.parsedType}),v}return E(e.data)}}X.create=e=>new X({typeName:xe.ZodUndefined,...k(e)});class z extends x{_parse(e){if(this._getType(e)!==d.null){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.null,received:t.parsedType}),v}return E(e.data)}}z.create=e=>new z({typeName:xe.ZodNull,...k(e)});class Y extends x{constructor(){super(...arguments),this._any=!0}_parse(e){return E(e.data)}}Y.create=e=>new Y({typeName:xe.ZodAny,...k(e)});class Q extends x{constructor(){super(...arguments),this._unknown=!0}_parse(e){return E(e.data)}}Q.create=e=>new Q({typeName:xe.ZodUnknown,...k(e)});class ee extends x{_parse(e){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.never,received:t.parsedType}),v}}ee.create=e=>new ee({typeName:xe.ZodNever,...k(e)});class te extends x{_parse(e){if(this._getType(e)!==d.undefined){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.void,received:t.parsedType}),v}return E(e.data)}}te.create=e=>new te({typeName:xe.ZodVoid,...k(e)});class re extends x{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==d.array)return b(t,{code:f.invalid_type,expected:d.array,received:t.parsedType}),v;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,n=t.data.length<s.exactLength.value;(e||n)&&(b(t,{code:e?f.too_big:f.too_small,minimum:n?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(b(t,{code:f.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(b(t,{code:f.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>s.type._parseAsync(new R(t,e,t.path,r)))).then(e=>w.mergeArray(r,e));const n=[...t.data].map((e,r)=>s.type._parseSync(new R(t,e,t.path,r)));return w.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new re({...this._def,minLength:{value:e,message:N.toString(t)}})}max(e,t){return new re({...this._def,maxLength:{value:e,message:N.toString(t)}})}length(e,t){return new re({...this._def,exactLength:{value:e,message:N.toString(t)}})}nonempty(e){return this.min(1,e)}}function se(e){if(e instanceof ne){const t={};for(const r in e.shape){const s=e.shape[r];t[r]=Te.create(se(s))}return new ne({...e._def,shape:()=>t})}return e instanceof re?new re({...e._def,type:se(e.element)}):e instanceof Te?Te.create(se(e.unwrap())):e instanceof Ee?Ee.create(se(e.unwrap())):e instanceof le?le.create(e.items.map(e=>se(e))):e}re.create=(e,t)=>new re({type:e,minLength:null,maxLength:null,exactLength:null,typeName:xe.ZodArray,...k(t)});class ne extends x{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),r=t.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==d.object){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.object,received:t.parsedType}),v}const{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof ee&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||i.push(e);const o=[];for(const e of n){const t=s[e],n=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new R(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ee){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(b(r,{code:f.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const s=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new R(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of o){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>w.mergeObjectSync(t,e)):w.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new ne({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,n,i,o;const a=null!==(i=null===(n=(s=this._def).errorMap)||void 0===n?void 0:n.call(s,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=N.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new ne({...this._def,unknownKeys:"strip"})}passthrough(){return new ne({...this._def,unknownKeys:"passthrough"})}extend(e){return new ne({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ne({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:xe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ne({...this._def,catchall:e})}pick(e){const r={};return t.objectKeys(e).forEach(t=>{e[t]&&this.shape[t]&&(r[t]=this.shape[t])}),new ne({...this._def,shape:()=>r})}omit(e){const r={};return t.objectKeys(this.shape).forEach(t=>{e[t]||(r[t]=this.shape[t])}),new ne({...this._def,shape:()=>r})}deepPartial(){return se(this)}partial(e){const r={};return t.objectKeys(this.shape).forEach(t=>{const s=this.shape[t];e&&!e[t]?r[t]=s:r[t]=s.optional()}),new ne({...this._def,shape:()=>r})}required(e){const r={};return t.objectKeys(this.shape).forEach(t=>{if(e&&!e[t])r[t]=this.shape[t];else{let e=this.shape[t];for(;e instanceof Te;)e=e._def.innerType;r[t]=e}}),new ne({...this._def,shape:()=>r})}keyof(){return ye(t.objectKeys(this.shape))}}ne.create=(e,t)=>new ne({shape:()=>e,unknownKeys:"strip",catchall:ee.create(),typeName:xe.ZodObject,...k(t)}),ne.strictCreate=(e,t)=>new ne({shape:()=>e,unknownKeys:"strict",catchall:ee.create(),typeName:xe.ZodObject,...k(t)}),ne.lazycreate=(e,t)=>new ne({shape:e,unknownKeys:"strip",catchall:ee.create(),typeName:xe.ZodObject,...k(t)});class ie extends x{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map(e=>new h(e.ctx.common.issues));return b(t,{code:f.invalid_union,unionErrors:r}),v});{let e;const s=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=s.map(e=>new h(e));return b(t,{code:f.invalid_union,unionErrors:n}),v}}get options(){return this._def.options}}ie.create=(e,t)=>new ie({options:e,typeName:xe.ZodUnion,...k(t)});const oe=e=>e instanceof me?oe(e.schema):e instanceof ve?oe(e.innerType()):e instanceof ge?[e.value]:e instanceof Ie?e.options:e instanceof be?Object.keys(e.enum):e instanceof _e?oe(e._def.innerType):e instanceof X?[void 0]:e instanceof z?[null]:null;class ae extends x{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==d.object)return b(t,{code:f.invalid_type,expected:d.object,received:t.parsedType}),v;const r=this.discriminator,s=t.data[r],n=this.optionsMap.get(s);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(b(t,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),v)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const r of t){const t=oe(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(s.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);s.set(n,r)}}return new ae({typeName:xe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...k(r)})}}function ce(e,r){const s=p(e),n=p(r);if(e===r)return{valid:!0,data:e};if(s===d.object&&n===d.object){const s=t.objectKeys(r),n=t.objectKeys(e).filter(e=>-1!==s.indexOf(e)),i={...e,...r};for(const t of n){const s=ce(e[t],r[t]);if(!s.valid)return{valid:!1};i[t]=s.data}return{valid:!0,data:i}}if(s===d.array&&n===d.array){if(e.length!==r.length)return{valid:!1};const t=[];for(let s=0;s<e.length;s++){const n=ce(e[s],r[s]);if(!n.valid)return{valid:!1};t.push(n.data)}return{valid:!0,data:t}}return s===d.date&&n===d.date&&+e===+r?{valid:!0,data:e}:{valid:!1}}class ue extends x{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if(_(e)||_(s))return v;const n=ce(e.value,s.value);return n.valid?((A(e)||A(s))&&t.dirty(),{status:t.value,value:n.data}):(b(r,{code:f.invalid_intersection_types}),v)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ue.create=(e,t,r)=>new ue({left:e,right:t,typeName:xe.ZodIntersection,...k(r)});class le extends x{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==d.array)return b(r,{code:f.invalid_type,expected:d.array,received:r.parsedType}),v;if(r.data.length<this._def.items.length)return b(r,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),v;!this._def.rest&&r.data.length>this._def.items.length&&(b(r,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new R(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(s).then(e=>w.mergeArray(t,e)):w.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new le({...this._def,rest:e})}}le.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new le({items:e,typeName:xe.ZodTuple,rest:null,...k(t)})};class de extends x{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==d.object)return b(r,{code:f.invalid_type,expected:d.object,received:r.parsedType}),v;const s=[],n=this._def.keyType,i=this._def.valueType;for(const e in r.data)s.push({key:n._parse(new R(r,e,r.path,e)),value:i._parse(new R(r,r.data[e],r.path,e))});return r.common.async?w.mergeObjectAsync(t,s):w.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new de(t instanceof x?{keyType:e,valueType:t,typeName:xe.ZodRecord,...k(r)}:{keyType:V.create(),valueType:e,typeName:xe.ZodRecord,...k(t)})}}class pe extends x{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==d.map)return b(r,{code:f.invalid_type,expected:d.map,received:r.parsedType}),v;const s=this._def.keyType,n=this._def.valueType,i=[...r.data.entries()].map(([e,t],i)=>({key:s._parse(new R(r,e,r.path,[i,"key"])),value:n._parse(new R(r,t,r.path,[i,"value"]))}));if(r.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const r of i){const s=await r.key,n=await r.value;if("aborted"===s.status||"aborted"===n.status)return v;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}})}{const e=new Map;for(const r of i){const s=r.key,n=r.value;if("aborted"===s.status||"aborted"===n.status)return v;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}}}pe.create=(e,t,r)=>new pe({valueType:t,keyType:e,typeName:xe.ZodMap,...k(r)});class fe extends x{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==d.set)return b(r,{code:f.invalid_type,expected:d.set,received:r.parsedType}),v;const s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(b(r,{code:f.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(b(r,{code:f.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const n=this._def.valueType;function i(e){const r=new Set;for(const s of e){if("aborted"===s.status)return v;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}const o=[...r.data.values()].map((e,t)=>n._parse(new R(r,e,r.path,t)));return r.common.async?Promise.all(o).then(e=>i(e)):i(o)}min(e,t){return new fe({...this._def,minSize:{value:e,message:N.toString(t)}})}max(e,t){return new fe({...this._def,maxSize:{value:e,message:N.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}fe.create=(e,t)=>new fe({valueType:e,minSize:null,maxSize:null,typeName:xe.ZodSet,...k(t)});class he extends x{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==d.function)return b(t,{code:f.invalid_type,expected:d.function,received:t.parsedType}),v;function r(e,r){return I({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,y(),m].filter(e=>!!e),issueData:{code:f.invalid_arguments,argumentsError:r}})}function s(e,r){return I({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,y(),m].filter(e=>!!e),issueData:{code:f.invalid_return_type,returnTypeError:r}})}const n={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof we?E(async(...e)=>{const t=new h([]),o=await this._def.args.parseAsync(e,n).catch(s=>{throw t.addIssue(r(e,s)),t}),a=await i(...o);return await this._def.returns._def.type.parseAsync(a,n).catch(e=>{throw t.addIssue(s(a,e)),t})}):E((...e)=>{const t=this._def.args.safeParse(e,n);if(!t.success)throw new h([r(e,t.error)]);const o=i(...t.data),a=this._def.returns.safeParse(o,n);if(!a.success)throw new h([s(o,a.error)]);return a.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new he({...this._def,args:le.create(e).rest(Q.create())})}returns(e){return new he({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new he({args:e||le.create([]).rest(Q.create()),returns:t||Q.create(),typeName:xe.ZodFunction,...k(r)})}}class me extends x{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}me.create=(e,t)=>new me({getter:e,typeName:xe.ZodLazy,...k(t)});class ge extends x{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return b(t,{received:t.data,code:f.invalid_literal,expected:this._def.value}),v}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ye(e,t){return new Ie({values:e,typeName:xe.ZodEnum,...k(t)})}ge.create=(e,t)=>new ge({value:e,typeName:xe.ZodLiteral,...k(t)});class Ie extends x{_parse(e){if("string"!=typeof e.data){const r=this._getOrReturnCtx(e),s=this._def.values;return b(r,{expected:t.joinValues(s),received:r.parsedType,code:f.invalid_type}),v}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return b(t,{received:t.data,code:f.invalid_enum_value,options:r}),v}return E(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Ie.create(e)}exclude(e){return Ie.create(this.options.filter(t=>!e.includes(t)))}}Ie.create=ye;class be extends x{_parse(e){const r=t.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==d.string&&s.parsedType!==d.number){const e=t.objectValues(r);return b(s,{expected:t.joinValues(e),received:s.parsedType,code:f.invalid_type}),v}if(-1===r.indexOf(e.data)){const e=t.objectValues(r);return b(s,{received:s.data,code:f.invalid_enum_value,options:e}),v}return E(e.data)}get enum(){return this._def.values}}be.create=(e,t)=>new be({values:e,typeName:xe.ZodNativeEnum,...k(t)});class we extends x{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==d.promise&&!1===t.common.async)return b(t,{code:f.invalid_type,expected:d.promise,received:t.parsedType}),v;const r=t.parsedType===d.promise?t.data:Promise.resolve(t.data);return E(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}we.create=(e,t)=>new we({type:e,typeName:xe.ZodPromise,...k(t)});class ve extends x{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===xe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:s}=this._processInputParams(e),n=this._def.effect||null;if("preprocess"===n.type){const e=n.transform(s.data);return s.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:s.path,parent:s})):this._def.schema._parseSync({data:e,path:s.path,parent:s})}const i={addIssue:e=>{b(s,e),e.fatal?r.abort():r.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),"refinement"===n.type){const e=e=>{const t=n.refinement(e,i);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const t=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===t.status?v:("dirty"===t.status&&r.dirty(),e(t.value),{status:r.value,value:t.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(t=>"aborted"===t.status?v:("dirty"===t.status&&r.dirty(),e(t.value).then(()=>({status:r.value,value:t.value}))))}if("transform"===n.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!S(e))return e;const t=n.transform(e.value,i);if(t instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:t}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>S(e)?Promise.resolve(n.transform(e.value,i)).then(e=>({status:r.value,value:e})):e)}t.assertNever(n)}}ve.create=(e,t,r)=>new ve({schema:e,typeName:xe.ZodEffects,effect:t,...k(r)}),ve.createWithPreprocess=(e,t,r)=>new ve({schema:t,effect:{type:"preprocess",transform:e},typeName:xe.ZodEffects,...k(r)});class Te extends x{_parse(e){return this._getType(e)===d.undefined?E(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Te.create=(e,t)=>new Te({innerType:e,typeName:xe.ZodOptional,...k(t)});class Ee extends x{_parse(e){return this._getType(e)===d.null?E(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ee.create=(e,t)=>new Ee({innerType:e,typeName:xe.ZodNullable,...k(t)});class _e extends x{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===d.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}_e.create=(e,t)=>new _e({innerType:e,typeName:xe.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...k(t)});class Ae extends x{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return O(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new h(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new h(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ae.create=(e,t)=>new Ae({innerType:e,typeName:xe.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...k(t)});class Se extends x{_parse(e){if(this._getType(e)!==d.nan){const t=this._getOrReturnCtx(e);return b(t,{code:f.invalid_type,expected:d.nan,received:t.parsedType}),v}return{status:"valid",value:e.data}}}Se.create=e=>new Se({typeName:xe.ZodNaN,...k(e)});const Oe=Symbol("zod_brand");class Ne extends x{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Re extends x{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?v:"dirty"===e.status?(t.dirty(),T(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})()}{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?v:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new Re({in:e,out:t,typeName:xe.ZodPipeline})}}const Ce=(e,t={},r)=>e?Y.create().superRefine((s,n)=>{var i,o;if(!e(s)){const e="function"==typeof t?t(s):"string"==typeof t?{message:t}:t,a=null===(o=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===o||o,c="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...c,fatal:a})}}):Y.create(),ke={object:ne.lazycreate};var xe;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"}(xe||(xe={}));const Le=V.create,Be=q.create,Pe=Se.create,Me=W.create,De=H.create,$e=Z.create,Ue=J.create,je=X.create,Ge=z.create,Fe=Y.create,Ve=Q.create,Ke=ee.create,qe=te.create,We=re.create,He=ne.create,Ze=ne.strictCreate,Je=ie.create,Xe=ae.create,ze=ue.create,Ye=le.create,Qe=de.create,et=pe.create,tt=fe.create,rt=he.create,st=me.create,nt=ge.create,it=Ie.create,ot=be.create,at=we.create,ct=ve.create,ut=Te.create,lt=Ee.create,dt=ve.createWithPreprocess,pt=Re.create,ft={string:e=>V.create({...e,coerce:!0}),number:e=>q.create({...e,coerce:!0}),boolean:e=>H.create({...e,coerce:!0}),bigint:e=>W.create({...e,coerce:!0}),date:e=>Z.create({...e,coerce:!0})},ht=v;var mt=Object.freeze({__proto__:null,defaultErrorMap:m,setErrorMap:function(e){g=e},getErrorMap:y,makeIssue:I,EMPTY_PATH:[],addIssueToContext:b,ParseStatus:w,INVALID:v,DIRTY:T,OK:E,isAborted:_,isDirty:A,isValid:S,isAsync:O,get util(){return t},get objectUtil(){return r},ZodParsedType:d,getParsedType:p,ZodType:x,ZodString:V,ZodNumber:q,ZodBigInt:W,ZodBoolean:H,ZodDate:Z,ZodSymbol:J,ZodUndefined:X,ZodNull:z,ZodAny:Y,ZodUnknown:Q,ZodNever:ee,ZodVoid:te,ZodArray:re,ZodObject:ne,ZodUnion:ie,ZodDiscriminatedUnion:ae,ZodIntersection:ue,ZodTuple:le,ZodRecord:de,ZodMap:pe,ZodSet:fe,ZodFunction:he,ZodLazy:me,ZodLiteral:ge,ZodEnum:Ie,ZodNativeEnum:be,ZodPromise:we,ZodEffects:ve,ZodTransformer:ve,ZodOptional:Te,ZodNullable:Ee,ZodDefault:_e,ZodCatch:Ae,ZodNaN:Se,BRAND:Oe,ZodBranded:Ne,ZodPipeline:Re,custom:Ce,Schema:x,ZodSchema:x,late:ke,get ZodFirstPartyTypeKind(){return xe},coerce:ft,any:Fe,array:We,bigint:Me,boolean:De,date:$e,discriminatedUnion:Xe,effect:ct,enum:it,function:rt,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Ce(t=>t instanceof e,t),intersection:ze,lazy:st,literal:nt,map:et,nan:Pe,nativeEnum:ot,never:Ke,null:Ge,nullable:lt,number:Be,object:He,oboolean:()=>De().optional(),onumber:()=>Be().optional(),optional:ut,ostring:()=>Le().optional(),pipeline:pt,preprocess:dt,promise:at,record:Qe,set:tt,strictObject:Ze,string:Le,symbol:Ue,transformer:ct,tuple:Ye,undefined:je,union:Je,unknown:Ve,void:qe,NEVER:ht,ZodIssueCode:f,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:h});const gt=["interface","display","layout","module","panel"],yt=["hook","endpoint"],It=["operation"],bt="directus:extension",wt=mt.object({app:mt.string(),api:mt.string()}),vt=mt.union([mt.object({type:mt.union([mt.enum(gt),mt.enum(yt)]),name:mt.string(),source:mt.string()}),mt.object({type:mt.enum(It),name:mt.string(),source:wt})]),Tt=mt.object({host:mt.string(),hidden:mt.boolean().optional()}),Et=mt.object({type:mt.union([mt.enum(gt),mt.enum(yt)]),path:mt.string(),source:mt.string()}),_t=mt.object({type:mt.enum(It),path:wt,source:wt}),At=mt.object({type:mt.literal("bundle"),path:wt,entries:mt.array(vt)});mt.array(vt);const St=Tt.and(mt.union([Et,_t,At]));var Ot,Nt;mt.object({name:mt.string(),version:mt.string(),dependencies:mt.record(mt.string()).optional(),[bt]:St}),function(e){e.NULL="null",e.UNDEFINED="undefined",e.STRING="string",e.INTEGER="integer",e.FLOAT="float",e.BOOLEAN="boolean",e.EMPTY="empty"}(Ot||(Ot={})),function(e){e[e.TRUE=-1]="TRUE",e[e.FALSE=-2]="FALSE",e[e.NULL=-3]="NULL",e[e.EMPTY=-4]="EMPTY",e[e.UNDEFINED=-5]="UNDEFINED"}(Nt||(Nt={}));var Rt=(0).constructor;Rt.isFinite,Rt.isInteger,[].constructor.isArray;new(function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var r=this.cachedKeys[this.oldestIndex];void 0!==r&&delete this.map[r],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}())(1e3);var Ct="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function kt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xt={exports:{}},Lt=function(...e){try{return JSON.stringify(...e)}catch(e){return"[Cannot display object: "+e.message+"]"}};!function(e,t){const r=Lt;xt.exports=class extends Error{constructor(e){super(e.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:r(e)).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}}(0,xt.exports);var Bt=xt.exports;const Pt=Bt;var Mt=function(e,...t){if(!e){if(1===t.length&&t[0]instanceof Error)throw t[0];throw new Pt(t)}};const Dt=Mt,$t={};var Ut=function(e,t,r){if(!1===t||null==t)return e;"string"==typeof(r=r||{})&&(r={separator:r});const s=Array.isArray(t);Dt(!s||!r.separator,"Separator option is not valid for array-based chain");const n=s?t:t.split(r.separator||".");let i=e;for(let e=0;e<n.length;++e){let s=n[e];const o=r.iterables&&$t.iterables(i);if(Array.isArray(i)||"set"===o){const e=Number(s);Number.isInteger(e)&&(s=e<0?i.length+e:e)}if(!i||"function"==typeof i&&!1===r.functions||!o&&void 0===i[s]){Dt(!r.strict||e+1===n.length,"Missing segment",s,"in reach path ",t),Dt("object"==typeof i||!0===r.functions||"function"!=typeof i,"Invalid segment",s,"in reach path ",t),i=r.default;break}i=o?"set"===o?[...i][s]:i.get(s):i[s]}return i};$t.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0};var jt={exports:{}};!function(e,t){const r={};t=jt.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},r.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const s=Object.prototype.toString.call(e);return r.typeMap.get(s)||t.generic}}(0,jt.exports);var Gt=jt.exports,Ft={keys:function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}};const Vt=Ut,Kt=Gt,qt=Ft,Wt={needsProtoHack:new Set([Kt.set,Kt.map,Kt.weakSet,Kt.weakMap])};var Ht=Wt.clone=function(e,t={},r=null){if("object"!=typeof e||null===e)return e;let s=Wt.clone,n=r;if(t.shallow){if(!0!==t.shallow)return Wt.cloneWithShallow(e,t);s=e=>e}else if(n){const t=n.get(e);if(t)return t}else n=new Map;const i=Kt.getInternalProto(e);if(i===Kt.buffer)return Buffer&&Buffer.from(e);if(i===Kt.date)return new Date(e.getTime());if(i===Kt.regex)return new RegExp(e);const o=Wt.base(e,i,t);if(o===e)return e;if(n&&n.set(e,o),i===Kt.set)for(const r of e)o.add(s(r,t,n));else if(i===Kt.map)for(const[r,i]of e)o.set(r,s(i,t,n));const a=qt.keys(e,t);for(const r of a){if("__proto__"===r)continue;if(i===Kt.array&&"length"===r){o.length=e.length;continue}const a=Object.getOwnPropertyDescriptor(e,r);a?a.get||a.set?Object.defineProperty(o,r,a):a.enumerable?o[r]=s(e[r],t,n):Object.defineProperty(o,r,{enumerable:!1,writable:!0,configurable:!0,value:s(e[r],t,n)}):Object.defineProperty(o,r,{enumerable:!0,writable:!0,configurable:!0,value:s(e[r],t,n)})}return o};Wt.cloneWithShallow=function(e,t){const r=t.shallow;(t=Object.assign({},t)).shallow=!1;const s=new Map;for(const t of r){const r=Vt(e,t);"object"!=typeof r&&"function"!=typeof r||s.set(r,r)}return Wt.clone(e,t,s)},Wt.base=function(e,t,r){if(!1===r.prototype)return Wt.needsProtoHack.has(t)?new t.constructor:t===Kt.array?[]:{};const s=Object.getPrototypeOf(e);if(s&&s.isImmutable)return e;if(t===Kt.array){const e=[];return s!==t&&Object.setPrototypeOf(e,s),e}if(Wt.needsProtoHack.has(t)){const e=new s.constructor;return s!==t&&Object.setPrototypeOf(e,s),e}return Object.create(s)};var Zt,Jt={},Xt={},zt={name:"joi",description:"Object schema validation",version:"17.9.1",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.0.0","@hapi/topo":"^5.0.0","@sideway/address":"^4.1.3","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.0.1","@types/node":"^14.18.24",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"},Yt={};function Qt(){if(Zt)return Yt;Zt=1;const e=gn(),t={};return t.wrap=e.string().min(1).max(2).allow(!1),Yt.preferences=e.object({allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),context:e.object(),convert:e.boolean(),dateFormat:e.valid("date","iso","string","time","utc"),debug:e.boolean(),errors:{escapeHtml:e.boolean(),label:e.valid("path","key",!1),language:[e.string(),e.object().ref()],render:e.boolean(),stack:e.boolean(),wrap:{label:t.wrap,array:t.wrap,string:t.wrap}},externals:e.boolean(),messages:e.object(),noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:e.valid("required","optional","forbidden"),skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()}).strict(),t.nameRx=/^[a-zA-Z0-9]\w*$/,t.rule=e.object({alias:e.array().items(e.string().pattern(t.nameRx)).single(),args:e.array().items(e.string(),e.object({name:e.string().pattern(t.nameRx).required(),ref:e.boolean(),assert:e.alternatives([e.function(),e.object().schema()]).conditional("ref",{is:!0,then:e.required()}),normalize:e.function(),message:e.string().when("assert",{is:e.function(),then:e.required()})})),convert:e.boolean(),manifest:e.boolean(),method:e.function().allow(!1),multi:e.boolean(),validate:e.function()}),Yt.extension=e.object({type:e.alternatives([e.string(),e.object().regex()]).required(),args:e.function(),cast:e.object().pattern(t.nameRx,e.object({from:e.function().maxArity(1).required(),to:e.function().minArity(1).maxArity(2).required()})),base:e.object().schema().when("type",{is:e.object().regex(),then:e.forbidden()}),coerce:[e.function().maxArity(3),e.object({method:e.function().maxArity(3).required(),from:e.array().items(e.string()).single()})],flags:e.object().pattern(t.nameRx,e.object({setter:e.string(),default:e.any()})),manifest:{build:e.function().arity(2)},messages:[e.object(),e.string()],modifiers:e.object().pattern(t.nameRx,e.function().minArity(1).maxArity(2)),overrides:e.object().pattern(t.nameRx,e.function()),prepare:e.function().maxArity(3),rebuild:e.function().arity(1),rules:e.object().pattern(t.nameRx,t.rule),terms:e.object().pattern(t.nameRx,e.object({init:e.array().allow(null).required(),manifest:e.object().pattern(/.+/,[e.valid("schema","single"),e.object({mapped:e.object({from:e.string().required(),to:e.string().required()}).required()})])})),validate:e.function().maxArity(3)}).strict(),Yt.extensions=e.array().items(e.object(),e.function().arity(1)).strict(),t.desc={buffer:e.object({buffer:e.string()}),func:e.object({function:e.function().required(),options:{literal:!0}}),override:e.object({override:!0}),ref:e.object({ref:e.object({type:e.valid("value","global","local"),path:e.array().required(),separator:e.string().length(1).allow(!1),ancestor:e.number().min(0).integer().allow("root"),map:e.array().items(e.array().length(2)).min(1),adjust:e.function(),iterables:e.boolean(),in:e.boolean(),render:e.boolean()}).required()}),regex:e.object({regex:e.string().min(3)}),special:e.object({special:e.valid("deep").required()}),template:e.object({template:e.string().required(),options:e.object()}),value:e.object({value:e.alternatives([e.object(),e.array()]).required()})},t.desc.entity=e.alternatives([e.array().items(e.link("...")),e.boolean(),e.function(),e.number(),e.string(),t.desc.buffer,t.desc.func,t.desc.ref,t.desc.regex,t.desc.special,t.desc.template,t.desc.value,e.link("/")]),t.desc.values=e.array().items(null,e.boolean(),e.function(),e.number().allow(1/0,-1/0),e.string().allow(""),e.symbol(),t.desc.buffer,t.desc.func,t.desc.override,t.desc.ref,t.desc.regex,t.desc.template,t.desc.value),t.desc.messages=e.object().pattern(/.+/,[e.string(),t.desc.template,e.object().pattern(/.+/,[e.string(),t.desc.template])]),Yt.description=e.object({type:e.string().required(),flags:e.object({cast:e.string(),default:e.any(),description:e.string(),empty:e.link("/"),failover:t.desc.entity,id:e.string(),label:e.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:e.boolean(),unit:e.string()}).unknown(),preferences:{allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),convert:e.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:e.boolean(),label:["path","key"],language:[e.string(),t.desc.ref],wrap:{label:t.wrap,array:t.wrap}},externals:e.boolean(),messages:t.desc.messages,noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:["required","optional","forbidden"],skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()},allow:t.desc.values,invalid:t.desc.values,rules:e.array().min(1).items({name:e.string().required(),args:e.object().min(1),keep:e.boolean(),message:[e.string(),t.desc.messages],warn:e.boolean()}),keys:e.object().pattern(/.*/,e.link("/")),link:t.desc.ref}).pattern(/^[a-z]\w*$/,e.any()),Yt}var er={},tr={exports:{}};const rr={};var sr=function(e){if(!e)return"";let t="";for(let r=0;r<e.length;++r){const s=e.charCodeAt(r);rr.isSafe(s)?t+=e[r]:t+=rr.escapeHtmlChar(s)}return t};rr.escapeHtmlChar=function(e){const t=rr.namedHtml.get(e);if(t)return t;if(e>=256)return"&#"+e+";";return`&#x${e.toString(16).padStart(2,"0")};`},rr.isSafe=function(e){return rr.safeCharCodes.has(e)},rr.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),rr.safeCharCodes=function(){const e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&e.add(t);return e}();var nr={};!function(e){const t={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(e,r={}){if(!r[t.settings]&&r.constants)for(const e in r.constants){const t=r.constants[e];if(null!==t&&!["boolean","number","string"].includes(typeof t))throw new Error(`Formula constant ${e} contains invalid ${typeof t} value type`)}this.settings=r[t.settings]?r:Object.assign({[t.settings]:!0,constants:{},functions:{}},r),this.single=null,this._parts=null,this._parse(e)}_parse(r){let s=[],n="",i=0,o=!1;const a=r=>{if(i)throw new Error("Formula missing closing parenthesis");const a=s.length?s[s.length-1]:null;if(o||n||r){if(a&&"reference"===a.type&&")"===r)return a.type="function",a.value=this._subFormula(n,a.value),void(n="");if(")"===r){const t=new e.Parser(n,this.settings);s.push({type:"segment",value:t})}else if(o){if("]"===o)return s.push({type:"reference",value:n}),void(n="");s.push({type:"literal",value:n})}else if(t.operatorCharacters.includes(n))a&&"operator"===a.type&&t.operators.includes(a.value+n)?a.value+=n:s.push({type:"operator",value:n});else if(n.match(t.numberRx))s.push({type:"constant",value:parseFloat(n)});else if(void 0!==this.settings.constants[n])s.push({type:"constant",value:this.settings.constants[n]});else{if(!n.match(t.tokenRx))throw new Error(`Formula contains invalid token: ${n}`);s.push({type:"reference",value:n})}n=""}};for(const e of r)o?e===o?(a(),o=!1):n+=e:i?"("===e?(n+=e,++i):")"===e?(--i,i?n+=e:a(e)):n+=e:e in t.literals?o=t.literals[e]:"("===e?(a(),++i):t.operatorCharacters.includes(e)?(a(),n=e,a()):" "!==e?n+=e:a();a(),s=s.map((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==s[t-1].type?e:{type:"operator",value:"n"});let c=!1;for(const e of s){if("operator"===e.type){if(t.operatorsPrefix.includes(e.value))continue;if(!c)throw new Error("Formula contains an operator in invalid position");if(!t.operators.includes(e.value))throw new Error(`Formula contains an unknown operator ${e.value}`)}else if(c)throw new Error("Formula missing expected operator");c=!c}if(!c)throw new Error("Formula contains invalid trailing operator");1===s.length&&["reference","literal","constant"].includes(s[0].type)&&(this.single={type:"reference"===s[0].type?"reference":"value",value:s[0].value}),this._parts=s.map(e=>{if("operator"===e.type)return t.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error(`Formula contains invalid reference ${e.value}`);return this.settings.reference?this.settings.reference(e.value):t.reference(e.value)})}_subFormula(r,s){const n=this.settings.functions[s];if("function"!=typeof n)throw new Error(`Formula contains unknown function ${s}`);let i=[];if(r){let e="",n=0,o=!1;const a=()=>{if(!e)throw new Error(`Formula contains function ${s} with invalid arguments ${r}`);i.push(e),e=""};for(let s=0;s<r.length;++s){const i=r[s];o?(e+=i,i===o&&(o=!1)):i in t.literals&&!n?(e+=i,o=t.literals[i]):","!==i||n?(e+=i,"("===i?++n:")"===i&&--n):a()}a()}return i=i.map(t=>new e.Parser(t,this.settings)),function(e){const t=[];for(const r of i)t.push(r.evaluate(e));return n.call(e,...t)}}evaluate(e){const r=this._parts.slice();for(let s=r.length-2;s>=0;--s){const n=r[s];if(n&&"operator"===n.type){const i=r[s+1];r.splice(s+1,1);const o=t.evaluate(i,e);r[s]=t.single(n.value,o)}}return t.operatorsOrder.forEach(s=>{for(let n=1;n<r.length-1;)if(s.includes(r[n])){const s=r[n],i=t.evaluate(r[n-1],e),o=t.evaluate(r[n+1],e);r.splice(n,2);const a=t.calculate(s,i,o);r[n-1]=0===a?0:a}else n+=2}),t.evaluate(r[0],e)}},e.Parser.prototype[t.symbol]=!0,t.reference=function(e){return function(t){return t&&void 0!==t[e]?t[e]:null}},t.evaluate=function(e,r){return null===e?null:"function"==typeof e?e(r):e[t.symbol]?e.evaluate(r):e},t.single=function(e,t){if("!"===e)return!t;const r=-t;return 0===r?0:r},t.calculate=function(e,r,s){if("??"===e)return t.exists(r)?r:s;if("string"==typeof r||"string"==typeof s){if("+"===e)return(r=t.exists(r)?r:"")+(s=t.exists(s)?s:"")}else switch(e){case"^":return Math.pow(r,s);case"*":return r*s;case"/":return r/s;case"%":return r%s;case"+":return r+s;case"-":return r-s}switch(e){case"<":return r<s;case"<=":return r<=s;case">":return r>s;case">=":return r>=s;case"==":return r===s;case"!=":return r!==s;case"&&":return r&&s;case"||":return r||s}return null},t.exists=function(e){return null!=e}}(nr);var ir,or,ar={},cr={};function ur(){if(ir)return cr;ir=1;const e=Ht,t=wr(),r={annotations:Symbol("annotations")};return cr.error=function(s){if(!this._original||"object"!=typeof this._original)return this.details[0].message;const n=s?"":"[31m",i=s?"":"[41m",o=s?"":"[0m",a=e(this._original);for(let e=this.details.length-1;e>=0;--e){const s=e+1,n=this.details[e],i=n.path;let o=a;for(let e=0;;++e){const a=i[e];if(t.isSchema(o)&&(o=o.clone()),!(e+1<i.length&&"string"!=typeof o[a])){const e=o[r.annotations]||{errors:{},missing:{}};o[r.annotations]=e;const t=a||n.context.key;void 0!==o[a]?(e.errors[t]=e.errors[t]||[],e.errors[t].push(s)):e.missing[t]=s;break}o=o[a]}}const c=/_\$key\$_([, \d]+)_\$end\$_"/g,u=/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,l=/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,d=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g;let p=r.safeStringify(a,2).replace(c,(e,t)=>`" ${n}[${t}]${o}`).replace(u,(e,t,r)=>`${i}"${t}"${o}${n} [${r}]: -- missing --${o}`).replace(l,(e,t,r)=>`\n${r} ${n}[${t}]${o}`).replace(d,(e,t)=>t);p=`${p}\n${n}`;for(let e=0;e<this.details.length;++e){p=`${p}\n[${e+1}] ${this.details[e].message}`}return p+=o,p},r.safeStringify=function(e,t){return JSON.stringify(e,r.serializer(),t)},r.serializer=function(){const e=[],t=[],s=(r,s)=>t[0]===s?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(s)).join(".")+"]";return function(n,i){if(t.length>0){const r=t.indexOf(this);~r?(t.length=r+1,e.length=r+1,e[r]=n):(t.push(this),e.push(n)),~t.indexOf(i)&&(i=s.call(this,n,i))}else t.push(i);if(i){const e=i[r.annotations];if(e){if(Array.isArray(i)){const t=[];for(let r=0;r<i.length;++r)e.errors[r]&&t.push(`_$idx$_${e.errors[r].sort().join(", ")}_$end$_`),t.push(i[r]);i=t}else{for(const t in e.errors)i[`${t}_$key$_${e.errors[t].sort().join(", ")}_$end$_`]=i[t],i[t]=void 0;for(const t in e.missing)i[`_$miss$_${t}|${e.missing[t]}_$end$_`]="__missing__"}return i}}return i===1/0||i===-1/0||Number.isNaN(i)||"function"==typeof i||"symbol"==typeof i?"["+i.toString()+"]":i}},cr}function lr(){return or||(or=1,function(e){const t=ur(),r=wr(),s=Ir();e.Report=class{constructor(t,r,s,n,i,o,a){if(this.code=t,this.flags=n,this.messages=i,this.path=o.path,this.prefs=a,this.state=o,this.value=r,this.message=null,this.template=null,this.local=s||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;const e=this.code;if(!this.prefs.errors.render)return this.code;const t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===t?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,r){return e.template(this.value,t,r||this.code,this.state,this.prefs)}},e.path=function(e){let t="";for(const r of e)"object"!=typeof r&&("string"==typeof r?(t&&(t+="."),t+=r):t+=`[${r}]`);return t},e.template=function(e,t,n,i,o){if(!t)return;if(s.isTemplate(t))return"root"!==n?t:null;let a=o.errors.language;if(r.isResolvable(a)&&(a=a.resolve(e,i,o)),a&&t[a]){if(void 0!==t[a][n])return t[a][n];if(void 0!==t[a]["*"])return t[a]["*"]}return t[n]?t[n]:t["*"]},e.label=function(t,r,s,n){if(t.label)return t.label;if(!s.errors.label)return"";let i=r.path;"key"===s.errors.label&&r.path.length>1&&(i=r.path.slice(-1));const o=e.path(i);return o||(e.template(null,s.messages,"root",r,s)||n&&e.template(null,n,"root",r,s)||"value")},e.process=function(t,r,s){if(!t)return null;const{override:n,message:i,details:o}=e.details(t);if(n)return n;if(s.errors.stack)return new e.ValidationError(i,o,r);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const c=new e.ValidationError(i,o,r);return Error.stackTraceLimit=a,c},e.details=function(e,t={}){let r=[];const s=[];for(const n of e){if(n instanceof Error){if(!1!==t.override)return{override:n};const e=n.toString();r.push(e),s.push({message:e,type:"override",context:{error:n}});continue}const e=n.toString();r.push(e),s.push({message:e,path:n.path.filter(e=>"object"!=typeof e),type:n.code,context:n.local})}return r.length>1&&(r=[...new Set(r)]),{message:r.join(". "),details:s}},e.ValidationError=class extends Error{constructor(e,t,r){super(e),this._original=r,this.details=t}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=t.error}(ar)),ar}var dr,pr,fr,hr,mr,gr={};function yr(){return dr||(dr=1,function(e){const t=Mt,r=Ht,s=Ut,n=wr();let i;const o={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(e,r={}){t("string"==typeof e,"Invalid reference key:",e),n.assertOptions(r,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!r.prefix||"object"==typeof r.prefix,"options.prefix must be of type object");const s=Object.assign({},o.defaults,r);delete s.prefix;const i=s.separator,a=o.context(e,i,r.prefix);if(s.type=a.type,e=a.key,"value"===s.type)if(a.root&&(t(!i||e[0]!==i,"Cannot specify relative path with root prefix"),s.ancestor="root",e||(e=null)),i&&i===e)e=null,s.ancestor=0;else if(void 0!==s.ancestor)t(!i||!e||e[0]!==i,"Cannot combine prefix with ancestor option");else{const[t,r]=o.ancestor(e,i);r&&""===(e=e.slice(r))&&(e=null),s.ancestor=t}return s.path=i?null===e?[]:e.split(i):[e],new o.Ref(s)},e.in=function(t,r={}){return e.create(t,{...r,in:!0})},e.isRef=function(e){return!!e&&!!e[n.symbols.ref]},o.Ref=class{constructor(e){t("object"==typeof e,"Invalid reference construction"),n.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),t(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),t(!e.map||Array.isArray(e.map),"options.map must be an array"),t(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,o.defaults,e),t("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,r,s,n,i={}){return t(!this.in||i.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(s.context,r,i):"local"===this.type?this._resolve(n,r,i):this.ancestor?"root"===this.ancestor?this._resolve(r.ancestors[r.ancestors.length-1],r,i):(t(this.ancestor<=r.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(r.ancestors[this.ancestor-1],r,i)):this._resolve(e,r,i)}_resolve(e,t,r){let n;if("value"===this.type&&t.mainstay.shadow&&!1!==r.shadow&&(n=t.mainstay.shadow.get(this.absolute(t))),void 0===n&&(n=s(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(n=this.adjust(n)),this.map){const e=this.map.get(n);void 0!==e&&(n=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,n),n}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new o.Ref(this)}describe(){const e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){const e=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display=`ref:${this.type}:${e}`);if(!this.separator)return void(this.display=`ref:${e}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${e}`);if("root"===this.ancestor)return void(this.display=`ref:root:${e}`);if(1===this.ancestor)return void(this.display=`ref:${e||".."}`);const t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}},o.Ref.prototype[n.symbols.ref]=!0,e.build=function(e){return"value"===(e=Object.assign({},o.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new o.Ref(e)},o.context=function(e,t,r={}){if(e=e.trim(),r){const s=void 0===r.global?"$":r.global;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"global"};const n=void 0===r.local?"#":r.local;if(n!==t&&e.startsWith(n))return{key:e.slice(n.length),type:"local"};const i=void 0===r.root?"/":r.root;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"value",root:!0}}return{key:e,type:"value"}},o.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let r=2;for(;e[r]===t;)++r;return[r-1,r]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,r){if(t)if(r=void 0===r?e.toParent:r,Array.isArray(t))for(const e of t)this.register(e,r);else if(n.isSchema(t))for(const e of t._refs.refs)e.ancestor-r>=0&&this.refs.push({ancestor:e.ancestor-r,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-r>=0&&this.refs.push({ancestor:t.ancestor-r,root:t.root}),i=i||Ir(),i.isTemplate(t)&&this.register(t.refs(),r)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=r(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}}(gr)),gr}function Ir(){return pr||(pr=1,function(e){const t=Mt,r=Ht,s=sr,n=nr,i=wr(),o=lr(),a=yr(),c={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=c.Template=class{constructor(e,s){t("string"==typeof e,"Template source must be a string"),t(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,this._settings=r(s),this._parse()}_parse(){if(!this.source.includes("{"))return;const e=c.encode(this.source),t=c.split(e);let r=!1;const s=[],n=t.shift();n&&s.push(n);for(const e of t){const t="{"!==e[0],n=t?"}":"}}",i=e.indexOf(n);if(-1===i||"{"===e[1]){s.push(`{${c.decode(e)}`);continue}let o=e.slice(t?0:1,i);const a=":"===o[0];a&&(o=o.slice(1));const u=this._ref(c.decode(o),{raw:t,wrapped:a});s.push(u),"string"!=typeof u&&(r=!0);const l=e.slice(i+n.length);l&&s.push(c.decode(l))}r?this._template=s:this.rendered=s.join("")}static date(e,t){return c.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;const t={template:this.source};return this._settings&&(t.options=this._settings),t}static build(e){return new c.Template(e.template,e.options)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[i.symbols.template]}refs(){if(!this._template)return;const e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}resolve(e,t,r,s){return this._template&&1===this._template.length?this._part(this._template[0],e,t,r,s,{}):this.render(e,t,r,s)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,r,n,i={}){if(!this.isDynamic())return this.rendered;const o=[];for(const a of this._template)if("string"==typeof a)o.push(a);else{const u=this._part(a,e,t,r,n,i),l=c.stringify(u,e,t,r,n,i);if(void 0!==l){const e=a.raw||!1===(i.errors&&i.errors.escapeHtml)?l:s(l);o.push(c.wrap(e,a.wrapped&&r.errors.wrap.label))}}return o.join("")}_ref(e,{raw:t,wrapped:r}){const s=[],i=e=>{const t=a.create(e,this._settings);return s.push(t),e=>t.resolve(...e)};try{var o=new n.Parser(e,{reference:i,functions:c.functions,constants:c.constants})}catch(t){throw t.message=`Invalid template variable "${e}" fails due to: ${t.message}`,t}if(o.single){if("reference"===o.single.type){const e=s[0];return{ref:e,raw:t,refs:s,wrapped:r||"local"===e.type&&"label"===e.key}}return c.stringify(o.single.value)}return{formula:o,raw:t,refs:s}}toString(){return this.source}},c.Template.prototype[i.symbols.template]=!0,c.Template.prototype.isImmutable=!0,c.encode=function(e){return e.replace(/\\(\{+)/g,(e,t)=>c.opens.slice(0,t.length)).replace(/\\(\}+)/g,(e,t)=>c.closes.slice(0,t.length))},c.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},c.split=function(e){const t=[];let r="";for(let s=0;s<e.length;++s){const n=e[s];if("{"===n){let n="";for(;s+1<e.length&&"{"===e[s+1];)n+="{",++s;t.push(r),r=n}else r+=n}return t.push(r),t},c.wrap=function(e,t){return t?1===t.length?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e},c.stringify=function(e,t,r,s,n,i={}){const o=typeof e,u=s&&s.errors&&s.errors.wrap||{};let l=!1;if(a.isRef(e)&&e.render&&(l=e.in,e=e.resolve(t,r,s,n,{in:e.in,...i})),null===e)return"null";if("string"===o)return c.wrap(e,i.arrayItems&&u.string);if("number"===o||"function"===o||"symbol"===o)return e.toString();if("object"!==o)return JSON.stringify(e);if(e instanceof Date)return c.Template.date(e,s);if(e instanceof Map){const t=[];for(const[r,s]of e.entries())t.push(`${r.toString()} -> ${s.toString()}`);e=t}if(!Array.isArray(e))return e.toString();const d=[];for(const o of e)d.push(c.stringify(o,t,r,s,n,{arrayItems:!0,...i}));return c.wrap(d.join(", "),!l&&u.array)},c.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},c.functions={if:(e,t,r)=>e?t:r,length:e=>"string"==typeof e?e.length:e&&"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:null,msg(e){const[t,r,s,n,i]=this,a=i.messages;if(!a)return"";const c=o.template(t,a[0],e,r,s)||o.template(t,a[1],e,r,s);return c?c.render(t,r,s,n,i):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}}(tr)),tr.exports}function br(){return fr||(fr=1,function(e){const t=Mt,r=Ht,s=Ir();e.compile=function(e,n){if("string"==typeof e)return t(!n,"Cannot set single message string"),new s(e);if(s.isTemplate(e))return t(!n,"Cannot set single message template"),e;t("object"==typeof e&&!Array.isArray(e),"Invalid message options"),n=n?r(n):{};for(let r in e){const i=e[r];if("root"===r||s.isTemplate(i)){n[r]=i;continue}if("string"==typeof i){n[r]=new s(i);continue}t("object"==typeof i&&!Array.isArray(i),"Invalid message for",r);const o=r;for(r in n[o]=n[o]||{},i){const e=i[r];"root"===r||s.isTemplate(e)?n[o][r]=e:(t("string"==typeof e,"Invalid message for",r,"in",o),n[o][r]=new s(e))}}return n},e.decompile=function(e){const t={};for(let r in e){const n=e[r];if("root"===r){t.root=n;continue}if(s.isTemplate(n)){t[r]=n.describe({compact:!0});continue}const i=r;for(r in t[i]={},n){const e=n[r];"root"!==r?t[i][r]=e.describe({compact:!0}):t[i].root=e}}return t},e.merge=function(n,i){if(!n)return e.compile(i);if(!i)return n;if("string"==typeof i)return new s(i);if(s.isTemplate(i))return i;const o=r(n);for(let e in i){const r=i[e];if("root"===e||s.isTemplate(r)){o[e]=r;continue}if("string"==typeof r){o[e]=new s(r);continue}t("object"==typeof r&&!Array.isArray(r),"Invalid message for",e);const n=e;for(e in o[n]=o[n]||{},r){const i=r[e];"root"===e||s.isTemplate(i)?o[n][e]=i:(t("string"==typeof i,"Invalid message for",e,"in",n),o[n][e]=new s(i))}}return o}}(er)),er}function wr(){return hr||(hr=1,function(e){const t=Mt,r=Bt,s=zt;let n,i;const o={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=s.version,e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},e.assertOptions=function(e,r,s="Options"){t(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");const n=Object.keys(e).filter(e=>!r.includes(e));t(0===n.length,`${s} contain unknown keys: ${n}`)},e.checkPreferences=function(e){i=i||Qt();const t=i.preferences.validate(e);if(t.error)throw new r([t.error.details[0].message])},e.compare=function(e,t,r){switch(r){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}},e.default=function(e,t){return void 0===e?t:e},e.isIsoDate=function(e){return o.isoDate.test(e)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(r,s={}){const n=r&&r[e.symbols.any];return!!n&&(t(s.legacy||n.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(e){return Number.isSafeInteger(e)&&e>=0},e.preferences=function(t,r){n=n||br(),t=t||{},r=r||{};const s=Object.assign({},t,r);return r.errors&&t.errors&&(s.errors=Object.assign({},t.errors,r.errors),s.errors.wrap=Object.assign({},t.errors.wrap,r.errors.wrap)),r.messages&&(s.messages=n.compile(r.messages,t.messages)),delete s[e.symbols.prefs],s},e.tryWithPath=function(e,t,r={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,r.append&&(e.message=`${e.message} (${e.path})`),e}},e.validateArg=function(t,r,{assert:s,message:n}){if(e.isSchema(s)){const e=s.validate(t);if(!e.error)return;return e.error.message}if(!s(t))return r?`${r} ${n}`:n},e.verifyFlat=function(e,r){for(const s of e)t(!Array.isArray(s),"Method no longer accepts array arguments:",r)}}(Xt)),Xt}function vr(){if(mr)return Jt;mr=1;const e=Mt,t=Ht,r=wr(),s={max:1e3,supported:new Set(["undefined","boolean","number","string"])};return Jt.provider={provision:e=>new s.Cache(e)},s.Cache=class{constructor(t={}){r.assertOptions(t,["max"]),e(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||s.max,this._map=new Map,this._list=new s.List}get length(){return this._map.size}set(e,t){if(null!==e&&!s.supported.has(typeof e))return;let r=this._map.get(e);if(r)return r.value=t,void this._list.first(r);r=this._list.unshift({key:e,value:t}),this._map.set(e,r),this._compact()}get(e){const r=this._map.get(e);if(r)return this._list.first(r),t(r.value)}_compact(){if(this._map.size>this._max){const e=this._list.pop();this._map.delete(e.key)}}},s.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){const{next:t,prev:r}=e;return t.prev=r,r&&(r.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}},Jt}var Tr,Er={};function _r(){return Tr||(Tr=1,function(e){const t=Mt,r=wr(),s=yr(),n={};e.schema=function(e,t,s={}){r.assertOptions(s,["appendPath","override"]);try{return n.schema(e,t,s)}catch(e){throw s.appendPath&&void 0!==e.path&&(e.message=`${e.message} (${e.path})`),e}},n.schema=function(e,s,i){t(void 0!==s,"Invalid undefined schema"),Array.isArray(s)&&(t(s.length,"Invalid empty array schema"),1===s.length&&(s=s[0]));const o=(t,...r)=>!1!==i.override?t.valid(e.override,...r):t.valid(...r);if(n.simple(s))return o(e,s);if("function"==typeof s)return e.custom(s);if(t("object"==typeof s,"Invalid schema content:",typeof s),r.isResolvable(s))return o(e,s);if(r.isSchema(s))return s;if(Array.isArray(s)){for(const t of s)if(!n.simple(t))return e.alternatives().try(...s);return o(e,...s)}return s instanceof RegExp?e.string().regex(s):s instanceof Date?o(e.date(),s):(t(Object.getPrototypeOf(s)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(s))},e.ref=function(e,t){return s.isRef(e)?e:s.create(e,t)},e.compile=function(s,i,o={}){r.assertOptions(o,["legacy"]);const a=i&&i[r.symbols.any];if(a)return t(o.legacy||a.version===r.version,"Cannot mix different versions of joi schemas:",a.version,r.version),i;if("object"!=typeof i||!o.legacy)return e.schema(s,i,{appendPath:!0});const c=n.walk(i);return c?c.compile(c.root,i):e.schema(s,i,{appendPath:!0})},n.walk=function(e){if("object"!=typeof e)return null;if(Array.isArray(e)){for(const t of e){const e=n.walk(t);if(e)return e}return null}const s=e[r.symbols.any];if(s)return{root:e[s.root],compile:s.compile};t(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const t in e){const r=n.walk(e[t]);if(r)return r}return null},n.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},e.when=function(i,o,a){if(void 0===a&&(t(o&&"object"==typeof o,"Missing options"),a=o,o=s.create(".")),Array.isArray(a)&&(a={switch:a}),r.assertOptions(a,["is","not","then","otherwise","switch","break"]),r.isSchema(o))return t(void 0===a.is,'"is" can not be used with a schema condition'),t(void 0===a.not,'"not" can not be used with a schema condition'),t(void 0===a.switch,'"switch" can not be used with a schema condition'),n.condition(i,{is:o,then:a.then,otherwise:a.otherwise,break:a.break});if(t(s.isRef(o)||"string"==typeof o,"Invalid condition:",o),t(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let c=a;void 0!==a.not&&(c={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let u=void 0!==c.is?i.$_compile(c.is):i.$_root.invalid(null,!1,0,"").required();return t(void 0!==c.then||void 0!==c.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),t(void 0===c.break||void 0===c.then||void 0===c.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||s.isRef(a.is)||r.isSchema(a.is)||(u=u.required()),n.condition(i,{ref:e.ref(o),is:u,then:c.then,otherwise:c.otherwise,break:c.break})}t(Array.isArray(a.switch),'"switch" must be an array'),t(void 0===a.is,'Cannot combine "switch" with "is"'),t(void 0===a.not,'Cannot combine "switch" with "not"'),t(void 0===a.then,'Cannot combine "switch" with "then"');const c={ref:e.ref(o),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const n=a.switch[e],o=e===a.switch.length-1;r.assertOptions(n,o?["is","then","otherwise"]:["is","then"]),t(void 0!==n.is,'Switch statement missing "is"'),t(void 0!==n.then,'Switch statement missing "then"');const u={is:i.$_compile(n.is),then:i.$_compile(n.then)};if(s.isRef(n.is)||r.isSchema(n.is)||(u.is=u.is.required()),o){t(void 0===a.otherwise||void 0===n.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:n.otherwise;void 0!==e&&(t(void 0===c.break,"Cannot specify both otherwise and break"),u.otherwise=i.$_compile(e))}c.switch.push(u)}return c},n.condition=function(e,t){for(const r of["then","otherwise"])void 0===t[r]?delete t[r]:t[r]=e.$_compile(t[r]);return t}}(Er)),Er}var Ar,Sr={};function Or(){if(Ar)return Sr;Ar=1;const e=Mt,t=Ht,r=wr(),s=br(),n={};return Sr.type=function(i,o){const a=Object.getPrototypeOf(i),c=t(a),u=i._assign(Object.create(c)),l=Object.assign({},o);delete l.base,c._definition=l;const d=a._definition||{};l.messages=s.merge(d.messages,l.messages),l.properties=Object.assign({},d.properties,l.properties),u.type=l.type,l.flags=Object.assign({},d.flags,l.flags);const p=Object.assign({},d.terms);if(l.terms)for(const t in l.terms){const r=l.terms[t];e(void 0===u.$_terms[t],"Invalid term override for",l.type,t),u.$_terms[t]=r.init,p[t]=r}l.terms=p,l.args||(l.args=d.args),l.prepare=n.prepare(l.prepare,d.prepare),l.coerce&&("function"==typeof l.coerce&&(l.coerce={method:l.coerce}),l.coerce.from&&!Array.isArray(l.coerce.from)&&(l.coerce={method:l.coerce.method,from:[].concat(l.coerce.from)})),l.coerce=n.coerce(l.coerce,d.coerce),l.validate=n.validate(l.validate,d.validate);const f=Object.assign({},d.rules);if(l.rules)for(const t in l.rules){const s=l.rules[t];e("object"==typeof s,"Invalid rule definition for",l.type,t);let n=s.method;if(void 0===n&&(n=function(){return this.$_addRule(t)}),n&&(e(!c[t],"Rule conflict in",l.type,t),c[t]=n),e(!f[t],"Rule conflict in",l.type,t),f[t]=s,s.alias){const e=[].concat(s.alias);for(const t of e)c[t]=s.method}s.args&&(s.argsByName=new Map,s.args=s.args.map(t=>("string"==typeof t&&(t={name:t}),e(!s.argsByName.has(t.name),"Duplicated argument name",t.name),r.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),s.argsByName.set(t.name,t),t)))}l.rules=f;const h=Object.assign({},d.modifiers);if(l.modifiers)for(const t in l.modifiers){e(!c[t],"Rule conflict in",l.type,t);const r=l.modifiers[t];e("function"==typeof r,"Invalid modifier definition for",l.type,t);const s=function(e){return this.rule({[t]:e})};c[t]=s,h[t]=r}if(l.modifiers=h,l.overrides){c._super=a,u.$_super={};for(const t in l.overrides)e(a[t],"Cannot override missing",t),l.overrides[t][r.symbols.parent]=a[t],u.$_super[t]=a[t].bind(u);Object.assign(c,l.overrides)}l.cast=Object.assign({},d.cast,l.cast);const m=Object.assign({},d.manifest,l.manifest);return m.build=n.build(l.manifest&&l.manifest.build,d.manifest&&d.manifest.build),l.manifest=m,l.rebuild=n.rebuild(l.rebuild,d.rebuild),u},n.build=function(e,t){return e&&t?function(r,s){return t(e(r,s),s)}:e||t},n.coerce=function(e,t){return e&&t?{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(r,s){let n;if((!t.from||t.from.includes(typeof r))&&(n=t.method(r,s),n)){if(n.errors||void 0===n.value)return n;r=n.value}if(!e.from||e.from.includes(typeof r)){const t=e.method(r,s);if(t)return t}return n}}:e||t},n.prepare=function(e,t){return e&&t?function(r,s){const n=e(r,s);if(n){if(n.errors||void 0===n.value)return n;r=n.value}return t(r,s)||n}:e||t},n.rebuild=function(e,t){return e&&t?function(r){t(r),e(r)}:e||t},n.validate=function(e,t){return e&&t?function(r,s){const n=t(r,s);if(n){if(n.errors&&(!Array.isArray(n.errors)||n.errors.length))return n;r=n.value}return e(r,s)||n}:e||t},Sr}var Nr,Rr={};function Cr(){if(Nr)return Rr;Nr=1;const e=Mt,t=Ht,r=wr(),s=br(),n=yr(),i=Ir();let o;const a={};return Rr.describe=function(n){const i=n._definition,o={type:n.type,flags:{},rules:[]};for(const e in n._flags)"_"!==e[0]&&(o.flags[e]=a.describe(n._flags[e]));Object.keys(o.flags).length||delete o.flags,n._preferences&&(o.preferences=t(n._preferences,{shallow:["messages"]}),delete o.preferences[r.symbols.prefs],o.preferences.messages&&(o.preferences.messages=s.decompile(o.preferences.messages))),n._valids&&(o.allow=n._valids.describe()),n._invalids&&(o.invalid=n._invalids.describe());for(const e of n._rules){if(!1===i.rules[e.name].manifest)continue;const t={name:e.name};for(const r in i.modifiers)void 0!==e[r]&&(t[r]=a.describe(e[r]));if(e.args){t.args={};for(const r in e.args){const s=e.args[r];("options"!==r||Object.keys(s).length)&&(t.args[r]=a.describe(s,{assign:r}))}Object.keys(t.args).length||delete t.args}o.rules.push(t)}o.rules.length||delete o.rules;for(const t in n.$_terms){if("_"===t[0])continue;e(!o[t],"Cannot describe schema due to internal name conflict with",t);const s=n.$_terms[t];if(!s)continue;if(s instanceof Map){s.size&&(o[t]=[...s.entries()]);continue}if(r.isValues(s)){o[t]=s.describe();continue}e(i.terms[t],"Term",t,"missing configuration");const c=i.terms[t].manifest,u="object"==typeof c;if(!s.length&&!u)continue;const l=[];for(const e of s)l.push(a.describe(e));if(u){const{from:e,to:r}=c.mapped;o[t]={};for(const s of l)o[t][s[r]]=s[e];continue}"single"!==c?o[t]=l:(e(1===l.length,"Term",t,"contains more than one item"),o[t]=l[0])}return a.validate(n.$_root,o),o},a.describe=function(e,s={}){if(Array.isArray(e))return e.map(a.describe);if(e===r.symbols.deepDefault)return{special:"deep"};if("object"!=typeof e||null===e)return e;if("options"===s.assign)return t(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return"regex"===s.assign?e.toString():{regex:e.toString()};if(e[r.symbols.literal])return{function:e.literal};if("function"==typeof e.describe)return"ref"===s.assign?e.describe().ref:e.describe();const n={};for(const t in e){const r=e[t];void 0!==r&&(n[t]=a.describe(r,{assign:t}))}return n},Rr.build=function(e,t){return new a.Builder(e).parse(t)},a.Builder=class{constructor(e){this.joi=e}parse(t){a.validate(this.joi,t);let r=this.joi[t.type]()._bare();const s=r._definition;if(t.flags)for(const n in t.flags){const i=s.flags[n]&&s.flags[n].setter||n;e("function"==typeof r[i],"Invalid flag",n,"for type",t.type),r=r[i](this.build(t.flags[n]))}if(t.preferences&&(r=r.preferences(this.build(t.preferences))),t.allow&&(r=r.allow(...this.build(t.allow))),t.invalid&&(r=r.invalid(...this.build(t.invalid))),t.rules)for(const n of t.rules){e("function"==typeof r[n.name],"Invalid rule",n.name,"for type",t.type);const i=[];if(n.args){const r={};for(const e in n.args)r[e]=this.build(n.args[e],{assign:e});const o=Object.keys(r),a=s.rules[n.name].args;if(a){e(o.length<=a.length,"Invalid number of arguments for",t.type,n.name,"(expected up to",a.length,", found",o.length,")");for(const{name:e}of a)i.push(r[e])}else e(1===o.length,"Invalid number of arguments for",t.type,n.name,"(expected up to 1, found",o.length,")"),i.push(r[o[0]])}r=r[n.name](...i);const o={};for(const e in s.modifiers)void 0!==n[e]&&(o[e]=this.build(n[e]));Object.keys(o).length&&(r=r.rule(o))}const n={};for(const r in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(r))continue;e(s.terms[r],"Term",r,"missing configuration");const i=s.terms[r].manifest;if("schema"!==i)if("values"!==i)if("single"!==i)if("object"!=typeof i)n[r]=this.build(t[r]);else{n[r]={};for(const e in t[r]){const s=t[r][e];n[r][e]=this.parse(s)}}else n[r]=this.build(t[r]);else n[r]=t[r].map(e=>this.build(e));else n[r]=t[r].map(e=>this.parse(e))}return t.whens&&(n.whens=t.whens.map(e=>this.build(e))),r=s.manifest.build(r,n),r.$_temp.ruleset=!1,r}build(s,o={}){if(null===s)return null;if(Array.isArray(s))return s.map(e=>this.build(e));if(s instanceof Error)return s;if("options"===o.assign)return t(s);if("regex"===o.assign)return a.regex(s);if("ref"===o.assign)return n.build(s);if("object"!=typeof s)return s;if(1===Object.keys(s).length){if(s.buffer)return e(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(s.buffer,"binary");if(s.function)return{[r.symbols.literal]:!0,literal:s.function};if(s.override)return r.symbols.override;if(s.ref)return n.build(s.ref);if(s.regex)return a.regex(s.regex);if(s.special)return e(["deep"].includes(s.special),"Unknown special value",s.special),r.symbols.deepDefault;if(s.value)return t(s.value)}if(s.type)return this.parse(s);if(s.template)return i.build(s);const c={};for(const e in s)c[e]=this.build(s[e],{assign:e});return c}},a.regex=function(e){const t=e.lastIndexOf("/"),r=e.slice(1,t),s=e.slice(t+1);return new RegExp(r,s)},a.validate=function(e,t){o=o||Qt(),e.assert(t,o.description)},Rr}var kr={};const xr=Gt,Lr={mismatched:null};var Br=function(e,t,r){return r=Object.assign({prototype:!0},r),!!Lr.isDeepEqual(e,t,r,[])};Lr.isDeepEqual=function(e,t,r,s){if(e===t)return 0!==e||1/e==1/t;const n=typeof e;if(n!==typeof t)return!1;if(null===e||null===t)return!1;if("function"===n){if(!r.deepFunction||e.toString()!==t.toString())return!1}else if("object"!==n)return e!=e&&t!=t;const i=Lr.getSharedType(e,t,!!r.prototype);switch(i){case xr.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case xr.promise:return e===t;case xr.regex:return e.toString()===t.toString();case Lr.mismatched:return!1}for(let r=s.length-1;r>=0;--r)if(s[r].isSame(e,t))return!0;s.push(new Lr.SeenEntry(e,t));try{return!!Lr.isDeepEqualObj(i,e,t,r,s)}finally{s.pop()}},Lr.getSharedType=function(e,t,r){if(r)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?Lr.mismatched:xr.getInternalProto(e);const s=xr.getInternalProto(e);return s!==xr.getInternalProto(t)?Lr.mismatched:s},Lr.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},Lr.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},Lr.isSetSimpleEqual=function(e,t){for(const r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0},Lr.isDeepEqualObj=function(e,t,r,s,n){const{isDeepEqual:i,valueOf:o,hasOwnEnumerableProperty:a}=Lr,{keys:c,getOwnPropertySymbols:u}=Object;if(e===xr.array){if(!s.part){if(t.length!==r.length)return!1;for(let e=0;e<t.length;++e)if(!i(t[e],r[e],s,n))return!1;return!0}for(const e of t)for(const t of r)if(i(e,t,s,n))return!0}else if(e===xr.set){if(t.size!==r.size)return!1;if(!Lr.isSetSimpleEqual(t,r)){const e=new Set(Set.prototype.values.call(r));for(const r of Set.prototype.values.call(t)){if(e.delete(r))continue;let t=!1;for(const o of e)if(i(r,o,s,n)){e.delete(o),t=!0;break}if(!t)return!1}}}else if(e===xr.map){if(t.size!==r.size)return!1;for(const[e,o]of Map.prototype.entries.call(t)){if(void 0===o&&!Map.prototype.has.call(r,e))return!1;if(!i(o,Map.prototype.get.call(r,e),s,n))return!1}}else if(e===xr.error&&(t.name!==r.name||t.message!==r.message))return!1;const l=o(t),d=o(r);if((t!==l||r!==d)&&!i(l,d,s,n))return!1;const p=c(t);if(!s.part&&p.length!==c(r).length&&!s.skip)return!1;let f=0;for(const e of p)if(s.skip&&s.skip.includes(e))void 0===r[e]&&++f;else{if(!a(r,e))return!1;if(!i(t[e],r[e],s,n))return!1}if(!s.part&&p.length-f!==c(r).length)return!1;if(!1!==s.symbols){const e=u(t),o=new Set(u(r));for(const c of e){if(!s.skip||!s.skip.includes(c))if(a(t,c)){if(!a(r,c))return!1;if(!i(t[c],r[c],s,n))return!1}else if(a(r,c))return!1;o.delete(c)}for(const e of o)if(a(r,e))return!1}return!0},Lr.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}};var Pr,Mr={};function Dr(){if(Pr)return kr;Pr=1;const e=Br,t=Mr,r=lr(),s={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};return kr.setup=function(e){const t=function(){return e._tracer=e._tracer||new s.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}},kr.location=function(e){return e.$_setFlag("_tracerLocation",t.location(2))},s.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){const r=this._schemas.get(e);if(r)return r.store;const n=new s.Store(e),{filename:i,line:o}=e._flags._tracerLocation||t.location(5);return this._schemas.set(e,{filename:i,line:o,store:n}),n}_combine(e,t){for(const{store:r}of this._schemas.values())r._combine(e,t)}report(e){const t=[];for(const{filename:r,line:n,store:i}of this._schemas.values()){if(e&&e!==r)continue;const o=[],a=[];for(const[e,t]of i._sources.entries()){if(s.sub(t.paths,a))continue;if(!t.entry){o.push({status:"never reached",paths:[...t.paths]}),a.push(...t.paths);continue}for(const r of["valid","invalid"]){const s=e[`_${r}s`];if(!s)continue;const n=new Set(s._values),i=new Set(s._refs);for(const{value:e,ref:s}of t[r])n.delete(e),i.delete(s);(n.size||i.size)&&o.push({status:[...n,...[...i].map(e=>e.display)],rule:`${r}s`})}const r=e._rules.map(e=>e.name);for(const t of["default","failover"])void 0!==e._flags[t]&&r.push(t);for(const e of r){const r=s.labels[t.rule[e]||0];if(r){const s={rule:e,status:r};t.paths.size&&(s.paths=[...t.paths]),o.push(s)}}}o.length&&t.push({filename:r,line:n,missing:o,severity:"error",message:`Schema missing tests for ${o.map(s.message).join(", ")}`})}return t.length?t:null}},s.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,r,s){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:r,result:s,path:e.path})}entry(e,t){s.debug(t,{type:"entry"}),this._record(e,e=>{e.entry=!0})}filter(e,t,r,n){s.debug(t,{type:r,...n}),this._record(e,e=>{e[r].add(n)})}log(e,t,r,n,i){s.debug(t,{type:r,name:n,result:"full"===i?"pass":i}),this._record(e,e=>{e[r][n]=e[r][n]||0,e[r][n]|=s.codes[i]})}resolve(e,t,r){if(!e.mainstay.debug)return;const s={type:"resolve",ref:t.display,to:r,path:e.path};e.mainstay.debug.push(s)}value(t,r,s,n,i){if(!t.mainstay.debug||e(s,n))return;const o={type:"value",by:r,from:s,to:n,path:t.path};i&&(o.name=i),t.mainstay.debug.push(o)}_record(e,t){const r=this._sources.get(e);if(r)return void t(r);const s=this._combos.get(e);for(const e of s)this._record(e,t)}_scan(e,t){const r=t||[];let n=this._sources.get(e);n||(n={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,n)),r.length&&n.paths.add(r);e.$_modify({each:(e,t)=>{const n=s.id(e,t);this._scan(e,r.concat(n))},ref:!1})}_combine(e,t){this._combos.set(e,t)}},s.message=function(e){return`${e.paths?r.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`},s.id=function(e,{source:t,name:r,path:s,key:n}){return e._flags.id?e._flags.id:n||(r=`@${r}`,"terms"===t?[r,s[Math.min(s.length-1,1)]]:r)},s.sub=function(t,r){for(const s of t)for(const t of r)if(e(s.slice(0,t.length),t))return!0;return!1},s.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))},kr}Mr.location=function(e=0){const t=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const r={};Error.captureStackTrace(r,this);const s=r.stack[e+1];return Error.prepareStackTrace=t,{filename:s.getFileName(),line:s.getLineNumber()}};const $r=Mt,Ur=Ht,jr=Ft,Gr={};var Fr,Vr=Gr.merge=function(e,t,r){if($r(e&&"object"==typeof e,"Invalid target value: must be an object"),$r(null==t||"object"==typeof t,"Invalid source value: must be null, undefined, or an object"),!t)return e;if(r=Object.assign({nullOverride:!0,mergeArrays:!0},r),Array.isArray(t)){$r(Array.isArray(e),"Cannot merge array onto an object"),r.mergeArrays||(e.length=0);for(let s=0;s<t.length;++s)e.push(Ur(t[s],{symbols:r.symbols}));return e}const s=jr.keys(t,r);for(let n=0;n<s.length;++n){const i=s[n];if("__proto__"===i||!Object.prototype.propertyIsEnumerable.call(t,i))continue;const o=t[i];if(o&&"object"==typeof o){if(e[i]===o)continue;!e[i]||"object"!=typeof e[i]||Array.isArray(e[i])!==Array.isArray(o)||o instanceof Date||Buffer&&Buffer.isBuffer(o)||o instanceof RegExp?e[i]=Ur(o,{symbols:r.symbols}):Gr.merge(e[i],o,r)}else(null!=o||r.nullOverride)&&(e[i]=o)}return e},Kr={};var qr,Wr,Hr,Zr,Jr,Xr,zr,Yr,Qr,es,ts,rs,ss,ns,is,os,as,cs={},us=function(){};function ls(){return Hr||(Hr=1,function(e){const t=Mt,r=Ht,s=us,n=Ut,i=wr(),o=lr(),a=function(){if(Wr)return qr;Wr=1;const e=Ht,t=Ut,r=wr(),s={value:Symbol("value")};return qr=s.State=class{constructor(e,t,r){this.path=e,this.ancestors=t,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(e,t=null,r=null){const n=new s.State(e,t,this);return r&&n.schemas&&(n.schemas=[s.schemas(r),...n.schemas]),n}nest(e,t){const r=new s.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[s.schemas(e),...r.schemas],r.debug=t,r}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new s.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=e(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}},s.schemas=function(e){return r.isSchema(e)?{schema:e}:e},s.Shadow=class{constructor(){this._values=null}set(e,t,r){if(!e.length)return;if("strip"===r&&"number"==typeof e[e.length-1])return;this._values=this._values||new Map;let n=this._values;for(let t=0;t<e.length;++t){const r=e[t];let s=n.get(r);s||(s=new Map,n.set(r,s)),n=s}n[s.value]=t}get(e){const t=this.node(e);if(t)return t[s.value]}node(e){if(this._values)return t(this._values,e,{iterables:!0})}override(e,r){if(!this._values)return;const s=e.slice(0,-1),n=e[e.length-1],i=t(this._values,s,{iterables:!0});r?i.set(n,r):i&&i.delete(n)}},qr}(),c={result:Symbol("result")};e.entry=function(e,r,s){let n=i.defaults;s&&(t(void 0===s.warnings,"Cannot override warnings preference in synchronous validation"),t(void 0===s.artifacts,"Cannot override artifacts preference in synchronous validation"),n=i.preferences(i.defaults,s));const a=c.entry(e,r,n);t(!a.mainstay.externals.length,"Schema with external rules must use validateAsync()");const u={value:a.value};return a.error&&(u.error=a.error),a.mainstay.warnings.length&&(u.warning=o.details(a.mainstay.warnings)),a.mainstay.debug&&(u.debug=a.mainstay.debug),a.mainstay.artifacts&&(u.artifacts=a.mainstay.artifacts),u},e.entryAsync=async function(e,t,r){let s=i.defaults;r&&(s=i.preferences(i.defaults,r));const a=c.entry(e,t,s),u=a.mainstay;if(a.error)throw u.debug&&(a.error.debug=u.debug),a.error;if(u.externals.length){let t=a.value;const l=[];for(const a of u.externals){const d=a.state.path,p="link"===a.schema.type?u.links.get(a.schema):null;let f,h,m=t;const g=d.length?[t]:[],y=d.length?n(e,d):e;if(d.length){f=d[d.length-1];let e=t;for(const t of d.slice(0,-1))e=e[t],g.unshift(e);h=g[0],m=h[f]}try{const e=(e,t)=>(p||a.schema).$_createError(e,m,t,a.state,s),n=await a.method(m,{schema:a.schema,linked:p,state:a.state,prefs:r,original:y,error:e,errorsArray:c.errorsArray,warn:(e,t)=>u.warnings.push((p||a.schema).$_createError(e,m,t,a.state,s)),message:(e,t)=>(p||a.schema).$_createError("external",m,t,a.state,s,{messages:e})});if(void 0===n||n===m)continue;if(n instanceof o.Report){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(n),s.abortEarly)break;continue}if(Array.isArray(n)&&n[i.symbols.errors]){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(...n),s.abortEarly)break;continue}h?(u.tracer.value(a.state,"rule",m,n,"external"),h[f]=n):(u.tracer.value(a.state,"rule",t,n,"external"),t=n)}catch(e){throw s.errors.label&&(e.message+=` (${a.label})`),e}}if(a.value=t,l.length)throw a.error=o.process(l,e,s),u.debug&&(a.error.debug=u.debug),a.error}if(!s.warnings&&!s.debug&&!s.artifacts)return a.value;const l={value:a.value};return u.warnings.length&&(l.warning=o.details(u.warnings)),u.debug&&(l.debug=u.debug),u.artifacts&&(l.artifacts=u.artifacts),l},c.Mainstay=class{constructor(e,t,r){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=r,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}},c.entry=function(t,r,s){const{tracer:n,cleanup:i}=c.tracer(r,s),u=s.debug?[]:null,l=r._ids._schemaChain?new Map:null,d=new c.Mainstay(n,u,l),p=r._ids._schemaChain?[{schema:r}]:null,f=new a([],[],{mainstay:d,schemas:p}),h=e.validate(t,r,f,s);i&&r.$_root.untrace();const m=o.process(h.errors,t,s);return{value:h.value,error:m,mainstay:d}},c.tracer=function(e,r){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:r.debug?(t(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:c.ignore}},e.validate=function(e,t,r,s,n={}){if(t.$_terms.whens&&(t=t._generate(e,r,s).schema),t._preferences&&(s=c.prefs(t,s)),t._cache&&s.cache){const s=t._cache.get(e);if(r.mainstay.tracer.debug(r,"validate","cached",!!s),s)return s}const o=(n,i,o)=>t.$_createError(n,e,i,o||r,s),a={original:e,prefs:s,schema:t,state:r,error:o,errorsArray:c.errorsArray,warn:(e,t,s)=>r.mainstay.warnings.push(o(e,t,s)),message:(n,i)=>t.$_createError("custom",e,i,r,s,{messages:n})};r.mainstay.tracer.entry(t,r);const u=t._definition;if(u.prepare&&void 0!==e&&s.convert){const t=u.prepare(e,a);if(t){if(r.mainstay.tracer.value(r,"prepare",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}if(u.coerce&&void 0!==e&&s.convert&&(!u.coerce.from||u.coerce.from.includes(typeof e))){const t=u.coerce.method(e,a);if(t){if(r.mainstay.tracer.value(r,"coerced",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}const l=t._flags.empty;l&&l.$_match(c.trim(e,t),r.nest(l),i.defaults)&&(r.mainstay.tracer.value(r,"empty",e,void 0),e=void 0);const d=n.presence||t._flags.presence||(t._flags._endedSwitch?null:s.presence);if(void 0===e){if("forbidden"===d)return c.finalize(e,null,a);if("required"===d)return c.finalize(e,[t.$_createError("any.required",e,null,r,s)],a);if("optional"===d){if(t._flags.default!==i.symbols.deepDefault)return c.finalize(e,null,a);r.mainstay.tracer.value(r,"default",e,{}),e={}}}else if("forbidden"===d)return c.finalize(e,[t.$_createError("any.unknown",e,null,r,s)],a);const p=[];if(t._valids){const n=t._valids.get(e,r,s,t._flags.insensitive);if(n)return s.convert&&(r.mainstay.tracer.value(r,"valids",e,n.value),e=n.value),r.mainstay.tracer.filter(t,r,"valid",n),c.finalize(e,null,a);if(t._flags.only){const n=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},r,s);if(s.abortEarly)return c.finalize(e,[n],a);p.push(n)}}if(t._invalids){const n=t._invalids.get(e,r,s,t._flags.insensitive);if(n){r.mainstay.tracer.filter(t,r,"invalid",n);const i=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},r,s);if(s.abortEarly)return c.finalize(e,[i],a);p.push(i)}}if(u.validate){const t=u.validate(e,a);if(t&&(r.mainstay.tracer.value(r,"base",e,t.value),e=t.value,t.errors)){if(!Array.isArray(t.errors))return p.push(t.errors),c.finalize(e,p,a);if(t.errors.length)return p.push(...t.errors),c.finalize(e,p,a)}}return t._rules.length?c.rules(e,p,a):c.finalize(e,p,a)},c.rules=function(e,t,r){const{schema:s,state:n,prefs:o}=r;for(const a of s._rules){const u=s._definition.rules[a.method];if(u.convert&&o.convert){n.mainstay.tracer.log(s,n,"rule",a.name,"full");continue}let l,d=a.args;if(a._resolve.length){d=Object.assign({},d);for(const t of a._resolve){const r=u.argsByName.get(t),a=d[t].resolve(e,n,o),c=r.normalize?r.normalize(a):a,p=i.validateArg(c,null,r);if(p){l=s.$_createError("any.ref",a,{arg:t,ref:d[t],reason:p},n,o);break}d[t]=c}}l=l||u.validate(e,r,d,a);const p=c.rule(l,a);if(p.errors){if(n.mainstay.tracer.log(s,n,"rule",a.name,"error"),a.warn){n.mainstay.warnings.push(...p.errors);continue}if(o.abortEarly)return c.finalize(e,p.errors,r);t.push(...p.errors)}else n.mainstay.tracer.log(s,n,"rule",a.name,"pass"),n.mainstay.tracer.value(n,"rule",e,p.value,a.name),e=p.value}return c.finalize(e,t,r)},c.rule=function(e,t){return e instanceof o.Report?(c.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[i.symbols.errors]?(e.forEach(e=>c.error(e,t)),{errors:e,value:null}):{errors:null,value:e}},c.error=function(e,t){return t.message&&e._setTemplate(t.message),e},c.finalize=function(e,r,s){r=r||[];const{schema:n,state:i,prefs:a}=s;if(r.length){const t=c.default("failover",void 0,r,s);void 0!==t&&(i.mainstay.tracer.value(i,"failover",e,t),e=t,r=[])}if(r.length&&n._flags.error)if("function"==typeof n._flags.error){r=n._flags.error(r),Array.isArray(r)||(r=[r]);for(const e of r)t(e instanceof Error||e instanceof o.Report,"error() must return an Error object")}else r=[n._flags.error];if(void 0===e){const t=c.default("default",e,r,s);i.mainstay.tracer.value(i,"default",e,t),e=t}if(n._flags.cast&&void 0!==e){const t=n._definition.cast[n._flags.cast];if(t.from(e)){const r=t.to(e,s);i.mainstay.tracer.value(i,"cast",e,r,n._flags.cast),e=r}}if(n.$_terms.externals&&a.externals&&!1!==a._externals)for(const{method:e}of n.$_terms.externals)i.mainstay.externals.push({method:e,schema:n,state:i,label:o.label(n._flags,i,a)});const u={value:e,errors:r.length?r:null};return n._flags.result&&(u.value="strip"===n._flags.result?void 0:s.original,i.mainstay.tracer.value(i,n._flags.result,e,u.value),i.shadow(e,n._flags.result)),n._cache&&!1!==a.cache&&!n._refs.length&&n._cache.set(s.original,u),void 0===e||u.errors||void 0===n._flags.artifact||(i.mainstay.artifacts=i.mainstay.artifacts||new Map,i.mainstay.artifacts.has(n._flags.artifact)||i.mainstay.artifacts.set(n._flags.artifact,[]),i.mainstay.artifacts.get(n._flags.artifact).push(i.path)),u},c.prefs=function(e,t){const r=t===i.defaults;return r&&e._preferences[i.symbols.prefs]?e._preferences[i.symbols.prefs]:(t=i.preferences(t,e._preferences),r&&(e._preferences[i.symbols.prefs]=t),t)},c.default=function(e,t,s,n){const{schema:o,state:a,prefs:c}=n,u=o._flags[e];if(c.noDefaults||void 0===u)return t;if(a.mainstay.tracer.log(o,a,"rule",e,"full"),!u)return u;if("function"==typeof u){const t=u.length?[r(a.ancestors[0]),n]:[];try{return u(...t)}catch(t){return void s.push(o.$_createError(`any.${e}`,null,{error:t},a,c))}}return"object"!=typeof u?u:u[i.symbols.literal]?u.literal:i.isResolvable(u)?u.resolve(t,a,c):r(u)},c.trim=function(e,t){if("string"!=typeof e)return e;const r=t.$_getRule("trim");return r&&r.args.enabled?e.trim():e},c.ignore={active:!1,debug:s,entry:s,filter:s,log:s,resolve:s,value:s},c.errorsArray=function(){const e=[];return e[i.symbols.errors]=!0,e}}(cs)),cs}function ds(){if(Jr)return Zr;Jr=1;const e=Mt,t=Br,r=wr(),s={};return Zr=s.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=s.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){r.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,r){if(e=e||new s.Values,t){if(t._override)return t.clone();for(const r of[...t._values,...t._refs])e.add(r)}if(r)for(const t of[...r._values,...r._refs])e.remove(t);return e.length?e:null}remove(e){r.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,r,s){return!!this.get(e,t,r,s)}get(e,r,s,n){if(!this.length)return!1;if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&n){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(!this._refs.size&&"object"!=typeof e)return!1;if("object"==typeof e)for(const r of this._values)if(t(r,e))return{value:r};if(r)for(const i of this._refs){const o=i.resolve(e,r,s,null,{in:!0});if(void 0===o)continue;const a=i.in&&"object"==typeof o?Array.isArray(o)?o:Object.keys(o):[o];for(const r of a)if(typeof r==typeof e)if(n&&e&&"string"==typeof e){if(r.toLowerCase()===e.toLowerCase())return{value:r,ref:i}}else if(t(r,e))return{value:r,ref:i}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){const e=new s.Values(this._values,this._refs);return e._override=this._override,e}concat(t){e(!t._override,"Cannot concat override set of values");const r=new s.Values([...this._values,...t._values],[...this._refs,...t._refs]);return r._override=this._override,r}describe(){const e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const t of this._refs.values())e.push(t.describe());return e}},s.Values.prototype[r.symbols.values]=!0,s.Values.prototype.slice=s.Values.prototype.clone,s.lowercases=function(e){const t=new Map;if(e)for(const r of e)"string"==typeof r&&t.set(r.toLowerCase(),r);return t},Zr}function ps(){if(zr)return Xr;zr=1;const e=Mt,t=Ht,r=Br,s=Vr,n=vr(),i=wr(),o=_r(),a=lr(),c=Or(),u=Cr(),l=br(),d=(Fr||(Fr=1,function(e){const t=Mt,r=wr(),s=yr(),n={};e.Ids=n.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const e=new n.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(const[r,s]of e._byId.entries())t(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,s);for(const[r,s]of e._byKey.entries())t(!this._byId.has(r),"Schema key conflicts with existing id:",r),this._byKey.set(r,s)}fork(e,s,i){const o=this._collect(e);o.push({schema:i});const a=o.shift();let c={id:a.id,schema:s(a.schema)};t(r.isSchema(c.schema),"adjuster function failed to return a joi schema type");for(const e of o)c={id:e.id,schema:n.fork(e.schema,c.id,c.schema)};return c.schema}labels(e,t=[]){const r=e[0],s=this._get(r);if(!s)return[...t,...e].join(".");const n=e.slice(1);return t=[...t,s.schema._flags.label||r],n.length?s.schema._ids.labels(n,t):t.join(".")}reach(e,r=[]){const s=e[0],n=this._get(s);t(n,"Schema does not contain path",[...r,...e].join("."));const i=e.slice(1);return i.length?n.schema._ids.reach(i,[...r,s]):n.schema}register(e,{key:s}={}){if(!e||!r.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);const n=e._flags.id;if(n){const r=this._byId.get(n);t(!r||r.schema===e,"Cannot add different schemas with the same id:",n),t(!this._byKey.has(n),"Schema id conflicts with existing key:",n),this._byId.set(n,{schema:e,id:n})}s&&(t(!this._byKey.has(s),"Schema already contains key:",s),t(!this._byId.has(s),"Schema key conflicts with existing id:",s),this._byKey.set(s,{schema:e,id:s}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,r=[],s=[]){const n=e[0],i=this._get(n);t(i,"Schema does not contain path",[...r,...e].join(".")),s=[i,...s];const o=e.slice(1);return o.length?i.schema._ids._collect(o,[...r,n],s):s}_get(e){return this._byId.get(e)||this._byKey.get(e)}},n.fork=function(t,r,s){const n=e.schema(t,{each:(e,{key:t})=>{if(r===(e._flags.id||t))return s},ref:!1});return n?n.$_mutateRebuild():t},e.schema=function(e,t){let r;for(const s in e._flags){if("_"===s[0])continue;const i=n.scan(e._flags[s],{source:"flags",name:s},t);void 0!==i&&(r=r||e.clone(),r._flags[s]=i)}for(let s=0;s<e._rules.length;++s){const i=e._rules[s],o=n.scan(i.args,{source:"rules",name:i.name},t);if(void 0!==o){r=r||e.clone();const t=Object.assign({},i);t.args=o,r._rules[s]=t,r._singleRules.get(i.name)===i&&r._singleRules.set(i.name,t)}}for(const s in e.$_terms){if("_"===s[0])continue;const i=n.scan(e.$_terms[s],{source:"terms",name:s},t);void 0!==i&&(r=r||e.clone(),r.$_terms[s]=i)}return r},n.scan=function(e,t,i,o,a){const c=o||[];if(null===e||"object"!=typeof e)return;let u;if(Array.isArray(e)){for(let r=0;r<e.length;++r){const s="terms"===t.source&&"keys"===t.name&&e[r].key,o=n.scan(e[r],t,i,[r,...c],s);void 0!==o&&(u=u||e.slice(),u[r]=o)}return u}if(!1!==i.schema&&r.isSchema(e)||!1!==i.ref&&s.isRef(e)){const r=i.each(e,{...t,path:c,key:a});if(r===e)return;return r}for(const r in e){if("_"===r[0])continue;const s=n.scan(e[r],t,i,[r,...c],a);void 0!==s&&(u=u||Object.assign({},e),u[r]=s)}return u}}(Kr)),Kr),p=yr(),f=Dr(),h=ls(),m=ds(),g={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new d.Ids,this._preferences=null,this._refs=new p.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return e("function"==typeof u.describe,"Manifest functionality disabled"),u.describe(this)}allow(...e){return i.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(t){e(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),e(!this._inRuleset(),"Cannot set alterations inside a ruleset");const r=this.clone();r.$_terms.alterations=r.$_terms.alterations||[];for(const s in t){const n=t[s];e("function"==typeof n,"Alteration adjuster for",s,"must be a function"),r.$_terms.alterations.push({target:s,adjuster:n})}return r.$_temp.ruleset=!1,r}artifact(t){return e(void 0!==t,"Artifact cannot be undefined"),e(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return e(!1===t||"string"==typeof t,"Invalid to value"),e(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(e,t){return this._default("default",e,t)}description(t){return e(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(e){const t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(t){return e(t,"Missing error"),e(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,r={}){return e(void 0!==t,"Missing example"),i.assertOptions(r,["override"]),this._inner("examples",t,{single:!0,override:r.override})}external(t,r){return"object"==typeof t&&(e(!r,"Cannot combine options with description"),r=t.description,t=t.method),e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this._inner("externals",{method:t,description:r},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(t){return t?(e("string"==typeof t,"id must be a non-empty string"),e(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(t){return e(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return e(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){e(t.length,"Missing notes");for(const r of t)e(r&&"string"==typeof r,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return e("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){e(t,"Missing preferences"),e(void 0===t.context,"Cannot override context"),e(void 0===t.externals,"Cannot override externals"),e(void 0===t.warnings,"Cannot override warnings"),e(void 0===t.debug,"Cannot override debug"),i.checkPreferences(t);const r=this.clone();return r._preferences=i.preferences(r._preferences,t),r}presence(t){return e(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(t){return e(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(e){const t=this.clone(),r=void 0!==e&&!e;return t._preferences=i.preferences(t._preferences,{convert:r}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...t){e(t.length,"Missing tags");for(const r of t)e(r&&"string"==typeof r,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return e(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...e){i.verifyFlat(e,"valid");const t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(t,r){const s=this.clone();s.$_terms.whens||(s.$_terms.whens=[]);const n=o.when(s,t,r);if(!["any","link"].includes(s.type)){const t=n.is?[n]:n.switch;for(const r of t)e(!r.then||"any"===r.then.type||r.then.type===s.type,"Cannot combine",s.type,"with",r.then&&r.then.type),e(!r.otherwise||"any"===r.otherwise.type||r.otherwise.type===s.type,"Cannot combine",s.type,"with",r.otherwise&&r.otherwise.type)}return s.$_terms.whens.push(n),s.$_mutateRebuild()}cache(t){e(!this._inRuleset(),"Cannot set caching inside a ruleset"),e(!this._cache,"Cannot override schema cache"),e(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");const r=this.clone();return r._cache=t||n.provider.provision(),r.$_temp.ruleset=!1,r}clone(){const e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(t){e(i.isSchema(t),"Invalid schema object"),e("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),e(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),e(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let r=this.clone();if("any"===this.type&&"any"!==t.type){const e=t.clone();for(const t of Object.keys(r))"type"!==t&&(e[t]=r[t]);r=e}r._ids.concat(t._ids),r._refs.register(t,p.toSibling),r._preferences=r._preferences?i.preferences(r._preferences,t._preferences):t._preferences,r._valids=m.merge(r._valids,t._valids,t._invalids),r._invalids=m.merge(r._invalids,t._invalids,t._valids);for(const e of t._singleRules.keys())r._singleRules.has(e)&&(r._rules=r._rules.filter(t=>t.keep||t.name!==e),r._singleRules.delete(e));for(const e of t._rules)t._definition.rules[e.method].multi||r._singleRules.set(e.name,e),r._rules.push(e);if(r._flags.empty&&t._flags.empty){r._flags.empty=r._flags.empty.concat(t._flags.empty);const e=Object.assign({},t._flags);delete e.empty,s(r._flags,e)}else if(t._flags.empty){r._flags.empty=t._flags.empty;const e=Object.assign({},t._flags);delete e.empty,s(r._flags,e)}else s(r._flags,t._flags);for(const e in t.$_terms){const s=t.$_terms[e];s?r.$_terms[e]?r.$_terms[e]=r.$_terms[e].concat(s):r.$_terms[e]=s.slice():r.$_terms[e]||(r.$_terms[e]=s)}return this.$_root._tracer&&this.$_root._tracer._combine(r,[this,t]),r.$_mutateRebuild()}extend(t){return e(!t.base,"Cannot extend type with another base"),c.type(this,t)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(t,r){e(!this._inRuleset(),"Cannot fork inside a ruleset");let s=this;for(let e of[].concat(t))e=Array.isArray(e)?e:e.split("."),s=s._ids.fork(e,r,s);return s.$_temp.ruleset=!1,s}rule(r){const s=this._definition;i.assertOptions(r,Object.keys(s.modifiers)),e(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const n=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;e(n>=0&&n<this._rules.length,"Cannot apply rules to empty ruleset");const o=this.clone();for(let i=n;i<o._rules.length;++i){const n=o._rules[i],a=t(n);for(const t in r)s.modifiers[t](a,r[t]),e(a.name===n.name,"Cannot change rule name");o._rules[i]=a,o._singleRules.get(a.name)===n&&o._singleRules.set(a.name,a)}return o.$_temp.ruleset=!1,o.$_mutateRebuild()}get ruleset(){e(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),e(!this._inRuleset(),"Cannot tailor inside a ruleset");let r=this;if(this.$_terms.alterations)for(const{target:s,adjuster:n}of this.$_terms.alterations)t.includes(s)&&(r=n(r),e(i.isSchema(r),"Alteration adjuster for",s,"failed to return a schema object"));return r=r.$_modify({each:e=>e.tailor(t),ref:!1}),r.$_temp.ruleset=!1,r.$_mutateRebuild()}tracer(){return f.location?f.location(this):this}validate(e,t){return h.entry(e,this,t)}validateAsync(e,t){return h.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),e(t&&"object"==typeof t,"Invalid options"),e(t.name&&"string"==typeof t.name,"Invalid rule name");for(const r in t)e("_"!==r[0],"Cannot set private rule properties");const r=Object.assign({},t);r._resolve=[],r.method=r.method||r.name;const s=this._definition.rules[r.method],n=r.args;e(s,"Unknown rule",r.method);const o=this.clone();if(n){e(1===Object.keys(n).length||Object.keys(n).length===this._definition.rules[r.name].args.length,"Invalid rule definition for",this.type,r.name);for(const t in n){let a=n[t];if(s.argsByName){const c=s.argsByName.get(t);if(c.ref&&i.isResolvable(a))r._resolve.push(t),o.$_mutateRegister(a);else if(c.normalize&&(a=c.normalize(a),n[t]=a),c.assert){const r=i.validateArg(a,t,c);e(!r,r,"or reference")}}void 0!==a?n[t]=a:delete n[t]}}return s.multi||(o._ruleRemove(r.name,{clone:!1}),o._singleRules.set(r.name,r)),!1===o.$_temp.ruleset&&(o.$_temp.ruleset=null),s.priority?o._rules.unshift(r):o._rules.push(r),o}$_compile(e,t){return o.schema(this.$_root,e,t)}$_createError(e,t,r,s,n,i={}){const o=!1!==i.flags?this._flags:{},c=i.messages?l.merge(this._definition.messages,i.messages):this._definition.messages;return new a.Report(e,t,r,o,c,s,n)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,r,s){(r=Object.assign({},r)).abortEarly=!0,r._externals=!1,t.snapshot();const n=!h.validate(e,this,t,r,s).errors;return t.restore(),n}$_modify(e){return i.assertOptions(e,["each","once","ref","schema"]),d.schema(this,e)||this}$_mutateRebuild(){e(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();return this.$_modify({each:(e,{source:t,name:r,path:s,key:n})=>{const i=this._definition[t][r]&&this._definition[t][r].register;!1!==i&&this.$_mutateRegister(e,{family:i,key:n})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:r}={}){this._refs.register(e,t),this._ids.register(e,{key:r})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,s,n={}){e("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const i=this._definition.flags[t]||{};if(r(s,i.default)&&(s=void 0),r(s,this._flags[t]))return this;const o=!1!==n.clone?this.clone():this;return void 0!==s?(o._flags[t]=s,o.$_mutateRegister(s)):delete o._flags[t],"_"!==t[0]&&(o.$_temp.ruleset=!1),o}$_parent(e,...t){return this[e][i.symbols.parent].call(this,...t)}$_validate(e,t,r){return h.validate(e,this,t,r)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=t(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){const e=this.clone();e._reset();const t=e._definition.terms;for(const r in t){const s=t[r];e.$_terms[r]=s.init}return e.$_mutateRebuild()}_default(t,r,s={}){i.assertOptions(s,"literal"),e(void 0!==r,"Missing",t,"value"),e("function"==typeof r||!s.literal,"Only function value supports literal option"),"function"==typeof r&&s.literal&&(r={[i.symbols.literal]:!0,literal:r});return this.$_setFlag(t,r)}_generate(e,t,r){if(!this.$_terms.whens)return{schema:this};const s=[],n=[];for(let i=0;i<this.$_terms.whens.length;++i){const o=this.$_terms.whens[i];if(o.concat){s.push(o.concat),n.push(`${i}.concat`);continue}const a=o.ref?o.ref.resolve(e,t,r):e,c=o.is?[o]:o.switch,u=n.length;for(let u=0;u<c.length;++u){const{is:l,then:d,otherwise:p}=c[u],f=`${i}${o.switch?"."+u:""}`;if(l.$_match(a,t.nest(l,`${f}.is`),r)){if(d){const i=t.localize([...t.path,`${f}.then`],t.ancestors,t.schemas),{schema:o,id:a}=d._generate(e,i,r);s.push(o),n.push(`${f}.then${a?`(${a})`:""}`);break}}else if(p){const i=t.localize([...t.path,`${f}.otherwise`],t.ancestors,t.schemas),{schema:o,id:a}=p._generate(e,i,r);s.push(o),n.push(`${f}.otherwise${a?`(${a})`:""}`);break}}if(o.break&&n.length>u)break}const i=n.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",i),!i)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[i])return{schema:this.$_temp.whens[i],id:i};let o=this;this._definition.generate&&(o=this._definition.generate(this,e,t,r));for(const e of s)o=o.concat(e);return this.$_root._tracer&&this.$_root._tracer._combine(o,[this,...s]),this.$_temp.whens[i]=o,{schema:o,id:i}}_inner(t,r,s={}){e(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);const n=this.clone();return n.$_terms[t]&&!s.override||(n.$_terms[t]=[]),s.single?n.$_terms[t].push(r):n.$_terms[t].push(...r),n.$_temp.ruleset=!1,n}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;const r=!1!==t.clone?this.clone():this;r._singleRules.delete(e);const s=[];for(let t=0;t<r._rules.length;++t){const n=r._rules[t];n.name!==e||n.keep?s.push(n):r._inRuleset()&&t<r.$_temp.ruleset&&--r.$_temp.ruleset}return r._rules=s,r}_values(t,r){i.verifyFlat(t,r.slice(1,-1));const s=this.clone(),n=t[0]===i.symbols.override;if(n&&(t=t.slice(1)),!s[r]&&t.length?s[r]=new m:n&&(s[r]=t.length?new m:null,s.$_mutateRebuild()),!s[r])return s;n&&s[r].override();for(const n of t){e(void 0!==n,"Cannot call allow/valid/invalid with undefined"),e(n!==i.symbols.override,"Override must be the first value");const t="_invalids"===r?"_valids":"_invalids";s[t]&&(s[t].remove(n),s[t].length||(e("_valids"===r||!s._flags.only,"Setting invalid value",n,"leaves schema rejecting all values due to previous valid rule"),s[t]=null)),s[r].add(n,s._refs)}return s}}};return g.Base.prototype[i.symbols.any]={version:i.version,compile:o.compile,root:"$_root"},g.Base.prototype.isImmutable=!0,g.Base.prototype.deny=g.Base.prototype.invalid,g.Base.prototype.disallow=g.Base.prototype.invalid,g.Base.prototype.equal=g.Base.prototype.valid,g.Base.prototype.exist=g.Base.prototype.required,g.Base.prototype.not=g.Base.prototype.invalid,g.Base.prototype.options=g.Base.prototype.prefs,g.Base.prototype.preferences=g.Base.prototype.prefs,Xr=new g.Base}function fs(){if(Qr)return Yr;Qr=1;const e=Mt,t=ps(),r=wr(),s=br();return Yr=t.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,r){return e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:r}})},validate(e,t,{method:r}){try{return r(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(t){e(r.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const s=this.clone();return s.$_terms.shared=s.$_terms.shared||[],s.$_terms.shared.push(t),s.$_mutateRegister(t),s}},warning:{method(t,r){return e(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:r},warn:!0})},validate:(e,t,{code:r,local:s})=>t.error(r,s),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=s.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const r in t){const s=t[r];if(["examples","externals","metas","notes","tags"].includes(r))for(const t of s)e=e[r.slice(0,-1)](t);else{if("alterations"===r){const t={};for(const{target:e,adjuster:r}of s)t[e]=r;e=e.alter(t);continue}if("whens"!==r){if("shared"===r)for(const t of s)e=e.shared(t)}else for(const t of s){const{ref:r,is:s,not:n,then:i,otherwise:o,concat:a}=t;e=a?e.concat(a):r?e.when(r,{is:s,not:n,then:i,otherwise:o,switch:t.switch,break:t.break}):e.when(s,{then:i,otherwise:o,break:t.break})}}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}}),Yr}function hs(){if(ts)return es;ts=1;const e=Mt,t=Vr,r=fs(),s=wr(),n=_r(),i=lr(),o=yr(),a={};return es=r.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:o.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(e,r){const{schema:s,error:n,state:o,prefs:c}=r;if(s._flags.match){const r=[],a=[];for(let t=0;t<s.$_terms.matches.length;++t){const n=s.$_terms.matches[t],i=o.nest(n.schema,`match.${t}`);i.snapshot();const u=n.schema.$_validate(e,i,c);u.errors?(a.push(u.errors),i.restore()):r.push(u.value)}if(0===r.length){return{errors:n("alternatives.any",{details:a.map(e=>i.details(e,{override:!1}))})}}if("one"===s._flags.match)return 1===r.length?{value:r[0]}:{errors:n("alternatives.one")};if(r.length!==s.$_terms.matches.length){return{errors:n("alternatives.all",{details:a.map(e=>i.details(e,{override:!1}))})}}const u=e=>e.$_terms.matches.some(e=>"object"===e.schema.type||"alternatives"===e.schema.type&&u(e.schema));return u(s)?{value:r.reduce((e,r)=>t(e,r,{mergeArrays:!1}))}:{value:r[r.length-1]}}const u=[];for(let t=0;t<s.$_terms.matches.length;++t){const r=s.$_terms.matches[t];if(r.schema){const s=o.nest(r.schema,`match.${t}`);s.snapshot();const n=r.schema.$_validate(e,s,c);if(!n.errors)return n;s.restore(),u.push({schema:r.schema,reports:n.errors});continue}const n=r.ref?r.ref.resolve(e,o,c):e,i=r.is?[r]:r.switch;for(let s=0;s<i.length;++s){const a=i[s],{is:u,then:l,otherwise:d}=a,p=`match.${t}${r.switch?"."+s:""}`;if(u.$_match(n,o.nest(u,`${p}.is`),c)){if(l)return l.$_validate(e,o.nest(l,`${p}.then`),c)}else if(d)return d.$_validate(e,o.nest(d,`${p}.otherwise`),c)}}return a.errors(u,r)},rules:{conditional:{method(t,r){e(!this._flags._endedSwitch,"Unreachable condition"),e(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),e(void 0===r.break,"Cannot use break option with alternatives conditional");const s=this.clone(),i=n.when(s,t,r),o=i.is?[i]:i.switch;for(const e of o)if(e.then&&e.otherwise){s.$_setFlag("_endedSwitch",!0,{clone:!1});break}return s.$_terms.matches.push(i),s.$_mutateRebuild()}},match:{method(t){if(e(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const r of this.$_terms.matches)e(r.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){e(t.length,"Missing alternative schemas"),s.verifyFlat(t,"try"),e(!this._flags._endedSwitch,"Unreachable condition");const r=this.clone();for(const e of t)r.$_terms.matches.push({schema:r.$_compile(e)});return r.$_mutateRebuild()}}},overrides:{label(e){return this.$_parent("label",e).$_modify({each:(t,r)=>"is"!==r.path[0]?t.label(e):void 0,ref:!1})}},rebuild(e){e.$_modify({each:t=>{s.isSchema(t)&&"array"===t.type&&e.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const r of t.matches){const{schema:t,ref:s,is:n,not:i,then:o,otherwise:a}=r;e=t?e.try(t):s?e.conditional(s,{is:n,then:o,not:i,otherwise:a,switch:r.switch}):e.conditional(n,{then:o,otherwise:a})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),a.errors=function(e,{error:t,state:r}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};const s=new Set,n=[];for(const{reports:o,schema:c}of e){if(o.length>1)return a.unmatched(e,t);const u=o[0];if(u instanceof i.Report==!1)return a.unmatched(e,t);if(u.state.path.length!==r.path.length){n.push({type:c.type,report:u});continue}if("any.only"===u.code){for(const e of u.local.valids)s.add(e);continue}const[l,d]=u.code.split(".");"base"===d?s.add(l):n.push({type:c.type,report:u})}return n.length?1===n.length?{errors:n[0].report}:a.unmatched(e,t):{errors:t("alternatives.types",{types:[...s]})}},a.unmatched=function(e,t){const r=[];for(const t of e)r.push(...t.reports);return{errors:t("alternatives.match",i.details(r,{override:!1}))}},es}function ms(){if(ss)return rs;ss=1;const e=Mt,t=Br,r=Ut,s=fs(),n=wr(),i=_r(),o={};return rs=s.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:r,prefs:s}){if(!Array.isArray(e))return;const n=t.$_getRule("sort");return n?o.sort(t,e,n.args.options,r,s):void 0}},validate(e,{schema:t,error:r}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[n.symbols.arraySingle]=!0,{value:t}}return{errors:r("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});const t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:r,error:s},{schema:n}){const i=[e,...t.ancestors];for(let s=0;s<e.length;++s){const o=t.localize([...t.path,s],i,n);if(n.$_match(e[s],o,r))return e}const o=n._flags.label;return o?s("array.hasKnown",{patternLabel:o}):s("array.hasUnknown",null)},multi:!0},items:{method(...e){n.verifyFlat(e,"items");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const s=n.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});t.$_terms.items.push(s)}return t.$_mutateRebuild()},validate(e,{schema:t,error:r,state:s,prefs:i,errorsArray:a}){const c=t.$_terms._requireds.slice(),u=t.$_terms.ordered.slice(),l=[...t.$_terms._inclusions,...c],d=!e[n.symbols.arraySingle];delete e[n.symbols.arraySingle];const p=a();let f=e.length;for(let n=0;n<f;++n){const a=e[n];let h=!1,m=!1;const g=d?n:new Number(n),y=[...s.path,g];if(!t._flags.sparse&&void 0===a){if(p.push(r("array.sparse",{key:g,path:y,pos:n,value:void 0},s.localize(y))),i.abortEarly)return p;u.shift();continue}const I=[e,...s.ancestors];for(const e of t.$_terms._exclusions)if(e.$_match(a,s.localize(y,I,e),i,{presence:"ignore"})){if(p.push(r("array.excludes",{pos:n,value:a},s.localize(y))),i.abortEarly)return p;h=!0,u.shift();break}if(h)continue;if(t.$_terms.ordered.length){if(u.length){const c=u.shift(),l=c.$_validate(a,s.localize(y,I,c),i);if(l.errors){if(p.push(...l.errors),i.abortEarly)return p}else if("strip"===c._flags.result)o.fastSplice(e,n),--n,--f;else{if(!t._flags.sparse&&void 0===l.value){if(p.push(r("array.sparse",{key:g,path:y,pos:n,value:void 0},s.localize(y))),i.abortEarly)return p;continue}e[n]=l.value}continue}if(!t.$_terms.items.length){if(p.push(r("array.orderedLength",{pos:n,limit:t.$_terms.ordered.length})),i.abortEarly)return p;break}}const b=[];let w=c.length;for(let u=0;u<w;++u){const l=s.localize(y,I,c[u]);l.snapshot();const d=c[u].$_validate(a,l,i);if(b[u]=d,!d.errors){if(e[n]=d.value,m=!0,o.fastSplice(c,u),--u,--w,!t._flags.sparse&&void 0===d.value&&(p.push(r("array.sparse",{key:g,path:y,pos:n,value:void 0},s.localize(y))),i.abortEarly))return p;break}l.restore()}if(m)continue;const v=i.stripUnknown&&!!i.stripUnknown.arrays||!1;w=l.length;for(const u of l){let l;const d=c.indexOf(u);if(-1!==d)l=b[d];else{const c=s.localize(y,I,u);if(c.snapshot(),l=u.$_validate(a,c,i),!l.errors){"strip"===u._flags.result?(o.fastSplice(e,n),--n,--f):t._flags.sparse||void 0!==l.value?e[n]=l.value:(p.push(r("array.sparse",{key:g,path:y,pos:n,value:void 0},s.localize(y))),h=!0),m=!0;break}c.restore()}if(1===w){if(v){o.fastSplice(e,n),--n,--f,m=!0;break}if(p.push(...l.errors),i.abortEarly)return p;h=!0;break}}if(!h&&((t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!m)){if(v){o.fastSplice(e,n),--n,--f;continue}if(p.push(r("array.includes",{pos:n,value:a},s.localize(y))),i.abortEarly)return p}}return c.length&&o.fillMissedErrors(t,p,c,e,s,i),u.length&&(o.fillOrderedErrors(t,p,u,e,s,i),p.length||o.fillDefault(u,e,s,i)),p.length?p:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:s,operator:i,args:o})=>n.compare(e.length,r,i)?e:t.error("array."+s,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:n.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){n.verifyFlat(e,"ordered");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const s=n.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});o.validateSingle(s,t),t.$_mutateRegister(s),t.$_terms.ordered.push(s)}return t.$_mutateRebuild()}},single:{method(t){const r=void 0===t||!!t;return e(!r||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",r)}},sort:{method(t={}){n.assertOptions(t,["by","order"]);const r={order:t.order||"ascending"};return t.by&&(r.by=i.ref(t.by,{ancestor:0}),e(!r.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:r}})},validate(e,{error:t,state:r,prefs:s,schema:n},{options:i}){const{value:a,errors:c}=o.sort(n,e,i,r,s);if(c)return c;for(let r=0;r<e.length;++r)if(e[r]!==a[r])return t("array.sort",{order:i.order,by:i.by?i.by.key:"value"});return e},convert:!0},sparse:{method(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;return(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(t,r={}){e(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),n.assertOptions(r,["ignoreUndefined","separator"]);const s={name:"unique",args:{options:r,comparator:t}};if(t)if("string"==typeof t){const e=n.default(r.separator,".");s.path=e?t.split(e):[t]}else s.comparator=t;return this.$_addRule(s)},validate(s,{state:n,error:i,schema:o},{comparator:a,options:c},{comparator:u,path:l}){const d={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},p=u||t,f=c.ignoreUndefined;for(let t=0;t<s.length;++t){const o=l?r(s[t],l):s[t],c=u?d.custom:d[typeof o];if(e(c,"Failed to find unique map container for type",typeof o),c instanceof Map){const e=c.entries();let r;for(;!(r=e.next()).done;)if(p(r.value[0],o)){const e=n.localize([...n.path,t],[s,...n.ancestors]),o={pos:t,value:s[t],dupePos:r.value[1],dupeValue:s[r.value[1]]};return l&&(o.path=a),i("array.unique",o,e)}c.set(o,t)}else{if((!f||void 0!==o)&&void 0!==c[o]){const e={pos:t,value:s[t],dupePos:c[o],dupeValue:s[c[o]]};l&&(e.path=a);return i("array.unique",e,n.localize([...n.path,t],[s,...n.ancestors]))}c[o]=t}}return s},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)o.validateSingle(t,e),"required"===t._flags.presence?e.$_terms._requireds.push(t):"forbidden"===t._flags.presence?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(const t of e.$_terms.ordered)o.validateSingle(t,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),o.fillMissedErrors=function(e,t,r,s,n,i){const o=[];let a=0;for(const e of r){const t=e._flags.label;t?o.push(t):++a}o.length?a?t.push(e.$_createError("array.includesRequiredBoth",s,{knownMisses:o,unknownMisses:a},n,i)):t.push(e.$_createError("array.includesRequiredKnowns",s,{knownMisses:o},n,i)):t.push(e.$_createError("array.includesRequiredUnknowns",s,{unknownMisses:a},n,i))},o.fillOrderedErrors=function(e,t,r,s,n,i){const a=[];for(const e of r)"required"===e._flags.presence&&a.push(e);a.length&&o.fillMissedErrors(e,t,a,s,n,i)},o.fillDefault=function(e,t,r,s){const n=[];let i=!0;for(let o=e.length-1;o>=0;--o){const a=e[o],c=[t,...r.ancestors],u=a.$_validate(void 0,r.localize(r.path,c,a),s).value;if(i){if(void 0===u)continue;i=!1}n.unshift(u)}n.length&&t.push(...n)},o.fastSplice=function(e,t){let r=t;for(;r<e.length;)e[r++]=e[r];--e.length},o.validateSingle=function(t,r){("array"===t.type||t._flags._arrayItems)&&(e(!r._flags.single,"Cannot specify array item with single rule enabled"),r.$_setFlag("_arrayItems",!0,{clone:!1}))},o.sort=function(e,t,r,s,n){const i="ascending"===r.order?1:-1,a=-1*i,c=i,u=(u,l)=>{let d=o.compare(u,l,a,c);if(null!==d)return d;if(r.by&&(u=r.by.resolve(u,s,n),l=r.by.resolve(l,s,n)),d=o.compare(u,l,a,c),null!==d)return d;const p=typeof u;if(p!==typeof l)throw e.$_createError("array.sort.mismatching",t,null,s,n);if("number"!==p&&"string"!==p)throw e.$_createError("array.sort.unsupported",t,{type:p},s,n);return"number"===p?(u-l)*i:u<l?a:c};try{return{value:t.slice().sort(u)}}catch(e){return{errors:e}}},o.compare=function(e,t,r,s){return e===t?0:void 0===e?1:void 0===t?-1:null===e?s:null===t?r:null},rs}function gs(){if(is)return ns;is=1;const e=Mt,t=fs(),r=wr(),s=ds(),n={isBool:function(e){return"boolean"==typeof e}};return ns=t.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if("boolean"!=typeof e){if("string"==typeof e){const r=t._flags.sensitive?e:e.toLowerCase();e="true"===r||"false"!==r&&e}return"boolean"!=typeof e&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e),{value:e}}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){r.verifyFlat(t,"truthy");const n=this.clone();n.$_terms.truthy=n.$_terms.truthy||new s;for(let r=0;r<t.length;++r){const s=t[r];e(void 0!==s,"Cannot call truthy with undefined"),n.$_terms.truthy.add(s)}return n}},falsy:{method(...t){r.verifyFlat(t,"falsy");const n=this.clone();n.$_terms.falsy=n.$_terms.falsy||new s;for(let r=0;r<t.length;++r){const s=t[r];e(void 0!==s,"Cannot call falsy with undefined"),n.$_terms.falsy.add(s)}return n}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:n.isBool,to:(e,t)=>e?1:0},string:{from:n.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e)},messages:{"boolean.base":"{{#label}} must be a boolean"}}),ns}function ys(){if(as)return os;as=1;const e=Mt,t=fs(),r=wr(),s=Ir(),n={isDate:function(e){return e instanceof Date}};return os=t.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:n.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:r,prefs:s}){if(e instanceof Date&&!isNaN(e.getTime()))return;const n=t._flags.format;return s.convert&&n&&"string"==typeof e?{value:e,errors:r("date.format",{format:n})}:{value:e,errors:r("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:s},{name:n,operator:i,args:o}){const a="now"===s?Date.now():s.getTime();return r.compare(e.getTime(),a,i)?e:t.error("date."+n,{limit:o.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:n.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(t){return e(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(t="javascript"){return e(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:n.isDate,to:(e,t)=>e.getTime()},string:{from:n.isDate,to:(e,{prefs:t})=>s.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),n.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return r.isIsoDate(e)?n.date(e.toString()):null;const s=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return n.date(1*e);if("unix"===t)return n.date(1e3*e);if("string"==typeof s)return null}return n.date(e)},n.date=function(e){const t=new Date(e);return isNaN(t.getTime())?null:t},os}const Is=Mt,bs=Ht,ws=Vr,vs=Ut,Ts={};var Es=function(e,t,r={}){if(Is(e&&"object"==typeof e,"Invalid defaults value: must be an object"),Is(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),Is("object"==typeof r,"Invalid options: must be an object"),!t)return null;if(r.shallow)return Ts.applyToDefaultsWithShallow(e,t,r);const s=bs(e);if(!0===t)return s;const n=void 0!==r.nullOverride&&r.nullOverride;return ws(s,t,{nullOverride:n,mergeArrays:!1})};Ts.applyToDefaultsWithShallow=function(e,t,r){const s=r.shallow;Is(Array.isArray(s),"Invalid keys");const n=new Map,i=!0===t?null:new Set;for(let r of s){r=Array.isArray(r)?r:r.split(".");const s=vs(e,r);s&&"object"==typeof s?n.set(s,i&&vs(t,r)||s):i&&i.add(r)}const o=bs(e,{},n);if(!i)return o;for(const e of i)Ts.reachCopy(o,t,e);const a=void 0!==r.nullOverride&&r.nullOverride;return ws(o,t,{nullOverride:a,mergeArrays:!1})},Ts.reachCopy=function(e,t,r){for(const e of r){if(!(e in t))return;const r=t[e];if("object"!=typeof r||null===r)return;t=r}const s=t;let n=e;for(let e=0;e<r.length-1;++e){const t=r[e];"object"!=typeof n[t]&&(n[t]={}),n=n[t]}n[r[r.length-1]]=s};var _s={};const As=Mt,Ss={};var Os,Ns,Rs,Cs,ks,xs,Ls,Bs,Ps,Ms;function Ds(){if(Ns)return Os;Ns=1;const e=Es,t=Mt,r=Ht,s=_s,n=fs(),i=wr(),o=_r(),a=lr(),c=yr(),u=Ir(),l={renameDefaults:{alias:!1,multiple:!1,override:!1}};return Os=n.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:r,state:s,prefs:n}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:r("object.base",{type:t.$_property("typeof")})};if(!(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals))return;e=l.clone(e,n);const i=[];if(t.$_terms.renames&&!l.rename(t,e,s,n,i))return{value:e,errors:i};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:i};const o=new Set(Object.keys(e));if(t.$_terms.keys){const r=[e,...s.ancestors];for(const a of t.$_terms.keys){const t=a.key,c=e[t];o.delete(t);const u=s.localize([...s.path,t],r,a),l=a.schema.$_validate(c,u,n);if(l.errors){if(n.abortEarly)return{value:e,errors:l.errors};void 0!==l.value&&(e[t]=l.value),i.push(...l.errors)}else"strip"===a.schema._flags.result||void 0===l.value&&void 0!==c?delete e[t]:void 0!==l.value&&(e[t]=l.value)}}if(o.size||t._flags._hasPatternMatch){const r=l.unknown(t,e,o,i,s,n);if(r)return r}if(t.$_terms.dependencies)for(const r of t.$_terms.dependencies){if(null!==r.key&&!1===l.isPresent(r.options)(r.key.resolve(e,s,n,null,{shadow:!1})))continue;const o=l.dependencies[r.rel](t,r,e,s,n);if(o){const r=t.$_createError(o.code,e,o.context,s,n);if(n.abortEarly)return{value:e,errors:r};i.push(r)}}return{value:e,errors:i}},rules:{and:{method(...e){return i.verifyFlat(e,"and"),l.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,r,s){u.isTemplate(e)||(e=o.ref(e)),t(void 0===s||"string"==typeof s,"Message must be a string"),r=this.$_compile(r,{appendPath:!0});const n=this.$_addRule({name:"assert",args:{subject:e,schema:r,message:s}});return n.$_mutateRegister(e),n.$_mutateRegister(r),n},validate(e,{error:t,prefs:r,state:s},{subject:n,schema:i,message:o}){const a=n.resolve(e,s,r),u=c.isRef(n)?n.absolute(s):[];return i.$_match(a,s.localize(u,[e,...s.ancestors],i),r)?e:t("object.assert",{subject:n,message:o})},args:["subject","schema","message"],multi:!0},instance:{method(e,r){return t("function"==typeof e,"constructor must be a function"),r=r||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:r}})},validate:(e,t,{constructor:r,name:s})=>e instanceof r?e:t.error("object.instance",{type:s,value:e}),args:["constructor","name"]},keys:{method(e){t(void 0===e||"object"==typeof e,"Object schema must be a valid object"),t(!i.isSchema(e),"Object schema cannot be a joi schema");const r=this.clone();if(e)if(Object.keys(e).length){r.$_terms.keys=r.$_terms.keys?r.$_terms.keys.filter(t=>!e.hasOwnProperty(t.key)):new l.Keys;for(const t in e)i.tryWithPath(()=>r.$_terms.keys.push({key:t,schema:this.$_compile(e[t])}),t)}else r.$_terms.keys=new l.Keys;else r.$_terms.keys=null;return r.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:s,operator:n,args:o})=>i.compare(Object.keys(e).length,r,n)?e:t.error("object."+s,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:i.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return i.verifyFlat(e,"nand"),l.dependency(this,"nand",null,e)}},or:{method(...e){return i.verifyFlat(e,"or"),l.dependency(this,"or",null,e)}},oxor:{method(...e){return l.dependency(this,"oxor",null,e)}},pattern:{method(e,r,s={}){const n=e instanceof RegExp;n||(e=this.$_compile(e,{appendPath:!0})),t(void 0!==r,"Invalid rule"),i.assertOptions(s,["fallthrough","matches"]),n&&t(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),r=this.$_compile(r,{appendPath:!0});const o=this.clone();o.$_terms.patterns=o.$_terms.patterns||[];const a={[n?"regex":"schema"]:e,rule:r};return s.matches&&(a.matches=this.$_compile(s.matches),"array"!==a.matches.type&&(a.matches=a.matches.$_root.array().items(a.matches)),o.$_mutateRegister(a.matches),o.$_setFlag("_hasPatternMatch",!0,{clone:!1})),s.fallthrough&&(a.fallthrough=!0),o.$_terms.patterns.push(a),o.$_mutateRegister(r),o}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>c.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(r,s,n={}){t("string"==typeof r||r instanceof RegExp,"Rename missing the from argument"),t("string"==typeof s||s instanceof u,"Invalid rename to argument"),t(s!==r,"Cannot rename key to same name:",r),i.assertOptions(n,["alias","ignoreUndefined","override","multiple"]);const o=this.clone();o.$_terms.renames=o.$_terms.renames||[];for(const e of o.$_terms.renames)t(e.from!==r,"Cannot rename the same key multiple times");return s instanceof u&&o.$_mutateRegister(s),o.$_terms.renames.push({from:r,to:s,options:e(l.renameDefaults,n)}),o}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:r})=>!i.isSchema(e)||"any"!==r&&e.type!==r?t.error("object.schema",{type:r}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,r={}){return l.dependency(this,"with",e,t,r)}},without:{method(e,t,r={}){return l.dependency(this,"without",e,t,r)}},xor:{method(...e){return i.verifyFlat(e,"xor"),l.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=i.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){const t=new s.Sorter;for(const r of e.$_terms.keys)i.tryWithPath(()=>t.add(r,{after:r.schema.$_rootReferences(),group:r.key}),r.key);e.$_terms.keys=new l.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(const{rel:r,key:s=null,peers:n,options:i}of t.dependencies)e=l.dependency(e,r,s,n,i);if(t.patterns)for(const{regex:r,schema:s,rule:n,fallthrough:i,matches:o}of t.patterns)e=e.pattern(r||s,n,{fallthrough:i,matches:o});if(t.renames)for(const{from:r,to:s,options:n}of t.renames)e=e.rename(r,s,n);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),l.clone=function(e,t){if("object"==typeof e){if(t.nonEnumerables)return r(e,{shallow:!0});const s=Object.create(Object.getPrototypeOf(e));return Object.assign(s,e),s}const s=function(...t){return e.apply(this,t)};return s.prototype=r(e.prototype),Object.defineProperty(s,"name",{value:e.name,writable:!1}),Object.defineProperty(s,"length",{value:e.length,writable:!1}),Object.assign(s,e),s},l.dependency=function(e,r,s,n,a){t(null===s||"string"==typeof s,r,"key must be a strings"),a||(a=n.length>1&&"object"==typeof n[n.length-1]?n.pop():{}),i.assertOptions(a,["separator","isPresent"]),n=[].concat(n);const c=i.default(a.separator,"."),u=[];for(const e of n)t("string"==typeof e,r,"peers must be strings"),u.push(o.ref(e,{separator:c,ancestor:0,prefix:!1}));null!==s&&(s=o.ref(s,{separator:c,ancestor:0,prefix:!1}));const d=e.clone();return d.$_terms.dependencies=d.$_terms.dependencies||[],d.$_terms.dependencies.push(new l.Dependency(r,s,u,n,a)),d},l.dependencies={and(e,t,r,s,n){const i=[],o=[],a=t.peers.length,c=l.isPresent(t.options);for(const e of t.peers)!1===c(e.resolve(r,s,n,null,{shadow:!1}))?i.push(e.key):o.push(e.key);if(i.length!==a&&o.length!==a)return{code:"object.and",context:{present:o,presentWithLabels:l.keysToLabels(e,o),missing:i,missingWithLabels:l.keysToLabels(e,i)}}},nand(e,t,r,s,n){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,s,n,null,{shadow:!1}))&&i.push(e.key);if(i.length!==t.peers.length)return;const a=t.paths[0],c=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:l.keysToLabels(e,a),peers:c,peersWithLabels:l.keysToLabels(e,c)}}},or(e,t,r,s,n){const i=l.isPresent(t.options);for(const e of t.peers)if(i(e.resolve(r,s,n,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)}}},oxor(e,t,r,s,n){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,s,n,null,{shadow:!1}))&&i.push(e.key);if(!i.length||1===i.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return a.present=i,a.presentWithLabels=l.keysToLabels(e,i),{code:"object.oxor",context:a}},with(e,t,r,s,n){const i=l.isPresent(t.options);for(const o of t.peers)if(!1===i(o.resolve(r,s,n,null,{shadow:!1})))return{code:"object.with",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:l.keysToLabels(e,o.key)}}},without(e,t,r,s,n){const i=l.isPresent(t.options);for(const o of t.peers)if(i(o.resolve(r,s,n,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:l.keysToLabels(e,o.key)}}},xor(e,t,r,s,n){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,s,n,null,{shadow:!1}))&&i.push(e.key);if(1===i.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return 0===i.length?{code:"object.missing",context:a}:(a.present=i,a.presentWithLabels=l.keysToLabels(e,i),{code:"object.xor",context:a})}},l.keysToLabels=function(e,t){return Array.isArray(t)?t.map(t=>e.$_mapLabels(t)):e.$_mapLabels(t)},l.isPresent=function(e){return"function"==typeof e.isPresent?e.isPresent:e=>void 0!==e},l.rename=function(e,t,r,s,n){const i={};for(const o of e.$_terms.renames){const a=[],c="string"!=typeof o.from;if(c)for(const e in t){if(void 0===t[e]&&o.options.ignoreUndefined)continue;if(e===o.to)continue;const r=o.from.exec(e);r&&a.push({from:e,to:o.to,match:r})}else!Object.prototype.hasOwnProperty.call(t,o.from)||void 0===t[o.from]&&o.options.ignoreUndefined||a.push(o);for(const l of a){const a=l.from;let d=l.to;if(d instanceof u&&(d=d.render(t,r,s,l.match)),a!==d){if(!o.options.multiple&&i[d]&&(n.push(e.$_createError("object.rename.multiple",t,{from:a,to:d,pattern:c},r,s)),s.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(t,d)&&!o.options.override&&!i[d]&&(n.push(e.$_createError("object.rename.override",t,{from:a,to:d,pattern:c},r,s)),s.abortEarly))return!1;void 0===t[a]?delete t[d]:t[d]=t[a],i[d]=!0,o.options.alias||delete t[a]}}}return!0},l.unknown=function(e,t,r,s,n,o){if(e.$_terms.patterns){let i=!1;const c=e.$_terms.patterns.map(e=>{if(e.matches)return i=!0,[]}),u=[t,...n.ancestors];for(const i of r){const a=t[i],l=[...n.path,i];for(let d=0;d<e.$_terms.patterns.length;++d){const p=e.$_terms.patterns[d];if(p.regex){const e=p.regex.test(i);if(n.mainstay.tracer.debug(n,"rule",`pattern.${d}`,e?"pass":"error"),!e)continue}else if(!p.schema.$_match(i,n.nest(p.schema,`pattern.${d}`),o))continue;r.delete(i);const f=n.localize(l,u,{schema:p.rule,key:i}),h=p.rule.$_validate(a,f,o);if(h.errors){if(o.abortEarly)return{value:t,errors:h.errors};s.push(...h.errors)}if(p.matches&&c[d].push(i),t[i]=h.value,!p.fallthrough)break}}if(i)for(let r=0;r<c.length;++r){const i=c[r];if(!i)continue;const l=e.$_terms.patterns[r].matches,d=n.localize(n.path,u,l),p=l.$_validate(i,d,o);if(p.errors){const r=a.details(p.errors,{override:!1});r.matches=i;const c=e.$_createError("object.pattern.match",t,r,n,o);if(o.abortEarly)return{value:t,errors:c};s.push(c)}}}if(!r.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(o.stripUnknown&&!e._flags.unknown||o.skipFunctions){const e=!!o.stripUnknown&&(!0===o.stripUnknown||!!o.stripUnknown.objects);for(const s of r)e?(delete t[s],r.delete(s)):"function"==typeof t[s]&&r.delete(s)}if(!i.default(e._flags.unknown,o.allowUnknown))for(const i of r){const r=n.localize([...n.path,i],[]),a=e.$_createError("object.unknown",t[i],{child:i},r,o,{flags:!1});if(o.abortEarly)return{value:t,errors:a};s.push(a)}},l.Dependency=class{constructor(e,t,r,s,n){this.rel=e,this.key=t,this.peers=r,this.paths=s,this.options=n}describe(){const e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}},l.Keys=class extends Array{concat(e){const t=this.slice(),r=new Map;for(let e=0;e<t.length;++e)r.set(t[e].key,e);for(const s of e){const e=s.key,n=r.get(e);void 0!==n?t[n]={key:e,schema:t[n].schema.concat(s.schema)}:t.push(s)}return t}},Os}function $s(){if(Cs)return Rs;Cs=1;const e=Mt,t=Ds();return Rs=t.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(e,t,{n:r})=>e.length===r?e:t.error("function.arity",{n:r})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(t){return e(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length>=r?e:t.error("function.minArity",{n:r})},maxArity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length<=r?e:t.error("function.maxArity",{n:r})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})}function Us(){if(xs)return ks;xs=1;const e=Mt,t=fs(),r=wr(),s=_r(),n=lr(),i={};return ks=t.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(t,{schema:r,state:s,prefs:n}){e(r.$_terms.link,"Uninitialized link schema");const o=i.generate(r,t,s,n),a=r.$_terms.link[0].ref;return o.$_validate(t,s.nest(o,`link:${a.display}:${o.type}`),n)},generate:(e,t,r,s)=>i.generate(e,t,r,s),rules:{ref:{method(t){e(!this.$_terms.link,"Cannot reinitialize schema"),t=s.ref(t),e("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),e("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const r=this.clone();return r.$_terms.link=[{ref:t}],r}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(t){e(this.$_terms.link,"Uninitialized link schema"),e(r.isSchema(t),"Invalid schema object"),e("link"!==t.type,"Cannot merge type link with another link");const s=this.clone();return s.$_terms.whens||(s.$_terms.whens=[]),s.$_terms.whens.push({concat:t}),s.$_mutateRebuild()}},manifest:{build:(t,r)=>(e(r.link,"Invalid link description missing link"),t.ref(r.link))}}),i.generate=function(e,t,r,s){let n=r.mainstay.links.get(e);if(n)return n._generate(t,r,s).schema;const o=e.$_terms.link[0].ref,{perspective:a,path:c}=i.perspective(o,r);i.assert(a,"which is outside of schema boundaries",o,e,r,s);try{n=c.length?a.$_reach(c):a}catch(t){i.assert(!1,"to non-existing schema",o,e,r,s)}return i.assert("link"!==n.type,"which is another link",o,e,r,s),e._flags.relative||r.mainstay.links.set(e,n),n._generate(t,r,s).schema},i.perspective=function(e,t){if("local"===e.type){for(const{schema:r,key:s}of t.schemas){if((r._flags.id||s)===e.path[0])return{perspective:r,path:e.path.slice(1)};if(r.$_terms.shared)for(const t of r.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}}return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}},i.assert=function(t,r,s,i,o,a){t||e(!1,`"${n.label(i._flags,o,a)}" contains link reference "${s.display}" ${r}`)},ks}function js(){if(Bs)return Ls;Bs=1;const e=Mt,t=fs(),r=wr(),s={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/};return Ls=t.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:r}){if(!e.match(s.numberRx))return;e=e.trim();const n={value:parseFloat(e)};if(0===n.value&&(n.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(s.extractSignificantDigits(e)!==s.extractSignificantDigits(String(n.value)))return n.errors=r("number.unsafe"),n}else{const t=n.value.toString();if(t.match(/e/i))return n;if(t!==s.normalizeDecimal(e))return n.errors=r("number.unsafe"),n}return n}},validate(e,{schema:t,error:s,prefs:n}){if(e===1/0||e===-1/0)return{value:e,errors:s("number.infinity")};if(!r.isNumber(e))return{value:e,errors:s("number.base")};const i={value:e};if(n.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);i.value=Math.round(i.value*t)/t}}return 0===i.value&&(i.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(i.errors=s("number.unsafe")),i},rules:{compare:{method:!1,validate:(e,t,{limit:s},{name:n,operator:i,args:o})=>r.compare(e,s,i)?e:t.error("number."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e===0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){return this.$_addRule({name:"multiple",args:{base:e}})},validate:(e,t,{base:r},s)=>e*(1/r)%1==0?e:t.error("number.multiple",{multiple:s.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&e>0,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return e(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(e,t,{limit:r}){const n=e.toString().match(s.precisionRx);return Math.max((n[1]?n[1].length:0)-(n[2]?parseInt(n[2],10):0),0)<=r?e:t.error("number.precision",{limit:r,value:e})},convert:!0},sign:{method(t){return e(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(e,t,{sign:r})=>"negative"===r&&e<0||"positive"===r&&e>0?e:t.error(`number.${r}`)},unsafe:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),s.extractSignificantDigits=function(e){return e.replace(s.exponentialPartRegex,"").replace(s.dotRegex,"").replace(s.trailingZerosRegex,"").replace(s.leadingSignAndZerosRegex,"")},s.normalizeDecimal=function(e){return(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),"-0"===e?"0":e},Ls}function Gs(){if(Ms)return Ps;Ms=1;const e=Ds();return Ps=e.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}})}_s.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){const r=[].concat((t=t||{}).before||[]),s=[].concat(t.after||[]),n=t.group||"?",i=t.sort||0;As(!r.includes(n),`Item cannot come before itself: ${n}`),As(!r.includes("?"),"Item cannot come before unassociated items"),As(!s.includes(n),`Item cannot come after itself: ${n}`),As(!s.includes("?"),"Item cannot come after unassociated items"),Array.isArray(e)||(e=[e]);for(const t of e){const e={seq:this._items.length,sort:i,before:r,after:s,group:n,node:t};this._items.push(e)}if(!t.manual){const e=this._sort();As(e,"item","?"!==n?`added into group ${n}`:"","created a dependencies error")}return this.nodes}merge(e){Array.isArray(e)||(e=[e]);for(const t of e)if(t)for(const e of t._items)this._items.push(Object.assign({},e));this._items.sort(Ss.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return As(t,"merge created a dependencies error"),this.nodes}sort(){const e=this._sort();return As(e,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),r=Object.create(null);for(const s of this._items){const n=s.seq,i=s.group;r[i]=r[i]||[],r[i].push(n),e[n]=s.before;for(const e of s.after)t[e]=t[e]||[],t[e].push(n)}for(const t in e){const s=[];for(const n in e[t]){const i=e[t][n];r[i]=r[i]||[],s.push(...r[i])}e[t]=s}for(const s in t)if(r[s])for(const n of r[s])e[n].push(...t[s]);const s={};for(const t in e){const r=e[t];for(const e of r)s[e]=s[e]||[],s[e].push(t)}const n={},i=[];for(let e=0;e<this._items.length;++e){let t=e;if(s[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===n[e])continue;s[e]||(s[e]=[]);const r=s[e].length;let i=0;for(let t=0;t<r;++t)n[s[e][t]]&&++i;if(i===r){t=e;break}}}null!==t&&(n[t]=!0,i.push(t))}if(i.length!==this._items.length)return!1;const o={};for(const e of this._items)o[e.seq]=e;this._items=[],this.nodes=[];for(const e of i){const t=o[e];this.nodes.push(t.node),this._items.push(t)}return!0}},Ss.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1;var Fs,Vs={},Ks={};(Fs=Ks).codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},Fs.code=function(e){return{code:e,error:Fs.codes[e]}},function(e){const t=Ks,r={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:s.URL||URL};e.analyze=function(e,s={}){if(!e)return t.code("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(e.length>256)return t.code("DOMAIN_TOO_LONG");if(!!r.nonAsciiRx.test(e)){if(!1===s.allowUnicode)return t.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(r.domainControlRx.test(e))return t.code("DOMAIN_INVALID_CHARS");e=r.punycode(e),s.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));const n=s.minDomainSegments||r.minDomainSegments,i=e.split(".");if(i.length<n)return t.code("DOMAIN_SEGMENTS_COUNT");if(s.maxDomainSegments&&i.length>s.maxDomainSegments)return t.code("DOMAIN_SEGMENTS_COUNT_MAX");const o=s.tlds;if(o){const e=i[i.length-1].toLowerCase();if(o.deny&&o.deny.has(e)||o.allow&&!o.allow.has(e))return t.code("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<i.length;++e){const s=i[e];if(!s.length)return t.code("DOMAIN_EMPTY_SEGMENT");if(s.length>63)return t.code("DOMAIN_LONG_SEGMENT");if(e<i.length-1){if(!r.domainSegmentRx.test(s))return t.code("DOMAIN_INVALID_CHARS")}else if(!r.tldSegmentRx.test(s))return t.code("DOMAIN_INVALID_TLDS_CHARS")}return null},e.isValid=function(t,r){return!e.analyze(t,r)},r.punycode=function(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new r.URL(`http://${e}`).host}catch(t){return e}}}(Vs);var qs={};const Ws=Vs,Hs=Ks,Zs={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(n.TextEncoder||TextEncoder)};qs.analyze=function(e,t){return Zs.email(e,t)},qs.isValid=function(e,t){return!Zs.email(e,t)},Zs.email=function(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return Hs.code("EMPTY_STRING");const r=!Zs.nonAsciiRx.test(e);if(!r){if(!1===t.allowUnicode)return Hs.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}const s=e.split("@");if(2!==s.length)return s.length>2?Hs.code("MULTIPLE_AT_CHAR"):Hs.code("MISSING_AT_CHAR");const[n,i]=s;if(!n)return Hs.code("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return Hs.code("ADDRESS_TOO_LONG");if(Zs.encoder.encode(n).length>64)return Hs.code("LOCAL_TOO_LONG")}return Zs.local(n,r)||Ws.analyze(i,t)},Zs.local=function(e,t){const r=e.split(".");for(const e of r){if(!e.length)return Hs.code("EMPTY_LOCAL_SEGMENT");if(t){if(!Zs.atextRx.test(e))return Hs.code("INVALID_LOCAL_CHARS")}else for(const t of e){if(Zs.atextRx.test(t))continue;const e=Zs.binary(t);if(!Zs.atomRx.test(e))return Hs.code("INVALID_LOCAL_CHARS")}}},Zs.binary=function(e){return Array.from(Zs.encoder.encode(e)).map(e=>String.fromCharCode(e)).join("")},Zs.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,Zs.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"));var Js={},Xs={},zs=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};const Ys=Mt,Qs=zs,en={generate:function(){const e={},t="\\dA-Fa-f",r="["+t+"]",s="\\w-\\.~",n="!\\$&'\\(\\)\\*\\+,;=",i="%"+t,o=s+i+n+":@",a="["+o+"]",c="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+c+"\\.){3}"+c;const u=r+"{1,4}",l="(?:"+u+":"+u+"|"+e.ipv4address+")",d="(?:"+u+":){6}"+l,p="::(?:"+u+":){5}"+l,f="(?:"+u+")?::(?:"+u+":){4}"+l,h="(?:(?:"+u+":){0,1}"+u+")?::(?:"+u+":){3}"+l,m="(?:(?:"+u+":){0,2}"+u+")?::(?:"+u+":){2}"+l,g="(?:(?:"+u+":){0,3}"+u+")?::"+u+":"+l,y="(?:(?:"+u+":){0,4}"+u+")?::"+l,I="(?:(?:"+u+":){0,5}"+u+")?::"+u,b="(?:(?:"+u+":){0,6}"+u+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+d+"|"+p+"|"+f+"|"+h+"|"+m+"|"+g+"|"+y+"|"+I+"|"+b+")",e.ipvFuture="v"+r+"+\\.["+s+n+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);const w="["+s+i+n+":]*",v="["+s+i+n+"]{1,255}",T="(?:"+("\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]")+"|"+e.ipv4address+"|"+v+")",E="(?:"+w+"@)?"+T+"(?::\\d*)?",_="(?:"+w+"@)?("+T+")(?::\\d*)?",A=a+"*",S=a+"+",O="(?:\\/"+A+")*",N="\\/(?:"+S+O+")?",R=S+O,C="["+s+i+n+"@]+"+O,k="(?:\\/\\/\\/"+A+O+")";return e.hierPart="(?:(?:\\/\\/"+E+O+")|"+N+"|"+R+"|"+k+")",e.hierPartCapture="(?:(?:\\/\\/"+_+O+")|"+N+"|"+R+")",e.relativeRef="(?:(?:\\/\\/"+E+O+")|"+N+"|"+C+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+_+O+")|"+N+"|"+C+"|)",e.query="["+o+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+o+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+o+"\\/\\?]*",e}};en.rfc3986=en.generate(),Xs.ip={v4Cidr:en.rfc3986.ipv4Cidr,v6Cidr:en.rfc3986.ipv6Cidr,ipv4:en.rfc3986.ipv4address,ipv6:en.rfc3986.ipv6address,ipvfuture:en.rfc3986.ipvFuture},en.createRegex=function(e){const t=en.rfc3986,r="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",s=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return en.wrap(s+r);let n="";if(e.scheme){Ys(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const r=[].concat(e.scheme);Ys(r.length>=1,"scheme must have at least 1 scheme specified");const s=[];for(let e=0;e<r.length;++e){const n=r[e];Ys(n instanceof RegExp||"string"==typeof n,"scheme at position "+e+" must be a RegExp or String"),n instanceof RegExp?s.push(n.source.toString()):(Ys(t.schemeRegex.test(n),"scheme at position "+e+" must be a valid scheme"),s.push(Qs(n)))}n=s.join("|")}const i="(?:"+(n?"(?:"+n+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",o=e.allowRelative?"(?:"+i+"|"+s+")":i;return en.wrap(o+r,n)},en.wrap=function(e,t){return{raw:e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,regex:new RegExp(`^${e}$`),scheme:t}},en.uriRegex=en.createRegex({}),Xs.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?en.createRegex(e):en.uriRegex};const tn=Mt,rn=Xs;Js.regex=function(e={}){tn(void 0===e.cidr||"string"==typeof e.cidr,"options.cidr must be a string");const t=e.cidr?e.cidr.toLowerCase():"optional";tn(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),tn(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let r=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),tn(r.length>=1,"options.version must have at least 1 version specified");for(let e=0;e<r.length;++e)tn("string"==typeof r[e],"options.version must only contain strings"),r[e]=r[e].toLowerCase(),tn(["ipv4","ipv6","ipvfuture"].includes(r[e]),"options.version contains unknown version "+r[e]+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));const s=r.map(e=>{if("forbidden"===t)return rn.ip[e];const r=`\\/${"ipv4"===e?rn.ip.v4Cidr:rn.ip.v6Cidr}`;return"required"===t?`${rn.ip[e]}${r}`:`${rn.ip[e]}(?:${r})?`}),n=`(?:${s.join("|")})`,i=new RegExp(`^${n}$`);return{cidr:t,versions:r,regex:i,raw:n}};const sn={tlds:["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"]};var nn,on,an,cn,un,ln,dn,pn,fn=new Set(sn.tlds.map(e=>e.toLowerCase()));function hn(){if(on)return nn;on=1;const e=Mt,t=Vs,r=qs,s=Js,n=zs,i=fn,o=Xs,a=fs(),c=wr(),u={tlds:i instanceof Set&&{tlds:{allow:i,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:s.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};return nn=a.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:r,prefs:s}){const n=t.$_getRule("normalize");n&&(e=e.normalize(n.args.form));const i=t.$_getRule("case");i&&(e="upper"===i.args.direction?e.toLocaleUpperCase():e.toLocaleLowerCase());const o=t.$_getRule("trim");if(o&&o.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(const r of t.$_terms.replacements)e=e.replace(r.pattern,r.replacement);const a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!=0&&(e=`0${e}`),t.$_getRule("isoDate")){const t=u.isoDate(e);t&&(e=t)}if(t._flags.truncate){const n=t.$_getRule("max");if(n){let i=n.args.limit;if(c.isResolvable(i)&&(i=i.resolve(e,r,s),!c.limit(i)))return{value:e,errors:t.$_createError("any.ref",i,{ref:n.args.limit,arg:"limit",reason:"must be a positive integer"},r,s)};e=e.slice(0,i)}}return{value:e}}},validate(e,{schema:t,error:r}){if("string"!=typeof e)return{value:e,errors:r("string.base")};if(""===e){const s=t.$_getRule("min");if(s&&0===s.args.limit)return;return{value:e,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(t={}){return c.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),e("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(e,t,{options:r})=>u.base64Regex[r.paddingRequired][r.urlSafe].test(e)?e:t.error("string.base64")},case:{method(t){return e(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(e,t,{direction:r})=>"lower"===r&&e===e.toLocaleLowerCase()||"upper"===r&&e===e.toLocaleUpperCase()?e:t.error(`string.${r}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let r=e.length,s=0,n=1;for(;r--;){const t=e.charAt(r)*n;s+=t-9*(t>9),n^=3}return s>0&&s%10==0?e:t.error("string.creditCard")}},dataUri:{method(t={}){return c.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(e,t,{options:r}){const s=e.match(u.dataUriRegex);if(s){if(!s[2])return e;if("base64"!==s[2])return e;if(u.base64Regex[r.paddingRequired].false.test(s[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&c.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const t=u.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,r,s,{address:n})=>t.isValid(e,n)?e:r.error("string.domain")},email:{method(t={}){c.assertOptions(t,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),e(void 0===t.multiple||"boolean"==typeof t.multiple,"multiple option must be an boolean");const r=u.addressOptions(t),s=new RegExp(`\\s*[${t.separator?n(t.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:t},regex:s,address:r})},validate(e,t,{options:s},{regex:n,address:i}){const o=s.multiple?e.split(n):[e],a=[];for(const e of o)r.isValid(e,i)||a.push(e);return a.length?t.error("string.email",{value:e,invalids:a}):e}},guid:{alias:"uuid",method(t={}){c.assertOptions(t,["version","separator"]);let r="";if(t.version){const s=[].concat(t.version);e(s.length>=1,"version must have at least 1 valid version specified");const n=new Set;for(let t=0;t<s.length;++t){const i=s[t];e("string"==typeof i,"version at position "+t+" must be a string");const o=u.guidVersions[i.toLowerCase()];e(o,"version at position "+t+" must be one of "+Object.keys(u.guidVersions).join(", ")),e(!n.has(o),"version at position "+t+" must not be a duplicate"),r+=o,n.add(o)}}e(u.guidSeparators.has(t.separator),'separator must be one of true, false, "-", or ":"');const s=void 0===t.separator?"[:-]?":!0===t.separator?"[:-]":!1===t.separator?"[]?":`\\${t.separator}`,n=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${s})[0-9A-F]{4}\\2?[${r||"0-9A-F"}][0-9A-F]{3}\\2?[${r?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:t},regex:n})},validate(e,t,r,{regex:s}){const n=s.exec(e);return n?u.guidBrackets[n[1]]!==n[n.length-1]?t.error("string.guid"):e:t.error("string.guid")}},hex:{method(t={}){return c.assertOptions(t,["byteAligned"]),t={byteAligned:!1,...t},e("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:t}})},validate:(e,t,{options:r})=>u.hexRegex.test(e)?r.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,r)=>t.isValid(e,{minDomainSegments:1})||u.ipRegex.test(e)?e:r.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){c.assertOptions(e,["cidr","version"]);const{cidr:t,versions:r,regex:n}=s.regex(e),i=e.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:i}},regex:n})},validate:(e,t,{options:r},{regex:s})=>s.test(e)?e:r.version?t.error("string.ipVersion",{value:e,cidr:r.cidr,version:r.version}):t.error("string.ip",{value:e,cidr:r.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>u.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>u.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return u.length(this,"length",e,"=",t)},validate(e,t,{limit:r,encoding:s},{name:n,operator:i,args:o}){const a=s?Buffer&&Buffer.byteLength(e,s):e.length;return c.compare(a,r,i)?e:t.error("string."+n,{limit:o.limit,value:e,encoding:s})},args:[{name:"limit",ref:!0,assert:c.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return u.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return u.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(t="NFC"){return e(u.normalizationForms.includes(t),"normalization form must be one of "+u.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(e,{error:t},{form:r})=>e===e.normalize(r)?e:t("string.normalize",{value:e,form:r}),convert:!0},pattern:{alias:"regex",method(t,r={}){e(t instanceof RegExp,"regex must be a RegExp"),e(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof r&&(r={name:r}),c.assertOptions(r,["invert","name"]);const s=["string.pattern",r.invert?".invert":"",r.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:r},errorCode:s})},validate:(e,t,{regex:r,options:s},{errorCode:n})=>r.test(e)^s.invert?e:t.error(n,{name:s.name,regex:r,value:e}),args:["regex","options"],multi:!0},replace:{method(t,r){"string"==typeof t&&(t=new RegExp(n(t),"g")),e(t instanceof RegExp,"pattern must be a RegExp"),e("string"==typeof r,"replacement must be a String");const s=this.clone();return s.$_terms.replacements||(s.$_terms.replacements=[]),s.$_terms.replacements.push({pattern:t,replacement:r}),s}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(e,t,{enabled:r})=>r&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){c.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),e.domain&&c.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:t,scheme:r}=o.regex(e),s=e.domain?u.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:s,scheme:r})},validate(e,r,{options:s},{regex:n,domain:i,scheme:o}){if(["http:/","https:/"].includes(e))return r.error("string.uri");const a=n.exec(e);if(a){const n=a[1]||a[2];return!i||s.allowRelative&&!n||t.isValid(n,i)?e:r.error("string.domain",{value:n})}return s.relativeOnly?r.error("string.uriRelativeOnly"):s.scheme?r.error("string.uriCustomScheme",{scheme:o,value:e}):r.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(const{pattern:r,replacement:s}of t.replacements)e=e.replace(r,s);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),u.addressOptions=function(t){if(!t)return t;if(e(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),e(void 0===t.maxDomainSegments||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds);e("object"==typeof t.tlds,"tlds must be true, false, or an object");const r=t.tlds.deny;if(r)return Array.isArray(r)&&(t=Object.assign({},t,{tlds:{deny:new Set(r)}})),e(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),e(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),u.validateTlds(t.tlds.deny,"tlds.deny"),t;const s=t.tlds.allow;return s?!0===s?(e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds)):(Array.isArray(s)&&(t=Object.assign({},t,{tlds:{allow:new Set(s)}})),e(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),u.validateTlds(t.tlds.allow,"tlds.allow"),t):t},u.validateTlds=function(r,s){for(const n of r)e(t.isValid(n,{minDomainSegments:1,maxDomainSegments:1}),`${s} must contain valid top level domain names`)},u.isoDate=function(e){if(!c.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()},u.length=function(t,r,s,n,i){return e(!i||Buffer&&Buffer.isEncoding(i),"Invalid encoding:",i),t.$_addRule({name:r,method:"length",args:{limit:s,encoding:i},operator:n})},nn}function mn(){if(cn)return an;cn=1;const e=Mt,t=fs(),r={};return r.Map=class extends Map{slice(){return new r.Map(this)}},an=t.extend({type:"symbol",terms:{map:{init:new r.Map}},coerce:{method(e,{schema:t,error:r}){const s=t.$_terms.map.get(e);return s&&(e=s),t._flags.only&&"symbol"!=typeof e?{value:e,errors:r("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),e(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const r=this.clone(),s=[];for(const n of t){e(n&&n[Symbol.iterator],"Entry must be an iterable");const[t,i]=n;e("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),e("symbol"==typeof i,"Value must be a Symbol"),r.$_terms.map.set(t,i),s.push(i)}return r.valid(...s)}}},manifest:{build:(e,t)=>(t.map&&(e=e.map(t.map)),e)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}}),an}function gn(){if(pn)return dn;pn=1;const e=Mt,t=Ht,r=vr(),s=wr(),n=_r(),i=lr(),o=Or(),a=Cr(),c=yr(),u=Ir(),l=Dr();let d;const p={types:{alternatives:hs(),any:fs(),array:ms(),boolean:gs(),date:ys(),function:$s(),link:Us(),number:js(),object:Gs(),string:hn(),symbol:mn()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};return Buffer&&(p.types.binary=function(){if(ln)return un;ln=1;const e=Mt,t=fs(),r=wr();return un=t.extend({type:"binary",coerce:{from:"string",method(e,{schema:t}){try{return{value:Buffer.from(e,t._flags.encoding)}}catch(e){}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(t){return e(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:s},{name:n,operator:i,args:o})=>r.compare(e.length,s,i)?e:t.error("binary."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to:(e,t)=>e.toString()}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}}),un}()),p.root=function(){const t={_types:new Set(Object.keys(p.types))};for(const r of t._types)t[r]=function(...t){return e(!t.length||["alternatives","link","object"].includes(r),"The",r,"type does not allow arguments"),p.generate(this,p.types[r],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,p.methods);for(const e in p.aliases){const r=p.aliases[e];t[e]=t[r]}return t.x=t.expression,l.setup&&l.setup(t),t},p.methods={ValidationError:i.ValidationError,version:s.version,cache:r.provider,assert(e,t,...r){p.assert(e,t,!0,r)},attempt:(e,t,...r)=>p.assert(e,t,!1,r),build(t){return e("function"==typeof a.build,"Manifest functionality disabled"),a.build(this,t)},checkPreferences(e){s.checkPreferences(e)},compile(e,t){return n.compile(this,e,t)},defaults(t){e("function"==typeof t,"modifier must be a function");const r=Object.assign({},this);for(const n of r._types){const i=t(r[n]());e(s.isSchema(i),"modifier must return a valid schema object"),r[n]=function(...e){return p.generate(this,i,e)}}return r},expression:(...e)=>new u(...e),extend(...t){s.verifyFlat(t,"extend"),d=d||Qt(),e(t.length,"You need to provide at least one extension"),this.assert(t,d.extensions);const r=Object.assign({},this);r._types=new Set(r._types);for(let s of t){"function"==typeof s&&(s=s(r)),this.assert(s,d.extension);const t=p.expandExtension(s,r);for(const s of t){e(void 0===r[s.type]||r._types.has(s.type),"Cannot override name",s.type);const t=s.base||this.any(),n=o.type(t,s);r._types.add(s.type),r[s.type]=function(...e){return p.generate(this,n,e)}}}return r},isError:i.ValidationError.isError,isExpression:u.isTemplate,isRef:c.isRef,isSchema:s.isSchema,in:(...e)=>c.in(...e),override:s.symbols.override,ref:(...e)=>c.create(...e),types(){const e={};for(const t of this._types)e[t]=this[t]();for(const t in p.aliases)e[t]=this[t]();return e}},p.assert=function(e,r,n,o){const a=o[0]instanceof Error||"string"==typeof o[0]?o[0]:null,c=null!==a?o[1]:o[0],u=r.validate(e,s.preferences({errors:{stack:!0}},c||{}));let l=u.error;if(!l)return u.value;if(a instanceof Error)throw a;const d=n&&"function"==typeof l.annotate?l.annotate():l.message;throw l instanceof i.ValidationError==!1&&(l=t(l)),l.message=a?`${a} ${d}`:d,l},p.generate=function(t,r,s){return e(t,"Must be invoked on a Joi instance."),r.$_root=t,r._definition.args&&s.length?r._definition.args(r,...s):r},p.expandExtension=function(e,t){if("string"==typeof e.type)return[e];const r=[];for(const s of t._types)if(e.type.test(s)){const n=Object.assign({},e);n.type=s,n.base=t[s](),r.push(n)}return r},dn=p.root()}var yn=kt(gn());yn.extend({type:"string",base:yn.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate:(e,t,{substring:r})=>!1===e.includes(r)?t.error("string.contains",{substring:r}):e},ncontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate:(e,t,{substring:r})=>!0===e.includes(r)?t.error("string.ncontains",{substring:r}):e}}});const{assign:In}=Object,bn={NOTHING:0,ERROR:1,WARN:2,INFO:4,DEBUG:5},wn=(e,t,r,s,n)=>(i,o={})=>{t>r()||n({namespace:s,level:t,label:e,log:In({timestamp:(new Date).toISOString(),logger:"kafkajs",message:i},o)})},vn=e=>{const t=(process.env.KAFKAJS_LOG_LEVEL||"").toUpperCase();return null==bn[t]?e:bn[t]};var Tn={LEVELS:bn,createLogger:({level:e=bn.INFO,logCreator:t}={})=>{let r=vn(e);const s=t(r),n=(e,t=null)=>{const r=vn(t);return i(e,r)},i=(e,t=null)=>{const i=()=>null==t?r:t,o={info:wn("INFO",bn.INFO,i,e,s),error:wn("ERROR",bn.ERROR,i,e,s),warn:wn("WARN",bn.WARN,i,e,s),debug:wn("DEBUG",bn.DEBUG,i,e,s)};return In(o,{namespace:n,setLogLevel:e=>{r=e}})};return i()}};let En=0;var _n=class{constructor(e,t){this.id=(En===Number.MAX_VALUE&&(En=0),En++),this.type=e,this.timestamp=Date.now(),this.payload=t}};const An={name:"kafkajs",version:"2.2.4",description:"A modern Apache Kafka client for node.js",author:"Tulio Ornelas <ornelas.tulio@gmail.com>",main:"index.js",types:"types/index.d.ts",license:"MIT",keywords:["kafka","sasl","scram"],engines:{node:">=14.0.0"},repository:{type:"git",url:"https://github.com/tulios/kafkajs.git"},bugs:{url:"https://github.com/tulios/kafkajs/issues"},homepage:"https://kafka.js.org",scripts:{jest:"export KAFKA_VERSION=${KAFKA_VERSION:='2.4'} && NODE_ENV=test echo \"KAFKA_VERSION: ${KAFKA_VERSION}\" && KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 jest","test:local":"yarn jest --detectOpenHandles","test:debug":"NODE_ENV=test KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 node --inspect-brk $(yarn bin 2>/dev/null)/jest --detectOpenHandles --runInBand --watch","test:local:watch":"yarn test:local --watch",test:"yarn lint && JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh 'yarn jest --ci --maxWorkers=4 --no-watchman --forceExit'",lint:"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name '*.js' -print0 | xargs -0 eslint",format:"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name '*.js' -print0 | xargs -0 prettier --write",precommit:"lint-staged","test:group:broker":"yarn jest --forceExit --testPathPattern 'src/broker/.*'","test:group:admin":"yarn jest --forceExit --testPathPattern 'src/admin/.*'","test:group:producer":"yarn jest --forceExit --testPathPattern 'src/producer/.*'","test:group:consumer":"yarn jest --forceExit --testPathPattern 'src/consumer/.*.spec.js'","test:group:others":"yarn jest --forceExit --testPathPattern 'src/(?!(broker|admin|producer|consumer)/).*'","test:group:oauthbearer":"OAUTHBEARER_ENABLED=1 yarn jest --forceExit src/producer/index.spec.js src/broker/__tests__/connect.spec.js src/consumer/__tests__/connection.spec.js src/broker/__tests__/disconnect.spec.js src/admin/__tests__/connection.spec.js src/broker/__tests__/reauthenticate.spec.js","test:group:broker:ci":'JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh "yarn test:group:broker --ci --maxWorkers=4 --no-watchman"',"test:group:admin:ci":'JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh "yarn test:group:admin --ci --maxWorkers=4 --no-watchman"',"test:group:producer:ci":'JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh "yarn test:group:producer --ci --maxWorkers=4 --no-watchman"',"test:group:consumer:ci":'JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh "yarn test:group:consumer --ci --maxWorkers=4 --no-watchman"',"test:group:others:ci":'JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh "yarn test:group:others --ci --maxWorkers=4 --no-watchman"',"test:group:oauthbearer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml COMPOSE_FILE='docker-compose.2_4_oauthbearer.yml' ./scripts/testWithKafka.sh \"yarn test:group:oauthbearer --ci --maxWorkers=4 --no-watchman\"","test:types":"tsc -p types/"},devDependencies:{"@types/jest":"^27.4.0","@types/node":"^12.0.8","@typescript-eslint/typescript-estree":"^1.10.2",eslint:"^6.8.0","eslint-config-prettier":"^6.0.0","eslint-config-standard":"^13.0.1","eslint-plugin-import":"^2.18.2","eslint-plugin-jest":"^26.1.0","eslint-plugin-node":"^11.0.0","eslint-plugin-prettier":"^3.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.0",execa:"^2.0.3",glob:"^7.1.4",husky:"^3.0.1",ip:"^1.1.5",jest:"^25.1.0","jest-circus":"^25.1.0","jest-extended":"^0.11.2","jest-junit":"^10.0.0",jsonwebtoken:"^9.0.0","lint-staged":"^9.2.0",mockdate:"^2.0.5",prettier:"^1.18.2",semver:"^6.2.0",typescript:"^3.8.3",uuid:"^3.3.2"},dependencies:{},"lint-staged":{"*.js":["prettier --write","git add"]}},{bugs:Sn}=An;let On=class extends Error{constructor(e,{retriable:t=!0,cause:r}={}){super(e,{cause:r}),Error.captureStackTrace(this,this.constructor),this.message=e.message||e,this.name="KafkaJSError",this.retriable=t,this.helpUrl=e.helpUrl,this.cause=r}},Nn=class extends On{constructor(e,{cause:t}={}){super(e,{retriable:!1,cause:t}),this.name="KafkaJSNonRetriableError"}},Rn=class extends On{constructor(e,{retriable:t=e.retriable}={}){super(e,{retriable:t}),this.type=e.type,this.code=e.code,this.name="KafkaJSProtocolError"}};let Cn=class extends On{constructor(e,{broker:t,code:r}={}){super(e),this.broker=t,this.code=r,this.name="KafkaJSConnectionError"}},kn=class extends On{constructor(){super(...arguments),this.name="KafkaJSMetadataNotLoaded"}};let xn=class extends Nn{constructor(){super(...arguments),this.name="KafkaJSTimeout"}};const Ln=Sn?Sn.url:null;let Bn=class extends Error{constructor(e,t){super(e),this.errors=t,this.name="KafkaJSAggregateError"}},Pn=class extends Error{};var Mn={KafkaJSError:On,KafkaJSNonRetriableError:Nn,KafkaJSPartialMessageError:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSPartialMessageError"}},KafkaJSBrokerNotFound:class extends On{constructor(){super(...arguments),this.name="KafkaJSBrokerNotFound"}},KafkaJSProtocolError:Rn,KafkaJSConnectionError:Cn,KafkaJSConnectionClosedError:class extends Cn{constructor(e,{host:t,port:r}={}){super(e,{broker:`${t}:${r}`}),this.host=t,this.port=r,this.name="KafkaJSConnectionClosedError"}},KafkaJSRequestTimeoutError:class extends On{constructor(e,{broker:t,correlationId:r,createdAt:s,sentAt:n,pendingDuration:i}={}){super(e),this.broker=t,this.correlationId=r,this.createdAt=s,this.sentAt=n,this.pendingDuration=i,this.name="KafkaJSRequestTimeoutError"}},KafkaJSSASLAuthenticationError:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSSASLAuthenticationError"}},KafkaJSNumberOfRetriesExceeded:class extends Nn{constructor(e,{retryCount:t,retryTime:r}){super(e,{cause:e}),this.stack=`${this.name}\n  Caused by: ${e.stack}`,this.retryCount=t,this.retryTime=r,this.name="KafkaJSNumberOfRetriesExceeded"}},KafkaJSOffsetOutOfRange:class extends Rn{constructor(e,{topic:t,partition:r}){super(e),this.topic=t,this.partition=r,this.name="KafkaJSOffsetOutOfRange"}},KafkaJSMemberIdRequired:class extends Rn{constructor(e,{memberId:t}){super(e),this.memberId=t,this.name="KafkaJSMemberIdRequired"}},KafkaJSGroupCoordinatorNotFound:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSGroupCoordinatorNotFound"}},KafkaJSNotImplemented:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSNotImplemented"}},KafkaJSMetadataNotLoaded:kn,KafkaJSTopicMetadataNotLoaded:class extends kn{constructor(e,{topic:t}={}){super(e),this.topic=t,this.name="KafkaJSTopicMetadataNotLoaded"}},KafkaJSStaleTopicMetadataAssignment:class extends On{constructor(e,{topic:t,unknownPartitions:r}={}){super(e),this.topic=t,this.unknownPartitions=r,this.name="KafkaJSStaleTopicMetadataAssignment"}},KafkaJSDeleteGroupsError:class extends On{constructor(e,t=[]){super(e),this.groups=t,this.name="KafkaJSDeleteGroupsError"}},KafkaJSTimeout:xn,KafkaJSLockTimeout:class extends xn{constructor(){super(...arguments),this.name="KafkaJSLockTimeout"}},KafkaJSServerDoesNotSupportApiKey:class extends Nn{constructor(e,{apiKey:t,apiName:r}={}){super(e),this.apiKey=t,this.apiName=r,this.name="KafkaJSServerDoesNotSupportApiKey"}},KafkaJSUnsupportedMagicByteInMessageSet:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSUnsupportedMagicByteInMessageSet"}},KafkaJSDeleteTopicRecordsError:class extends On{constructor({partitions:e}){const t=e.filter(({error:e})=>null!=e).every(({error:e})=>!0===e.retriable);super("Error while deleting records",{retriable:t}),this.name="KafkaJSDeleteTopicRecordsError",this.partitions=e}},KafkaJSInvariantViolation:class extends Nn{constructor(e){const t=e.message||e;if(super(`Invariant violated: ${t}. This is likely a bug and should be reported.`),this.name="KafkaJSInvariantViolation",null!==Ln){const e=encodeURIComponent(`Invariant violation: ${t}`);this.helpUrl=`${Ln}/new?assignees=&labels=bug&template=bug_report.md&title=${e}`}}},KafkaJSInvalidVarIntError:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}},KafkaJSInvalidLongError:class extends Nn{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}},KafkaJSCreateTopicError:class extends Rn{constructor(e,t){super(e),this.topic=t,this.name="KafkaJSCreateTopicError"}},KafkaJSAggregateError:Bn,KafkaJSFetcherRebalanceError:Pn,KafkaJSNoBrokerAvailableError:class extends On{constructor(){super("No broker available"),this.name="KafkaJSNoBrokerAvailableError"}},KafkaJSAlterPartitionReassignmentsError:class extends Rn{constructor(e,t,r){super(e),this.topic=t,this.partition=r,this.name="KafkaJSAlterPartitionReassignmentsError"}},isRebalancing:e=>"REBALANCE_IN_PROGRESS"===e.type||"NOT_COORDINATOR_FOR_GROUP"===e.type||"ILLEGAL_GENERATION"===e.type,isKafkaJSError:e=>e instanceof On};const{EventEmitter:Dn}=i,$n=_n,{KafkaJSError:Un}=Mn;var jn=class{constructor(){this.emitter=new Dn}emit(e,t){if(!e)throw new Un("Invalid event name",{retriable:!1});if(this.emitter.listenerCount(e)>0){const r=new $n(e,t);this.emitter.emit(e,r)}}addListener(e,t){return this.emitter.addListener(e,t),()=>this.emitter.removeListener(e,t)}};const{LEVELS:Gn}=Tn;const{format:Fn}=n,{KafkaJSLockTimeout:Vn}=Mn,Kn=Symbol("private:Lock:locked"),qn=Symbol("private:Lock:timeout"),Wn=Symbol("private:Lock:waiting"),Hn=Symbol("private:Lock:timeoutErrorMessage");var Zn,Jn,Xn=class{constructor({timeout:e,description:t=null}={}){if("number"!=typeof e)throw new TypeError(`'timeout' is not a number, received '${typeof e}'`);this[Kn]=!1,this[qn]=e,this[Wn]=new Set,this[Hn]=()=>{const e=Fn("Timeout while acquiring lock (%d waiting locks)",this[Wn].size);return t?`${e}: "${t}"`:e}}async acquire(){return new Promise((e,t)=>{if(!this[Kn])return this[Kn]=!0,e();let r=null;const s=async()=>{if(!this[Kn])return this[Kn]=!0,clearTimeout(r),this[Wn].delete(s),e()};this[Wn].add(s),r=setTimeout(()=>{const e=new Vn(this[Hn]());this[Wn].delete(s),t(e)},this[qn])})}async release(){this[Kn]=!1;const e=this[Wn].values().next().value;if(e)return e()}};const{KafkaJSNotImplemented:zn}=Mn,Yn={None:0,GZIP:1,Snappy:2,LZ4:3,ZSTD:4},Qn={[Yn.GZIP]:()=>function(){if(Jn)return Zn;Jn=1;const{promisify:e}=n,t=o,r=e(t.gzip),s=e(t.unzip);return Zn={compress:async e=>await r(e.buffer),decompress:async e=>await s(e)},Zn}(),[Yn.Snappy]:()=>{throw new zn("Snappy compression not implemented")},[Yn.LZ4]:()=>{throw new zn("LZ4 compression not implemented")},[Yn.ZSTD]:()=>{throw new zn("ZSTD compression not implemented")}};var ei={Types:Yn,Codecs:Qn,lookupCodec:e=>Qn[e]?Qn[e]():null,lookupCodecByAttributes:e=>{const t=Qn[7&e];return t?t():null},COMPRESSION_CODEC_MASK:7},ti={Produce:0,Fetch:1,ListOffsets:2,Metadata:3,LeaderAndIsr:4,StopReplica:5,UpdateMetadata:6,ControlledShutdown:7,OffsetCommit:8,OffsetFetch:9,GroupCoordinator:10,JoinGroup:11,Heartbeat:12,LeaveGroup:13,SyncGroup:14,DescribeGroups:15,ListGroups:16,SaslHandshake:17,ApiVersions:18,CreateTopics:19,DeleteTopics:20,DeleteRecords:21,InitProducerId:22,OffsetForLeaderEpoch:23,AddPartitionsToTxn:24,AddOffsetsToTxn:25,EndTxn:26,WriteTxnMarkers:27,TxnOffsetCommit:28,DescribeAcls:29,CreateAcls:30,DeleteAcls:31,DescribeConfigs:32,AlterConfigs:33,AlterReplicaLogDirs:34,DescribeLogDirs:35,SaslAuthenticate:36,CreatePartitions:37,CreateDelegationToken:38,RenewDelegationToken:39,ExpireDelegationToken:40,DescribeDelegationToken:41,DeleteGroups:42,ElectPreferredLeaders:43,IncrementalAlterConfigs:44,AlterPartitionReassignments:45,ListPartitionReassignments:46};let ri=class e{constructor(e){this.value=e}static isLong(e){return"bigint"==typeof e.value}static fromBits(t){return new e(BigInt(t))}static fromInt(t){return isNaN(t)?e.ZERO:new e(BigInt.asIntN(64,BigInt(t)))}static fromNumber(t){return isNaN(t)?e.ZERO:new e(BigInt(t))}static fromValue(t){return"number"==typeof t?this.fromNumber(t):"string"==typeof t?this.fromString(t):"bigint"==typeof t?new e(t):this.isLong(t)?new e(BigInt(t.value)):new e(BigInt(t))}static fromString(t){if(0===t.length)throw Error("empty string");return"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t?e.ZERO:new e(BigInt(t))}isZero(){return this.value===BigInt(0)}isNegative(){return this.value<BigInt(0)}toString(){return String(this.value)}toNumber(){return Number(this.value)}toInt(){return Number(BigInt.asIntN(32,this.value))}toJSON(){return this.toString()}shiftLeft(t){return new e(this.value<<BigInt(t))}shiftRight(t){return new e(this.value>>BigInt(t))}or(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.value|t.value)}xor(t){return e.isLong(t)||(t=e.fromValue(t)),new e(this.value^t.value)}and(t){return e.isLong(t)||(t=e.fromValue(t)),new e(this.value&t.value)}not(){return new e(~this.value)}shiftRightUnsigned(t){return new e(this.value>>BigInt.asUintN(64,BigInt(t)))}equals(t){return e.isLong(t)||(t=e.fromValue(t)),this.value===t.value}greaterThanOrEqual(t){return e.isLong(t)||(t=e.fromValue(t)),this.value>=t.value}gte(e){return this.greaterThanOrEqual(e)}notEquals(t){return e.isLong(t)||(t=e.fromValue(t)),!this.equals(t)}add(t){return e.isLong(t)||(t=e.fromValue(t)),new e(this.value+t.value)}subtract(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.negate())}multiply(t){return this.isZero()?e.ZERO:(e.isLong(t)||(t=e.fromValue(t)),new e(this.value*t.value))}divide(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");return new e(this.value/t.value)}compare(t){return e.isLong(t)||(t=e.fromValue(t)),this.value===t.value?0:this.value>t.value?1:t.value>this.value?-1:void 0}lessThan(t){return e.isLong(t)||(t=e.fromValue(t)),this.value<t.value}negate(){return this.equals(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)}getHighBits(){return Number(BigInt.asIntN(32,this.value>>BigInt(32)))}getLowBits(){return Number(BigInt.asIntN(32,this.value))}};ri.MIN_VALUE=new ri(BigInt("-9223372036854775808")),ri.MAX_VALUE=new ri(BigInt("9223372036854775807")),ri.ZERO=ri.fromInt(0),ri.ONE=ri.fromInt(1);var si=ri;const ni=si,ii=4294967168,oi=0xffffffffffffff80n;var ai,ci,ui,li,di,pi,fi,hi,mi,gi,yi,Ii,bi=class e{static encodeZigZag(e){return e<<1^e>>31}static encodeZigZag64(e){const t=ni.fromValue(e);return t.shiftLeft(1).xor(t.shiftRight(63))}static sizeOfVarInt(e){let t=this.encodeZigZag(e),r=1;for(;0!==(t&ii);)r+=1,t>>>=7;return r}static sizeOfVarLong(t){let r=e.encodeZigZag64(t),s=1;for(;r.and(oi).notEquals(ni.fromInt(0));)s+=1,r=r.shiftRightUnsigned(7);return s}static sizeOfVarIntBytes(t){const r=null==t?-1:Buffer.byteLength(t);return r<0?e.sizeOfVarInt(-1):e.sizeOfVarInt(r)+r}static nextPowerOfTwo(e){return 1<<31-Math.clz32(e)+1}constructor(t=511){this.buf=Buffer.alloc(e.nextPowerOfTwo(t)),this.offset=0}writeBufferInternal(e){const t=e.length;this.ensureAvailable(t),e.copy(this.buf,this.offset,0),this.offset+=t}ensureAvailable(t){if(this.offset+t>this.buf.length){const r=e.nextPowerOfTwo(this.offset+t),s=Buffer.alloc(r);this.buf.copy(s,0,0,this.offset),this.buf=s}}get buffer(){return this.buf.slice(0,this.offset)}writeInt8(e){return this.ensureAvailable(1),this.buf.writeInt8(e,this.offset),this.offset+=1,this}writeInt16(e){return this.ensureAvailable(2),this.buf.writeInt16BE(e,this.offset),this.offset+=2,this}writeInt32(e){return this.ensureAvailable(4),this.buf.writeInt32BE(e,this.offset),this.offset+=4,this}writeUInt32(e){return this.ensureAvailable(4),this.buf.writeUInt32BE(e,this.offset),this.offset+=4,this}writeInt64(e){this.ensureAvailable(8);const t=ni.fromValue(e);return this.buf.writeInt32BE(t.getHighBits(),this.offset),this.buf.writeInt32BE(t.getLowBits(),this.offset+4),this.offset+=8,this}writeDouble(e){return this.ensureAvailable(8),this.buf.writeDoubleBE(e,this.offset),this.offset+=8,this}writeBoolean(e){return e?this.writeInt8(1):this.writeInt8(0),this}writeString(e){if(null==e)return this.writeInt16(-1),this;const t=Buffer.byteLength(e,"utf8");return this.ensureAvailable(2+t),this.writeInt16(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeVarIntString(e){if(null==e)return this.writeVarInt(-1),this;const t=Buffer.byteLength(e,"utf8");return this.writeVarInt(t),this.ensureAvailable(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeUVarIntString(e){if(null==e)return this.writeUVarInt(0),this;const t=Buffer.byteLength(e,"utf8");return this.writeUVarInt(t+1),this.ensureAvailable(t),this.buf.write(e,this.offset,t,"utf8"),this.offset+=t,this}writeBytes(e){if(null==e)return this.writeInt32(-1),this;if(Buffer.isBuffer(e))this.ensureAvailable(4+e.length),this.writeInt32(e.length),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.ensureAvailable(4+r),this.writeInt32(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeVarIntBytes(e){if(null==e)return this.writeVarInt(-1),this;if(Buffer.isBuffer(e))this.writeVarInt(e.length),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.writeVarInt(r),this.ensureAvailable(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeUVarIntBytes(e){if(null==e)return this.writeVarInt(0),this;if(Buffer.isBuffer(e))this.writeUVarInt(e.length+1),this.writeBufferInternal(e);else{const t=String(e),r=Buffer.byteLength(t,"utf8");this.writeUVarInt(r+1),this.ensureAvailable(r),this.buf.write(t,this.offset,r,"utf8"),this.offset+=r}return this}writeEncoder(e){if(null==e||!Buffer.isBuffer(e.buf))throw new Error("value should be an instance of Encoder");return this.writeBufferInternal(e.buffer),this}writeEncoderArray(e){if(!Array.isArray(e)||e.some(e=>null==e||!Buffer.isBuffer(e.buf)))throw new Error("all values should be an instance of Encoder[]");return e.forEach(e=>{this.writeBufferInternal(e.buffer)}),this}writeBuffer(e){if(!Buffer.isBuffer(e))throw new Error("value should be an instance of Buffer");return this.writeBufferInternal(e),this}writeNullableArray(e,t){const r=0!==e.length?e.length:-1;return this.writeArray(e,t,r),this}writeArray(e,t,r){const s=null==r?e.length:r;if(this.writeInt32(s),void 0!==t)switch(t){case"int32":case"number":e.forEach(e=>this.writeInt32(e));break;case"string":e.forEach(e=>this.writeString(e));break;case"object":this.writeEncoderArray(e)}else e.forEach(e=>{switch(typeof e){case"number":this.writeInt32(e);break;case"string":this.writeString(e);break;case"object":this.writeEncoder(e)}});return this}writeVarIntArray(e,t){if("object"===t)this.writeVarInt(e.length),this.writeEncoderArray(e);else{const t=e.filter(e=>"object"==typeof e);this.writeVarInt(t.length),this.writeEncoderArray(t)}return this}writeUVarIntArray(e,t){if("object"===t)this.writeUVarInt(e.length+1),this.writeEncoderArray(e);else if(null===e)this.writeUVarInt(0);else{const t=e.filter(e=>"object"==typeof e);this.writeUVarInt(t.length+1),this.writeEncoderArray(t)}return this}writeVarInt(t){return this.writeUVarInt(e.encodeZigZag(t))}writeUVarInt(e){const t=[];for(;0!==(e&ii);)t.push(127&e|128),e>>>=7;return t.push(127&e),this.writeBufferInternal(Buffer.from(t)),this}writeVarLong(t){const r=[];let s=e.encodeZigZag64(t);for(;s.and(oi).notEquals(ni.fromInt(0));)r.push(s.and(127).or(128).toInt()),s=s.shiftRightUnsigned(7);return r.push(s.toInt()),this.writeBufferInternal(Buffer.from(r)),this}size(){return this.offset}toJSON(){return this.buffer.toJSON()}};function wi(){if(ci)return ai;ci=1;var e=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);return ai=t=>{const{buffer:r}=t,s=r.length;let n=-1;for(let t=0;t<s;t++)n=e[255&(n^r[t])]^n>>>8;return-1^n},ai}function vi(){if(li)return ui;li=1;const e=bi,t=wi(),{Types:r,COMPRESSION_CODEC_MASK:s}=ei;return ui=({compression:n=r.None,key:i,value:o})=>{const a=(new e).writeInt8(0).writeInt8(n&s).writeBytes(i).writeBytes(o),c=t(a);return(new e).writeInt32(c).writeEncoder(a)},ui}function Ti(){if(pi)return di;pi=1;const e=bi,t=wi(),{Types:r,COMPRESSION_CODEC_MASK:s}=ei;return di=({compression:n=r.None,timestamp:i=Date.now(),key:o,value:a})=>{const c=(new e).writeInt8(1).writeInt8(n&s).writeInt64(i).writeBytes(o).writeBytes(a),u=t(c);return(new e).writeInt32(u).writeEncoder(c)},di}function Ei(){if(gi)return mi;gi=1;const e=bi,t=function(){if(hi)return fi;hi=1;const e={0:vi(),1:Ti()};return fi=({version:t=0})=>e[t],fi}(),{Types:r}=ei;return mi=({messageVersion:s=0,compression:n,entries:i})=>{const o=n!==r.None,a=t({version:s}),c=new e;return i.forEach((e,t)=>{const r=a(e);c.writeInt64(o?t:-1),c.writeInt32(r.size()),c.writeEncoder(r)}),c},mi}function _i(){if(Ii)return yi;Ii=1;const e=bi,{Produce:t}=ti,r=Ei();yi=({acks:r,timeout:n,topicData:i})=>({apiKey:t,apiVersion:0,apiName:"Produce",expectResponse:()=>0!==r,encode:async()=>(new e).writeInt16(r).writeInt32(n).writeArray(i.map(s))});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(n)),n=({partition:t,messages:s})=>{const n=r({messageVersion:0,entries:s});return(new e).writeInt32(t).writeInt32(n.size()).writeEncoder(n)};return yi}const{KafkaJSInvalidVarIntError:Ai,KafkaJSInvalidLongError:Si}=Mn,Oi=si;var Ni=class e{static int32Size(){return 4}static decodeZigZag(e){return e>>>1^-(1&e)}static decodeZigZag64(e){return e.shiftRightUnsigned(1).xor(e.and(Oi.fromInt(1)).negate())}constructor(e){this.buffer=e,this.offset=0}readInt8(){const e=this.buffer.readInt8(this.offset);return this.offset+=1,e}canReadInt16(){return this.canReadBytes(2)}readInt16(){const e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}canReadInt32(){return this.canReadBytes(4)}readInt32(){const e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}canReadInt64(){return this.canReadBytes(8)}readInt64(){const e=this.buffer[this.offset],t=this.buffer[this.offset+7],r=(e<<24)+65536*this.buffer[this.offset+1]+256*this.buffer[this.offset+2]+this.buffer[this.offset+3],s=this.buffer[this.offset+4]*2**24+65536*this.buffer[this.offset+5]+256*this.buffer[this.offset+6]+t;return this.offset+=8,(BigInt(r)<<32n)+BigInt(s)}readDouble(){const e=this.buffer.readDoubleBE(this.offset);return this.offset+=8,e}readString(){const e=this.readInt16();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e).toString("utf8");return this.offset+=e,t}readVarIntString(){const e=this.readVarInt();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e).toString("utf8");return this.offset+=e,t}readUVarIntString(){const e=this.readUVarInt();if(0===e)return null;const t=this.buffer.slice(this.offset,this.offset+e-1).toString("utf8");return this.offset+=e-1,t}canReadBytes(e){return Buffer.byteLength(this.buffer)-this.offset>=e}readBytes(e=this.readInt32()){if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarIntBytes(){const e=this.readVarInt();if(-1===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readUVarIntBytes(){const e=this.readUVarInt();if(0===e)return null;const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e-1,t}readBoolean(){return 1===this.readInt8()}readAll(){const e=this.buffer.slice(this.offset);return this.offset+=Buffer.byteLength(this.buffer),e}readArray(e){const t=this.readInt32();if(-1===t)return[];const r=new Array(t);for(let s=0;s<t;s++)r[s]=e(this);return r}readVarIntArray(e){const t=this.readVarInt();if(-1===t)return[];const r=new Array(t);for(let s=0;s<t;s++)r[s]=e(this);return r}readUVarIntArray(e){const t=this.readUVarInt();if(0===t)return null;const r=new Array(t-1);for(let s=0;s<t-1;s++)r[s]=e(this);return r}async readArrayAsync(e){const t=this.readInt32();if(-1===t)return[];const r=new Array(t);for(let s=0;s<t;s++)r[s]=await e(this);return r}readVarInt(){let t,r=0,s=0;do{t=this.buffer[this.offset++],r+=(127&t)<<s,s+=7}while(t>=128);return e.decodeZigZag(r)}readUVarInt(){let e,t=0,r=0;for(;128&(e=this.buffer[this.offset++]);)if(t|=(127&e)<<r,r+=7,r>28)throw new Ai("Invalid VarInt, must contain 5 bytes or less");return t|=e<<r,t>>>0}readTaggedFields(){const e=this.readUVarInt();if(0===e)return null;for(let t=0;t<e;t++)this.readUVarInt(),this.readUVarIntBytes();return{}}readVarLong(){let t,r=Oi.fromInt(0),s=0;do{if(s>63)throw new Si("Invalid Long, must contain 9 bytes or less");t=this.buffer[this.offset++],r=r.add(Oi.fromInt(127&t).shiftLeft(s)),s+=7}while(t>=128);return e.decodeZigZag64(r)}slice(t){return new e(this.buffer.slice(this.offset,this.offset+t))}forward(e){this.offset+=e}};const Ri=e=>t=>t.charAt(0)===e?t.substring(1):t,Ci=Ri("/"),ki=Ri("#");var xi=(e,t)=>`https://kafka.js.org/${Ci(e)}${t?"#"+ki(t):""}`;const{KafkaJSProtocolError:Li}=Mn,Bi=xi,Pi=[{type:"UNKNOWN",code:-1,retriable:!1,message:"The server experienced an unexpected error when processing the request"},{type:"OFFSET_OUT_OF_RANGE",code:1,retriable:!1,message:"The requested offset is not within the range of offsets maintained by the server"},{type:"CORRUPT_MESSAGE",code:2,retriable:!0,message:"This message has failed its CRC checksum, exceeds the valid size, or is otherwise corrupt"},{type:"UNKNOWN_TOPIC_OR_PARTITION",code:3,retriable:!0,message:"This server does not host this topic-partition"},{type:"INVALID_FETCH_SIZE",code:4,retriable:!1,message:"The requested fetch size is invalid"},{type:"LEADER_NOT_AVAILABLE",code:5,retriable:!0,message:"There is no leader for this topic-partition as we are in the middle of a leadership election"},{type:"NOT_LEADER_FOR_PARTITION",code:6,retriable:!0,message:"This server is not the leader for that topic-partition"},{type:"REQUEST_TIMED_OUT",code:7,retriable:!0,message:"The request timed out"},{type:"BROKER_NOT_AVAILABLE",code:8,retriable:!1,message:"The broker is not available"},{type:"REPLICA_NOT_AVAILABLE",code:9,retriable:!0,message:"The replica is not available for the requested topic-partition"},{type:"MESSAGE_TOO_LARGE",code:10,retriable:!1,message:"The request included a message larger than the max message size the server will accept"},{type:"STALE_CONTROLLER_EPOCH",code:11,retriable:!1,message:"The controller moved to another broker"},{type:"OFFSET_METADATA_TOO_LARGE",code:12,retriable:!1,message:"The metadata field of the offset request was too large"},{type:"NETWORK_EXCEPTION",code:13,retriable:!0,message:"The server disconnected before a response was received"},{type:"GROUP_LOAD_IN_PROGRESS",code:14,retriable:!0,message:"The coordinator is loading and hence can't process requests for this group"},{type:"GROUP_COORDINATOR_NOT_AVAILABLE",code:15,retriable:!0,message:"The group coordinator is not available"},{type:"NOT_COORDINATOR_FOR_GROUP",code:16,retriable:!0,message:"This is not the correct coordinator for this group"},{type:"INVALID_TOPIC_EXCEPTION",code:17,retriable:!1,message:"The request attempted to perform an operation on an invalid topic"},{type:"RECORD_LIST_TOO_LARGE",code:18,retriable:!1,message:"The request included message batch larger than the configured segment size on the server"},{type:"NOT_ENOUGH_REPLICAS",code:19,retriable:!0,message:"Messages are rejected since there are fewer in-sync replicas than required"},{type:"NOT_ENOUGH_REPLICAS_AFTER_APPEND",code:20,retriable:!0,message:"Messages are written to the log, but to fewer in-sync replicas than required"},{type:"INVALID_REQUIRED_ACKS",code:21,retriable:!1,message:"Produce request specified an invalid value for required acks"},{type:"ILLEGAL_GENERATION",code:22,retriable:!1,message:"Specified group generation id is not valid"},{type:"INCONSISTENT_GROUP_PROTOCOL",code:23,retriable:!1,message:"The group member's supported protocols are incompatible with those of existing members"},{type:"INVALID_GROUP_ID",code:24,retriable:!1,message:"The configured groupId is invalid"},{type:"UNKNOWN_MEMBER_ID",code:25,retriable:!1,message:"The coordinator is not aware of this member"},{type:"INVALID_SESSION_TIMEOUT",code:26,retriable:!1,message:"The session timeout is not within the range allowed by the broker (as configured by group.min.session.timeout.ms and group.max.session.timeout.ms)"},{type:"REBALANCE_IN_PROGRESS",code:27,retriable:!1,message:"The group is rebalancing, so a rejoin is needed",helpUrl:Bi("docs/faq","what-does-it-mean-to-get-rebalance-in-progress-errors")},{type:"INVALID_COMMIT_OFFSET_SIZE",code:28,retriable:!1,message:"The committing offset data size is not valid"},{type:"TOPIC_AUTHORIZATION_FAILED",code:29,retriable:!1,message:"Not authorized to access topics: [Topic authorization failed]"},{type:"GROUP_AUTHORIZATION_FAILED",code:30,retriable:!1,message:"Not authorized to access group: Group authorization failed"},{type:"CLUSTER_AUTHORIZATION_FAILED",code:31,retriable:!1,message:"Cluster authorization failed"},{type:"INVALID_TIMESTAMP",code:32,retriable:!1,message:"The timestamp of the message is out of acceptable range"},{type:"UNSUPPORTED_SASL_MECHANISM",code:33,retriable:!1,message:"The broker does not support the requested SASL mechanism"},{type:"ILLEGAL_SASL_STATE",code:34,retriable:!1,message:"Request is not valid given the current SASL state"},{type:"UNSUPPORTED_VERSION",code:35,retriable:!1,message:"The version of API is not supported"},{type:"TOPIC_ALREADY_EXISTS",code:36,retriable:!1,message:"Topic with this name already exists"},{type:"INVALID_PARTITIONS",code:37,retriable:!1,message:"Number of partitions is invalid"},{type:"INVALID_REPLICATION_FACTOR",code:38,retriable:!1,message:"Replication-factor is invalid"},{type:"INVALID_REPLICA_ASSIGNMENT",code:39,retriable:!1,message:"Replica assignment is invalid"},{type:"INVALID_CONFIG",code:40,retriable:!1,message:"Configuration is invalid"},{type:"NOT_CONTROLLER",code:41,retriable:!0,message:"This is not the correct controller for this cluster"},{type:"INVALID_REQUEST",code:42,retriable:!1,message:"This most likely occurs because of a request being malformed by the client library or the message was sent to an incompatible broker. See the broker logs for more details"},{type:"UNSUPPORTED_FOR_MESSAGE_FORMAT",code:43,retriable:!1,message:"The message format version on the broker does not support the request"},{type:"POLICY_VIOLATION",code:44,retriable:!1,message:"Request parameters do not satisfy the configured policy"},{type:"OUT_OF_ORDER_SEQUENCE_NUMBER",code:45,retriable:!1,message:"The broker received an out of order sequence number"},{type:"DUPLICATE_SEQUENCE_NUMBER",code:46,retriable:!1,message:"The broker received a duplicate sequence number"},{type:"INVALID_PRODUCER_EPOCH",code:47,retriable:!1,message:"Producer attempted an operation with an old epoch. Either there is a newer producer with the same transactionalId, or the producer's transaction has been expired by the broker"},{type:"INVALID_TXN_STATE",code:48,retriable:!1,message:"The producer attempted a transactional operation in an invalid state"},{type:"INVALID_PRODUCER_ID_MAPPING",code:49,retriable:!1,message:"The producer attempted to use a producer id which is not currently assigned to its transactional id"},{type:"INVALID_TRANSACTION_TIMEOUT",code:50,retriable:!1,message:"The transaction timeout is larger than the maximum value allowed by the broker (as configured by max.transaction.timeout.ms)"},{type:"CONCURRENT_TRANSACTIONS",code:51,retriable:!0,message:"The producer attempted to update a transaction while another concurrent operation on the same transaction was ongoing"},{type:"TRANSACTION_COORDINATOR_FENCED",code:52,retriable:!1,message:"Indicates that the transaction coordinator sending a WriteTxnMarker is no longer the current coordinator for a given producer"},{type:"TRANSACTIONAL_ID_AUTHORIZATION_FAILED",code:53,retriable:!1,message:"Transactional Id authorization failed"},{type:"SECURITY_DISABLED",code:54,retriable:!1,message:"Security features are disabled"},{type:"OPERATION_NOT_ATTEMPTED",code:55,retriable:!1,message:"The broker did not attempt to execute this operation. This may happen for batched RPCs where some operations in the batch failed, causing the broker to respond without trying the rest"},{type:"KAFKA_STORAGE_ERROR",code:56,retriable:!0,message:"Disk error when trying to access log file on the disk"},{type:"LOG_DIR_NOT_FOUND",code:57,retriable:!1,message:"The user-specified log directory is not found in the broker config"},{type:"SASL_AUTHENTICATION_FAILED",code:58,retriable:!1,message:"SASL Authentication failed",helpUrl:Bi("docs/configuration","sasl")},{type:"UNKNOWN_PRODUCER_ID",code:59,retriable:!1,message:"This exception is raised by the broker if it could not locate the producer metadata associated with the producerId in question. This could happen if, for instance, the producer's records were deleted because their retention time had elapsed. Once the last records of the producerId are removed, the producer's metadata is removed from the broker, and future appends by the producer will return this exception"},{type:"REASSIGNMENT_IN_PROGRESS",code:60,retriable:!1,message:"A partition reassignment is in progress"},{type:"DELEGATION_TOKEN_AUTH_DISABLED",code:61,retriable:!1,message:"Delegation Token feature is not enabled"},{type:"DELEGATION_TOKEN_NOT_FOUND",code:62,retriable:!1,message:"Delegation Token is not found on server"},{type:"DELEGATION_TOKEN_OWNER_MISMATCH",code:63,retriable:!1,message:"Specified Principal is not valid Owner/Renewer"},{type:"DELEGATION_TOKEN_REQUEST_NOT_ALLOWED",code:64,retriable:!1,message:"Delegation Token requests are not allowed on PLAINTEXT/1-way SSL channels and on delegation token authenticated channels"},{type:"DELEGATION_TOKEN_AUTHORIZATION_FAILED",code:65,retriable:!1,message:"Delegation Token authorization failed"},{type:"DELEGATION_TOKEN_EXPIRED",code:66,retriable:!1,message:"Delegation Token is expired"},{type:"INVALID_PRINCIPAL_TYPE",code:67,retriable:!1,message:"Supplied principalType is not supported"},{type:"NON_EMPTY_GROUP",code:68,retriable:!1,message:"The group is not empty"},{type:"GROUP_ID_NOT_FOUND",code:69,retriable:!1,message:"The group id was not found"},{type:"FETCH_SESSION_ID_NOT_FOUND",code:70,retriable:!0,message:"The fetch session ID was not found"},{type:"INVALID_FETCH_SESSION_EPOCH",code:71,retriable:!0,message:"The fetch session epoch is invalid"},{type:"LISTENER_NOT_FOUND",code:72,retriable:!0,message:"There is no listener on the leader broker that matches the listener on which metadata request was processed"},{type:"TOPIC_DELETION_DISABLED",code:73,retriable:!1,message:"Topic deletion is disabled"},{type:"FENCED_LEADER_EPOCH",code:74,retriable:!0,message:"The leader epoch in the request is older than the epoch on the broker"},{type:"UNKNOWN_LEADER_EPOCH",code:75,retriable:!0,message:"The leader epoch in the request is newer than the epoch on the broker"},{type:"UNSUPPORTED_COMPRESSION_TYPE",code:76,retriable:!1,message:"The requesting client does not support the compression type of given partition"},{type:"STALE_BROKER_EPOCH",code:77,retriable:!1,message:"Broker epoch has changed"},{type:"OFFSET_NOT_AVAILABLE",code:78,retriable:!0,message:"The leader high watermark has not caught up from a recent leader election so the offsets cannot be guaranteed to be monotonically increasing"},{type:"MEMBER_ID_REQUIRED",code:79,retriable:!1,message:"The group member needs to have a valid member id before actually entering a consumer group"},{type:"PREFERRED_LEADER_NOT_AVAILABLE",code:80,retriable:!0,message:"The preferred leader was not available"},{type:"GROUP_MAX_SIZE_REACHED",code:81,retriable:!1,message:"The consumer group has reached its max size. It already has the configured maximum number of members"},{type:"FENCED_INSTANCE_ID",code:82,retriable:!1,message:"The broker rejected this static consumer since another consumer with the same group instance id has registered with a different member id"},{type:"ELIGIBLE_LEADERS_NOT_AVAILABLE",code:83,retriable:!0,message:"Eligible topic partition leaders are not available"},{type:"ELECTION_NOT_NEEDED",code:84,retriable:!0,message:"Leader election not needed for topic partition"},{type:"NO_REASSIGNMENT_IN_PROGRESS",code:85,retriable:!1,message:"No partition reassignment is in progress"},{type:"GROUP_SUBSCRIBED_TO_TOPIC",code:86,retriable:!1,message:"Deleting offsets of a topic is forbidden while the consumer group is actively subscribed to it"},{type:"INVALID_RECORD",code:87,retriable:!1,message:"This record has failed the validation on broker and hence be rejected"},{type:"UNSTABLE_OFFSET_COMMIT",code:88,retriable:!0,message:"There are unstable offsets that need to be cleared"}],Mi=e=>new Li(Pi.find(t=>t.code===e)||{type:"KAFKAJS_UNKNOWN_ERROR_CODE",code:-99,retriable:!1,message:`Unknown error code ${e}`});var Di,$i,Ui,ji,Gi,Fi,Vi,Ki,qi,Wi,Hi,Zi,Ji,Xi,zi,Yi,Qi,eo,to,ro,so,no,io,oo,ao,co,uo,lo,po,fo,ho,mo,go,yo,Io,bo,wo,vo,To,Eo,_o={failure:e=>0!==e,errorCodes:Pi,createErrorFromCode:Mi,failIfVersionNotSupported:e=>{if(35===e)throw Mi(35)},staleMetadata:e=>["UNKNOWN_TOPIC_OR_PARTITION","LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION"].includes(e.type)};function Ao(){if($i)return Di;$i=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString()});return Di={decode:async t=>{const r=new e(t).readArray(e=>({topicName:e.readString(),partitions:e.readArray(s)}));return{topics:r}},parse:async e=>{const s=e.topics.flatMap(e=>e.partitions.filter(e=>t(e.errorCode)));if(s.length>0){const{errorCode:e}=s[0];throw r(e)}return e}},Di}function So(){if(Ki)return Vi;Ki=1;const e=bi,{Produce:t}=ti,r=Ei(),{Types:s,lookupCodec:n}=ei;Vi=({acks:r,timeout:n,compression:o=s.None,topicData:a})=>({apiKey:t,apiVersion:2,apiName:"Produce",expectResponse:()=>0!==r,encode:async()=>{const t=i(o),s=[];for(const e of a)s.push(await t(e));return(new e).writeInt16(r).writeInt32(n).writeArray(s)}});const i=t=>{const r=o(t);return async({topic:t,partitions:s})=>{const n=[];for(const e of s)n.push(await r(e));return(new e).writeString(t).writeArray(n)}},o=t=>async({partition:i,messages:o})=>{const a=r({messageVersion:1,compression:t,entries:o});if(t===s.None)return(new e).writeInt32(i).writeInt32(a.size()).writeEncoder(a);const c=o[0].timestamp||Date.now(),u=n(t),l=await u.compress(a),d=r({messageVersion:1,entries:[{compression:t,timestamp:c,value:l}]});return(new e).writeInt32(i).writeInt32(d.size()).writeEncoder(d)};return Vi}function Oo(){if(Xi)return Ji;Xi=1;const e=bi,t=function(){if(Zi)return Hi;Zi=1;const e=bi;return Hi=({key:t,value:r})=>(new e).writeVarIntString(t).writeVarIntBytes(r)}();Ji=({offsetDelta:s=0,timestampDelta:n=0,key:i,value:o,headers:a={}})=>{const c=Object.keys(a).flatMap(e=>Array.isArray(a[e])?a[e].map(t=>({key:e,value:t})):[{key:e,value:a[e]}]),u=1+e.sizeOfVarLong(n)+e.sizeOfVarInt(s)+e.sizeOfVarIntBytes(i)+e.sizeOfVarIntBytes(o)+r(c);return(new e).writeVarInt(u).writeInt8(0).writeVarLong(n).writeVarInt(s).writeVarIntBytes(i).writeVarIntBytes(o).writeVarIntArray(c.map(t))};const r=t=>{let r=e.sizeOfVarInt(t.length);for(const s of t){const t=Buffer.byteLength(s.key),n=Buffer.byteLength(s.value);r+=e.sizeOfVarInt(t)+t,null===s.value?r+=e.sizeOfVarInt(-1):r+=e.sizeOfVarInt(n)+n}return r};return Ji}function No(){if(eo)return Qi;eo=1;const e=function(){if(Yi)return zi;Yi=1,zi=t=>{let r=-1;for(let s=0;s<t.length;s++)r=e[255&(r^t[s])]^r>>>8;return(-1^r)>>>0};var e=new Int32Array([0,4067132163,3778769143,324072436,3348797215,904991772,648144872,3570033899,2329499855,2024987596,1809983544,2575936315,1296289744,3207089363,2893594407,1578318884,274646895,3795141740,4049975192,51262619,3619967088,632279923,922689671,3298075524,2592579488,1760304291,2075979607,2312596564,1562183871,2943781820,3156637768,1313733451,549293790,3537243613,3246849577,871202090,3878099393,357341890,102525238,4101499445,2858735121,1477399826,1264559846,3107202533,1845379342,2677391885,2361733625,2125378298,820201905,3263744690,3520608582,598981189,4151959214,85089709,373468761,3827903834,3124367742,1213305469,1526817161,2842354314,2107672161,2412447074,2627466902,1861252501,1098587580,3004210879,2688576843,1378610760,2262928035,1955203488,1742404180,2511436119,3416409459,969524848,714683780,3639785095,205050476,4266873199,3976438427,526918040,1361435347,2739821008,2954799652,1114974503,2529119692,1691668175,2005155131,2247081528,3690758684,697762079,986182379,3366744552,476452099,3993867776,4250756596,255256311,1640403810,2477592673,2164122517,1922457750,2791048317,1412925310,1197962378,3037525897,3944729517,427051182,170179418,4165941337,746937522,3740196785,3451792453,1070968646,1905808397,2213795598,2426610938,1657317369,3053634322,1147748369,1463399397,2773627110,4215344322,153784257,444234805,3893493558,1021025245,3467647198,3722505002,797665321,2197175160,1889384571,1674398607,2443626636,1164749927,3070701412,2757221520,1446797203,137323447,4198817972,3910406976,461344835,3484808360,1037989803,781091935,3705997148,2460548119,1623424788,1939049696,2180517859,1429367560,2807687179,3020495871,1180866812,410100952,3927582683,4182430767,186734380,3756733383,763408580,1053836080,3434856499,2722870694,1344288421,1131464017,2971354706,1708204729,2545590714,2229949006,1988219213,680717673,3673779818,3383336350,1002577565,4010310262,493091189,238226049,4233660802,2987750089,1082061258,1395524158,2705686845,1972364758,2279892693,2494862625,1725896226,952904198,3399985413,3656866545,731699698,4283874585,222117402,510512622,3959836397,3280807620,837199303,582374963,3504198960,68661723,4135334616,3844915500,390545967,1230274059,3141532936,2825850620,1510247935,2395924756,2091215383,1878366691,2644384480,3553878443,565732008,854102364,3229815391,340358836,3861050807,4117890627,119113024,1493875044,2875275879,3090270611,1247431312,2660249211,1828433272,2141937292,2378227087,3811616794,291187481,34330861,4032846830,615137029,3603020806,3314634738,939183345,1776939221,2609017814,2295496738,2058945313,2926798794,1545135305,1330124605,3173225534,4084100981,17165430,307568514,3762199681,888469610,3332340585,3587147933,665062302,2042050490,2346497209,2559330125,1793573966,3190661285,1279665062,1595330642,2910671697]);return zi}();return Qi=t=>{return r=e(t),Uint32Array.from([r])[0];var r}}function Ro(){if(ro)return to;ro=1;const e=si,t=bi,r=No(),{Types:s,lookupCodec:n,COMPRESSION_CODEC_MASK:i}=ei,o=async(e,r)=>{const s=n(e),i=new t;return i.writeEncoderArray(r),s.compress(i)};return to={RecordBatch:async({compression:n=s.None,firstOffset:a=e.fromInt(0),firstTimestamp:c=Date.now(),maxTimestamp:u=Date.now(),partitionLeaderEpoch:l=0,lastOffsetDelta:d=0,transactional:p=!1,producerId:f=e.fromValue(-1),producerEpoch:h=0,firstSequence:m=0,records:g=[]})=>{const y=0|n&i|(p?16:0),I=(new t).writeInt16(y).writeInt32(d).writeInt64(c).writeInt64(u).writeInt64(f).writeInt16(h).writeInt32(m);if(n===s.None)g.every(e=>typeof e==typeof g[0])?I.writeArray(g,typeof g[0]):I.writeArray(g);else{const e=await o(n,g);I.writeInt32(g.length).writeBuffer(e)}const b=(new t).writeInt32(l).writeInt8(2).writeUInt32(r(I.buffer)).writeEncoder(I);return(new t).writeInt64(a).writeBytes(b.buffer)},MAGIC_BYTE:2},to}function Co(){if(no)return so;no=1;const e=si,t=bi,{Produce:r}=ti,{Types:s}=ei,n=Oo(),{RecordBatch:i}=Ro();so=({acks:n,timeout:i,transactionalId:a=null,producerId:c=e.fromInt(-1),producerEpoch:u=0,compression:l=s.None,topicData:d})=>({apiKey:r,apiVersion:3,apiName:"Produce",expectResponse:()=>0!==n,encode:async()=>{const e=o(l),r=[];for(const t of d)r.push(await e({...t,transactionalId:a,producerId:c,producerEpoch:u}));return(new t).writeString(a).writeInt16(n).writeInt32(i).writeArray(r)}});const o=e=>async({topic:r,partitions:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const c=a(e),u=[];for(const e of s)u.push(await c({...e,transactionalId:n,producerId:i,producerEpoch:o}));return(new t).writeString(r).writeArray(u)},a=e=>async({partition:r,messages:s,transactionalId:o,firstSequence:a,producerId:c,producerEpoch:u})=>{const l=Date.now(),d=s.map(e=>e.timestamp).filter(e=>null!=e).sort(),p=0===d.length?[l]:d,f=p[0],h=p[p.length-1],m=s.map((e,t)=>n({...e,offsetDelta:t,timestampDelta:(e.timestamp||l)-f})),g=await i({compression:e,records:m,firstTimestamp:f,maxTimestamp:h,producerId:c,producerEpoch:u,firstSequence:a,transactional:!!o,lastOffsetDelta:m.length-1});return(new t).writeInt32(r).writeInt32(g.size()).writeEncoder(g)};return so}function ko(){if(oo)return io;oo=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({partition:e.readInt32(),errorCode:e.readInt16(),baseOffset:e.readInt64().toString(),logAppendTime:e.readInt64().toString()});return io={decode:async t=>{const r=new e(t),n=r.readArray(e=>({topicName:e.readString(),partitions:e.readArray(s)}));return{topics:n,throttleTime:r.readInt32()}},parse:async e=>{const s=e.topics.flatMap(e=>e.partitions.filter(e=>t(e.errorCode)));if(s.length>0){const{errorCode:e}=s[0];throw r(e)}return e}},io}function xo(){if(fo)return po;fo=1;const e=Co();return po=({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a})=>Object.assign(e({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a}),{apiVersion:5}),po}function Lo(){if(mo)return ho;mo=1;const e=Ni,{parse:t}=ko(),r=e=>({partition:e.readInt32(),errorCode:e.readInt16(),baseOffset:e.readInt64().toString(),logAppendTime:e.readInt64().toString(),logStartOffset:e.readInt64().toString()});return ho={decode:async t=>{const s=new e(t),n=s.readArray(e=>({topicName:e.readString(),partitions:e.readArray(r)}));return{topics:n,throttleTime:s.readInt32()}},parse:t},ho}function Bo(){if(yo)return go;yo=1;const e=xo();return go=({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a})=>Object.assign(e({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a}),{apiVersion:6}),go}function Po(){if(bo)return Io;bo=1;const{parse:e,decode:t}=Lo();return Io={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const Mo={0:({acks:e,timeout:t,topicData:r})=>{const s=_i(),n=Ao();return{request:s({acks:e,timeout:t,topicData:r}),response:n}},1:({acks:e,timeout:t,topicData:r})=>{const s=function(){if(ji)return Ui;ji=1;const e=_i();return Ui=({acks:t,timeout:r,topicData:s})=>Object.assign(e({acks:t,timeout:r,topicData:s}),{apiVersion:1})}(),n=function(){if(Fi)return Gi;Fi=1;const e=Ni,{parse:t}=Ao(),r=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString()});return Gi={decode:async t=>{const s=new e(t),n=s.readArray(e=>({topicName:e.readString(),partitions:e.readArray(r)}));return{topics:n,throttleTime:s.readInt32()}},parse:t},Gi}();return{request:s({acks:e,timeout:t,topicData:r}),response:n}},2:({acks:e,timeout:t,topicData:r,compression:s})=>{const n=So(),i=function(){if(Wi)return qi;Wi=1;const e=Ni,{parse:t}=Ao(),r=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offset:e.readInt64().toString(),timestamp:e.readInt64().toString()});return qi={decode:async t=>{const s=new e(t),n=s.readArray(e=>({topicName:e.readString(),partitions:e.readArray(r)}));return{topics:n,throttleTime:s.readInt32()}},parse:t},qi}();return{request:n({acks:e,timeout:t,compression:s,topicData:r}),response:i}},3:({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const a=Co(),c=ko();return{request:a({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o}),response:c}},4:({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const a=function(){if(co)return ao;co=1;const e=Co();return ao=({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a})=>Object.assign(e({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a}),{apiVersion:4}),ao}(),c=function(){if(lo)return uo;lo=1;const{decode:e,parse:t}=ko();return uo={decode:e,parse:t}}();return{request:a({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o}),response:c}},5:({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const a=xo(),c=Lo();return{request:a({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o}),response:c}},6:({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const a=Bo(),c=Po();return{request:a({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o}),response:c}},7:({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o})=>{const a=function(){if(vo)return wo;vo=1;const e=Bo();return wo=({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a})=>Object.assign(e({acks:t,timeout:r,transactionalId:s,producerId:n,producerEpoch:i,compression:o,topicData:a}),{apiVersion:7}),wo}(),c=function(){if(Eo)return To;Eo=1;const{decode:e,parse:t}=Po();return To={decode:e,parse:t}}();return{request:a({acks:e,timeout:t,compression:r,topicData:s,transactionalId:n,producerId:i,producerEpoch:o}),response:c}}};var Do,$o,Uo,jo,Go,Fo,Vo,Ko,qo,Wo,Ho,Zo,Jo,Xo,zo,Yo,Qo,ea,ta,ra,sa,na,ia,oa,aa,ca,ua,la,da,pa,fa,ha,ma,ga,ya,Ia,ba,wa,va,Ta,Ea,_a,Aa,Sa,Oa,Na,Ra,Ca,ka,xa,La,Ba,Pa,Ma,Da,$a,Ua,ja,Ga,Fa,Va,Ka,qa,Wa,Ha,Za,Ja={versions:Object.keys(Mo),protocol:({version:e})=>Mo[e]},Xa={READ_UNCOMMITTED:0,READ_COMMITTED:1};function za(){if($o)return Do;$o=1;const e=bi,{Fetch:t}=ti;Do=({replicaId:s,maxWaitTime:n,minBytes:i,topics:o})=>({apiKey:t,apiVersion:0,apiName:"Fetch",encode:async()=>(new e).writeInt32(s).writeInt32(n).writeInt32(i).writeArray(o.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,fetchOffset:r,maxBytes:s})=>(new e).writeInt32(t).writeInt64(r).writeInt32(s);return Do}function Ya(){if(Ko)return Vo;Ko=1;const{KafkaJSPartialMessageError:e,KafkaJSUnsupportedMagicByteInMessageSet:t}=Mn,r=(jo||(jo=1,Uo=e=>({attributes:e.readInt8(),key:e.readBytes(),value:e.readBytes()})),Uo),s=(Fo||(Fo=1,Go=e=>({attributes:e.readInt8(),timestamp:e.readInt64().toString(),key:e.readBytes(),value:e.readBytes()})),Go);return Vo=(n,i,o)=>{const a=Buffer.byteLength(o.slice(i).buffer);if(a<i)throw new e(`Tried to decode a partial message: remainingBytes(${a}) < messageSize(${i})`);const c=o.readInt32(),u=o.readInt8(),l=((e,n)=>{switch(n){case 0:return r(e);case 1:return s(e);default:throw new t(`Unsupported MessageSet message version, magic byte: ${n}`)}})(o,u);return Object.assign({offset:n,size:i,crc:c,magicByte:u},l)},Vo}function Qa(){if(Wo)return qo;Wo=1;const e=si,t=Ni,r=Ya(),{lookupCodecByAttributes:s}=ei,{KafkaJSPartialMessageError:n}=Mn;qo=async(e,r=null)=>{const n=[],a=r||e.readInt32(),c=e.slice(a);for(;c.offset<a;)try{const e=o(c),r=s(e.attributes);if(r){const s=await r.decompress(e.value);n.push(...i(new t(s),e))}else n.push(e)}catch(e){if("KafkaJSPartialMessageError"===e.name)break;if("KafkaJSUnsupportedMagicByteInMessageSet"===e.name)break;throw e}return e.forward(a),n};const i=(t,r)=>{const s=[];for(;t.offset<t.buffer.length;)s.push(o(t));if(r.magicByte>0&&r.offset>=0){const t=e.fromValue(r.offset)-e.fromValue(s[s.length-1].offset);for(const r of s)r.offset=e.fromValue(r.offset).add(t).toString()}return s},o=e=>{if(!e.canReadInt64())throw new n("Tried to decode a partial message: There isn't enough bytes to read the offset");const t=e.readInt64().toString();if(!e.canReadInt32())throw new n("Tried to decode a partial message: There isn't enough bytes to read the message size");const s=e.readInt32();return r(t,s,e)};return qo}function ec(){if(Zo)return Ho;Zo=1;const e=Ni,{KafkaJSOffsetOutOfRange:t}=Mn,{failure:r,createErrorFromCode:s,errorCodes:n}=_o,i=Qa(),o=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),messages:await i(e)}),a=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(o)}),{code:c}=n.find(e=>"OFFSET_OUT_OF_RANGE"===e.type);return Ho={decode:async t=>{const r=new e(t);return{responses:await r.readArrayAsync(a)}},parse:async e=>{const n=e.responses.flatMap(({topicName:e,partitions:t})=>t.filter(e=>r(e.errorCode)).map(t=>Object.assign({},t,{topic:e})));if(n.length>0){const{errorCode:e,topic:r,partition:i}=n[0];if(e===c)throw new t(s(e),{topic:r,partition:i});throw s(e)}return e}},Ho}function tc(){if(Yo)return zo;Yo=1;const e=Ni,{parse:t}=ec(),r=Qa(),s=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),messages:await r(e)}),n=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(s)});return zo={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),responses:await r.readArrayAsync(n)}},parse:t},zo}function rc(){if(ca)return aa;ca=1;const e=bi,{Fetch:t}=ti,r=Xa;aa=({replicaId:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c,isolationLevel:u=r.READ_COMMITTED})=>({apiKey:t,apiVersion:4,apiName:"Fetch",encode:async()=>(new e).writeInt32(n).writeInt32(i).writeInt32(o).writeInt32(a).writeInt8(u).writeArray(c.map(s))});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(n)),n=({partition:t,fetchOffset:r,maxBytes:s})=>(new e).writeInt32(t).writeInt64(r).writeInt32(s);return aa}function sc(){return pa?da:(pa=1,da={NO_TIMESTAMP:-1,CREATE_TIME:0,LOG_APPEND_TIME:1})}function nc(){if(ha)return fa;ha=1;const e=si,t=(la||(la=1,ua=e=>({key:e.readVarIntString(),value:e.readVarIntBytes()})),ua),r=sc();return fa=(s,n={})=>{const{firstOffset:i,firstTimestamp:o,magicByte:a,isControlBatch:c=!1,timestampType:u,maxTimestamp:l}=n,d=s.readInt8(),p=s.readVarLong(),f=u===r.LOG_APPEND_TIME&&l?l:e.fromValue(o).add(p).toString(),h=s.readVarInt(),m=e.fromValue(i).add(h).toString(),g=s.readVarIntBytes(),y=s.readVarIntBytes(),I=s.readVarIntArray(t).reduce((e,{key:t,value:r})=>({...e,[t]:void 0===e[t]?r:Array.isArray(e[t])?e[t].concat([r]):[e[t],r]}),{});return{magicByte:a,attributes:d,timestamp:f,offset:m,key:g,value:y,headers:I,isControlRecord:c,batchContext:n}},fa}function ic(){if(Ia)return ya;Ia=1;const e=Ni,t=Qa(),r=function(){if(ga)return ma;ga=1;const e=Ni,{KafkaJSPartialMessageError:t}=Mn,{lookupCodecByAttributes:r}=ei,s=nc(),n=sc();ma=async e=>{const s=e.readInt64().toString(),o=e.readInt32(),a=e.slice(o);e.forward(o);const c=Buffer.byteLength(a.buffer);if(c<o)throw new t(`Tried to decode a partial record batch: remainingBytes(${c}) < recordBatchLength(${o})`);const u=a.readInt32(),l=a.readInt8();a.readInt32();const d=a.readInt16(),p=a.readInt32(),f=a.readInt64().toString(),h=a.readInt64().toString(),m=a.readInt64().toString(),g=a.readInt16(),y=a.readInt32(),I=(16&d)>0,b=(32&d)>0,w=(8&d)>0?n.LOG_APPEND_TIME:n.CREATE_TIME,v=r(d),T={firstOffset:s,firstTimestamp:f,partitionLeaderEpoch:u,inTransaction:I,isControlBatch:b,lastOffsetDelta:p,producerId:m,producerEpoch:g,firstSequence:y,maxTimestamp:h,timestampType:w},E=await i(v,a,{...T,magicByte:l});return{...T,records:E}};const i=async(t,r,s)=>{if(!t)return r.readArray(e=>o(e,s));const n=r.readInt32();if(n<=0)return[];const i=r.readAll(),a=await t.decompress(i),c=new e(a),u=new Array(n);for(let e=0;e<n;e++)u[e]=o(c,s);return u},o=(t,r)=>{const n=t.readVarIntBytes();return s(new e(n),r)};return ma}(),{MAGIC_BYTE:s}=Ro();return ya=async n=>{const i=n.readInt32();if(i<=0||!n.canReadBytes(i))return[];const o=n.readBytes(i),a=new e(o);if(o.slice(16).readInt8(0)===s){const e=[];for(;a.canReadBytes(49);)try{const t=await r(a);e.push(...t.records)}catch(e){if("KafkaJSPartialMessageError"===e.name)break;throw e}return e}return t(a,i)},ya}function oc(){if(Ta)return va;Ta=1;const e=bi,{Fetch:t}=ti,r=Xa;va=({replicaId:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c,isolationLevel:u=r.READ_COMMITTED})=>({apiKey:t,apiVersion:5,apiName:"Fetch",encode:async()=>(new e).writeInt32(n).writeInt32(i).writeInt32(o).writeInt32(a).writeInt8(u).writeArray(c.map(s))});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(n)),n=({partition:t,fetchOffset:r,logStartOffset:s=-1,maxBytes:n})=>(new e).writeInt32(t).writeInt64(r).writeInt64(s).writeInt32(n);return va}function ac(){if(_a)return Ea;_a=1;const e=Ni,{parse:t}=tc(),r=ic(),s=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(s),messages:await r(e)}),i=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});return Ea={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),responses:await r.readArrayAsync(i)}},parse:t},Ea}function cc(){if(Sa)return Aa;Sa=1;const e=Xa,t=oc();return Aa=({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a=e.READ_COMMITTED})=>Object.assign(t({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a}),{apiVersion:6}),Aa}function uc(){if(Ca)return Ra;Ca=1;const e=bi,{Fetch:t}=ti,r=Xa;Ra=({replicaId:i,maxWaitTime:o,minBytes:a,maxBytes:c,topics:u,isolationLevel:l=r.READ_COMMITTED,sessionId:d=0,sessionEpoch:p=-1,forgottenTopics:f=[]})=>({apiKey:t,apiVersion:7,apiName:"Fetch",encode:async()=>(new e).writeInt32(i).writeInt32(o).writeInt32(a).writeInt32(c).writeInt8(l).writeInt32(d).writeInt32(p).writeArray(u.map(n)).writeArray(f.map(s))});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r),n=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(i)),i=({partition:t,fetchOffset:r,logStartOffset:s=-1,maxBytes:n})=>(new e).writeInt32(t).writeInt64(r).writeInt64(s).writeInt32(n);return Ra}function lc(){if(Ba)return La;Ba=1;const e=Xa,t=uc();return La=({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a=e.READ_COMMITTED,sessionId:c=0,sessionEpoch:u=-1,forgottenTopics:l=[]})=>Object.assign(t({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a,sessionId:c,sessionEpoch:u,forgottenTopics:l}),{apiVersion:8}),La}function dc(){if(Ma)return Pa;Ma=1;const e=Ni,{parse:t}=tc(),r=ic(),s=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(s),messages:await r(e)}),i=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});return Pa={decode:async t=>{const r=new e(t);return{throttleTime:0,clientSideThrottleTime:r.readInt32(),errorCode:r.readInt16(),sessionId:r.readInt32(),responses:await r.readArrayAsync(i)}},parse:t},Pa}function pc(){if($a)return Da;$a=1;const e=bi,{Fetch:t}=ti,r=Xa;Da=({replicaId:i,maxWaitTime:o,minBytes:a,maxBytes:c,topics:u,isolationLevel:l=r.READ_COMMITTED,sessionId:d=0,sessionEpoch:p=-1,forgottenTopics:f=[]})=>({apiKey:t,apiVersion:9,apiName:"Fetch",encode:async()=>(new e).writeInt32(i).writeInt32(o).writeInt32(a).writeInt32(c).writeInt8(l).writeInt32(d).writeInt32(p).writeArray(u.map(n)).writeArray(f.map(s))});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r),n=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(i)),i=({partition:t,currentLeaderEpoch:r=-1,fetchOffset:s,logStartOffset:n=-1,maxBytes:i})=>(new e).writeInt32(t).writeInt32(r).writeInt64(s).writeInt64(n).writeInt32(i);return Da}function fc(){if(ja)return Ua;ja=1;const{decode:e,parse:t}=dc();return Ua={decode:e,parse:t}}function hc(){if(Fa)return Ga;Fa=1;const e=Xa,t=pc();return Ga=({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a=e.READ_COMMITTED,sessionId:c=0,sessionEpoch:u=-1,forgottenTopics:l=[]})=>Object.assign(t({replicaId:r,maxWaitTime:s,minBytes:n,maxBytes:i,topics:o,isolationLevel:a,sessionId:c,sessionEpoch:u,forgottenTopics:l}),{apiVersion:10}),Ga}function mc(){if(Wa)return qa;Wa=1;const e=bi,{Fetch:t}=ti,r=Xa;qa=({replicaId:i,maxWaitTime:o,minBytes:a,maxBytes:c,topics:u,rackId:l="",isolationLevel:d=r.READ_COMMITTED,sessionId:p=0,sessionEpoch:f=-1,forgottenTopics:h=[]})=>({apiKey:t,apiVersion:11,apiName:"Fetch",encode:async()=>(new e).writeInt32(i).writeInt32(o).writeInt32(a).writeInt32(c).writeInt8(d).writeInt32(p).writeInt32(f).writeArray(u.map(n)).writeArray(h.map(s)).writeString(l)});const s=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r),n=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(i)),i=({partition:t,currentLeaderEpoch:r=-1,fetchOffset:s,logStartOffset:n=-1,maxBytes:i})=>(new e).writeInt32(t).writeInt32(r).writeInt64(s).writeInt64(n).writeInt32(i);return qa}const gc=Xa,yc=e=>Number.isSafeInteger(e+100)?e+100:e,Ic={0:({replicaId:e=-1,maxWaitTime:t,minBytes:r,topics:s})=>{const n=za(),i=ec();return{request:n({replicaId:e,maxWaitTime:t,minBytes:r,topics:s}),response:i,requestTimeout:yc(t)}},1:({replicaId:e=-1,maxWaitTime:t,minBytes:r,topics:s})=>{const n=function(){if(Xo)return Jo;Xo=1;const e=za();return Jo=({replicaId:t,maxWaitTime:r,minBytes:s,topics:n})=>Object.assign(e({replicaId:t,maxWaitTime:r,minBytes:s,topics:n}),{apiVersion:1})}(),i=tc();return{request:n({replicaId:e,maxWaitTime:t,minBytes:r,topics:s}),response:i,requestTimeout:yc(t)}},2:({replicaId:e=-1,maxWaitTime:t,minBytes:r,topics:s})=>{const n=function(){if(ea)return Qo;ea=1;const e=za();return Qo=({replicaId:t,maxWaitTime:r,minBytes:s,topics:n})=>Object.assign(e({replicaId:t,maxWaitTime:r,minBytes:s,topics:n}),{apiVersion:2})}(),i=function(){if(ra)return ta;ra=1;const{decode:e,parse:t}=tc();return ta={decode:e,parse:t}}();return{request:n({replicaId:e,maxWaitTime:t,minBytes:r,topics:s}),response:i,requestTimeout:yc(t)}},3:({replicaId:e=-1,maxWaitTime:t,minBytes:r,maxBytes:s,topics:n})=>{const i=function(){if(na)return sa;na=1;const e=bi,{Fetch:t}=ti;sa=({replicaId:s,maxWaitTime:n,minBytes:i,maxBytes:o,topics:a})=>({apiKey:t,apiVersion:3,apiName:"Fetch",encode:async()=>(new e).writeInt32(s).writeInt32(n).writeInt32(i).writeInt32(o).writeArray(a.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,fetchOffset:r,maxBytes:s})=>(new e).writeInt32(t).writeInt64(r).writeInt32(s);return sa}(),o=function(){if(oa)return ia;oa=1;const{decode:e,parse:t}=tc();return ia={decode:e,parse:t}}();return{request:i({replicaId:e,maxWaitTime:t,minBytes:r,maxBytes:s,topics:n}),response:o,requestTimeout:yc(t)}},4:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i})=>{const o=rc(),a=function(){if(wa)return ba;wa=1;const e=Ni,{parse:t}=tc(),r=ic(),s=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),abortedTransactions:e.readArray(s),messages:await r(e)}),i=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});return ba={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),responses:await r.readArrayAsync(i)}},parse:t},ba}();return{request:o({replicaId:e,isolationLevel:t,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i}),response:a,requestTimeout:yc(r)}},5:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i})=>{const o=oc(),a=ac();return{request:o({replicaId:e,isolationLevel:t,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i}),response:a,requestTimeout:yc(r)}},6:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i})=>{const o=cc(),a=function(){if(Na)return Oa;Na=1;const{decode:e,parse:t}=ac();return Oa={decode:e,parse:t}}();return{request:o({replicaId:e,isolationLevel:t,maxWaitTime:r,minBytes:s,maxBytes:n,topics:i}),response:a,requestTimeout:yc(r)}},7:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,sessionId:r=0,sessionEpoch:s=-1,forgottenTopics:n=[],maxWaitTime:i,minBytes:o,maxBytes:a,topics:c})=>{const u=uc(),l=function(){if(xa)return ka;xa=1;const e=Ni,{parse:t}=tc(),r=ic(),s=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(s),messages:await r(e)}),i=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});return ka={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),errorCode:r.readInt16(),sessionId:r.readInt32(),responses:await r.readArrayAsync(i)}},parse:t},ka}();return{request:u({replicaId:e,isolationLevel:t,sessionId:r,sessionEpoch:s,forgottenTopics:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c}),response:l,requestTimeout:yc(i)}},8:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,sessionId:r=0,sessionEpoch:s=-1,forgottenTopics:n=[],maxWaitTime:i,minBytes:o,maxBytes:a,topics:c})=>{const u=lc(),l=dc();return{request:u({replicaId:e,isolationLevel:t,sessionId:r,sessionEpoch:s,forgottenTopics:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c}),response:l,requestTimeout:yc(i)}},9:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,sessionId:r=0,sessionEpoch:s=-1,forgottenTopics:n=[],maxWaitTime:i,minBytes:o,maxBytes:a,topics:c})=>{const u=pc(),l=fc();return{request:u({replicaId:e,isolationLevel:t,sessionId:r,sessionEpoch:s,forgottenTopics:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c}),response:l,requestTimeout:yc(i)}},10:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,sessionId:r=0,sessionEpoch:s=-1,forgottenTopics:n=[],maxWaitTime:i,minBytes:o,maxBytes:a,topics:c})=>{const u=hc(),l=function(){if(Ka)return Va;Ka=1;const{decode:e,parse:t}=fc();return Va={decode:e,parse:t}}();return{request:u({replicaId:e,isolationLevel:t,sessionId:r,sessionEpoch:s,forgottenTopics:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c}),response:l,requestTimeout:yc(i)}},11:({replicaId:e=-1,isolationLevel:t=gc.READ_COMMITTED,sessionId:r=0,sessionEpoch:s=-1,forgottenTopics:n=[],maxWaitTime:i,minBytes:o,maxBytes:a,topics:c,rackId:u})=>{const l=mc(),d=function(){if(Za)return Ha;Za=1;const e=Ni,{parse:t}=tc(),r=ic(),s=e=>({producerId:e.readInt64().toString(),firstOffset:e.readInt64().toString()}),n=async e=>({partition:e.readInt32(),errorCode:e.readInt16(),highWatermark:e.readInt64().toString(),lastStableOffset:e.readInt64().toString(),lastStartOffset:e.readInt64().toString(),abortedTransactions:e.readArray(s),preferredReadReplica:e.readInt32(),messages:await r(e)}),i=async e=>({topicName:e.readString(),partitions:await e.readArrayAsync(n)});return Ha={decode:async t=>{const r=new e(t);return{throttleTime:0,clientSideThrottleTime:r.readInt32(),errorCode:r.readInt16(),sessionId:r.readInt32(),responses:await r.readArrayAsync(i)}},parse:t},Ha}();return{request:l({replicaId:e,isolationLevel:t,sessionId:r,sessionEpoch:s,forgottenTopics:n,maxWaitTime:i,minBytes:o,maxBytes:a,topics:c,rackId:u}),response:d,requestTimeout:yc(i)}}};var bc,wc,vc,Tc,Ec,_c,Ac,Sc,Oc,Nc,Rc,Cc,kc,xc,Lc,Bc,Pc={versions:Object.keys(Ic),protocol:({version:e})=>Ic[e]};function Mc(){if(Nc)return Oc;Nc=1;const e=bi,{ListOffsets:t}=ti;Oc=({replicaId:s,isolationLevel:n,topics:i})=>({apiKey:t,apiVersion:2,apiName:"ListOffsets",encode:async()=>(new e).writeInt32(s).writeInt8(n).writeArray(i.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,timestamp:r=-1})=>(new e).writeInt32(t).writeInt64(r);return Oc}function Dc(){if(Cc)return Rc;Cc=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16(),timestamp:e.readInt64().toString(),offset:e.readInt64().toString()});return Rc={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),responses:r.readArray(s)}},parse:async e=>{const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},Rc}const $c=Xa,Uc={0:({replicaId:e=-1,topics:t})=>{const r=function(){if(wc)return bc;wc=1;const e=bi,{ListOffsets:t}=ti;bc=({replicaId:s,topics:n})=>({apiKey:t,apiVersion:0,apiName:"ListOffsets",encode:async()=>(new e).writeInt32(s).writeArray(n.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,timestamp:r=-1,maxNumOffsets:s=1})=>(new e).writeInt32(t).writeInt64(r).writeInt32(s);return bc}(),s=function(){if(Tc)return vc;Tc=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16(),offsets:e.readArray(i)}),i=e=>e.readInt64().toString();return vc={decode:async t=>({responses:new e(t).readArray(s)}),parse:async e=>{const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},vc}();return{request:r({replicaId:e,topics:t}),response:s}},1:({replicaId:e=-1,topics:t})=>{const r=function(){if(_c)return Ec;_c=1;const e=bi,{ListOffsets:t}=ti;Ec=({replicaId:s,topics:n})=>({apiKey:t,apiVersion:1,apiName:"ListOffsets",encode:async()=>(new e).writeInt32(s).writeArray(n.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,timestamp:r=-1})=>(new e).writeInt32(t).writeInt64(r);return Ec}(),s=function(){if(Sc)return Ac;Sc=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16(),timestamp:e.readInt64().toString(),offset:e.readInt64().toString()});return Ac={decode:async t=>({responses:new e(t).readArray(s)}),parse:async e=>{const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},Ac}();return{request:r({replicaId:e,topics:t}),response:s}},2:({replicaId:e=-1,isolationLevel:t=$c.READ_COMMITTED,topics:r})=>{const s=Mc(),n=Dc();return{request:s({replicaId:e,isolationLevel:t,topics:r}),response:n}},3:({replicaId:e=-1,isolationLevel:t=$c.READ_COMMITTED,topics:r})=>{const s=function(){if(xc)return kc;xc=1;const e=Mc();return kc=({replicaId:t,isolationLevel:r,topics:s})=>Object.assign(e({replicaId:t,isolationLevel:r,topics:s}),{apiVersion:3}),kc}(),n=function(){if(Bc)return Lc;Bc=1;const{parse:e,decode:t}=Dc();return Lc={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:s({replicaId:e,isolationLevel:t,topics:r}),response:n}}};var jc,Gc,Fc,Vc,Kc,qc,Wc,Hc,Zc,Jc,Xc,zc,Yc,Qc,eu,tu,ru,su,nu,iu,ou,au,cu,uu,lu,du,pu,fu,hu={versions:Object.keys(Uc),protocol:({version:e})=>Uc[e]};function mu(){if(Vc)return Fc;Vc=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32()}),n=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),partitionMetadata:e.readArray(i)}),i=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray(e=>e.readInt32()),isr:e.readArray(e=>e.readInt32())});return Fc={decode:async t=>{const r=new e(t);return{brokers:r.readArray(s),topicMetadata:r.readArray(n)}},parse:async e=>{const s=e.topicMetadata.filter(e=>t(e.topicErrorCode));if(s.length>0){const{topicErrorCode:e}=s[0];throw r(e)}const n=e.topicMetadata.flatMap(e=>e.partitionMetadata.filter(e=>t(e.partitionErrorCode)));if(n.length>0){const{partitionErrorCode:e}=n[0];throw r(e)}return e}},Fc}function gu(){if(qc)return Kc;qc=1;const e=bi,{Metadata:t}=ti;return Kc=({topics:r})=>({apiKey:t,apiVersion:1,apiName:"Metadata",encode:async()=>(new e).writeNullableArray(r)})}function yu(){if(tu)return eu;tu=1;const e=Ni,{parse:t}=mu(),r=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),s=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(n)}),n=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray(e=>e.readInt32()),isr:e.readArray(e=>e.readInt32())});return eu={decode:async t=>{const n=new e(t);return{throttleTime:n.readInt32(),brokers:n.readArray(r),clusterId:n.readString(),controllerId:n.readInt32(),topicMetadata:n.readArray(s)}},parse:t},eu}function Iu(){if(su)return ru;su=1;const e=bi,{Metadata:t}=ti;return ru=({topics:r,allowAutoTopicCreation:s=!0})=>({apiKey:t,apiVersion:4,apiName:"Metadata",encode:async()=>(new e).writeNullableArray(r).writeBoolean(s)})}function bu(){if(au)return ou;au=1;const e=Iu();return ou=({topics:t,allowAutoTopicCreation:r=!0})=>Object.assign(e({topics:t,allowAutoTopicCreation:r}),{apiVersion:5})}function wu(){if(uu)return cu;uu=1;const e=Ni,{parse:t}=mu(),r=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),s=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(n)}),n=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray(e=>e.readInt32()),isr:e.readArray(e=>e.readInt32()),offlineReplicas:e.readArray(e=>e.readInt32())});return cu={decode:async t=>{const n=new e(t);return{throttleTime:n.readInt32(),brokers:n.readArray(r),clusterId:n.readString(),controllerId:n.readInt32(),topicMetadata:n.readArray(s)}},parse:t},cu}const vu={0:({topics:e})=>{const t=function(){if(Gc)return jc;Gc=1;const e=bi,{Metadata:t}=ti;return jc=({topics:r})=>({apiKey:t,apiVersion:0,apiName:"Metadata",encode:async()=>(new e).writeArray(r)})}(),r=mu();return{request:t({topics:e}),response:r}},1:({topics:e})=>{const t=gu(),r=function(){if(Hc)return Wc;Hc=1;const e=Ni,{parse:t}=mu(),r=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),s=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(n)}),n=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray(e=>e.readInt32()),isr:e.readArray(e=>e.readInt32())});return Wc={decode:async t=>{const n=new e(t);return{brokers:n.readArray(r),controllerId:n.readInt32(),topicMetadata:n.readArray(s)}},parse:t},Wc}();return{request:t({topics:e}),response:r}},2:({topics:e})=>{const t=function(){if(Jc)return Zc;Jc=1;const e=gu();return Zc=({topics:t})=>Object.assign(e({topics:t}),{apiVersion:2})}(),r=function(){if(zc)return Xc;zc=1;const e=Ni,{parse:t}=mu(),r=e=>({nodeId:e.readInt32(),host:e.readString(),port:e.readInt32(),rack:e.readString()}),s=e=>({topicErrorCode:e.readInt16(),topic:e.readString(),isInternal:e.readBoolean(),partitionMetadata:e.readArray(n)}),n=e=>({partitionErrorCode:e.readInt16(),partitionId:e.readInt32(),leader:e.readInt32(),replicas:e.readArray(e=>e.readInt32()),isr:e.readArray(e=>e.readInt32())});return Xc={decode:async t=>{const n=new e(t);return{brokers:n.readArray(r),clusterId:n.readString(),controllerId:n.readInt32(),topicMetadata:n.readArray(s)}},parse:t},Xc}();return{request:t({topics:e}),response:r}},3:({topics:e})=>{const t=function(){if(Qc)return Yc;Qc=1;const e=gu();return Yc=({topics:t})=>Object.assign(e({topics:t}),{apiVersion:3})}(),r=yu();return{request:t({topics:e}),response:r}},4:({topics:e,allowAutoTopicCreation:t})=>{const r=Iu(),s=function(){if(iu)return nu;iu=1;const{parse:e,decode:t}=yu();return nu={parse:e,decode:t}}();return{request:r({topics:e,allowAutoTopicCreation:t}),response:s}},5:({topics:e,allowAutoTopicCreation:t})=>{const r=bu(),s=wu();return{request:r({topics:e,allowAutoTopicCreation:t}),response:s}},6:({topics:e,allowAutoTopicCreation:t})=>{const r=function(){if(du)return lu;du=1;const e=bu();return lu=({topics:t,allowAutoTopicCreation:r=!0})=>Object.assign(e({topics:t,allowAutoTopicCreation:r}),{apiVersion:6})}(),s=function(){if(fu)return pu;fu=1;const{parse:e,decode:t}=wu();return pu={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({topics:e,allowAutoTopicCreation:t}),response:s}}};var Tu,Eu,_u,Au,Su,Ou,Nu,Ru,Cu,ku,xu,Lu,Bu,Pu,Mu,Du,$u,Uu,ju,Gu,Fu,Vu,Ku,qu,Wu={versions:Object.keys(vu),protocol:({version:e})=>vu[e]};function Hu(){if(Au)return _u;Au=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16()});return _u={decode:async t=>({responses:new e(t).readArray(s)}),parse:async e=>{const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},_u}function Zu(){if(ku)return Cu;ku=1;const e=bi,{OffsetCommit:t}=ti;Cu=({groupId:s,groupGenerationId:n,memberId:i,retentionTime:o,topics:a})=>({apiKey:t,apiVersion:2,apiName:"OffsetCommit",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeInt64(o).writeArray(a.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,offset:r,metadata:s=null})=>(new e).writeInt32(t).writeInt64(r).writeString(s);return Cu}function Ju(){if(Pu)return Bu;Pu=1;const e=Zu();return Bu=({groupId:t,groupGenerationId:r,memberId:s,retentionTime:n,topics:i})=>Object.assign(e({groupId:t,groupGenerationId:r,memberId:s,retentionTime:n,topics:i}),{apiVersion:3})}function Xu(){if(Du)return Mu;Du=1;const e=Ni,{parse:t}=Hu(),r=e=>({topic:e.readString(),partitions:e.readArray(s)}),s=e=>({partition:e.readInt32(),errorCode:e.readInt16()});return Mu={decode:async t=>{const s=new e(t);return{throttleTime:s.readInt32(),responses:s.readArray(r)}},parse:t},Mu}function zu(){if(Gu)return ju;Gu=1;const{parse:e,decode:t}=Xu();return ju={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const Yu={0:({groupId:e,topics:t})=>{const r=function(){if(Eu)return Tu;Eu=1;const e=bi,{OffsetCommit:t}=ti;Tu=({groupId:s,topics:n})=>({apiKey:t,apiVersion:0,apiName:"OffsetCommit",encode:async()=>(new e).writeString(s).writeArray(n.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,offset:r,metadata:s=null})=>(new e).writeInt32(t).writeInt64(r).writeString(s);return Tu}(),s=Hu();return{request:r({groupId:e,topics:t}),response:s}},1:({groupId:e,groupGenerationId:t,memberId:r,topics:s})=>{const n=function(){if(Ou)return Su;Ou=1;const e=bi,{OffsetCommit:t}=ti;Su=({groupId:s,groupGenerationId:n,memberId:i,topics:o})=>({apiKey:t,apiVersion:1,apiName:"OffsetCommit",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeArray(o.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,offset:r,timestamp:s=Date.now(),metadata:n=null})=>(new e).writeInt32(t).writeInt64(r).writeInt64(s).writeString(n);return Su}(),i=function(){if(Ru)return Nu;Ru=1;const{parse:e,decode:t}=Hu();return Nu={decode:t,parse:e}}();return{request:n({groupId:e,groupGenerationId:t,memberId:r,topics:s}),response:i}},2:({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s=-1,topics:n})=>{const i=Zu(),o=function(){if(Lu)return xu;Lu=1;const{parse:e,decode:t}=Hu();return xu={decode:t,parse:e}}();return{request:i({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:n}),response:o}},3:({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s=-1,topics:n})=>{const i=Ju(),o=Xu();return{request:i({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:n}),response:o}},4:({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s=-1,topics:n})=>{const i=function(){if(Uu)return $u;Uu=1;const e=Ju();return $u=({groupId:t,groupGenerationId:r,memberId:s,retentionTime:n,topics:i})=>Object.assign(e({groupId:t,groupGenerationId:r,memberId:s,retentionTime:n,topics:i}),{apiVersion:4})}(),o=zu();return{request:i({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:n}),response:o}},5:({groupId:e,groupGenerationId:t,memberId:r,topics:s})=>{const n=function(){if(Vu)return Fu;Vu=1;const e=bi,{OffsetCommit:t}=ti;Fu=({groupId:s,groupGenerationId:n,memberId:i,topics:o})=>({apiKey:t,apiVersion:5,apiName:"OffsetCommit",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeArray(o.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,offset:r,metadata:s=null})=>(new e).writeInt32(t).writeInt64(r).writeString(s);return Fu}(),i=function(){if(qu)return Ku;qu=1;const{parse:e,decode:t}=zu();return Ku={decode:t,parse:e}}();return{request:n({groupId:e,groupGenerationId:t,memberId:r,topics:s}),response:i}}};var Qu,el,tl,rl,sl,nl,il,ol,al,cl,ul,ll,dl,pl,fl,hl,ml={versions:Object.keys(Yu),protocol:({version:e})=>Yu[e]};function gl(){if(el)return Qu;el=1;const e=bi,{OffsetFetch:t}=ti;Qu=({groupId:s,topics:n})=>({apiKey:t,apiVersion:1,apiName:"OffsetFetch",encode:async()=>(new e).writeString(s).writeArray(n.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t})=>(new e).writeInt32(t);return Qu}function yl(){if(ol)return il;ol=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});return il={decode:async t=>{const r=new e(t);return{responses:r.readArray(s),errorCode:r.readInt16()}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},il}function Il(){if(cl)return al;cl=1;const e=bi,{OffsetFetch:t}=ti;al=({groupId:s,topics:n})=>({apiKey:t,apiVersion:3,apiName:"OffsetFetch",encode:async()=>(new e).writeString(s).writeNullableArray(n.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t})=>(new e).writeInt32(t);return al}function bl(){if(ll)return ul;ll=1;const e=Ni,{parse:t}=yl(),r=e=>({topic:e.readString(),partitions:e.readArray(s)}),s=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});return ul={decode:async t=>{const s=new e(t);return{throttleTime:s.readInt32(),responses:s.readArray(r),errorCode:s.readInt16()}},parse:t},ul}const wl={1:({groupId:e,topics:t})=>{const r=gl(),s=function(){if(rl)return tl;rl=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({topic:e.readString(),partitions:e.readArray(n)}),n=e=>({partition:e.readInt32(),offset:e.readInt64().toString(),metadata:e.readString(),errorCode:e.readInt16()});return tl={decode:async t=>({responses:new e(t).readArray(s)}),parse:async e=>{const s=e.responses.flatMap(e=>e.partitions.filter(e=>t(e.errorCode))),n=s[0];if(n)throw r(n.errorCode);return e}},tl}();return{request:r({groupId:e,topics:t}),response:s}},2:({groupId:e,topics:t})=>{const r=function(){if(nl)return sl;nl=1;const e=gl();return sl=({groupId:t,topics:r})=>Object.assign(e({groupId:t,topics:r}),{apiVersion:2})}(),s=yl();return{request:r({groupId:e,topics:t}),response:s}},3:({groupId:e,topics:t})=>{const r=Il(),s=bl();return{request:r({groupId:e,topics:t}),response:s}},4:({groupId:e,topics:t})=>{const r=function(){if(pl)return dl;pl=1;const e=Il();return dl=({groupId:t,topics:r})=>Object.assign(e({groupId:t,topics:r}),{apiVersion:4})}(),s=function(){if(hl)return fl;hl=1;const{parse:e,decode:t}=bl();return fl={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({groupId:e,topics:t}),response:s}}};var vl,Tl,El,_l,Al,Sl,Ol,Nl,Rl,Cl,kl,xl,Ll={versions:Object.keys(wl),protocol:({version:e})=>wl[e]},Bl={GROUP:0,TRANSACTION:1};function Pl(){if(Sl)return Al;Sl=1;const e=bi,{GroupCoordinator:t}=ti;return Al=({coordinatorKey:r,coordinatorType:s})=>({apiKey:t,apiVersion:1,apiName:"GroupCoordinator",encode:async()=>(new e).writeString(r).writeInt8(s)})}function Ml(){if(Nl)return Ol;Nl=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return Ol={decode:async t=>{const r=new e(t),n=r.readInt32(),i=r.readInt16();s(i);return{throttleTime:n,errorCode:i,errorMessage:r.readString(),coordinator:{nodeId:r.readInt32(),host:r.readString(),port:r.readInt32()}}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},Ol}const Dl=Bl,$l={0:({groupId:e})=>{const t=function(){if(Tl)return vl;Tl=1;const e=bi,{GroupCoordinator:t}=ti;return vl=({groupId:r})=>({apiKey:t,apiVersion:0,apiName:"GroupCoordinator",encode:async()=>(new e).writeString(r)})}(),r=function(){if(_l)return El;_l=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return El={decode:async t=>{const r=new e(t),n=r.readInt16();return s(n),{errorCode:n,coordinator:{nodeId:r.readInt32(),host:r.readString(),port:r.readInt32()}}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},El}();return{request:t({groupId:e}),response:r}},1:({groupId:e,coordinatorType:t=Dl.GROUP})=>{const r=Pl(),s=Ml();return{request:r({coordinatorKey:e,coordinatorType:t}),response:s}},2:({groupId:e,coordinatorType:t=Dl.GROUP})=>{const r=function(){if(Cl)return Rl;Cl=1;const e=Pl();return Rl=({coordinatorKey:t,coordinatorType:r})=>Object.assign(e({coordinatorKey:t,coordinatorType:r}),{apiVersion:2})}(),s=function(){if(xl)return kl;xl=1;const{parse:e,decode:t}=Ml();return kl={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({coordinatorKey:e,coordinatorType:t}),response:s}}};var Ul,jl,Gl,Fl,Vl,Kl,ql,Wl,Hl,Zl,Jl,Xl,zl,Yl,Ql,ed,td,rd,sd,nd,id,od,ad,cd,ud={versions:Object.keys($l),protocol:({version:e})=>$l[e]};function ld(){if(Fl)return Gl;Fl=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return Gl={decode:async t=>{const r=new e(t),n=r.readInt16();return s(n),{errorCode:n,generationId:r.readInt32(),groupProtocol:r.readString(),leaderId:r.readString(),memberId:r.readString(),members:r.readArray(e=>({memberId:e.readString(),memberMetadata:e.readBytes()}))}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},Gl}function dd(){if(Kl)return Vl;Kl=1;const e=bi,{JoinGroup:t}=ti;Vl=({groupId:s,sessionTimeout:n,rebalanceTimeout:i,memberId:o,protocolType:a,groupProtocols:c})=>({apiKey:t,apiVersion:1,apiName:"JoinGroup",encode:async()=>(new e).writeString(s).writeInt32(n).writeInt32(i).writeString(o).writeString(a).writeArray(c.map(r))});const r=({name:t,metadata:r=Buffer.alloc(0)})=>(new e).writeString(t).writeBytes(r);return Vl}function pd(){if(Zl)return Hl;Zl=1;const e=dd();return Hl=({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o})=>Object.assign(e({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o}),{apiVersion:2})}function fd(){if(Xl)return Jl;Xl=1;const e=Ni,{failIfVersionNotSupported:t}=_o,{parse:r}=ld();return Jl={decode:async r=>{const s=new e(r),n=s.readInt32(),i=s.readInt16();return t(i),{throttleTime:n,errorCode:i,generationId:s.readInt32(),groupProtocol:s.readString(),leaderId:s.readString(),memberId:s.readString(),members:s.readArray(e=>({memberId:e.readString(),memberMetadata:e.readBytes()}))}},parse:r},Jl}function hd(){if(Yl)return zl;Yl=1;const e=pd();return zl=({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o})=>Object.assign(e({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o}),{apiVersion:3})}function md(){if(ed)return Ql;ed=1;const{parse:e,decode:t}=fd();return Ql={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const gd=({rebalanceTimeout:e,sessionTimeout:t})=>{const r=e||t;return Number.isSafeInteger(r+5e3)?r+5e3:r},yd=e=>null!=e&&""!==e,Id={0:({groupId:e,sessionTimeout:t,memberId:r,protocolType:s,groupProtocols:n})=>{const i=function(){if(jl)return Ul;jl=1;const e=bi,{JoinGroup:t}=ti;Ul=({groupId:s,sessionTimeout:n,memberId:i,protocolType:o,groupProtocols:a})=>({apiKey:t,apiVersion:0,apiName:"JoinGroup",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeString(o).writeArray(a.map(r))});const r=({name:t,metadata:r=Buffer.alloc(0)})=>(new e).writeString(t).writeBytes(r);return Ul}(),o=ld();return{request:i({groupId:e,sessionTimeout:t,memberId:r,protocolType:s,groupProtocols:n}),response:o,requestTimeout:gd({rebalanceTimeout:null,sessionTimeout:t})}},1:({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i})=>{const o=dd(),a=function(){if(Wl)return ql;Wl=1;const{parse:e,decode:t}=ld();return ql={decode:t,parse:e}}();return{request:o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i}),response:a,requestTimeout:gd({rebalanceTimeout:r,sessionTimeout:t})}},2:({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i})=>{const o=pd(),a=fd();return{request:o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i}),response:a,requestTimeout:gd({rebalanceTimeout:r,sessionTimeout:t})}},3:({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i})=>{const o=hd(),a=md();return{request:o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i}),response:a,requestTimeout:gd({rebalanceTimeout:r,sessionTimeout:t})}},4:({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i})=>{const o=function(){if(rd)return td;rd=1;const e=hd();return td=({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o})=>Object.assign(e({groupId:t,sessionTimeout:r,rebalanceTimeout:s,memberId:n,protocolType:i,groupProtocols:o}),{apiVersion:4})}(),a=function(){if(nd)return sd;nd=1;const{decode:e}=md(),{KafkaJSMemberIdRequired:t}=Mn,{failure:r,createErrorFromCode:s,errorCodes:n}=_o,{code:i}=n.find(e=>"MEMBER_ID_REQUIRED"===e.type);return sd={decode:e,parse:async e=>{if(r(e.errorCode)){if(e.errorCode===i)throw new t(s(e.errorCode),{memberId:e.memberId});throw s(e.errorCode)}return e}}}();return{request:o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,protocolType:n,groupProtocols:i}),response:a,requestTimeout:gd({rebalanceTimeout:r,sessionTimeout:t}),logResponseError:yd(s)}},5:({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,groupInstanceId:n,protocolType:i,groupProtocols:o})=>{const a=function(){if(od)return id;od=1;const e=bi,{JoinGroup:t}=ti;id=({groupId:s,sessionTimeout:n,rebalanceTimeout:i,memberId:o,groupInstanceId:a=null,protocolType:c,groupProtocols:u})=>({apiKey:t,apiVersion:5,apiName:"JoinGroup",encode:async()=>(new e).writeString(s).writeInt32(n).writeInt32(i).writeString(o).writeString(a).writeString(c).writeArray(u.map(r))});const r=({name:t,metadata:r=Buffer.alloc(0)})=>(new e).writeString(t).writeBytes(r);return id}(),c=function(){if(cd)return ad;cd=1;const e=Ni,{KafkaJSMemberIdRequired:t}=Mn,{failure:r,createErrorFromCode:s,errorCodes:n,failIfVersionNotSupported:i}=_o,{code:o}=n.find(e=>"MEMBER_ID_REQUIRED"===e.type);return ad={decode:async t=>{const r=new e(t),s=r.readInt32(),n=r.readInt16();return i(n),{throttleTime:0,clientSideThrottleTime:s,errorCode:n,generationId:r.readInt32(),groupProtocol:r.readString(),leaderId:r.readString(),memberId:r.readString(),members:r.readArray(e=>({memberId:e.readString(),groupInstanceId:e.readString(),memberMetadata:e.readBytes()}))}},parse:async e=>{if(r(e.errorCode)){if(e.errorCode===o)throw new t(s(e.errorCode),{memberId:e.memberId});throw s(e.errorCode)}return e}},ad}();return{request:a({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s,groupInstanceId:n,protocolType:i,groupProtocols:o}),response:c,requestTimeout:gd({rebalanceTimeout:r,sessionTimeout:t}),logResponseError:yd(s)}}};var bd,wd,vd,Td,Ed,_d,Ad,Sd,Od,Nd,Rd,Cd,kd,xd,Ld,Bd,Pd={versions:Object.keys(Id),protocol:({version:e})=>Id[e]};function Md(){if(wd)return bd;wd=1;const e=bi,{Heartbeat:t}=ti;return bd=({groupId:r,groupGenerationId:s,memberId:n})=>({apiKey:t,apiVersion:0,apiName:"Heartbeat",encode:async()=>(new e).writeString(r).writeInt32(s).writeString(n)})}function Dd(){if(Td)return vd;Td=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return vd={decode:async t=>{const r=new e(t).readInt16();return s(r),{errorCode:r}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}}}function $d(){if(_d)return Ed;_d=1;const e=Md();return Ed=({groupId:t,groupGenerationId:r,memberId:s})=>Object.assign(e({groupId:t,groupGenerationId:r,memberId:s}),{apiVersion:1})}function Ud(){if(Sd)return Ad;Sd=1;const e=Ni,{failIfVersionNotSupported:t}=_o,{parse:r}=Dd();return Ad={decode:async r=>{const s=new e(r),n=s.readInt32(),i=s.readInt16();return t(i),{throttleTime:n,errorCode:i}},parse:r},Ad}function jd(){if(Cd)return Rd;Cd=1;const{parse:e,decode:t}=Ud();return Rd={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const Gd={0:({groupId:e,groupGenerationId:t,memberId:r})=>{const s=Md(),n=Dd();return{request:s({groupId:e,groupGenerationId:t,memberId:r}),response:n}},1:({groupId:e,groupGenerationId:t,memberId:r})=>{const s=$d(),n=Ud();return{request:s({groupId:e,groupGenerationId:t,memberId:r}),response:n}},2:({groupId:e,groupGenerationId:t,memberId:r})=>{const s=function(){if(Nd)return Od;Nd=1;const e=$d();return Od=({groupId:t,groupGenerationId:r,memberId:s})=>Object.assign(e({groupId:t,groupGenerationId:r,memberId:s}),{apiVersion:2})}(),n=jd();return{request:s({groupId:e,groupGenerationId:t,memberId:r}),response:n}},3:({groupId:e,groupGenerationId:t,memberId:r,groupInstanceId:s})=>{const n=function(){if(xd)return kd;xd=1;const e=bi,{Heartbeat:t}=ti;return kd=({groupId:r,groupGenerationId:s,memberId:n,groupInstanceId:i})=>({apiKey:t,apiVersion:3,apiName:"Heartbeat",encode:async()=>(new e).writeString(r).writeInt32(s).writeString(n).writeString(i)})}(),i=function(){if(Bd)return Ld;Bd=1;const{parse:e,decode:t}=jd();return Ld={decode:t,parse:e}}();return{request:n({groupId:e,groupGenerationId:t,memberId:r,groupInstanceId:s}),response:i}}};var Fd,Vd,Kd,qd,Wd,Hd,Zd,Jd,Xd,zd,Yd,Qd,ep,tp,rp,sp,np={versions:Object.keys(Gd),protocol:({version:e})=>Gd[e]};function ip(){if(Vd)return Fd;Vd=1;const e=bi,{LeaveGroup:t}=ti;return Fd=({groupId:r,memberId:s})=>({apiKey:t,apiVersion:0,apiName:"LeaveGroup",encode:async()=>(new e).writeString(r).writeString(s)})}function op(){if(qd)return Kd;qd=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return Kd={decode:async t=>{const r=new e(t).readInt16();return s(r),{errorCode:r}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}}}function ap(){if(Hd)return Wd;Hd=1;const e=ip();return Wd=({groupId:t,memberId:r})=>Object.assign(e({groupId:t,memberId:r}),{apiVersion:1})}function cp(){if(Jd)return Zd;Jd=1;const e=Ni,{failIfVersionNotSupported:t}=_o,{parse:r}=op();return Zd={decode:async r=>{const s=new e(r),n=s.readInt32(),i=s.readInt16();return t(i),{throttleTime:n,errorCode:i}},parse:r},Zd}function up(){if(Qd)return Yd;Qd=1;const{parse:e,decode:t}=cp();return Yd={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const lp={0:({groupId:e,memberId:t})=>{const r=ip(),s=op();return{request:r({groupId:e,memberId:t}),response:s}},1:({groupId:e,memberId:t})=>{const r=ap(),s=cp();return{request:r({groupId:e,memberId:t}),response:s}},2:({groupId:e,memberId:t})=>{const r=function(){if(zd)return Xd;zd=1;const e=ap();return Xd=({groupId:t,memberId:r})=>Object.assign(e({groupId:t,memberId:r}),{apiVersion:2})}(),s=up();return{request:r({groupId:e,memberId:t}),response:s}},3:({groupId:e,memberId:t,groupInstanceId:r})=>{const s=function(){if(tp)return ep;tp=1;const e=bi,{LeaveGroup:t}=ti;ep=({groupId:s,members:n})=>({apiKey:t,apiVersion:3,apiName:"LeaveGroup",encode:async()=>(new e).writeString(s).writeArray(n.map(e=>r(e)))});const r=({memberId:t,groupInstanceId:r=null})=>(new e).writeString(t).writeString(r);return ep}(),n=function(){if(sp)return rp;sp=1;const e=Ni,{failIfVersionNotSupported:t,failure:r,createErrorFromCode:s}=_o,{parse:n}=up(),i=e=>({memberId:e.readString(),groupInstanceId:e.readString(),errorCode:e.readInt16()});return rp={decode:async r=>{const s=new e(r),n=s.readInt32(),o=s.readInt16(),a=s.readArray(i);return t(o),{throttleTime:0,clientSideThrottleTime:n,errorCode:o,members:a}},parse:async e=>{const t=n(e),i=e.members.find(e=>r(e.errorCode));if(i)throw s(i.errorCode);return t}},rp}();return{request:s({groupId:e,members:[{memberId:t,groupInstanceId:r}]}),response:n}}};var dp,pp,fp,hp,mp,gp,yp,Ip,bp,wp,vp,Tp,Ep,_p,Ap,Sp,Op={versions:Object.keys(lp),protocol:({version:e})=>lp[e]};function Np(){if(pp)return dp;pp=1;const e=bi,{SyncGroup:t}=ti;dp=({groupId:s,generationId:n,memberId:i,groupAssignment:o})=>({apiKey:t,apiVersion:0,apiName:"SyncGroup",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeArray(o.map(r))});const r=({memberId:t,memberAssignment:r})=>(new e).writeString(t).writeBytes(r);return dp}function Rp(){if(hp)return fp;hp=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return fp={decode:async t=>{const r=new e(t),n=r.readInt16();return s(n),{errorCode:n,memberAssignment:r.readBytes()}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},fp}function Cp(){if(gp)return mp;gp=1;const e=Np();return mp=({groupId:t,generationId:r,memberId:s,groupAssignment:n})=>Object.assign(e({groupId:t,generationId:r,memberId:s,groupAssignment:n}),{apiVersion:1})}function kp(){if(Ip)return yp;Ip=1;const e=Ni,{failIfVersionNotSupported:t}=_o,{parse:r}=Rp();return yp={decode:async r=>{const s=new e(r),n=s.readInt32(),i=s.readInt16();return t(i),{throttleTime:n,errorCode:i,memberAssignment:s.readBytes()}},parse:r},yp}function xp(){if(Tp)return vp;Tp=1;const{parse:e,decode:t}=kp();return vp={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}const Lp={0:({groupId:e,generationId:t,memberId:r,groupAssignment:s})=>{const n=Np(),i=Rp();return{request:n({groupId:e,generationId:t,memberId:r,groupAssignment:s}),response:i}},1:({groupId:e,generationId:t,memberId:r,groupAssignment:s})=>{const n=Cp(),i=kp();return{request:n({groupId:e,generationId:t,memberId:r,groupAssignment:s}),response:i}},2:({groupId:e,generationId:t,memberId:r,groupAssignment:s})=>{const n=function(){if(wp)return bp;wp=1;const e=Cp();return bp=({groupId:t,generationId:r,memberId:s,groupAssignment:n})=>Object.assign(e({groupId:t,generationId:r,memberId:s,groupAssignment:n}),{apiVersion:2})}(),i=xp();return{request:n({groupId:e,generationId:t,memberId:r,groupAssignment:s}),response:i}},3:({groupId:e,generationId:t,memberId:r,groupInstanceId:s,groupAssignment:n})=>{const i=function(){if(_p)return Ep;_p=1;const e=bi,{SyncGroup:t}=ti;Ep=({groupId:s,generationId:n,memberId:i,groupInstanceId:o=null,groupAssignment:a})=>({apiKey:t,apiVersion:3,apiName:"SyncGroup",encode:async()=>(new e).writeString(s).writeInt32(n).writeString(i).writeString(o).writeArray(a.map(r))});const r=({memberId:t,memberAssignment:r})=>(new e).writeString(t).writeBytes(r);return Ep}(),o=function(){if(Sp)return Ap;Sp=1;const{decode:e,parse:t}=xp();return Ap={decode:e,parse:t}}();return{request:i({groupId:e,generationId:t,memberId:r,groupInstanceId:s,groupAssignment:n}),response:o}}};var Bp,Pp,Mp,Dp,$p,Up,jp,Gp,Fp,Vp,Kp,qp,Wp={versions:Object.keys(Lp),protocol:({version:e})=>Lp[e]};function Hp(){if(Pp)return Bp;Pp=1;const e=bi,{DescribeGroups:t}=ti;return Bp=({groupIds:r})=>({apiKey:t,apiVersion:0,apiName:"DescribeGroups",encode:async()=>(new e).writeArray(r)})}function Zp(){if(Dp)return Mp;Dp=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({memberId:e.readString(),clientId:e.readString(),clientHost:e.readString(),memberMetadata:e.readBytes(),memberAssignment:e.readBytes()}),n=e=>({errorCode:e.readInt16(),groupId:e.readString(),state:e.readString(),protocolType:e.readString(),protocol:e.readString(),members:e.readArray(s)});return Mp={decode:async t=>({groups:new e(t).readArray(n)}),parse:async e=>{const s=e.groups.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}}}function Jp(){if(Up)return $p;Up=1;const e=Hp();return $p=({groupIds:t})=>Object.assign(e({groupIds:t}),{apiVersion:1})}function Xp(){if(Gp)return jp;Gp=1;const e=Ni,{parse:t}=Zp(),r=e=>({memberId:e.readString(),clientId:e.readString(),clientHost:e.readString(),memberMetadata:e.readBytes(),memberAssignment:e.readBytes()}),s=e=>({errorCode:e.readInt16(),groupId:e.readString(),state:e.readString(),protocolType:e.readString(),protocol:e.readString(),members:e.readArray(r)});return jp={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),groups:r.readArray(s)}},parse:t},jp}const zp={0:({groupIds:e})=>{const t=Hp(),r=Zp();return{request:t({groupIds:e}),response:r}},1:({groupIds:e})=>{const t=Jp(),r=Xp();return{request:t({groupIds:e}),response:r}},2:({groupIds:e})=>{const t=function(){if(Vp)return Fp;Vp=1;const e=Jp();return Fp=({groupIds:t})=>Object.assign(e({groupIds:t}),{apiVersion:2})}(),r=function(){if(qp)return Kp;qp=1;const{parse:e,decode:t}=Xp();return Kp={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:t({groupIds:e}),response:r}}};var Yp,Qp,ef,tf,rf,sf,nf,of,af,cf,uf,lf,df={versions:Object.keys(zp),protocol:({version:e})=>zp[e]};function pf(){if(Qp)return Yp;Qp=1;const e=bi,{ListGroups:t}=ti;return Yp=()=>({apiKey:t,apiVersion:0,apiName:"ListGroups",encode:async()=>new e})}function ff(){if(tf)return ef;tf=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({groupId:e.readString(),protocolType:e.readString()});return ef={decodeGroup:s,decode:async t=>{const r=new e(t);return{errorCode:r.readInt16(),groups:r.readArray(s)}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},ef}function hf(){if(sf)return rf;sf=1;const e=pf();return rf=()=>Object.assign(e(),{apiVersion:1})}function mf(){if(of)return nf;of=1;const e=ff(),t=Ni;return nf={decode:async r=>{const s=new t(r);return{throttleTime:s.readInt32(),errorCode:s.readInt16(),groups:s.readArray(e.decodeGroup)}},parse:e.parse},nf}const gf={0:()=>{const e=pf(),t=ff();return{request:e(),response:t}},1:()=>{const e=hf(),t=mf();return{request:e(),response:t}},2:()=>{const e=function(){if(cf)return af;cf=1;const e=hf();return af=()=>Object.assign(e(),{apiVersion:2})}(),t=function(){if(lf)return uf;lf=1;const{parse:e,decode:t}=mf();return uf={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:e(),response:t}}};var yf,If,bf,wf,vf,Tf,Ef,_f,Af={versions:Object.keys(gf),protocol:({version:e})=>gf[e]};function Sf(){if(If)return yf;If=1;const e=bi,{SaslHandshake:t}=ti;return yf=({mechanism:r})=>({apiKey:t,apiVersion:0,apiName:"SaslHandshake",encode:async()=>(new e).writeString(r)})}function Of(){if(wf)return bf;wf=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return bf={decode:async t=>{const r=new e(t),n=r.readInt16();return s(n),{errorCode:n,enabledMechanisms:r.readArray(e=>e.readString())}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},bf}const Nf={0:({mechanism:e})=>{const t=Sf(),r=Of();return{request:t({mechanism:e}),response:r}},1:({mechanism:e})=>{const t=function(){if(Tf)return vf;Tf=1;const e=Sf();return vf=({mechanism:t})=>({...e({mechanism:t}),apiVersion:1})}(),r=function(){if(_f)return Ef;_f=1;const{decode:e,parse:t}=Of();return Ef={decode:e,parse:t}}();return{request:t({mechanism:e}),response:r}}};var Rf,Cf,kf,xf,Lf,Bf,Pf,Mf,Df,$f,Uf,jf,Gf={versions:Object.keys(Nf),protocol:({version:e})=>Nf[e]};function Ff(){if(Cf)return Rf;Cf=1;const e=bi,{ApiVersions:t}=ti;return Rf=()=>({apiKey:t,apiVersion:0,apiName:"ApiVersions",encode:async()=>new e})}function Vf(){if(xf)return kf;xf=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o,n=e=>({apiKey:e.readInt16(),minVersion:e.readInt16(),maxVersion:e.readInt16()});return kf={decode:async t=>{const r=new e(t),i=r.readInt16();return s(i),{errorCode:i,apiVersions:r.readArray(n)}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},kf}function Kf(){if(Mf)return Pf;Mf=1;const e=Ni,{failIfVersionNotSupported:t}=_o,{parse:r}=Vf(),s=e=>({apiKey:e.readInt16(),minVersion:e.readInt16(),maxVersion:e.readInt16()});return Pf={decode:async r=>{const n=new e(r),i=n.readInt16();t(i);return{errorCode:i,apiVersions:n.readArray(s),throttleTime:n.canReadInt32()?n.readInt32():0}},parse:r},Pf}const qf=!1,Wf={0:()=>{const e=Ff(),t=Vf();return{request:e(),response:t,logResponseError:!0}},1:()=>{const e=function(){if(Bf)return Lf;Bf=1;const e=Ff();return Lf=()=>({...e(),apiVersion:1})}(),t=Kf();return{request:e(),response:t,logResponseError:qf}},2:()=>{const e=function(){if($f)return Df;$f=1;const e=Ff();return Df=()=>({...e(),apiVersion:2})}(),t=function(){if(jf)return Uf;jf=1;const{parse:e,decode:t}=Kf();return Uf={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:e(),response:t,logResponseError:qf}}};var Hf,Zf,Jf,Xf,zf,Yf,Qf,eh,th,rh,sh,nh,ih,oh,ah,ch,uh={versions:Object.keys(Wf),protocol:({version:e})=>Wf[e]};function lh(){if(Xf)return Jf;Xf=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,{KafkaJSAggregateError:s,KafkaJSCreateTopicError:n}=Mn,i=(e,t)=>e.topic.localeCompare(t.topic),o=e=>({topic:e.readString(),errorCode:e.readInt16()});return Jf={decode:async t=>({topicErrors:new e(t).readArray(o).sort(i)}),parse:async e=>{const i=e.topicErrors.filter(({errorCode:e})=>t(e));if(i.length>0)throw new s("Topic creation errors",i.map(e=>new n(r(e.errorCode),e.topic)));return e}},Jf}function dh(){if(Yf)return zf;Yf=1;const e=bi,{CreateTopics:t}=ti;zf=({topics:s,validateOnly:n=!1,timeout:i=5e3})=>({apiKey:t,apiVersion:1,apiName:"CreateTopics",encode:async()=>(new e).writeArray(s.map(r)).writeInt32(i).writeBoolean(n)});const r=({topic:t,numPartitions:r=-1,replicationFactor:i=-1,replicaAssignment:o=[],configEntries:a=[]})=>(new e).writeString(t).writeInt32(r).writeInt16(i).writeArray(o.map(s)).writeArray(a.map(n)),s=({partition:t,replicas:r})=>(new e).writeInt32(t).writeArray(r),n=({name:t,value:r})=>(new e).writeString(t).writeString(r);return zf}function ph(){if(eh)return Qf;eh=1;const e=Ni,{parse:t}=lh(),r=(e,t)=>e.topic.localeCompare(t.topic),s=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});return Qf={decode:async t=>({topicErrors:new e(t).readArray(s).sort(r)}),parse:t}}function fh(){if(rh)return th;rh=1;const e=dh();return th=({topics:t,validateOnly:r,timeout:s})=>Object.assign(e({topics:t,validateOnly:r,timeout:s}),{apiVersion:2})}function hh(){if(nh)return sh;nh=1;const e=Ni,{parse:t}=ph(),r=(e,t)=>e.topic.localeCompare(t.topic),s=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});return sh={decode:async t=>{const n=new e(t);return{throttleTime:n.readInt32(),topicErrors:n.readArray(s).sort(r)}},parse:t},sh}const mh={0:({topics:e,timeout:t})=>{const r=function(){if(Zf)return Hf;Zf=1;const e=bi,{CreateTopics:t}=ti;Hf=({topics:s,timeout:n=5e3})=>({apiKey:t,apiVersion:0,apiName:"CreateTopics",encode:async()=>(new e).writeArray(s.map(r)).writeInt32(n)});const r=({topic:t,numPartitions:r=-1,replicationFactor:i=-1,replicaAssignment:o=[],configEntries:a=[]})=>(new e).writeString(t).writeInt32(r).writeInt16(i).writeArray(o.map(s)).writeArray(a.map(n)),s=({partition:t,replicas:r})=>(new e).writeInt32(t).writeArray(r),n=({name:t,value:r})=>(new e).writeString(t).writeString(r);return Hf}(),s=lh();return{request:r({topics:e,timeout:t}),response:s}},1:({topics:e,validateOnly:t,timeout:r})=>{const s=dh(),n=ph();return{request:s({topics:e,validateOnly:t,timeout:r}),response:n}},2:({topics:e,validateOnly:t,timeout:r})=>{const s=fh(),n=hh();return{request:s({topics:e,validateOnly:t,timeout:r}),response:n}},3:({topics:e,validateOnly:t,timeout:r})=>{const s=function(){if(oh)return ih;oh=1;const e=fh();return ih=({topics:t,validateOnly:r,timeout:s})=>Object.assign(e({topics:t,validateOnly:r,timeout:s}),{apiVersion:3})}(),n=function(){if(ch)return ah;ch=1;const{parse:e,decode:t}=hh();return ah={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:s({topics:e,validateOnly:t,timeout:r}),response:n}}};var gh,yh,Ih,bh,wh,vh,Th,Eh,_h={versions:Object.keys(mh),protocol:({version:e})=>mh[e]};function Ah(){if(yh)return gh;yh=1;const e=bi,{DeleteTopics:t}=ti;return gh=({topics:r,timeout:s=5e3})=>({apiKey:t,apiVersion:0,apiName:"DeleteTopics",encode:async()=>(new e).writeArray(r).writeInt32(s)})}function Sh(){if(bh)return Ih;bh=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=(e,t)=>e.topic.localeCompare(t.topic),n=e=>({topic:e.readString(),errorCode:e.readInt16()});return Ih={decode:async t=>({topicErrors:new e(t).readArray(n).sort(s)}),parse:async e=>{const s=e.topicErrors.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}}}const Oh={0:({topics:e,timeout:t})=>{const r=Ah(),s=Sh();return{request:r({topics:e,timeout:t}),response:s}},1:({topics:e,timeout:t})=>{const r=function(){if(vh)return wh;vh=1;const e=Ah();return wh=({topics:t,timeout:r})=>Object.assign(e({topics:t,timeout:r}),{apiVersion:1})}(),s=function(){if(Eh)return Th;Eh=1;const e=Ni,{parse:t}=Sh(),r=(e,t)=>e.topic.localeCompare(t.topic),s=e=>({topic:e.readString(),errorCode:e.readInt16()});return Th={decode:async t=>{const n=new e(t);return{throttleTime:0,clientSideThrottleTime:n.readInt32(),topicErrors:n.readArray(s).sort(r)}},parse:t},Th}();return{request:r({topics:e,timeout:t}),response:s}}};var Nh,Rh,Ch,kh,xh,Lh,Bh,Ph,Mh={versions:Object.keys(Oh),protocol:({version:e})=>Oh[e]};function Dh(){if(Rh)return Nh;Rh=1;const e=bi,{DeleteRecords:t}=ti;return Nh=({topics:r,timeout:s=5e3})=>({apiKey:t,apiVersion:0,apiName:"DeleteRecords",encode:async()=>(new e).writeArray(r.map(({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(({partition:t,offset:r})=>(new e).writeInt32(t).writeInt64(r))))).writeInt32(s)})}function $h(){if(kh)return Ch;kh=1;const e=Ni,{KafkaJSDeleteTopicRecordsError:t}=Mn,{failure:r,createErrorFromCode:s}=_o,n=(e,t)=>e.topic.localeCompare(t.topic),i=async t=>{const r=new e(t);return{throttleTime:r.readInt32(),topics:r.readArray(e=>({topic:e.readString(),partitions:e.readArray(e=>({partition:e.readInt32(),lowWatermark:e.readInt64(),errorCode:e.readInt16()}))})).sort(n)}};return Ch=({topics:e})=>{return{decode:i,parse:(n=e,async e=>{const i=e.topics.map(({partitions:e})=>({partitionsWithErrors:e.filter(({errorCode:e})=>r(e))})).filter(({partitionsWithErrors:e})=>e.length);if(i.length>0){const[{topic:r}]=e.topics,[{partitions:o}]=n,[{partitionsWithErrors:a}]=i;throw new t({topic:r,partitions:a.map(({partition:e,errorCode:t})=>({partition:e,error:s(t),offset:o.find(t=>t.partition===e).offset}))})}return e})};var n}}const Uh={0:({topics:e,timeout:t})=>{const r=Dh(),s=$h();return{request:r({topics:e,timeout:t}),response:s({topics:e})}},1:({topics:e,timeout:t})=>{const r=function(){if(Lh)return xh;Lh=1;const e=Dh();return xh=({topics:t,timeout:r})=>Object.assign(e({topics:t,timeout:r}),{apiVersion:1})}(),s=function(){if(Ph)return Bh;Ph=1;const e=$h();return Bh=({topics:t})=>{const{parse:r,decode:s}=e({topics:t});return{decode:async e=>{const t=await s(e);return{...t,throttleTime:0,clientSideThrottleTime:t.throttleTime}},parse:r}}}();return{request:r({topics:e,timeout:t}),response:s({topics:e})}}};var jh,Gh,Fh,Vh,Kh,qh,Wh,Hh,Zh={versions:Object.keys(Uh),protocol:({version:e})=>Uh[e]};function Jh(){if(Gh)return jh;Gh=1;const e=bi,{InitProducerId:t}=ti;return jh=({transactionalId:r,transactionTimeout:s})=>({apiKey:t,apiVersion:0,apiName:"InitProducerId",encode:async()=>(new e).writeString(r).writeInt32(s)})}function Xh(){if(Vh)return Fh;Vh=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return Fh={decode:async t=>{const r=new e(t),n=r.readInt32(),i=r.readInt16();return s(i),{throttleTime:n,errorCode:i,producerId:r.readInt64().toString(),producerEpoch:r.readInt16()}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},Fh}const zh={0:({transactionalId:e,transactionTimeout:t=5e3})=>{const r=Jh(),s=Xh();return{request:r({transactionalId:e,transactionTimeout:t}),response:s}},1:({transactionalId:e,transactionTimeout:t=5e3})=>{const r=function(){if(qh)return Kh;qh=1;const e=Jh();return Kh=({transactionalId:t,transactionTimeout:r})=>Object.assign(e({transactionalId:t,transactionTimeout:r}),{apiVersion:1})}(),s=function(){if(Hh)return Wh;Hh=1;const{parse:e,decode:t}=Xh();return Wh={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({transactionalId:e,transactionTimeout:t}),response:s}}};var Yh,Qh,em,tm,rm,sm,nm,im,om={versions:Object.keys(zh),protocol:({version:e})=>zh[e]};function am(){if(Qh)return Yh;Qh=1;const e=bi,{AddPartitionsToTxn:t}=ti;Yh=({transactionalId:s,producerId:n,producerEpoch:i,topics:o})=>({apiKey:t,apiVersion:0,apiName:"AddPartitionsToTxn",encode:async()=>(new e).writeString(s).writeInt64(n).writeInt16(i).writeArray(o.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=t=>(new e).writeInt32(t);return Yh}function cm(){if(tm)return em;tm=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=async e=>({topic:e.readString(),partitionErrors:await e.readArrayAsync(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16()});return em={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),errors:await r.readArrayAsync(s)}},parse:async e=>{const s=e.errors.map(({partitionErrors:e})=>({partitionsWithErrors:e.filter(({errorCode:e})=>t(e))})).filter(({partitionsWithErrors:e})=>e.length);if(s.length>0)throw r(s[0].partitionsWithErrors[0].errorCode);return e}},em}const um={0:({transactionalId:e,producerId:t,producerEpoch:r,topics:s})=>{const n=am(),i=cm();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,topics:s}),response:i}},1:({transactionalId:e,producerId:t,producerEpoch:r,topics:s})=>{const n=function(){if(sm)return rm;sm=1;const e=am();return rm=({transactionalId:t,producerId:r,producerEpoch:s,topics:n})=>Object.assign(e({transactionalId:t,producerId:r,producerEpoch:s,topics:n}),{apiVersion:1})}(),i=function(){if(im)return nm;im=1;const{parse:e,decode:t}=cm();return nm={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,topics:s}),response:i}}};var lm,dm,pm,fm,hm,mm,gm,ym,Im={versions:Object.keys(um),protocol:({version:e})=>um[e]};function bm(){if(dm)return lm;dm=1;const e=bi,{AddOffsetsToTxn:t}=ti;return lm=({transactionalId:r,producerId:s,producerEpoch:n,groupId:i})=>({apiKey:t,apiVersion:0,apiName:"AddOffsetsToTxn",encode:async()=>(new e).writeString(r).writeInt64(s).writeInt16(n).writeString(i)})}function wm(){if(fm)return pm;fm=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return pm={decode:async t=>{const r=new e(t),n=r.readInt32(),i=r.readInt16();return s(i),{throttleTime:n,errorCode:i}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},pm}const vm={0:({transactionalId:e,producerId:t,producerEpoch:r,groupId:s})=>{const n=bm(),i=wm();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,groupId:s}),response:i}},1:({transactionalId:e,producerId:t,producerEpoch:r,groupId:s})=>{const n=function(){if(mm)return hm;mm=1;const e=bm();return hm=({transactionalId:t,producerId:r,producerEpoch:s,groupId:n})=>Object.assign(e({transactionalId:t,producerId:r,producerEpoch:s,groupId:n}),{apiVersion:1})}(),i=function(){if(ym)return gm;ym=1;const{parse:e,decode:t}=wm();return gm={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,groupId:s}),response:i}}};var Tm,Em,_m,Am,Sm,Om,Nm,Rm,Cm={versions:Object.keys(vm),protocol:({version:e})=>vm[e]};function km(){if(Em)return Tm;Em=1;const e=bi,{EndTxn:t}=ti;return Tm=({transactionalId:r,producerId:s,producerEpoch:n,transactionResult:i})=>({apiKey:t,apiVersion:0,apiName:"EndTxn",encode:async()=>(new e).writeString(r).writeInt64(s).writeInt16(n).writeBoolean(i)})}function xm(){if(Am)return _m;Am=1;const e=Ni,{failure:t,createErrorFromCode:r,failIfVersionNotSupported:s}=_o;return _m={decode:async t=>{const r=new e(t),n=r.readInt32(),i=r.readInt16();return s(i),{throttleTime:n,errorCode:i}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},_m}const Lm={0:({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s})=>{const n=km(),i=xm();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s}),response:i}},1:({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s})=>{const n=function(){if(Om)return Sm;Om=1;const e=km();return Sm=({transactionalId:t,producerId:r,producerEpoch:s,transactionResult:n})=>Object.assign(e({transactionalId:t,producerId:r,producerEpoch:s,transactionResult:n}),{apiVersion:1})}(),i=function(){if(Rm)return Nm;Rm=1;const{parse:e,decode:t}=xm();return Nm={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:n({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s}),response:i}}};var Bm,Pm,Mm,Dm,$m,Um,jm,Gm,Fm={versions:Object.keys(Lm),protocol:({version:e})=>Lm[e]};function Vm(){if(Pm)return Bm;Pm=1;const e=bi,{TxnOffsetCommit:t}=ti;Bm=({transactionalId:s,groupId:n,producerId:i,producerEpoch:o,topics:a})=>({apiKey:t,apiVersion:0,apiName:"TxnOffsetCommit",encode:async()=>(new e).writeString(s).writeString(n).writeInt64(i).writeInt16(o).writeArray(a.map(r))});const r=({topic:t,partitions:r})=>(new e).writeString(t).writeArray(r.map(s)),s=({partition:t,offset:r,metadata:s})=>(new e).writeInt32(t).writeInt64(r).writeString(s);return Bm}function Km(){if(Dm)return Mm;Dm=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=async e=>({topic:e.readString(),partitions:await e.readArrayAsync(n)}),n=e=>({partition:e.readInt32(),errorCode:e.readInt16()});return Mm={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),topics:await r.readArrayAsync(s)}},parse:async e=>{const s=e.topics.map(({partitions:e})=>({partitionsWithErrors:e.filter(({errorCode:e})=>t(e))})).filter(({partitionsWithErrors:e})=>e.length);if(s.length>0)throw r(s[0].partitionsWithErrors[0].errorCode);return e}},Mm}const qm={0:({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n})=>{const i=Vm(),o=Km();return{request:i({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n}),response:o}},1:({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n})=>{const i=function(){if(Um)return $m;Um=1;const e=Vm();return $m=({transactionalId:t,groupId:r,producerId:s,producerEpoch:n,topics:i})=>Object.assign(e({transactionalId:t,groupId:r,producerId:s,producerEpoch:n,topics:i}),{apiVersion:1})}(),o=function(){if(Gm)return jm;Gm=1;const{parse:e,decode:t}=Km();return jm={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:i({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n}),response:o}}};var Wm,Hm,Zm,Jm,Xm,zm,Ym,Qm,eg={versions:Object.keys(qm),protocol:({version:e})=>qm[e]};function tg(){if(Jm)return Zm;Jm=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),n=e=>({resourceType:e.readInt8(),resourceName:e.readString(),acls:e.readArray(s)});return Zm={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),errorCode:r.readInt16(),errorMessage:r.readString(),resources:r.readArray(n)}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},Zm}const rg={0:({resourceType:e,resourceName:t,principal:r,host:s,operation:n,permissionType:i})=>{const o=function(){if(Hm)return Wm;Hm=1;const e=bi,{DescribeAcls:t}=ti;return Wm=({resourceType:r,resourceName:s,principal:n,host:i,operation:o,permissionType:a})=>({apiKey:t,apiVersion:0,apiName:"DescribeAcls",encode:async()=>(new e).writeInt8(r).writeString(s).writeString(n).writeString(i).writeInt8(o).writeInt8(a)})}(),a=tg();return{request:o({resourceType:e,resourceName:t,principal:r,host:s,operation:n,permissionType:i}),response:a}},1:({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:n,operation:i,permissionType:o})=>{const a=function(){if(zm)return Xm;zm=1;const e=bi,{DescribeAcls:t}=ti;return Xm=({resourceType:r,resourceName:s,resourcePatternType:n,principal:i,host:o,operation:a,permissionType:c})=>({apiKey:t,apiVersion:1,apiName:"DescribeAcls",encode:async()=>(new e).writeInt8(r).writeString(s).writeInt8(n).writeString(i).writeString(o).writeInt8(a).writeInt8(c)})}(),c=function(){if(Qm)return Ym;Qm=1;const{parse:e}=tg(),t=Ni,r=e=>({principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),s=e=>({resourceType:e.readInt8(),resourceName:e.readString(),resourcePatternType:e.readInt8(),acls:e.readArray(r)});return Ym={decode:async e=>{const r=new t(e);return{throttleTime:0,clientSideThrottleTime:r.readInt32(),errorCode:r.readInt16(),errorMessage:r.readString(),resources:r.readArray(s)}},parse:e},Ym}();return{request:a({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:n,operation:i,permissionType:o}),response:c}}};var sg,ng,ig,og,ag,cg,ug,lg,dg={versions:Object.keys(rg),protocol:({version:e})=>rg[e]};function pg(){if(og)return ig;og=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({errorCode:e.readInt16(),errorMessage:e.readString()});return ig={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),creationResponses:r.readArray(s)}},parse:async e=>{const s=e.creationResponses.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}},ig}const fg={0:({creations:e})=>{const t=function(){if(ng)return sg;ng=1;const e=bi,{CreateAcls:t}=ti,r=({resourceType:t,resourceName:r,principal:s,host:n,operation:i,permissionType:o})=>(new e).writeInt8(t).writeString(r).writeString(s).writeString(n).writeInt8(i).writeInt8(o);return sg=({creations:s})=>({apiKey:t,apiVersion:0,apiName:"CreateAcls",encode:async()=>(new e).writeArray(s.map(r))})}(),r=pg();return{request:t({creations:e}),response:r}},1:({creations:e})=>{const t=function(){if(cg)return ag;cg=1;const e=bi,{CreateAcls:t}=ti,r=({resourceType:t,resourceName:r,resourcePatternType:s,principal:n,host:i,operation:o,permissionType:a})=>(new e).writeInt8(t).writeString(r).writeInt8(s).writeString(n).writeString(i).writeInt8(o).writeInt8(a);return ag=({creations:s})=>({apiKey:t,apiVersion:1,apiName:"CreateAcls",encode:async()=>(new e).writeArray(s.map(r))})}(),r=function(){if(lg)return ug;lg=1;const{parse:e,decode:t}=pg();return ug={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:t({creations:e}),response:r}}};var hg,mg,gg,yg,Ig,bg,wg,vg,Tg={versions:Object.keys(fg),protocol:({version:e})=>fg[e]};function Eg(){if(yg)return gg;yg=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),n=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),matchingAcls:e.readArray(s)});return gg={decodeMatchingAcls:s,decodeFilterResponse:n,decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),filterResponses:r.readArray(n)}},parse:async e=>{const s=e.filterResponses.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);for(const s of e.filterResponses){const e=s.matchingAcls.filter(({errorCode:e})=>t(e));if(e.length>0)throw r(e[0].errorCode)}return e}},gg}const _g={0:({filters:e})=>{const t=function(){if(mg)return hg;mg=1;const e=bi,{DeleteAcls:t}=ti,r=({resourceType:t,resourceName:r,principal:s,host:n,operation:i,permissionType:o})=>(new e).writeInt8(t).writeString(r).writeString(s).writeString(n).writeInt8(i).writeInt8(o);return hg=({filters:s})=>({apiKey:t,apiVersion:0,apiName:"DeleteAcls",encode:async()=>(new e).writeArray(s.map(r))})}(),r=Eg();return{request:t({filters:e}),response:r}},1:({filters:e})=>{const t=function(){if(bg)return Ig;bg=1;const e=bi,{DeleteAcls:t}=ti,r=({resourceType:t,resourceName:r,resourcePatternType:s,principal:n,host:i,operation:o,permissionType:a})=>(new e).writeInt8(t).writeString(r).writeInt8(s).writeString(n).writeString(i).writeInt8(o).writeInt8(a);return Ig=({filters:s})=>({apiKey:t,apiVersion:1,apiName:"DeleteAcls",encode:async()=>(new e).writeArray(s.map(r))})}(),r=function(){if(vg)return wg;vg=1;const e=Ni,{parse:t}=Eg(),r=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),resourcePatternType:e.readInt8(),principal:e.readString(),host:e.readString(),operation:e.readInt8(),permissionType:e.readInt8()}),s=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),matchingAcls:e.readArray(r)});return wg={decode:async t=>{const r=new e(t);return{throttleTime:0,clientSideThrottleTime:r.readInt32(),filterResponses:r.readArray(s)}},parse:t},wg}();return{request:t({filters:e}),response:r}}};var Ag,Sg,Og={versions:Object.keys(_g),protocol:({version:e})=>_g[e]};var Ng,Rg,Cg,kg,xg,Lg,Bg,Pg,Mg,Dg,$g={UNKNOWN:0,TOPIC_CONFIG:1,DYNAMIC_BROKER_CONFIG:2,DYNAMIC_DEFAULT_BROKER_CONFIG:3,STATIC_BROKER_CONFIG:4,DEFAULT_CONFIG:5,DYNAMIC_BROKER_LOGGER_CONFIG:6},Ug={UNKNOWN:0,TOPIC:2,BROKER:4,BROKER_LOGGER:8};function jg(){if(Rg)return Ng;Rg=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=$g,n=Ug,i=e=>{const t=e.readInt16(),r=e.readString(),i=e.readInt8(),o=e.readString(),a=e.readArray(e=>((e,t)=>{const r=e.readString(),i=e.readString(),o=e.readBoolean(),a=e.readBoolean(),c=e.readBoolean();let u;if(a)u=s.DEFAULT_CONFIG;else switch(t){case n.BROKER:u=s.STATIC_BROKER_CONFIG;break;case n.TOPIC:u=s.TOPIC_CONFIG;break;default:u=s.UNKNOWN}return{configName:r,configValue:i,readOnly:o,isDefault:a,configSource:u,isSensitive:c}})(e,i));return{errorCode:t,errorMessage:r,resourceType:i,resourceName:o,configEntries:a}};return Ng={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),resources:r.readArray(i)}},parse:async e=>{const s=e.resources.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}},Ng}function Gg(){if(kg)return Cg;kg=1;const e=bi,{DescribeConfigs:t}=ti;Cg=({resources:s,includeSynonyms:n=!1})=>({apiKey:t,apiVersion:1,apiName:"DescribeConfigs",encode:async()=>(new e).writeArray(s.map(r)).writeBoolean(n)});const r=({type:t,name:r,configNames:s=[]})=>(new e).writeInt8(t).writeString(r).writeNullableArray(s);return Cg}function Fg(){if(Lg)return xg;Lg=1;const e=Ni,{parse:t}=jg(),{DEFAULT_CONFIG:r}=$g,s=e=>({configName:e.readString(),configValue:e.readString(),configSource:e.readInt8()}),n=e=>{const t=e.readString(),n=e.readString(),i=e.readBoolean(),o=e.readInt8(),a=e.readBoolean(),c=e.readArray(s);return{configName:t,configValue:n,readOnly:i,isDefault:o===r,configSource:o,isSensitive:a,configSynonyms:c}},i=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString(),configEntries:e.readArray(n)});return xg={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),resources:r.readArray(i)}},parse:t},xg}const Vg={0:({resources:e})=>{const t=function(){if(Sg)return Ag;Sg=1;const e=bi,{DescribeConfigs:t}=ti;Ag=({resources:s})=>({apiKey:t,apiVersion:0,apiName:"DescribeConfigs",encode:async()=>(new e).writeArray(s.map(r))});const r=({type:t,name:r,configNames:s=[]})=>(new e).writeInt8(t).writeString(r).writeNullableArray(s);return Ag}(),r=jg();return{request:t({resources:e}),response:r}},1:({resources:e,includeSynonyms:t})=>{const r=Gg(),s=Fg();return{request:r({resources:e,includeSynonyms:t}),response:s}},2:({resources:e,includeSynonyms:t})=>{const r=function(){if(Pg)return Bg;Pg=1;const e=Gg();return Bg=({resources:t,includeSynonyms:r})=>Object.assign(e({resources:t,includeSynonyms:r}),{apiVersion:2})}(),s=function(){if(Dg)return Mg;Dg=1;const{parse:e,decode:t}=Fg();return Mg={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({resources:e,includeSynonyms:t}),response:s}}};var Kg,qg,Wg,Hg,Zg,Jg,Xg,zg,Yg={versions:Object.keys(Vg),protocol:({version:e})=>Vg[e]};function Qg(){if(qg)return Kg;qg=1;const e=bi,{AlterConfigs:t}=ti;Kg=({resources:s,validateOnly:n=!1})=>({apiKey:t,apiVersion:0,apiName:"AlterConfigs",encode:async()=>(new e).writeArray(s.map(r)).writeBoolean(n)});const r=({type:t,name:r,configEntries:n})=>(new e).writeInt8(t).writeString(r).writeArray(n.map(s)),s=({name:t,value:r})=>(new e).writeString(t).writeString(r);return Kg}function ey(){if(Hg)return Wg;Hg=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({errorCode:e.readInt16(),errorMessage:e.readString(),resourceType:e.readInt8(),resourceName:e.readString()});return Wg={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),resources:r.readArray(s)}},parse:async e=>{const s=e.resources.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}},Wg}const ty={0:({resources:e,validateOnly:t})=>{const r=Qg(),s=ey();return{request:r({resources:e,validateOnly:t}),response:s}},1:({resources:e,validateOnly:t})=>{const r=function(){if(Jg)return Zg;Jg=1;const e=Qg();return Zg=({resources:t,validateOnly:r})=>Object.assign(e({resources:t,validateOnly:r}),{apiVersion:1})}(),s=function(){if(zg)return Xg;zg=1;const{parse:e,decode:t}=ey();return Xg={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:r({resources:e,validateOnly:t}),response:s}}};var ry,sy,ny,iy,oy,ay,cy,uy,ly={versions:Object.keys(ty),protocol:({version:e})=>ty[e]};function dy(){if(sy)return ry;sy=1;const e=bi,{SaslAuthenticate:t}=ti;return ry=({authBytes:r})=>({apiKey:t,apiVersion:0,apiName:"SaslAuthenticate",encode:async()=>(new e).writeBuffer(r)})}function py(){if(iy)return ny;iy=1;const e=Ni,t=bi,{failure:r,createErrorFromCode:s,failIfVersionNotSupported:n,errorCodes:i}=_o,{KafkaJSProtocolError:o}=Mn,a=i.find(e=>58===e.code);return ny={decode:async r=>{const s=new e(r),i=s.readInt16();n(i);return{errorCode:i,errorMessage:s.readString(),authBytes:(new t).writeBytes(s.readBytes()).buffer}},parse:async e=>{if(58===e.errorCode&&e.errorMessage)throw new o({...a,message:e.errorMessage});if(r(e.errorCode))throw s(e.errorCode);return e}},ny}const fy={0:({authBytes:e})=>{const t=dy(),r=py();return{request:t({authBytes:e}),response:r}},1:({authBytes:e})=>{const t=function(){if(ay)return oy;ay=1;const e=dy();return oy=({authBytes:t})=>Object.assign(e({authBytes:t}),{apiVersion:1})}(),r=function(){if(uy)return cy;uy=1;const e=Ni,t=bi,{parse:r}=py(),{failIfVersionNotSupported:s}=_o;return cy={decode:async r=>{const n=new e(r),i=n.readInt16();return s(i),{errorCode:i,errorMessage:n.readString(),authBytes:(new t).writeBytes(n.readBytes()).buffer,sessionLifetimeMs:n.readInt64().toString()}},parse:r},cy}();return{request:t({authBytes:e}),response:r}}};var hy,my,gy,yy,Iy,by,wy,vy,Ty={versions:Object.keys(fy),protocol:({version:e})=>fy[e]};function Ey(){if(my)return hy;my=1;const e=bi,{CreatePartitions:t}=ti;hy=({topicPartitions:s,validateOnly:n=!1,timeout:i=5e3})=>({apiKey:t,apiVersion:0,apiName:"CreatePartitions",encode:async()=>(new e).writeArray(s.map(r)).writeInt32(i).writeBoolean(n)});const r=({topic:t,count:r,assignments:n=[]})=>(new e).writeString(t).writeInt32(r).writeNullableArray(n.map(s)),s=t=>(new e).writeNullableArray(t);return hy}function _y(){if(yy)return gy;yy=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=(e,t)=>e.topic.localeCompare(t.topic),n=e=>({topic:e.readString(),errorCode:e.readInt16(),errorMessage:e.readString()});return gy={decode:async t=>{const r=new e(t);return{throttleTime:r.readInt32(),topicErrors:r.readArray(n).sort(s)}},parse:async e=>{const s=e.topicErrors.filter(({errorCode:e})=>t(e));if(s.length>0)throw r(s[0].errorCode);return e}},gy}const Ay={0:({topicPartitions:e,timeout:t,validateOnly:r})=>{const s=Ey(),n=_y();return{request:s({topicPartitions:e,timeout:t,validateOnly:r}),response:n}},1:({topicPartitions:e,validateOnly:t,timeout:r})=>{const s=function(){if(by)return Iy;by=1;const e=Ey();return Iy=({topicPartitions:t,validateOnly:r,timeout:s})=>Object.assign(e({topicPartitions:t,validateOnly:r,timeout:s}),{apiVersion:1})}(),n=function(){if(vy)return wy;vy=1;const{parse:e,decode:t}=_y();return wy={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:s({topicPartitions:e,validateOnly:t,timeout:r}),response:n}}};var Sy,Oy,Ny,Ry,Cy,ky,xy,Ly,By={versions:Object.keys(Ay),protocol:({version:e})=>Ay[e]};function Py(){if(Oy)return Sy;Oy=1;const e=bi,{DeleteGroups:t}=ti;Sy=s=>({apiKey:t,apiVersion:0,apiName:"DeleteGroups",encode:async()=>(new e).writeArray(s.map(r))});const r=t=>(new e).writeString(t);return Sy}function My(){if(Ry)return Ny;Ry=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>({groupId:e.readString(),errorCode:e.readInt16()});return Ny={decode:async n=>{const i=new e(n),o=i.readInt32(),a=i.readArray(s);for(const e of a)t(e.errorCode)&&(e.error=r(e.errorCode));return{throttleTimeMs:o,results:a}},parse:async e=>e},Ny}const Dy={0:e=>{const t=Py(),r=My();return{request:t(e),response:r}},1:e=>{const t=function(){if(ky)return Cy;ky=1;const e=Py();return Cy=t=>Object.assign(e(t),{apiVersion:1})}(),r=function(){if(Ly)return xy;Ly=1;const{parse:e,decode:t}=My();return xy={decode:async e=>{const r=await t(e);return{...r,throttleTime:0,clientSideThrottleTime:r.throttleTime}},parse:e}}();return{request:t(e),response:r}}};var $y,Uy,jy,Gy,Fy={versions:Object.keys(Dy),protocol:({version:e})=>Dy[e]};const Vy={0:({topics:e,timeout:t})=>{const r=function(){if(Uy)return $y;Uy=1;const e=bi,{AlterPartitionReassignments:t}=ti;$y=({topics:s,timeout:n=5e3})=>({apiKey:t,apiVersion:0,apiName:"AlterPartitionReassignments",encode:async()=>(new e).writeUVarIntBytes().writeInt32(n).writeUVarIntArray(s.map(r)).writeUVarIntBytes()});const r=({topic:t,partitionAssignment:r})=>(new e).writeUVarIntString(t).writeUVarIntArray(r.map(s)).writeUVarIntBytes(),s=({partition:t,replicas:r})=>(new e).writeInt32(t).writeUVarIntArray(r.map(n)).writeUVarIntBytes(),n=t=>(new e).writeInt32(t);return $y}(),s=function(){if(Gy)return jy;Gy=1;const{KafkaJSAggregateError:e,KafkaJSAlterPartitionReassignmentsError:t}=Mn,r=Ni,{failure:s,createErrorFromCode:n}=_o,i=e=>{const t={topic:e.readUVarIntString(),partitions:e.readUVarIntArray(o)};return e.readTaggedFields(),t},o=e=>{const t={partition:e.readInt32(),errorCode:e.readInt16()};return e.readUVarIntString(),e.readTaggedFields(),t};return jy={decode:async e=>{const t=new r(e);t.readTaggedFields();const s=t.readInt32(),n=t.readInt16();return t.readUVarIntString(),{throttleTime:s,errorCode:n,responses:t.readUVarIntArray(i)}},parse:async r=>{if(s(r.errorCode))throw new t(n(r.errorCode));const i=r.responses.flatMap(({partitions:e,topic:t})=>e.filter(e=>s(e.errorCode)).map(e=>({...e,topic:t})));if(i.length>0)throw new e("Errors altering partition reassignments",i.map(({topic:e,partition:r,errorCode:s})=>new t(n(s),e,r)));return r}},jy}();return{request:r({topics:e,timeout:t}),response:s}}};var Ky,qy,Wy,Hy,Zy={versions:Object.keys(Vy),protocol:({version:e})=>Vy[e]};const Jy={0:({topics:e,timeout:t})=>{const r=function(){if(qy)return Ky;qy=1;const e=bi,{ListPartitionReassignments:t}=ti;Ky=({topics:s=null,timeout:n=5e3})=>({apiKey:t,apiVersion:0,apiName:"ListPartitionReassignments",encode:async()=>(new e).writeUVarIntBytes().writeInt32(n).writeUVarIntArray(null===s?s:s.map(r)).writeUVarIntBytes()});const r=({topic:t,partitions:r})=>(new e).writeUVarIntString(t).writeUVarIntArray(r.map(s)).writeUVarIntBytes(),s=t=>(new e).writeInt32(t);return Ky}(),s=function(){if(Hy)return Wy;Hy=1;const e=Ni,{failure:t,createErrorFromCode:r}=_o,s=e=>e.readInt32(),n=e=>{const t={partition:e.readInt32(),replicas:e.readUVarIntArray(s),addingReplicas:e.readUVarIntArray(s),removingReplicas:e.readUVarIntArray(s)};return e.readTaggedFields(),t},i=e=>{const t={name:e.readUVarIntString(),partitions:e.readUVarIntArray(n)};return e.readTaggedFields(),t};return Wy={decode:async t=>{const r=new e(t);r.readTaggedFields();const s=r.readInt32(),n=r.readInt16();return r.readUVarIntString(),{throttleTime:s,errorCode:n,topics:r.readUVarIntArray(i)}},parse:async e=>{if(t(e.errorCode))throw r(e.errorCode);return e}},Wy}();return{request:r({topics:e,timeout:t}),response:s}}};var Xy={versions:Object.keys(Jy),protocol:({version:e})=>Jy[e]};const zy=ti,{KafkaJSServerDoesNotSupportApiKey:Yy,KafkaJSNotImplemented:Qy}=Mn,eI={versions:[],protocol:()=>{throw new Qy}},tI={Produce:Ja,Fetch:Pc,ListOffsets:hu,Metadata:Wu,LeaderAndIsr:eI,StopReplica:eI,UpdateMetadata:eI,ControlledShutdown:eI,OffsetCommit:ml,OffsetFetch:Ll,GroupCoordinator:ud,JoinGroup:Pd,Heartbeat:np,LeaveGroup:Op,SyncGroup:Wp,DescribeGroups:df,ListGroups:Af,SaslHandshake:Gf,ApiVersions:uh,CreateTopics:_h,DeleteTopics:Mh,DeleteRecords:Zh,InitProducerId:om,OffsetForLeaderEpoch:eI,AddPartitionsToTxn:Im,AddOffsetsToTxn:Cm,EndTxn:Fm,WriteTxnMarkers:eI,TxnOffsetCommit:eg,DescribeAcls:dg,CreateAcls:Tg,DeleteAcls:Og,DescribeConfigs:Yg,AlterConfigs:ly,AlterReplicaLogDirs:eI,DescribeLogDirs:eI,SaslAuthenticate:Ty,CreatePartitions:By,CreateDelegationToken:eI,RenewDelegationToken:eI,ExpireDelegationToken:eI,DescribeDelegationToken:eI,DeleteGroups:Fy,ElectLeaders:eI,IncrementalAlterConfigs:eI,AlterPartitionReassignments:Zy,ListPartitionReassignments:Xy},rI=Object.keys(zy),sI=Object.values(zy),nI=e=>rI[sI.indexOf(e)];var iI={requests:tI,lookup:e=>(t,r)=>{const s=e[t],n=r.versions.map(Number),i=Math.max(...n);if(!s||null==s.maxVersion)throw new Yy("The Kafka server does not support the requested API version",{apiKey:t,apiName:nI(t)});const o=Math.min(i,s.maxVersion);return r.protocol({version:o})}},oI=e=>{if(!Array.isArray(e))throw new TypeError("'array' is not an array");if(e.length<2)return e;const t=e.slice();for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[r],t[r]=s}return t};const aI=Xn,{Types:cI}=ei,{requests:uI,lookup:lI}=iI,{KafkaJSNonRetriableError:dI}=Mn,pI=ti,fI=oI,hI=Symbol("private:Broker:sendRequest"),mI=()=>{throw new Error("Broker not connected")};var gI={maxRetryTime:3e4,initialRetryTime:300,factor:.2,multiplier:2,retries:5};const{KafkaJSNumberOfRetriesExceeded:yI,KafkaJSNonRetriableError:II}=Mn,bI=gI,wI=(e,t)=>{const r=e*t;return Math.ceil((s=t-r,n=t+r,Math.random()*(n-s)+s));var s,n},vI=["RangeError","ReferenceError","SyntaxError","TypeError"],TI=e=>{return(e.retriable||!1!==e.retriable)&&(t=e,!vI.includes(t.name));var t},EI=(e,t,r,s)=>{let n=!1;const{factor:i,multiplier:o,maxRetryTime:a,retries:c}=e,u=e=>{n=!0,r(e||new Error("Aborted"))},l=(e,d=0)=>{if(n)return;const p=(e=>Math.min(wI(i,e)*o,a))(e),f=d<c;s(u,d,e).then(t).catch(t=>{TI(t)?f?setTimeout(()=>l(p,d+1),e):r(new yI(t,{retryCount:d,retryTime:e,cause:t.cause||t})):r(new II(t,{cause:t.cause||t}))})};return l};var _I=(e={})=>t=>new Promise((r,s)=>{const n=Object.assign({},bI,e);EI(n,r,s,t)(wI(n.factor,n.initialRetryTime))}),AI=(e,t)=>{const r=[],s=e.length;let n=0;for(;n<s;)-1===t.indexOf(e[n])&&r.push(e[n]),n+=1;return r};const SI=class{constructor({connectionPool:e,logger:t,nodeId:r=null,versions:s=null,authenticationTimeout:n=1e4,allowAutoTopicCreation:i=!0}){this.connectionPool=e,this.nodeId=r,this.rootLogger=t,this.logger=t.namespace("Broker"),this.versions=s,this.authenticationTimeout=n,this.allowAutoTopicCreation=i;const o=2*this.connectionPool.connectionTimeout+this.authenticationTimeout;this.brokerAddress=`${this.connectionPool.host}:${this.connectionPool.port}`,this.lock=new aI({timeout:o,description:`connect to broker ${this.brokerAddress}`}),this.lookupRequest=mI}isConnected(){return this.connectionPool.sasl?this.connectionPool.isConnected()&&this.connectionPool.isAuthenticated():this.connectionPool.isConnected()}async connect(){await this.lock.acquire();try{if(this.isConnected())return;const e=await this.connectionPool.getConnection();if(this.versions||(this.versions=await this.apiVersions()),this.connectionPool.setVersions(this.versions),this.lookupRequest=lI(this.versions),null===e.getSupportAuthenticationProtocol()){let e=!1;try{this.lookupRequest(pI.SaslAuthenticate,uI.SaslAuthenticate),e=!0}catch(t){e=!1}this.connectionPool.setSupportAuthenticationProtocol(e),this.logger.debug("Verified support for SaslAuthenticate",{broker:this.brokerAddress,supportAuthenticationProtocol:e})}await e.authenticate()}finally{await this.lock.release()}}async disconnect(){await this.connectionPool.destroy()}async apiVersions(){let e;const t=uI.ApiVersions.versions.map(Number).sort().reverse();for(const r of t)try{const t=uI.ApiVersions.protocol({version:r});e=await this[hI]({...t(),requestTimeout:this.connectionPool.connectionTimeout});break}catch(e){if("UNSUPPORTED_VERSION"!==e.type)throw e}if(!e)throw new dI("API Versions not supported");return e.apiVersions.reduce((e,t)=>Object.assign(e,{[t.apiKey]:{minVersion:t.minVersion,maxVersion:t.maxVersion}}),{})}async metadata(e=[]){const t=this.lookupRequest(pI.Metadata,uI.Metadata),r=fI(e);return await this[hI](t({topics:r,allowAutoTopicCreation:this.allowAutoTopicCreation}))}async produce({topicData:e,transactionalId:t,producerId:r,producerEpoch:s,acks:n=-1,timeout:i=3e4,compression:o=cI.None}){const a=this.lookupRequest(pI.Produce,uI.Produce);return await this[hI](a({acks:n,timeout:i,compression:o,topicData:e,transactionalId:t,producerId:r,producerEpoch:s}))}async fetch({replicaId:e,isolationLevel:t,maxWaitTime:r=5e3,minBytes:s=1,maxBytes:n=10485760,topics:i,rackId:o=""}){const a=this.lookupRequest(pI.Fetch,uI.Fetch),c=i.reduce((e,{topic:t,partitions:r})=>(r.forEach(r=>{e.push({topic:t,partition:r})}),e),[]),u=fI(c).reduce((e,{topic:t,partition:r})=>{const s=e[e.length-1];return null!=s&&s.topic===t?e[e.length-1].partitions.push(r):e.push({topic:t,partitions:[r]}),e},[]);return await this[hI](a({replicaId:e,isolationLevel:t,maxWaitTime:r,minBytes:s,maxBytes:n,topics:u,rackId:o}))}async heartbeat({groupId:e,groupGenerationId:t,memberId:r}){const s=this.lookupRequest(pI.Heartbeat,uI.Heartbeat);return await this[hI](s({groupId:e,groupGenerationId:t,memberId:r}))}async findGroupCoordinator({groupId:e,coordinatorType:t}){const r=this.lookupRequest(pI.GroupCoordinator,uI.GroupCoordinator);return await this[hI](r({groupId:e,coordinatorType:t}))}async joinGroup({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:s="",protocolType:n="consumer",groupProtocols:i}){const o=this.lookupRequest(pI.JoinGroup,uI.JoinGroup),a=(a=s)=>this[hI](o({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:a,protocolType:n,groupProtocols:i}));try{return await a()}catch(e){if("KafkaJSMemberIdRequired"===e.name)return a(e.memberId);throw e}}async leaveGroup({groupId:e,memberId:t}){const r=this.lookupRequest(pI.LeaveGroup,uI.LeaveGroup);return await this[hI](r({groupId:e,memberId:t}))}async syncGroup({groupId:e,generationId:t,memberId:r,groupAssignment:s}){const n=this.lookupRequest(pI.SyncGroup,uI.SyncGroup);return await this[hI](n({groupId:e,generationId:t,memberId:r,groupAssignment:s}))}async listOffsets({replicaId:e,isolationLevel:t,topics:r}){const s=this.lookupRequest(pI.ListOffsets,uI.ListOffsets),n=await this[hI](s({replicaId:e,isolationLevel:t,topics:r}));for(const e of n.responses)e.partitions=e.partitions.map(({offsets:e,...t})=>e?{...t,offset:e.pop()}:t);return n}async offsetCommit({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:n}){const i=this.lookupRequest(pI.OffsetCommit,uI.OffsetCommit);return await this[hI](i({groupId:e,groupGenerationId:t,memberId:r,retentionTime:s,topics:n}))}async offsetFetch({groupId:e,topics:t}){const r=this.lookupRequest(pI.OffsetFetch,uI.OffsetFetch);return await this[hI](r({groupId:e,topics:t}))}async describeGroups({groupIds:e}){const t=this.lookupRequest(pI.DescribeGroups,uI.DescribeGroups);return await this[hI](t({groupIds:e}))}async createTopics({topics:e,validateOnly:t=!1,timeout:r=5e3}){const s=this.lookupRequest(pI.CreateTopics,uI.CreateTopics);return await this[hI](s({topics:e,validateOnly:t,timeout:r}))}async createPartitions({topicPartitions:e,validateOnly:t=!1,timeout:r=5e3}){const s=this.lookupRequest(pI.CreatePartitions,uI.CreatePartitions);return await this[hI](s({topicPartitions:e,validateOnly:t,timeout:r}))}async deleteTopics({topics:e,timeout:t=5e3}){const r=this.lookupRequest(pI.DeleteTopics,uI.DeleteTopics);return await this[hI](r({topics:e,timeout:t}))}async describeConfigs({resources:e,includeSynonyms:t=!1}){const r=this.lookupRequest(pI.DescribeConfigs,uI.DescribeConfigs);return await this[hI](r({resources:e,includeSynonyms:t}))}async alterConfigs({resources:e,validateOnly:t=!1}){const r=this.lookupRequest(pI.AlterConfigs,uI.AlterConfigs);return await this[hI](r({resources:e,validateOnly:t}))}async initProducerId({transactionalId:e,transactionTimeout:t}){const r=this.lookupRequest(pI.InitProducerId,uI.InitProducerId);return await this[hI](r({transactionalId:e,transactionTimeout:t}))}async addPartitionsToTxn({transactionalId:e,producerId:t,producerEpoch:r,topics:s}){const n=this.lookupRequest(pI.AddPartitionsToTxn,uI.AddPartitionsToTxn);return await this[hI](n({transactionalId:e,producerId:t,producerEpoch:r,topics:s}))}async addOffsetsToTxn({transactionalId:e,producerId:t,producerEpoch:r,groupId:s}){const n=this.lookupRequest(pI.AddOffsetsToTxn,uI.AddOffsetsToTxn);return await this[hI](n({transactionalId:e,producerId:t,producerEpoch:r,groupId:s}))}async txnOffsetCommit({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n}){const i=this.lookupRequest(pI.TxnOffsetCommit,uI.TxnOffsetCommit);return await this[hI](i({transactionalId:e,groupId:t,producerId:r,producerEpoch:s,topics:n}))}async endTxn({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s}){const n=this.lookupRequest(pI.EndTxn,uI.EndTxn);return await this[hI](n({transactionalId:e,producerId:t,producerEpoch:r,transactionResult:s}))}async listGroups(){const e=this.lookupRequest(pI.ListGroups,uI.ListGroups);return await this[hI](e())}async deleteGroups(e){const t=this.lookupRequest(pI.DeleteGroups,uI.DeleteGroups);return await this[hI](t(e))}async deleteRecords({topics:e}){const t=this.lookupRequest(pI.DeleteRecords,uI.DeleteRecords);return await this[hI](t({topics:e}))}async createAcls({acl:e}){const t=this.lookupRequest(pI.CreateAcls,uI.CreateAcls);return await this[hI](t({creations:e}))}async describeAcls({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:n,operation:i,permissionType:o}){const a=this.lookupRequest(pI.DescribeAcls,uI.DescribeAcls);return await this[hI](a({resourceType:e,resourceName:t,resourcePatternType:r,principal:s,host:n,operation:i,permissionType:o}))}async deleteAcls({filters:e}){const t=this.lookupRequest(pI.DeleteAcls,uI.DeleteAcls);return await this[hI](t({filters:e}))}async alterPartitionReassignments({topics:e,timeout:t}){const r=this.lookupRequest(pI.AlterPartitionReassignments,uI.AlterPartitionReassignments);return await this[hI](r({topics:e,timeout:t}))}async listPartitionReassignments({topics:e=null,timeout:t}){const r=this.lookupRequest(pI.ListPartitionReassignments,uI.ListPartitionReassignments);return await this[hI](r({topics:e,timeout:t}))}async[hI](e){try{return await this.connectionPool.send(e)}catch(e){throw"KafkaJSConnectionClosedError"===e.name&&await this.disconnect(),e}}},OI=_I,NI=oI,RI=AI,{KafkaJSBrokerNotFound:CI,KafkaJSProtocolError:kI}=Mn,{keys:xI,assign:LI,values:BI}=Object;var PI=e=>{let t=null;return(...r)=>(null==t&&(t=e(...r).finally(()=>t=null)),t)};const MI=bi;var DI={EARLIEST_OFFSET:-2,LATEST_OFFSET:-1,INT_32_MAX_VALUE:Math.pow(2,31)-1},$I=e=>t=>`${e}.${t}`;const UI=$I("network");var jI={NETWORK_REQUEST:UI("request"),NETWORK_REQUEST_TIMEOUT:UI("request_timeout"),NETWORK_REQUEST_QUEUE_SIZE:UI("request_queue_size")};const{KafkaJSRequestTimeoutError:GI,KafkaJSNonRetriableError:FI}=Mn,VI=jI,KI=Symbol("private:SocketRequest:state"),qI=Symbol("private:SocketRequest:emitEvent"),WI={PENDING:Symbol("PENDING"),SENT:Symbol("SENT"),COMPLETED:Symbol("COMPLETED"),REJECTED:Symbol("REJECTED")};const{EventEmitter:HI}=i,ZI=class{constructor({requestTimeout:e,broker:t,clientId:r,entry:s,expectResponse:n,send:i,timeout:o,instrumentationEmitter:a=null}){this.createdAt=Date.now(),this.requestTimeout=e,this.broker=t,this.clientId=r,this.entry=s,this.correlationId=s.correlationId,this.expectResponse=n,this.sendRequest=i,this.timeoutHandler=o,this.sentAt=null,this.duration=null,this.pendingDuration=null,this[KI]=WI.PENDING,this[qI]=(e,t)=>a&&a.emit(e,t)}send(){this.throwIfInvalidState({accepted:[WI.PENDING],next:WI.SENT}),this.sendRequest(),this.sentAt=Date.now(),this.pendingDuration=this.sentAt-this.createdAt,this[KI]=WI.SENT}timeoutRequest(){const{apiName:e,apiKey:t,apiVersion:r}=this.entry,s=`${e}(key: ${t}, version: ${r})`,n={broker:this.broker,clientId:this.clientId,correlationId:this.correlationId,createdAt:this.createdAt,sentAt:this.sentAt,pendingDuration:this.pendingDuration};this.timeoutHandler(),this.rejected(new GI(`Request ${s} timed out`,n)),this[qI](VI.NETWORK_REQUEST_TIMEOUT,{...n,apiName:e,apiKey:t,apiVersion:r})}completed({size:e,payload:t}){this.throwIfInvalidState({accepted:[WI.SENT],next:WI.COMPLETED});const{entry:r,correlationId:s,broker:n,clientId:i,createdAt:o,sentAt:a,pendingDuration:c}=this;this[KI]=WI.COMPLETED,this.duration=Date.now()-this.sentAt,r.resolve({correlationId:s,entry:r,size:e,payload:t}),this[qI](VI.NETWORK_REQUEST,{broker:n,clientId:i,correlationId:s,size:e,createdAt:o,sentAt:a,pendingDuration:c,duration:this.duration,apiName:r.apiName,apiKey:r.apiKey,apiVersion:r.apiVersion})}rejected(e){this.throwIfInvalidState({accepted:[WI.PENDING,WI.SENT],next:WI.REJECTED}),this[KI]=WI.REJECTED,this.duration=Date.now()-this.sentAt,this.entry.reject(e)}throwIfInvalidState({accepted:e,next:t}){if(e.includes(this[KI]))return;const r=this[KI].toString();throw new FI(`Invalid state, can't transition from ${r} to ${t.toString()}`)}},JI=jI,{KafkaJSInvariantViolation:XI}=Mn,zI=Symbol("private:RequestQueue:emitQueueSizeEvent"),YI=Symbol("private:RequestQueue:emitQueueEmpty"),QI="requestQueueEmpty";const eb={CONNECTED:"connected",DISCONNECTING:"disconnecting",DISCONNECTED:"disconnected"};var tb={CONNECTION_STATUS:eb,CONNECTED_STATUS:[eb.CONNECTED,eb.DISCONNECTING]};const rb=bi;var sb={request:({authorizationIdentity:e=null,username:t,password:r})=>({encode:async()=>(new rb).writeBytes([e,t,r].join("\0")).buffer}),response:{decode:async()=>!0,parse:async()=>!0}};const{request:nb,response:ib}=sb,{KafkaJSSASLAuthenticationError:ob}=Mn;var ab=e=>({host:t,port:r,logger:s,saslAuthenticate:n})=>({authenticate:async()=>{if(null==e.username||null==e.password)throw new ob("SASL Plain: Invalid username or password");const i=`${t}:${r}`;try{s.debug("Authenticate with SASL PLAIN",{broker:i}),await n({request:nb(e),response:ib}),s.debug("SASL PLAIN authentication successful",{broker:i})}catch(e){const t=new ob(`SASL PLAIN authentication failed: ${e.message}`);throw s.error(t.message,{broker:i}),t}}});const cb=bi;const ub=Ni,lb=/^([rsiev])=(.*)$/;var db={decode:async e=>new ub(e).readBytes(),parse:async e=>{const t=e.toString().split(",").map(e=>{const[t,r,s]=e.match(lb);return[r,s]}).reduce((e,t)=>({...e,[t[0]]:t[1]}),{});return{original:e.toString(),...t}}};const pb=bi;const fb=a,hb={firstMessage:{request:({clientFirstMessage:e})=>({encode:async()=>(new cb).writeBytes(e).buffer}),response:db},finalMessage:{request:({finalMessage:e})=>({encode:async()=>(new pb).writeBytes(e).buffer}),response:db}},{KafkaJSSASLAuthenticationError:mb,KafkaJSNonRetriableError:gb}=Mn,yb=/=/g,Ib=/,/g,bb=/\+/g,wb=/\//g,vb=/=+$/,Tb=e=>Buffer.from(e).toString("base64");var Eb={DIGESTS:{SHA256:{length:32,type:"sha256",minIterations:4096},SHA512:{length:64,type:"sha512",minIterations:4096}},SCRAM:class e{static sanitizeString(e){return e.replace(yb,"=3D").replace(Ib,"=2C")}static nonce(){return fb.randomBytes(16).toString("base64").replace(bb,"-").replace(wb,"_").replace(vb,"").toString("ascii")}static hi(e,t,r,s){return new Promise((n,i)=>{fb.pbkdf2(e,t,r,s.length,s.type,(e,t)=>e?i(e):n(t))})}static xor(e,t){const r=Buffer.from(e),s=Buffer.from(t),n=Buffer.byteLength(r);if(n!==Buffer.byteLength(s))throw new gb("Buffers must be of the same length");const i=[];for(let e=0;e<n;e++)i.push(r[e]^s[e]);return Buffer.from(i)}constructor(t,r,s,n,i,o){this.sasl=t,this.host=r,this.port=s,this.logger=n,this.saslAuthenticate=i,this.digestDefinition=o;const a=o.type.toUpperCase();this.PREFIX=`SASL SCRAM ${a} authentication`,this.currentNonce=e.nonce()}async authenticate(){const{PREFIX:e}=this,t=`${this.host}:${this.port}`;if(null==this.sasl.username||null==this.sasl.password)throw new mb(`${this.PREFIX}: Invalid username or password`);try{this.logger.debug("Exchanging first client message",{broker:t});const r=await this.sendClientFirstMessage();this.logger.debug("Sending final message",{broker:t});const s=await this.sendClientFinalMessage(r);if(s.e)throw new Error(s.e);const n=await this.serverKey(r),i=this.serverSignature(n,r);if(s.v!==i)throw new Error("Invalid server signature in server final message");this.logger.debug(`${e} successful`,{broker:t})}catch(r){const s=new mb(`${e} failed: ${r.message}`);throw this.logger.error(s.message,{broker:t}),s}}async sendClientFirstMessage(){const e=`n,,${this.firstMessageBare()}`,t=hb.firstMessage.request({clientFirstMessage:e}),r=hb.firstMessage.response;return this.saslAuthenticate({request:t,response:r})}async sendClientFinalMessage(e){const{PREFIX:t}=this,r=parseInt(e.i,10),{minIterations:s}=this.digestDefinition;if(!e.r.startsWith(this.currentNonce))throw new mb(`${t} failed: Invalid server nonce, it does not start with the client nonce`);if(r<s)throw new mb(`${t} failed: Requested iterations ${r} is less than the minimum ${s}`);const n=`${this.finalMessageWithoutProof(e)},p=${await this.clientProof(e)}`,i=hb.finalMessage.request({finalMessage:n}),o=hb.finalMessage.response;return this.saslAuthenticate({request:i,response:o})}async clientProof(t){const r=await this.clientKey(t),s=this.H(r),n=this.clientSignature(s,t);return Tb(e.xor(r,n))}async clientKey(e){const t=await this.saltPassword(e);return this.HMAC(t,"Client Key")}async serverKey(e){const t=await this.saltPassword(e);return this.HMAC(t,"Server Key")}clientSignature(e,t){return this.HMAC(e,this.authMessage(t))}serverSignature(e,t){return Tb(this.HMAC(e,this.authMessage(t)))}authMessage(e){return[this.firstMessageBare(),e.original,this.finalMessageWithoutProof(e)].join(",")}async saltPassword(t){const r=Buffer.from(t.s,"base64"),s=parseInt(t.i,10);return e.hi(this.encodedPassword(),r,s,this.digestDefinition)}firstMessageBare(){return`n=${this.encodedUsername()},r=${this.currentNonce}`}finalMessageWithoutProof(e){const t=e.r;return`c=${Tb("n,,")},r=${t}`}encodedUsername(){const{username:t}=this.sasl;return e.sanitizeString(t).toString("utf-8")}encodedPassword(){const{password:e}=this.sasl;return e.toString("utf-8")}H(e){return fb.createHash(this.digestDefinition.type).update(e).digest()}HMAC(e,t){return fb.createHmac(this.digestDefinition.type,e).update(t).digest()}}};const{SCRAM:_b,DIGESTS:Ab}=Eb;var Sb=e=>({host:t,port:r,logger:s,saslAuthenticate:n})=>{const i=new _b(e,t,r,s,n,Ab.SHA256);return{authenticate:async()=>await i.authenticate()}};const{SCRAM:Ob,DIGESTS:Nb}=Eb;var Rb=e=>({host:t,port:r,logger:s,saslAuthenticate:n})=>{const i=new Ob(e,t,r,s,n,Nb.SHA512);return{authenticate:async()=>await i.authenticate()}};const Cb=bi;var kb={request:({authorizationIdentity:e,accessKeyId:t,secretAccessKey:r,sessionToken:s=""})=>({encode:async()=>(new Cb).writeBytes([e,t,r,s].join("\0")).buffer}),response:{decode:async()=>!0,parse:async()=>!0}};const{request:xb,response:Lb}=kb,{KafkaJSSASLAuthenticationError:Bb}=Mn;var Pb=e=>({host:t,port:r,logger:s,saslAuthenticate:n})=>({authenticate:async()=>{if(!e.authorizationIdentity)throw new Bb("SASL AWS-IAM: Missing authorizationIdentity");if(!e.accessKeyId)throw new Bb("SASL AWS-IAM: Missing accessKeyId");if(!e.secretAccessKey)throw new Bb("SASL AWS-IAM: Missing secretAccessKey");e.sessionToken||(e.sessionToken="");const i=`${t}:${r}`;try{s.debug("Authenticate with SASL AWS-IAM",{broker:i}),await n({request:xb(e),response:Lb}),s.debug("SASL AWS-IAM authentication successful",{broker:i})}catch(e){const t=new Bb(`SASL AWS-IAM authentication failed: ${e.message}`);throw s.error(t.message,{broker:i}),t}}});const Mb=bi,Db="";var $b={request:async({authorizationIdentity:e=null},t)=>{const r=null==e?"":`"a=${e}`;let s=function(e){let t="";if(null==e)return t;let r="";for(const s in e)t+=`${r}${s}=${e[s]}`,r=Db;return t}(t.extensions);s.length>0&&(s=`${Db}${s}`);const n=`n,${r},${Db}auth=Bearer ${t.value}${s}${Db}${Db}`;return{encode:async()=>(new Mb).writeBytes(Buffer.from(n)).buffer}},response:{decode:async()=>!0,parse:async()=>!0}};const{request:Ub}=$b,{KafkaJSSASLAuthenticationError:jb}=Mn;var Gb=e=>({host:t,port:r,logger:s,saslAuthenticate:n})=>({authenticate:async()=>{const{oauthBearerProvider:i}=e;if(null==i)throw new jb("SASL OAUTHBEARER: Missing OAuth bearer token provider");const o=await i();if(null==o.value)throw new jb("SASL OAUTHBEARER: Invalid OAuth bearer token");const a=`${t}:${r}`;try{s.debug("Authenticate with SASL OAUTHBEARER",{broker:a}),await n({request:await Ub(e,o)}),s.debug("SASL OAUTHBEARER authentication successful",{broker:a})}catch(e){const t=new jb(`SASL OAUTHBEARER authentication failed: ${e.message}`);throw s.error(t.message,{broker:a}),t}}});const{requests:Fb,lookup:Vb}=iI,Kb=ti,qb=ab,Wb=Sb,Hb=Rb,Zb=Pb,Jb=Gb,{KafkaJSSASLAuthenticationError:Xb}=Mn,zb={AWS:Zb,PLAIN:qb,OAUTHBEARER:Jb,"SCRAM-SHA-256":Wb,"SCRAM-SHA-512":Hb};const Yb=({socketFactory:e,host:t,port:r,ssl:s,onConnect:n,onData:i,onEnd:o,onError:a,onTimeout:c})=>{const u=e({host:t,port:r,ssl:s,onConnect:n});return u.on("data",i),u.on("end",o),u.on("error",a),u.on("timeout",c),u},Qb=async({correlationId:e,clientId:t,request:{apiKey:r,apiVersion:s,encode:n}})=>{const i=await n(),o=(new MI).writeInt16(r).writeInt16(s).writeInt32(e).writeString(t).writeEncoder(i);return(new MI).writeInt32(o.size()).writeEncoder(o)},ew=Ni,{KafkaJSConnectionError:tw,KafkaJSConnectionClosedError:rw}=Mn,{INT_32_MAX_VALUE:sw}=DI,nw=()=>({KAFKAJS_DEBUG_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS}),iw=class extends HI{constructor({instrumentationEmitter:e=null,maxInFlightRequests:t,requestTimeout:r,enforceRequestTimeout:s,clientId:n,broker:i,logger:o,isConnected:a=()=>!0}){super(),this.instrumentationEmitter=e,this.maxInFlightRequests=t,this.requestTimeout=r,this.enforceRequestTimeout=s,this.clientId=n,this.broker=i,this.logger=o,this.isConnected=a,this.inflight=new Map,this.pending=[],this.throttledUntil=-1,this.throttleCheckTimeoutId=null,this[YI]=()=>{0===this.pending.length&&0===this.inflight.size&&this.emit(QI)},this[zI]=()=>{e&&e.emit(JI.NETWORK_REQUEST_QUEUE_SIZE,{broker:this.broker,clientId:this.clientId,queueSize:this.pending.length}),this[YI]()}}scheduleRequestTimeoutCheck(){this.enforceRequestTimeout&&(this.destroy(),this.requestTimeoutIntervalId=setInterval(()=>{this.inflight.forEach(e=>{Date.now()-e.sentAt>e.requestTimeout&&e.timeoutRequest()}),this.isConnected()||this.destroy()},Math.min(this.requestTimeout,100)))}maybeThrottle(e){if(null!==e&&e>0){this.logger.debug(`Client side throttling in effect for ${e}ms`);const t=Date.now()+e;this.throttledUntil=Math.max(t,this.throttledUntil)}}createSocketRequest(e){const{correlationId:t}=e.entry,r=this.requestTimeout,s=e.requestTimeout,n=Math.max(r,s||0),i=new ZI({entry:e.entry,expectResponse:e.expectResponse,broker:this.broker,clientId:this.clientId,instrumentationEmitter:this.instrumentationEmitter,requestTimeout:n,send:()=>{if(this.inflight.has(t))throw new XI("Correlation id already exists");this.inflight.set(t,i),e.sendRequest()},timeout:()=>{this.inflight.delete(t),this.checkPendingRequests(),this[YI]()}});return i}push(e){const{correlationId:t}=e.entry,r=this.createSocketRequest(e);this.canSendSocketRequestImmediately()?this.sendSocketRequest(r):(this.pending.push(r),this.scheduleCheckPendingRequests(),this.logger.debug("Request enqueued",{clientId:this.clientId,broker:this.broker,correlationId:t}),this[zI]())}sendSocketRequest(e){e.send(),e.expectResponse||(this.logger.debug("Request does not expect a response, resolving immediately",{clientId:this.clientId,broker:this.broker,correlationId:e.correlationId}),this.inflight.delete(e.correlationId),e.completed({size:0,payload:null}))}fulfillRequest({correlationId:e,payload:t,size:r}){const s=this.inflight.get(e);this.inflight.delete(e),this.checkPendingRequests(),s?s.completed({size:r,payload:t}):this.logger.warn("Response without match",{clientId:this.clientId,broker:this.broker,correlationId:e}),this[YI]()}rejectAll(e){const t=[...this.inflight.values(),...this.pending];for(const r of t)r.rejected(e),this.inflight.delete(r.correlationId);this.pending=[],this.inflight.clear(),this[zI]()}waitForPendingRequests(){return new Promise(e=>{if(0===this.pending.length&&0===this.inflight.size)return e();this.logger.debug("Waiting for pending requests",{clientId:this.clientId,broker:this.broker,currentInflightRequests:this.inflight.size,currentPendingQueueSize:this.pending.length}),this.once(QI,()=>e())})}destroy(){clearInterval(this.requestTimeoutIntervalId),clearTimeout(this.throttleCheckTimeoutId),this.throttleCheckTimeoutId=null}canSendSocketRequestImmediately(){return!(null!=this.maxInFlightRequests&&this.inflight.size>=this.maxInFlightRequests||this.throttledUntil>Date.now())}checkPendingRequests(){for(;this.pending.length>0&&this.canSendSocketRequestImmediately();){const e=this.pending.shift();this.sendSocketRequest(e),this.logger.debug("Consumed pending request",{clientId:this.clientId,broker:this.broker,correlationId:e.correlationId,pendingDuration:e.pendingDuration,currentPendingQueueSize:this.pending.length}),this[zI]()}this.scheduleCheckPendingRequests()}scheduleCheckPendingRequests(){let e=this.throttledUntil-Date.now();this.throttleCheckTimeoutId||(this.pending.length>0&&(e=e>0?e:10),this.throttleCheckTimeoutId=setTimeout(()=>{this.throttleCheckTimeoutId=null,this.checkPendingRequests()},e))}},{CONNECTION_STATUS:ow,CONNECTED_STATUS:aw}=tb,cw=PI,uw=si,lw=class{constructor(e,t,r,s){this.connection=e,this.logger=t,this.sessionLifetime="0";const n=Vb(r);this.saslHandshake=n(Kb.SaslHandshake,Fb.SaslHandshake),this.protocolAuthentication=s?n(Kb.SaslAuthenticate,Fb.SaslAuthenticate):null}async authenticate(){const e=this.connection.sasl.mechanism.toUpperCase();if(!(await this.connection.send(this.saslHandshake({mechanism:e}))).enabledMechanisms.includes(e))throw new Xb(`SASL ${e} mechanism is not supported by the server`);!this.connection.sasl.authenticationProvider&&Object.keys(zb).includes(e)&&(this.connection.sasl.authenticationProvider=zb[e](this.connection.sasl)),await this.connection.sasl.authenticationProvider({host:this.connection.host,port:this.connection.port,logger:this.logger.namespace(`SaslAuthenticator-${e}`),saslAuthenticate:async({request:e,response:t})=>{if(this.protocolAuthentication){const r=await e.encode(),s=await this.connection.send(this.protocolAuthentication({authBytes:r}));if(this.sessionLifetime=s.sessionLifetimeMs||"0",!t)return;const{authBytes:n}=s,i=await t.decode(n);return t.parse(i)}return this.connection.sendAuthRequest({request:e,response:t})}}).authenticate()}},dw=ti,pw=({apiName:e,apiKey:t,apiVersion:r})=>`${e}(key: ${t}, version: ${r})`,fw=Symbol("private:Connection:shouldReauthenticate"),hw=Symbol("private:Connection:authenticate");const mw=ti,gw=class{constructor({host:e,port:t,logger:r,socketFactory:s,requestTimeout:n,reauthenticationThreshold:i=1e4,rack:o=null,ssl:a=null,sasl:c=null,clientId:u="kafkajs",connectionTimeout:l,enforceRequestTimeout:d=!0,maxInFlightRequests:p=null,instrumentationEmitter:f=null}){this.host=e,this.port=t,this.rack=o,this.clientId=u,this.broker=`${this.host}:${this.port}`,this.logger=r.namespace("Connection"),this.socketFactory=s,this.ssl=a,this.sasl=c,this.requestTimeout=n,this.connectionTimeout=l,this.reauthenticationThreshold=i,this.bytesBuffered=0,this.bytesNeeded=ew.int32Size(),this.chunks=[],this.connectionStatus=ow.DISCONNECTED,this.correlationId=0,this.requestQueue=new iw({instrumentationEmitter:f,maxInFlightRequests:p,requestTimeout:n,enforceRequestTimeout:d,clientId:u,broker:this.broker,logger:r.namespace("RequestQueue"),isConnected:()=>this.isConnected()}),this.versions=null,this.authHandlers=null,this.authExpectResponse=!1;const h=e=>(t,r={})=>{(0,this.logger[e])(t,{broker:this.broker,clientId:u,...r})};this.logDebug=h("debug"),this.logError=h("error");const m=nw();this.shouldLogBuffers="1"===m.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,this.shouldLogFetchBuffer=this.shouldLogBuffers&&"1"===m.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS,this.authenticatedAt=null,this.sessionLifetime=uw.ZERO,this.supportAuthenticationProtocol=null,this[hw]=cw(async()=>{if(this.sasl&&!this.isAuthenticated()){const e=new lw(this,this.logger,this.versions,this.supportAuthenticationProtocol);await e.authenticate(),this.authenticatedAt=process.hrtime(),this.sessionLifetime=uw.fromValue(e.sessionLifetime)}})}getSupportAuthenticationProtocol(){return this.supportAuthenticationProtocol}setSupportAuthenticationProtocol(e){this.supportAuthenticationProtocol=e}setVersions(e){this.versions=e}isConnected(){return aw.includes(this.connectionStatus)}connect(){return new Promise((e,t)=>{if(this.isConnected())return e(!0);let r;this.authenticatedAt=null;const s=()=>{clearTimeout(r),this.connectionStatus=ow.CONNECTED,this.requestQueue.scheduleRequestTimeoutCheck(),e(!0)},n=e=>{this.processData(e)},i=async()=>{clearTimeout(r);const e=this.isConnected();this.authHandlers?this.authHandlers.onError():e&&(this.logDebug("Kafka server has closed connection"),this.rejectRequests(new rw("Closed connection",{host:this.host,port:this.port}))),await this.disconnect()},o=async e=>{clearTimeout(r);const s=new tw(`Connection error: ${e.message}`,{broker:`${this.host}:${this.port}`,code:e.code});this.logError(s.message,{stack:e.stack}),this.rejectRequests(s),await this.disconnect(),t(s)},a=async()=>{const e=new tw("Connection timeout",{broker:`${this.host}:${this.port}`});this.logError(e.message),this.rejectRequests(e),await this.disconnect(),t(e)};this.logDebug("Connecting",{ssl:!!this.ssl,sasl:!!this.sasl});try{r=setTimeout(a,this.connectionTimeout),this.socket=Yb({socketFactory:this.socketFactory,host:this.host,port:this.port,ssl:this.ssl,onConnect:s,onData:n,onEnd:i,onError:o,onTimeout:a})}catch(e){clearTimeout(r),t(new tw(`Failed to connect: ${e.message}`,{broker:`${this.host}:${this.port}`}))}})}async disconnect(){return this.authenticatedAt=null,this.connectionStatus=ow.DISCONNECTING,this.logDebug("disconnecting..."),await this.requestQueue.waitForPendingRequests(),this.requestQueue.destroy(),this.socket&&(this.socket.end(),this.socket.unref()),this.connectionStatus=ow.DISCONNECTED,this.logDebug("disconnected"),!0}isAuthenticated(){return null!=this.authenticatedAt&&!this[fw]()}[fw](){if(this.sessionLifetime.equals(uw.ZERO))return!1;if(null==this.authenticatedAt)return!0;const[e,t]=process.hrtime(this.authenticatedAt);return uw.fromValue(e).multiply(1e3).add(uw.fromValue(t).divide(1e6)).add(this.reauthenticationThreshold).greaterThanOrEqual(this.sessionLifetime)}async authenticate(){await this[hw]()}sendAuthRequest({request:e,response:t}){return this.authExpectResponse=!!t,new Promise(async(r,s)=>{this.authHandlers={onSuccess:e=>{this.authHandlers=null,this.authExpectResponse=!1,t.decode(e).then(e=>t.parse(e)).then(r).catch(s)},onError:()=>{this.authHandlers=null,this.authExpectResponse=!1,s(new tw("Connection closed by the server",{broker:`${this.host}:${this.port}`}))}};try{const t=await e.encode();this.failIfNotConnected(),this.socket.write(t,"binary")}catch(e){s(e)}})}async send({request:e,response:t,requestTimeout:r=null,logResponseError:s=!0}){!this.isAuthenticated()&&(e=>![dw.ApiVersions,dw.SaslHandshake,dw.SaslAuthenticate].includes(e.apiKey))(e)&&await this[hw](),this.failIfNotConnected();const n=!e.expectResponse||e.expectResponse(),{correlationId:i,size:o,entry:a,payload:c}=await(async()=>{const{clientId:t}=this,s=this.nextCorrelationId(),i=await Qb({request:e,correlationId:s,clientId:t}),{apiKey:o,apiName:a,apiVersion:c}=e;return this.logDebug(`Request ${pw(e)}`,{correlationId:s,expectResponse:n,size:Buffer.byteLength(i.buffer)}),new Promise((e,t)=>{try{this.failIfNotConnected();const u={apiKey:o,apiName:a,apiVersion:c,correlationId:s,resolve:e,reject:t};this.requestQueue.push({entry:u,expectResponse:n,requestTimeout:r,sendRequest:()=>{this.socket.write(i.buffer,"binary")}})}catch(e){t(e)}})})();if(n)try{const e=await t.decode(c);this.requestQueue.maybeThrottle(e.clientSideThrottleTime);const r=await t.parse(e),s="Fetch"===a.apiName;return this.logDebug(`Response ${pw(a)}`,{correlationId:i,size:o,data:s&&!this.shouldLogFetchBuffer?"[filtered]":r}),r}catch(e){s&&this.logError(`Response ${pw(a)}`,{error:e.message,correlationId:i,size:o});const t=Buffer.isBuffer(c);throw this.logDebug(`Response ${pw(a)}`,{error:e.message,correlationId:i,payload:t&&!this.shouldLogBuffers?{type:"Buffer",data:"[filtered]"}:c}),e}}failIfNotConnected(){if(!this.isConnected())throw new tw("Not connected",{broker:`${this.host}:${this.port}`})}nextCorrelationId(){return this.correlationId>=sw&&(this.correlationId=0),this.correlationId++}processData(e){if(this.authHandlers&&!this.authExpectResponse)return this.authHandlers.onSuccess(e);for(this.chunks.push(e),this.bytesBuffered+=Buffer.byteLength(e);this.bytesNeeded<=this.bytesBuffered;){const e=this.chunks.length>1?Buffer.concat(this.chunks):this.chunks[0],t=new ew(e),r=t.readInt32();if(!t.canReadBytes(r))return this.chunks=[e],this.bytesBuffered=Buffer.byteLength(e),void(this.bytesNeeded=ew.int32Size()+r);const s=new ew(t.readBytes(r)),n=t.readAll();if(this.chunks=[n],this.bytesBuffered=Buffer.byteLength(n),this.bytesNeeded=ew.int32Size(),this.authHandlers){const t=ew.int32Size()+r,s=e.slice(0,t);return this.authHandlers.onSuccess(s)}const i=s.readInt32(),o=s.readAll();this.requestQueue.fulfillRequest({size:r,correlationId:i,payload:o})}}rejectRequests(e){this.requestQueue.rejectAll(e)}};const{KafkaJSConnectionError:yw,KafkaJSNonRetriableError:Iw}=Mn,bw=class{constructor(e){this.logger=e.logger.namespace("ConnectionPool"),this.connectionTimeout=e.connectionTimeout,this.host=e.host,this.port=e.port,this.rack=e.rack,this.ssl=e.ssl,this.sasl=e.sasl,this.clientId=e.clientId,this.socketFactory=e.socketFactory,this.pool=new Array(2).fill().map(()=>new gw(e))}isConnected(){return this.pool.some(e=>e.isConnected())}isAuthenticated(){return this.pool.some(e=>e.isAuthenticated())}setSupportAuthenticationProtocol(e){this.map(t=>t.setSupportAuthenticationProtocol(e))}setVersions(e){this.map(t=>t.setVersions(e))}map(e){return this.pool.map(t=>e(t))}async send(e){return(await this.getConnectionByRequest(e)).send(e)}getConnectionByRequest({request:{apiKey:e}}){const t={[mw.Fetch]:1}[e]||0;return this.getConnection(t)}async getConnection(e=0){const t=this.pool[e];return t.isConnected()||await t.connect(),t}async destroy(){await Promise.all(this.map(e=>e.disconnect()))}};const ww=class{constructor({connectionPoolBuilder:e,logger:t,retry:r,allowAutoTopicCreation:s,authenticationTimeout:n,metadataMaxAge:i}){this.rootLogger=t,this.connectionPoolBuilder=e,this.metadataMaxAge=i||0,this.logger=t.namespace("BrokerPool"),this.retrier=OI(LI({},r)),this.createBroker=e=>new SI({allowAutoTopicCreation:s,authenticationTimeout:n,...e}),this.brokers={},this.seedBroker=void 0,this.metadata=null,this.metadataExpireAt=null,this.versions=null}hasConnectedBrokers(){return!!BI(this.brokers).find(e=>e.isConnected())||!!this.seedBroker&&this.seedBroker.isConnected()}async createSeedBroker(){this.seedBroker&&await this.seedBroker.disconnect();const e=await this.connectionPoolBuilder.build();this.seedBroker=this.createBroker({connectionPool:e,logger:this.rootLogger})}async connect(){if(!this.hasConnectedBrokers())return this.seedBroker||await this.createSeedBroker(),this.retrier(async(e,t,r)=>{try{await this.seedBroker.connect(),this.versions=this.seedBroker.versions}catch(s){if("KafkaJSConnectionError"===s.name||"ILLEGAL_SASL_STATE"===s.type?(await this.createSeedBroker(),this.logger.error(`Failed to connect to seed broker, trying another broker from the list: ${s.message}`,{retryCount:t,retryTime:r})):this.logger.error(s.message,{retryCount:t,retryTime:r}),s.retriable)throw s;e(s)}})}async disconnect(){this.seedBroker&&await this.seedBroker.disconnect(),await Promise.all(BI(this.brokers).map(e=>e.disconnect())),this.brokers={},this.metadata=null,this.versions=null}removeBroker({host:e,port:t}){const r=BI(this.brokers).find(r=>r.connectionPool.host===e&&r.connectionPool.port===t);r&&(delete this.brokers[r.nodeId],this.metadataExpireAt=null,this.seedBroker.nodeId===r.nodeId&&(this.seedBroker=NI(BI(this.brokers))[0]))}async refreshMetadata(e){const t=await this.findConnectedBroker(),{host:r,port:s}=this.seedBroker.connectionPool;return this.retrier(async(n,i,o)=>{try{this.metadata=await t.metadata(e),this.metadataExpireAt=Date.now()+this.metadataMaxAge;const n=[];this.brokers=await this.metadata.brokers.reduce(async(e,{nodeId:t,host:i,port:o,rack:a})=>{const c=await e;if(c[t]){if(!((e,{host:t,port:r,rack:s})=>e.connectionPool.host!==t||e.connectionPool.port!==r||e.connectionPool.rack!==s)(c[t],{host:i,port:o,rack:a}))return c;n.push(c[t])}return i===r&&o===s?(this.seedBroker.nodeId=t,this.seedBroker.connectionPool.rack=a,LI(c,{[t]:this.seedBroker})):LI(c,{[t]:this.createBroker({logger:this.rootLogger,versions:this.versions,connectionPool:await this.connectionPoolBuilder.build({host:i,port:o,rack:a}),nodeId:t})})},this.brokers);const i=this.metadata.brokers.map(({nodeId:e})=>`${e}`).sort(),o=xI(this.brokers).sort(),a=RI(o,i).map(e=>this.brokers[e].disconnect().then(()=>{delete this.brokers[e]})),c=n.map(e=>e.disconnect());await Promise.all([...a,...c])}catch(e){if("LEADER_NOT_AVAILABLE"===e.type)throw e;n(e)}})}async refreshMetadataIfNecessary(e){if(null==this.metadata||null==this.metadataExpireAt||Date.now()>this.metadataExpireAt||!e.every(e=>this.metadata.topicMetadata.some(t=>t.topic===e)))return this.refreshMetadata(e)}getNodeIds(){return xI(this.brokers)}async findBroker({nodeId:e}){const t=this.brokers[e];if(!t)throw new CI(`Broker ${e} not found in the cached metadata`);return await this.connectBroker(t),t}async withBroker(e){const t=NI(xI(this.brokers));if(0===t.length)throw new CI("No brokers in the broker pool");for(const r of t){const t=await this.findBroker({nodeId:r});try{return await e({nodeId:r,broker:t})}catch(e){}}return null}async findConnectedBroker(){const e=NI(xI(this.brokers)),t=e.find(e=>this.brokers[e].isConnected());if(t)return await this.findBroker({nodeId:t});for(const t of e)try{return await this.findBroker({nodeId:t})}catch(e){}return await this.connect(),this.seedBroker}async connectBroker(e){if(!e.isConnected())return this.retrier(async(t,r,s)=>{try{await e.connect()}catch(n){if("KafkaJSConnectionError"!==n.name&&"ILLEGAL_SASL_STATE"!==n.type||await e.disconnect(),"KafkaJSConnectionError"===n.name)return t(n);if("ILLEGAL_SASL_STATE"===n.type)throw e.connectionPool=await this.connectionPoolBuilder.build({host:e.connectionPool.host,port:e.connectionPool.port,rack:e.connectionPool.rack}),this.logger.error("Failed to connect to broker, reconnecting",{retryCount:r,retryTime:s}),new kI(n,{retriable:!0});if(n.retriable)throw n;this.logger.error(n,{retryCount:r,retryTime:s,stack:n.stack}),t(n)}})}},vw=Xn,Tw=PI,Ew=_I,_w=({socketFactory:e,brokers:t,ssl:r,sasl:s,clientId:n,requestTimeout:i,enforceRequestTimeout:o,connectionTimeout:a,maxInFlightRequests:c,logger:u,instrumentationEmitter:l=null,reauthenticationThreshold:d})=>{let p=0;const f=async()=>{let e;if("function"==typeof t)try{e=await t()}catch(e){const t=new yw(`Failed to connect: "config.brokers" threw: ${e.message}`);throw t.stack=`${t.name}\n  Caused by: ${e.stack}`,t}else e=t;return(e=>{if(!e)throw new Iw("Failed to connect: brokers should not be null");if(Array.isArray(e)){if(!e.length)throw new Iw("Failed to connect: brokers array is empty");e.forEach((e,t)=>{if(!(e=>e&&"string"==typeof e&&e.length>0)(e))throw new Iw(`Failed to connect: broker at index ${t} is invalid "${typeof e}"`)})}})(e),e};return{build:async({host:t,port:h,rack:m}={})=>{if(!t){const e=await f(),r=e[p++%e.length];t=r.split(":")[0],h=Number(r.split(":")[1])}return new bw({host:t,port:h,rack:m,sasl:s,ssl:r,clientId:n,socketFactory:e,connectionTimeout:a,requestTimeout:i,enforceRequestTimeout:o,maxInFlightRequests:c,instrumentationEmitter:l,logger:u,reauthenticationThreshold:d})}}},{EARLIEST_OFFSET:Aw,LATEST_OFFSET:Sw}=DI,{KafkaJSError:Ow,KafkaJSBrokerNotFound:Nw,KafkaJSMetadataNotLoaded:Rw,KafkaJSTopicMetadataNotLoaded:Cw,KafkaJSGroupCoordinatorNotFound:kw}=Mn,xw=Bl,{keys:Lw}=Object,Bw=(e,{topic:t,partitions:r})=>({...e,[t]:[...e[t]||[],...r]}),Pw=Symbol("private:Cluster:connect"),Mw=Symbol("private:Cluster:refreshMetadata"),Dw=Symbol("private:Cluster:refreshMetadataIfNecessary"),$w=Symbol("private:Cluster:findControllerBroker");const Uw=si,jw=Uw.fromValue(2538058380),Gw=Uw.fromValue(1540483477),Fw=Uw.fromValue(24);const{KafkaJSNonRetriableError:Vw}=Mn,Kw=e=>({randomBytes:t=>e.getRandomValues(Buffer.allocUnsafe(t))});let qw=null;Ct&&Ct.crypto?qw=void 0===Ct.crypto.randomBytes?Kw(Ct.crypto):Ct.crypto:Ct&&Ct.msCrypto?qw=Kw(Ct.msCrypto):Ct&&!Ct.crypto&&(qw=a);const Ww=e=>{if(e>65536)throw new Vw(`Byte length (${e}) exceeds the max number of bytes of entropy available (65536)`);if(!qw)throw new Vw("No available crypto implementation");return qw.randomBytes(e)},Hw=e=>2147483647&e;var Zw=e=>()=>{const t={};return({topic:r,partitionMetadata:s,message:n})=>{r in t||(t[r]=Ww(32).readUInt32BE(0));const i=s.length,o=s.filter(e=>e.leader>=0),a=o.length;if(null!==n.partition&&void 0!==n.partition)return n.partition;if(null!==n.key&&void 0!==n.key)return Hw(e(n.key))%i;if(a>0){return o[Hw(++t[r])%a].partitionId}return Hw(++t[r])%i}};var Jw=Zw(e=>{const t=Buffer.isBuffer(e)?e:Buffer.from(String(e)),r=t.length;let s=Uw.fromValue(jw.xor(r)),n=Math.floor(r/4);for(let e=0;e<n;e++){const r=4*e;let n=(255&t[r+0])+((255&t[r+1])<<8)+((255&t[r+2])<<16)+((255&t[r+3])<<24);n=Uw.fromValue(n),n=n.multiply(Gw),n=n.xor(n.toInt()>>>Fw),n=Uw.fromValue(n).multiply(Gw),s=s.multiply(Gw),s=s.xor(n)}switch(r%4){case 3:s=s.xor((255&t[2+(-4&r)])<<16);case 2:s=s.xor((255&t[1+(-4&r)])<<8);case 1:s=s.xor(255&t[-4&r]),s=s.multiply(Gw)}return s=s.xor(s.toInt()>>>13),s=s.multiply(Gw),s=s.xor(s.toInt()>>>15),s.toInt()});const Xw=1540483477;var zw={DefaultPartitioner:Jw,LegacyPartitioner:Zw(e=>{const t=Buffer.isBuffer(e)?e:Buffer.from(String(e)),r=t.length;let s=2538058380^r,n=r/4;for(let e=0;e<n;e++){const r=4*e;let n=(255&t[r+0])+((255&t[r+1])<<8)+((255&t[r+2])<<16)+((255&t[r+3])<<24);n*=Xw,n^=n>>>24,n*=Xw,s*=Xw,s^=n}switch(r%4){case 3:s^=(255&t[2+(-4&r)])<<16;case 2:s^=(255&t[1+(-4&r)])<<8;case 1:s^=255&t[-4&r],s*=Xw}return s^=s>>>13,s*=Xw,s^=s>>>15,s}),JavaCompatiblePartitioner:Jw},Yw={UNINITIALIZED:"UNINITIALIZED",READY:"READY",TRANSACTING:"TRANSACTING",COMMITTING:"COMMITTING",ABORTING:"ABORTING"};const{EventEmitter:Qw}=i,{KafkaJSNonRetriableError:ev}=Mn,tv=Yw,rv={[tv.UNINITIALIZED]:[tv.READY],[tv.READY]:[tv.READY,tv.TRANSACTING],[tv.TRANSACTING]:[tv.COMMITTING,tv.ABORTING],[tv.COMMITTING]:[tv.READY],[tv.ABORTING]:[tv.READY]};const sv=_I,nv=Xn,{KafkaJSNonRetriableError:iv}=Mn,ov=Bl,av=({logger:e,initialState:t=tv.UNINITIALIZED})=>{let r=t;const s=Object.assign(new Qw,{createGuarded(e,t){const s=Object.keys(t).reduce((s,n)=>(s[n]=((e,t,{legalStates:s,async:n=!0})=>{if(!e[t])throw new ev(`Cannot add guard on missing method "${t}"`);return(...i)=>{const o=e[t];if(!s.includes(r)){const e=new ev(`Transaction state exception: Cannot call "${t}" in state "${r}"`);if(n)return Promise.reject(e);throw e}return o.apply(e,i)}})(e,n,t[n]),s),{});return{...e,...s}},transitionTo(t){if(e.debug(`Transaction state transition ${r} --\x3e ${t}`),!rv[r].includes(t))throw new ev(`Transaction state exception: Invalid transition ${r} --\x3e ${t}`);s.emit("transition",{to:t,from:r}),r=t},state:()=>r});return s},{INT_32_MAX_VALUE:cv}=DI,uv=c,lv=Yw,dv=["NOT_COORDINATOR_FOR_GROUP","GROUP_COORDINATOR_NOT_AVAILABLE","GROUP_LOAD_IN_PROGRESS","CONCURRENT_TRANSACTIONS"],pv=["UNKNOWN_TOPIC_OR_PARTITION","COORDINATOR_LOAD_IN_PROGRESS"],fv=["COORDINATOR_NOT_AVAILABLE","NOT_COORDINATOR"];const{KafkaJSMetadataNotLoaded:hv}=Mn,{staleMetadata:mv}=_o,gv=({topic:e,partitionMetadata:t,messages:r,partitioner:s})=>0===t.length?{}:r.reduce((r,n)=>{const i=s({topic:e,partitionMetadata:t,message:n}),o=r[i]||[];return Object.assign(r,{[i]:[...o,n]})},{}),yv=e=>e.map(({topic:e,partitions:t,messagesPerPartition:r,sequencePerPartition:s})=>({topic:e,partitions:t.map(e=>({partition:e,messages:r[e]}))})),Iv=({topics:e})=>e.flatMap(({topicName:e,partitions:t})=>t.map(t=>({topicName:e,...t}))),{keys:bv}=Object;const wv=({logger:e,cluster:t,partitioner:r,eosManager:s,retrier:n})=>async({acks:i,timeout:o,compression:a,topicMessages:c})=>{const u=new Map;return n(async(n,l,d)=>{const p=c.map(({topic:e})=>e);await t.addMultipleTargetTopics(p);try{const n=await(async n=>{const u=new Map;await t.refreshMetadataIfNecessary();for(const{topic:s,messages:i}of c){const o=t.findTopicPartitionMetadata(s);if(0===o.length)throw e.debug("Producing to topic without metadata",{topic:s,targetTopics:Array.from(t.targetTopics)}),new hv("Producing to topic without metadata");const a=gv({topic:s,partitionMetadata:o,messages:i,partitioner:r}),c=bv(a),l=t.findLeaderForPartitions(s,c),d=bv(l);u.set(s,{partitionsPerLeader:l,messagesPerPartition:a});for(const e of d){const r=await t.findBroker({nodeId:e});n.has(r)||n.set(r,null)}}const l=Array.from(n.keys()).filter(e=>!n.get(e));return l.map(async e=>{const t=Array.from(u.entries()).filter(([t,{partitionsPerLeader:r}])=>!!r[e.nodeId]).map(([t,{partitionsPerLeader:r,messagesPerPartition:s,sequencePerPartition:n}])=>({topic:t,partitions:r[e.nodeId],messagesPerPartition:s})),r=yv(t);await s.acquireBrokerLock(e);try{let t;s.isTransactional()&&await s.addPartitionsToTransaction(r),r.forEach(({topic:e,partitions:t})=>{t.forEach(t=>{t.firstSequence=s.getSequence(e,t.partition),s.updateSequence(e,t.partition,t.messages.length)})});try{t=await e.produce({transactionalId:s.isTransactional()?s.getTransactionalId():void 0,producerId:s.getProducerId(),producerEpoch:s.getProducerEpoch(),acks:i,timeout:o,compression:a,topicData:r})}catch(e){throw r.forEach(({topic:e,partitions:t})=>{t.forEach(t=>{s.updateSequence(e,t.partition,-t.messages.length)})}),e}const c=0!==i?Iv(t):[];n.set(e,c)}catch(t){throw n.delete(e),t}finally{await s.releaseBrokerLock(e)}})})(u);return await Promise.all(n),Array.from(u.values()).flat()}catch(r){if("KafkaJSConnectionClosedError"===r.name&&t.removeBroker({host:r.host,port:r.port}),!t.isConnected())throw e.debug(`Cluster has disconnected, reconnecting: ${r.message}`,{retryCount:l,retryTime:d}),await t.connect(),await t.refreshMetadata(),r;if(mv(r)||"KafkaJSMetadataNotLoaded"===r.name||"KafkaJSConnectionError"===r.name||"KafkaJSConnectionClosedError"===r.name||"KafkaJSProtocolError"===r.name&&r.retriable)throw e.error(`Failed to send messages: ${r.message}`,{retryCount:l,retryTime:d}),await t.refreshMetadata(),r;if(e.error(`${r.message}`,{retryCount:l,retryTime:d}),r.retriable)throw r;n(r)}})},{KafkaJSError:vv,KafkaJSNonRetriableError:Tv}=Mn,{CONNECTION_STATUS:Ev}=tb;const{keys:_v}=Object;var Av=e=>_v(e).reduce((t,r)=>({...t,[e[r]]:r}),{});const Sv=Av,Ov=jI,Nv=$I("producer"),Rv={CONNECT:Nv("connect"),DISCONNECT:Nv("disconnect"),REQUEST:Nv(Ov.NETWORK_REQUEST),REQUEST_TIMEOUT:Nv(Ov.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:Nv(Ov.NETWORK_REQUEST_QUEUE_SIZE)},Cv={[Rv.REQUEST]:Ov.NETWORK_REQUEST,[Rv.REQUEST_TIMEOUT]:Ov.NETWORK_REQUEST_TIMEOUT,[Rv.REQUEST_QUEUE_SIZE]:Ov.NETWORK_REQUEST_QUEUE_SIZE},kv=Sv(Cv);var xv={events:Rv,wrap:e=>kv[e]||e,unwrap:e=>Cv[e]||e};const Lv=_I,{CONNECTION_STATUS:Bv}=tb,{DefaultPartitioner:Pv}=zw,Mv=jn,Dv=({logger:e,cluster:t,transactionTimeout:r=6e4,transactional:s,transactionalId:n})=>{if(s&&!n)throw new iv("Cannot manage transactions without a transactionalId");const i=sv(t.retry);let o=-1,a=0,c={},u={},l={},d=!1;const p=av({logger:e});p.on("transition",({to:e})=>{e===lv.READY&&(l={},d=!1)});const f=()=>t.findGroupCoordinator({groupId:n,coordinatorType:ov.TRANSACTION}),h=()=>{if(!s)throw new iv("Method unavailable if non-transactional")},m=()=>d||Object.entries(l).some(([,e])=>Object.entries(e).some(([,e])=>e)),g=p.createGuarded({getProducerId:()=>o,getProducerEpoch:()=>a,getTransactionalId:()=>n,initProducerId:async()=>i(async(i,l,d)=>{try{await t.refreshMetadataIfNecessary();const i=await(s?f():t.findControllerBroker()),l=await i.initProducerId({transactionalId:s?n:void 0,transactionTimeout:r});p.transitionTo(lv.READY),o=l.producerId,a=l.producerEpoch,c={},u={},e.debug("Initialized producer id & epoch",{producerId:o,producerEpoch:a})}catch(t){if(dv.includes(t.type))throw"CONCURRENT_TRANSACTIONS"===t.type&&e.debug("There is an ongoing transaction on this transactionId, retrying",{error:t.message,stack:t.stack,transactionalId:n,retryCount:l,retryTime:d}),t;i(t)}}),getSequence:(e,t)=>g.isInitialized()?(c[e]=c[e]||{},c[e][t]=c[e][t]||0,c[e][t]):0,updateSequence(t,r,s){if(!g.isInitialized())return;let n=g.getSequence(t,r)+s;n>=cv&&(e.debug(`Sequence for ${t} ${r} exceeds max value (${n}). Rotating to 0.`),n=0),c[t][r]=n},beginTransaction(){h(),p.transitionTo(lv.TRANSACTING)},async addPartitionsToTransaction(e){h();const t={};e.forEach(({topic:e,partitions:r})=>{l[e]=l[e]||{},r.forEach(({partition:r})=>{l[e][r]||(t[e]=t[e]||[],t[e].push(r))})});const r=Object.keys(t).map(e=>({topic:e,partitions:t[e]}));if(r.length){const e=await f();await e.addPartitionsToTxn({transactionalId:n,producerId:o,producerEpoch:a,topics:r})}r.forEach(({topic:e,partitions:t})=>{t.forEach(t=>{l[e][t]=!0})})},async commit(){if(h(),p.transitionTo(lv.COMMITTING),!m())return e.debug("No partitions or offsets registered, not sending EndTxn"),void p.transitionTo(lv.READY);const t=await f();await t.endTxn({producerId:o,producerEpoch:a,transactionalId:n,transactionResult:!0}),p.transitionTo(lv.READY)},async abort(){if(h(),p.transitionTo(lv.ABORTING),!m())return e.debug("No partitions or offsets registered, not sending EndTxn"),void p.transitionTo(lv.READY);const t=await f();await t.endTxn({producerId:o,producerEpoch:a,transactionalId:n,transactionResult:!1}),p.transitionTo(lv.READY)},isInitialized:()=>-1!==o,isTransactional:()=>s,isInTransaction:()=>p.state()===lv.TRANSACTING,async acquireBrokerLock(e){this.isInitialized()&&(u[e.nodeId]=u[e.nodeId]||new nv({timeout:65535}),await u[e.nodeId].acquire())},releaseBrokerLock(e){this.isInitialized()&&u[e.nodeId].release()},async sendOffsets({consumerGroupId:r,topics:s}){uv(r,"Missing consumerGroupId"),uv(s,"Missing offset topics");const c=await f();await c.addOffsetsToTxn({transactionalId:n,producerId:o,producerEpoch:a,groupId:r}),d=!0;let u=await t.findGroupCoordinator({groupId:r,coordinatorType:ov.GROUP});return i(async(i,c,l)=>{try{await u.txnOffsetCommit({transactionalId:n,producerId:o,producerEpoch:a,groupId:r,topics:s})}catch(s){if(pv.includes(s.type))throw e.debug("Group coordinator is not ready yet, retrying",{error:s.message,stack:s.stack,transactionalId:n,retryCount:c,retryTime:l}),s;if(fv.includes(s.type)||"ECONNREFUSED"===s.code)throw e.debug("Invalid group coordinator, finding new group coordinator and retrying",{error:s.message,stack:s.stack,transactionalId:n,retryCount:c,retryTime:l}),u=await t.findGroupCoordinator({groupId:r,coordinatorType:ov.GROUP}),s;i(s)}})}},{initProducerId:{legalStates:[lv.UNINITIALIZED,lv.READY]},beginTransaction:{legalStates:[lv.READY],async:!1},addPartitionsToTransaction:{legalStates:[lv.TRANSACTING]},sendOffsets:{legalStates:[lv.TRANSACTING]},commit:{legalStates:[lv.TRANSACTING]},abort:{legalStates:[lv.TRANSACTING]}});return g},$v=({logger:e,cluster:t,partitioner:r,eosManager:s,idempotent:n,retrier:i,getConnectionStatus:o})=>{const a=wv({logger:e,cluster:t,retrier:i,partitioner:r,eosManager:s}),c=async({acks:e=-1,timeout:t,compression:r,topicMessages:s=[]})=>{if(s.some(({topic:e})=>!e))throw new Tv("Invalid topic");if(n&&-1!==e)throw new Tv("Not requiring ack for all messages invalidates the idempotent producer's EoS guarantees");for(const{topic:e,messages:t}of s){if(!t)throw new Tv(`Invalid messages array [${t}] for topic "${e}"`);const r=t.find(e=>void 0===e.value);if(r)throw new Tv(`Invalid message without value for topic "${e}": ${JSON.stringify(r)}`)}(()=>{switch(o()){case Ev.DISCONNECTING:throw new Tv("The producer is disconnecting; therefore, it can't safely accept messages anymore");case Ev.DISCONNECTED:throw new vv("The producer is disconnected")}})();const i=s.reduce((e,{topic:t,messages:r})=>{const s=e.findIndex(({topic:e})=>t===e);return-1===s?e.push({topic:t,messages:r}):e[s].messages=[...e[s].messages,...r],e},[]);return await a({acks:e,timeout:t,compression:r,topicMessages:i})};return{send:async({acks:e,timeout:t,compression:r,topic:s,messages:n})=>c({acks:e,timeout:t,compression:r,topicMessages:[{topic:s,messages:n}]}),sendBatch:c}},{events:Uv,wrap:jv,unwrap:Gv}=xv,{KafkaJSNonRetriableError:Fv}=Mn,{values:Vv,keys:Kv}=Object,qv=Vv(Uv),Wv=Kv(Uv).map(e=>`producer.events.${e}`).join(", "),{CONNECT:Hv,DISCONNECT:Zv}=Uv;var Jv=e=>new Promise(t=>{setTimeout(t,e)});const Xv=si;var zv=e=>!e&&0!==e||Xv.fromValue(e).isNegative();const Yv=zv,{keys:Qv,assign:eT}=Object,tT=(e,{partition:t,offset:r})=>eT(e,{[t]:r}),rT=(e,{topic:t,partitions:r})=>eT(e,{[t]:r.reduce(tT,{})});const sT=Av,nT=jI,iT=$I("consumer"),oT={HEARTBEAT:iT("heartbeat"),COMMIT_OFFSETS:iT("commit_offsets"),GROUP_JOIN:iT("group_join"),FETCH:iT("fetch"),FETCH_START:iT("fetch_start"),START_BATCH_PROCESS:iT("start_batch_process"),END_BATCH_PROCESS:iT("end_batch_process"),CONNECT:iT("connect"),DISCONNECT:iT("disconnect"),STOP:iT("stop"),CRASH:iT("crash"),REBALANCING:iT("rebalancing"),RECEIVED_UNSUBSCRIBED_TOPICS:iT("received_unsubscribed_topics"),REQUEST:iT(nT.NETWORK_REQUEST),REQUEST_TIMEOUT:iT(nT.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:iT(nT.NETWORK_REQUEST_QUEUE_SIZE)},aT={[oT.REQUEST]:nT.NETWORK_REQUEST,[oT.REQUEST_TIMEOUT]:nT.NETWORK_REQUEST_TIMEOUT,[oT.REQUEST_QUEUE_SIZE]:nT.NETWORK_REQUEST_QUEUE_SIZE},cT=sT(aT);var uT={events:oT,wrap:e=>cT[e]||e,unwrap:e=>aT[e]||e};const lT=si,dT=zv,pT=(e,t)=>{const r=e.reduce(rT,{}),s=t.reduce(rT,{});return Qv(r).map(e=>{const t=r[e];return{topic:e,partitions:Qv(t).map(r=>{const n=t[r],i=Yv(n)?s[e][r]:n;return{partition:Number(r),offset:i}})}})},{events:{COMMIT_OFFSETS:fT}}=uT,{keys:hT,assign:mT}=Object,gT=Symbol("private:OffsetManager:committedOffsets");const yT=si,IT=Buffer.from([0,0,0,0]);const bT=si,wT=({messages:e,abortedTransactions:t})=>{const r=new Map;if(!t||!t.length)return e;const s=[...t];return e.filter(e=>{if(s.length&&yT.fromValue(e.offset).gte(s[0].firstOffset)){const{producerId:e}=s.shift();r.set(e,!0)}const{producerId:t,inTransaction:n}=e.batchContext;if((({key:e})=>!!e&&Buffer.from(e).equals(IT))(e))r.delete(t);else if(r.has(t)&&n)return!1;return!0})};var vT=class extends Map{getKey(e,t){return JSON.stringify([e,t])}set(e,t,r){const s=this.getKey(e,t);super.set(s,r)}has(e,t){const r=this.getKey(e,t);return super.has(r)}pop(e,t){if(0===this.size||!this.has(e,t))return;const r=this.getKey(e,t),s=this.get(r);return this.delete(r),{topic:e,partition:t,offset:s}}};const TT=e=>({topic:e,paused:new Set,pauseAll:!1,resumed:new Set});const ET=bi,_T=Ni,AT={encode:({version:e,topics:t,userData:r=Buffer.alloc(0)})=>(new ET).writeInt16(e).writeArray(t).writeBytes(r).buffer,decode(e){const t=new _T(e);return{version:t.readInt16(),topics:t.readArray(e=>e.readString()),userData:t.readBytes()}}},ST={encode:({version:e,assignment:t,userData:r=Buffer.alloc(0)})=>(new ET).writeInt16(e).writeArray(Object.keys(t).map(e=>(new ET).writeString(e).writeArray(t[e]))).writeBytes(r).buffer,decode(e){const t=new _T(e),r=e=>e.readInt32();return t.canReadInt16()?{version:t.readInt16(),assignment:t.readArray(e=>({topic:e.readString(),partitions:e.readArray(r)})).reduce((e,{topic:t,partitions:r})=>Object.assign(e,{[t]:r}),{}),userData:t.readBytes()}:null}};var OT={MemberMetadata:AT,MemberAssignment:ST};const NT=Jv,RT=xi,CT=AI,kT=_I,xT=PI,LT=class{constructor({cluster:e,coordinator:t,memberAssignment:r,autoCommit:s,autoCommitInterval:n,autoCommitThreshold:i,topicConfigurations:o,instrumentationEmitter:a,groupId:c,generationId:u,memberId:l}){this.cluster=e,this.coordinator=t,this.memberAssignment=r,this.topicConfigurations=o,this.instrumentationEmitter=a,this.groupId=c,this.generationId=u,this.memberId=l,this.autoCommit=s,this.autoCommitInterval=n,this.autoCommitThreshold=i,this.lastCommit=Date.now(),this.topics=hT(r),this.clearAllOffsets()}nextOffset(e,t){this.resolvedOffsets[e][t]||(this.resolvedOffsets[e][t]=this.committedOffsets()[e][t]);let r=this.resolvedOffsets[e][t];return dT(r)&&(r="0"),lT.fromValue(r)}async getCoordinator(){return this.coordinator.isConnected()||(this.coordinator=await this.cluster.findBroker(this.coordinator)),this.coordinator}resetOffset({topic:e,partition:t}){this.resolvedOffsets[e][t]=this.committedOffsets()[e][t]}resolveOffset({topic:e,partition:t,offset:r}){this.resolvedOffsets[e][t]=lT.fromValue(r).add(1).toString()}countResolvedOffsets(){const e=this.committedOffsets(),t=(e,t)=>hT(e).map(r=>((e,t)=>{const r=lT.fromValue(e);return dT(t)?r:r.subtract(lT.fromValue(t))})(e[r],t[r]));return this.topics.flatMap(r=>t(this.resolvedOffsets[r],e[r])).reduce((e,t)=>e.add(t),lT.fromValue(0))}async setDefaultOffset({topic:e,partition:t}){const{groupId:r,generationId:s,memberId:n}=this,i=this.cluster.defaultOffset(this.topicConfigurations[e]),o=await this.getCoordinator();await o.offsetCommit({groupId:r,memberId:n,groupGenerationId:s,topics:[{topic:e,partitions:[{partition:t,offset:i}]}]}),this.clearOffsets({topic:e,partition:t})}async seek({topic:e,partition:t,offset:r}){if(!this.memberAssignment[e]||!this.memberAssignment[e].includes(t))return;if(!this.autoCommit)return void this.resolveOffset({topic:e,partition:t,offset:lT.fromValue(r).subtract(1).toString()});const{groupId:s,generationId:n,memberId:i}=this,o=await this.getCoordinator();await o.offsetCommit({groupId:s,memberId:i,groupGenerationId:n,topics:[{topic:e,partitions:[{partition:t,offset:r}]}]}),this.clearOffsets({topic:e,partition:t})}async commitOffsetsIfNecessary(){const e=Date.now(),t=null!=this.autoCommitInterval&&e>=this.lastCommit+this.autoCommitInterval,r=null!=this.autoCommitThreshold&&this.countResolvedOffsets().gte(lT.fromValue(this.autoCommitThreshold));if(t||r)return this.commitOffsets()}uncommittedOffsets(){const e=e=>hT(this.resolvedOffsets[e]),t=e=>t=>({partition:t,offset:this.resolvedOffsets[e][t]}),r=e=>({partition:t,offset:r})=>r!==this.committedOffsets()[e][t]&&lT.fromValue(r).greaterThanOrEqual(0);return{topics:this.topics.map(s=>({topic:s,partitions:e(s).map(t(s)).filter(r(s))})).filter(({partitions:e})=>e.length>0)}}async commitOffsets(e={}){const{groupId:t,generationId:r,memberId:s}=this,{topics:n=this.uncommittedOffsets().topics}=e;if(0===n.length)return void(this.lastCommit=Date.now());const i={groupId:t,memberId:s,groupGenerationId:r,topics:n};try{const e=await this.getCoordinator();await e.offsetCommit(i),this.instrumentationEmitter.emit(fT,i),n.forEach(({topic:e,partitions:t})=>{const r=t.reduce((e,{partition:t,offset:r})=>mT(e,{[t]:r}),{});this[gT][e]=mT({},this.committedOffsets()[e],r)}),this.lastCommit=Date.now()}catch(e){throw"NOT_COORDINATOR_FOR_GROUP"===e.type&&await this.cluster.refreshMetadata(),e}}async resolveOffsets(){const{groupId:e}=this,t=e=>t=>dT(this.committedOffsets()[e][t]),r=this.topics.map(e=>({topic:e,partitions:this.memberAssignment[e].filter(t(e)).map(e=>({partition:e}))})).filter(e=>e.partitions.length>0);if(0===r.length)return;const s=await this.getCoordinator(),{responses:n}=await s.offsetFetch({groupId:e,topics:r}),i=n.map(({topic:e,partitions:t})=>mT({topic:e,partitions:t.filter(({offset:e})=>dT(e)).map(({partition:e})=>mT({partition:e}))},this.topicConfigurations[e])),o=(e,{partition:t,offset:r})=>mT(e,{[t]:r});let a=n;if(i.some(e=>e.partitions.length>0)){const e=await this.cluster.fetchTopicsOffset(i);a=pT(n,e)}a.forEach(({topic:e,partitions:t})=>{this.committedOffsets()[e]=t.reduce(o,{...this.committedOffsets()[e]})})}clearOffsets({topic:e,partition:t}){delete this.committedOffsets()[e][t],delete this.resolvedOffsets[e][t]}clearAllOffsets(){const e=this.committedOffsets();for(const t in e)delete e[t];for(const t of this.topics)e[t]={};this.resolvedOffsets=this.topics.reduce((e,t)=>mT(e,{[t]:{}}),{})}committedOffsets(){return this[gT]||(this[gT]=this.groupId?this.cluster.committedOffsets({groupId:this.groupId}):{}),this[gT]}},BT=class{constructor(e,t,r){this.fetchedOffset=t;const s=bT.fromValue(this.fetchedOffset),{abortedTransactions:n,messages:i}=r;this.topic=e,this.partition=r.partition,this.highWatermark=r.highWatermark,this.rawMessages=i,this.messagesWithinOffset=this.rawMessages.filter(e=>bT.fromValue(e.offset).gte(s)),this.messages=wT({messages:this.messagesWithinOffset,abortedTransactions:n}).filter(e=>!e.isControlRecord)}isEmpty(){return 0===this.messages.length}isEmptyIncludingFiltered(){return 0===this.messagesWithinOffset.length}isEmptyDueToFiltering(){return this.isEmpty()&&this.rawMessages.length>0}isEmptyControlRecord(){return this.isEmpty()&&this.messagesWithinOffset.some(({isControlRecord:e})=>e)}isEmptyDueToLogCompactedMessages(){return this.rawMessages.length>0&&this.isEmptyIncludingFiltered()}firstOffset(){return this.isEmptyIncludingFiltered()?null:this.messagesWithinOffset[0].offset}lastOffset(){return this.isEmptyDueToLogCompactedMessages()?this.fetchedOffset:this.isEmptyIncludingFiltered()?bT.fromValue(this.highWatermark).add(-1).toString():this.messagesWithinOffset[this.messagesWithinOffset.length-1].offset}offsetLag(){const e=bT.fromValue(this.highWatermark).add(-1),t=bT.fromValue(this.lastOffset());return e.add(t.multiply(-1)).toString()}offsetLagLow(){if(this.isEmptyIncludingFiltered())return"0";const e=bT.fromValue(this.highWatermark).add(-1),t=bT.fromValue(this.firstOffset());return e.add(t.multiply(-1)).toString()}},PT=vT,MT=class{constructor(){this.assignedPartitionsByTopic={},this.subscriptionStatesByTopic={}}assign(e=[]){this.assignedPartitionsByTopic=e.reduce((e,{topic:t,partitions:r=[]})=>({...e,[t]:{topic:t,partitions:r}}),{})}pause(e=[]){e.forEach(({topic:e,partitions:t})=>{const r=this.subscriptionStatesByTopic[e]||TT(e);void 0===t?(r.paused.clear(),r.resumed.clear(),r.pauseAll=!0):Array.isArray(t)&&(t.forEach(e=>{r.paused.add(e),r.resumed.delete(e)}),r.pauseAll=!1),this.subscriptionStatesByTopic[e]=r})}resume(e=[]){e.forEach(({topic:e,partitions:t})=>{const r=this.subscriptionStatesByTopic[e]||TT(e);void 0===t?(r.paused.clear(),r.resumed.clear(),r.pauseAll=!1):Array.isArray(t)&&t.forEach(e=>{r.paused.delete(e),r.pauseAll&&r.resumed.add(e)}),this.subscriptionStatesByTopic[e]=r})}assigned(){return Object.values(this.assignedPartitionsByTopic).map(({topic:e,partitions:t})=>({topic:e,partitions:t.sort()}))}active(){return Object.values(this.assignedPartitionsByTopic).map(({topic:e,partitions:t})=>({topic:e,partitions:t.filter(t=>!this.isPaused(e,t)).sort()}))}paused(){return Object.values(this.assignedPartitionsByTopic).map(({topic:e,partitions:t})=>({topic:e,partitions:t.filter(t=>this.isPaused(e,t)).sort()})).filter(({partitions:e})=>0!==e.length)}isPaused(e,t){const r=this.subscriptionStatesByTopic[e];if(!r)return!1;const s=r.resumed.has(t),n=r.paused.has(t);return r.pauseAll&&!s||n}},{events:{GROUP_JOIN:DT,HEARTBEAT:$T,CONNECT:UT,RECEIVED_UNSUBSCRIBED_TOPICS:jT}}=uT,{MemberAssignment:GT}=OT,{KafkaJSError:FT,KafkaJSNonRetriableError:VT,KafkaJSStaleTopicMetadataAssignment:KT,isRebalancing:qT}=Mn,{keys:WT}=Object,HT=["LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION","FENCED_LEADER_EPOCH","UNKNOWN_LEADER_EPOCH","UNKNOWN_TOPIC_OR_PARTITION"],ZT=Symbol("private:ConsumerGroup:join"),JT=Symbol("private:ConsumerGroup:sync"),XT=Symbol("private:ConsumerGroup:sharedHeartbeat");const zT=i;var YT=({nodeId:e,workerQueue:t,partitionAssignments:r,fetch:s,logger:n})=>{const i=n.namespace(`Fetcher ${e}`),o=new zT;let a=!1;const c=({topic:e,partition:t})=>`${e}|${t}`,u=t=>r.set(c(t),e),l=e=>r.delete(c(e)),d=t=>t.filter(t=>{const s=(e=>r.get(c(e)))(t);return null==s||s===e||(i.info("Filtering out batch due to partition already being processed by another fetcher",{topic:t.topic,partition:t.partition,assignedFetcher:s,fetcher:e}),!1)});return{start:async()=>{if(!a){for(a=!0;a;)try{const r=await s(e);if(a){const e=d(r);if(e.length>0){e.forEach(u);try{await t.push(...e)}finally{e.forEach(l)}}}}catch(e){throw a=!1,o.emit("end"),e}o.emit("end")}},stop:async()=>{a&&(a=!1,await new Promise(e=>o.once("end",()=>e())))},getWorkerQueue:()=>t}};const QT=PI;var eE=({handler:e,workerId:t})=>{const r=QT(async({next:r})=>{for(;;){const s=r();if(!s)break;const{batch:n,resolve:i,reject:o}=s;try{await e(n,{workerId:t}),i()}catch(e){o(e)}}});return{run:r}};var tE=({workers:e})=>{const t=[];return{push:async(...r)=>{const s=r.map(e=>new Promise((r,s)=>t.push({batch:e,resolve:r,reject:s})));e.forEach(e=>e.run({next:()=>t.shift()}));const n=(await Promise.allSettled(s)).find(e=>"rejected"===e.status);if(n)throw n.reason},getWorkers:()=>e}};const rE=(e,t=e=>e)=>new Array(e).fill(0).map((e,r)=>t(r)),sE=YT,nE=eE,iE=tE,{KafkaJSFetcherRebalanceError:oE,KafkaJSNoBrokerAvailableError:aE}=Mn;var cE=({logger:e,getNodeIds:t,fetch:r,handler:s,concurrency:n=1})=>{const i=e.namespace("FetchManager"),o=rE(n,e=>nE({handler:s,workerId:e})),a=iE({workers:o});let c=[];const u=()=>{const e=t(),s=new Map;if(0===e.length)throw new aE;const o=e.map(n=>sE({nodeId:n,workerQueue:a,partitionAssignments:s,fetch:async s=>((()=>{const r=t();if((e.length!==r.length||e.some(e=>!r.includes(e)))&&0!==r.length)throw new oE})(),r(s)),logger:i}));return i.debug(`Created ${o.length} fetchers`,{nodeIds:e,concurrency:n}),o},l=async()=>{i.debug("Stopping fetchers..."),await Promise.all(c.map(e=>e.stop())),i.debug("Stopped fetchers")};return{start:async()=>{for(i.debug("Starting...");;){c=u();try{await Promise.all(c.map(e=>e.start()))}catch(e){if(await l(),e instanceof oE){i.debug("Rebalancing fetchers...");continue}throw e}break}},stop:l,getFetchers:()=>c}};const{EventEmitter:uE}=i,lE=si,dE=_I,{isKafkaJSError:pE,isRebalancing:fE}=Mn,{events:{FETCH:hE,FETCH_START:mE,START_BATCH_PROCESS:gE,END_BATCH_PROCESS:yE,REBALANCING:IE}}=uT,bE=cE,wE="consuming-stop";const{MemberMetadata:vE,MemberAssignment:TE}=OT;const EE=({cluster:e})=>({name:"RoundRobinAssigner",version:0,async assign({members:t,topics:r}){const s=t.length,n=t.map(({memberId:e})=>e).sort(),i={};return r.flatMap(t=>e.findTopicPartitionMetadata(t).map(e=>({topic:t,partitionId:e.partitionId}))).forEach((e,t)=>{const r=n[t%s];i[r]||(i[r]=Object.create(null)),i[r][e.topic]||(i[r][e.topic]=[]),i[r][e.topic].push(e.partitionId)}),Object.keys(i).map(e=>({memberId:e,memberAssignment:TE.encode({version:this.version,assignment:i[e]})}))},protocol({topics:e}){return{name:this.name,metadata:vE.encode({version:this.version,topics:e})}}});var _E={roundRobin:EE};const AE=si,SE=_I,{initialRetryTime:OE}=gI,NE=class{constructor({retry:e,cluster:t,groupId:r,topics:s,topicConfigurations:n,logger:i,instrumentationEmitter:o,assigners:a,sessionTimeout:c,rebalanceTimeout:u,maxBytesPerPartition:l,minBytes:d,maxBytes:p,maxWaitTimeInMs:f,autoCommit:h,autoCommitInterval:m,autoCommitThreshold:g,isolationLevel:y,rackId:I,metadataMaxAge:b}){this.cluster=t,this.groupId=r,this.topics=s,this.topicsSubscribed=s,this.topicConfigurations=n,this.logger=i.namespace("ConsumerGroup"),this.instrumentationEmitter=o,this.retrier=kT(Object.assign({},e)),this.assigners=a,this.sessionTimeout=c,this.rebalanceTimeout=u,this.maxBytesPerPartition=l,this.minBytes=d,this.maxBytes=p,this.maxWaitTime=f,this.autoCommit=h,this.autoCommitInterval=m,this.autoCommitThreshold=g,this.isolationLevel=y,this.rackId=I,this.metadataMaxAge=b,this.seekOffset=new PT,this.coordinator=null,this.generationId=null,this.leaderId=null,this.memberId=null,this.members=null,this.groupProtocol=null,this.partitionsPerSubscribedTopic=null,this.preferredReadReplicasPerTopicPartition={},this.offsetManager=null,this.subscriptionState=new MT,this.lastRequest=Date.now(),this[XT]=xT(async({interval:e})=>{const{groupId:t,generationId:r,memberId:s}=this,n=Date.now();if(s&&n>=this.lastRequest+e){const e={groupId:t,memberId:s,groupGenerationId:r};await this.coordinator.heartbeat(e),this.instrumentationEmitter.emit($T,e),this.lastRequest=Date.now()}})}isLeader(){return this.leaderId&&this.memberId===this.leaderId}getNodeIds(){return this.cluster.getNodeIds()}async connect(){await this.cluster.connect(),this.instrumentationEmitter.emit(UT),await this.cluster.refreshMetadataIfNecessary()}async[ZT](){const{groupId:e,sessionTimeout:t,rebalanceTimeout:r}=this;this.coordinator=await this.cluster.findGroupCoordinator({groupId:e});const s=await this.coordinator.joinGroup({groupId:e,sessionTimeout:t,rebalanceTimeout:r,memberId:this.memberId||"",groupProtocols:this.assigners.map(e=>e.protocol({topics:this.topicsSubscribed}))});this.generationId=s.generationId,this.leaderId=s.leaderId,this.memberId=s.memberId,this.members=s.members,this.groupProtocol=s.groupProtocol}async leave(){const{groupId:e,memberId:t}=this;t&&(await this.coordinator.leaveGroup({groupId:e,memberId:t}),this.memberId=null)}async[JT](){let e=[];const{groupId:t,generationId:r,memberId:s,members:n,groupProtocol:i,topics:o,topicsSubscribed:a,coordinator:c}=this;if(this.isLeader()){this.logger.debug("Chosen as group leader",{groupId:t,generationId:r,memberId:s,topics:o});const c=this.assigners.find(({name:e})=>e===i);if(!c)throw new VT(`Unsupported partition assigner "${i}", the assigner wasn't found in the assigners list`);await this.cluster.refreshMetadata(),e=await c.assign({members:n,topics:a}),this.logger.debug("Group assignment",{groupId:t,generationId:r,groupProtocol:i,assignment:e,topics:a})}this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();const{memberAssignment:u}=await this.coordinator.syncGroup({groupId:t,generationId:r,memberId:s,groupAssignment:e}),l=GT.decode(u),d=null!=l?l.assignment:{};this.logger.debug("Received assignment",{groupId:t,generationId:r,memberId:s,memberAssignment:d});const p=WT(d),f=CT(p,a);if(f.length>0){const e={groupId:t,generationId:r,memberId:s,assignedTopics:p,topicsSubscribed:a,topicsNotSubscribed:f};this.instrumentationEmitter.emit(jT,e),this.logger.warn("Consumer group received unsubscribed topics",{...e,helpUrl:RT("docs/faq","why-am-i-receiving-messages-for-topics-i-m-not-subscribed-to")})}const h=CT(p,f).map(e=>({topic:e,partitions:d[e]}));for(const e of h){const{topic:n,partitions:i}=e,o=this.partitionsPerSubscribedTopic.get(n);if(!i.every(e=>o.includes(e))){this.logger.warn("Consumer is not aware of all assigned partitions, refreshing metadata",{groupId:t,generationId:r,memberId:s,topic:n,knownPartitions:o,assignedPartitions:i}),await this.cluster.refreshMetadata(),this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();break}}this.topics=h.map(({topic:e})=>e),this.subscriptionState.assign(h),this.offsetManager=new LT({cluster:this.cluster,topicConfigurations:this.topicConfigurations,instrumentationEmitter:this.instrumentationEmitter,memberAssignment:h.reduce((e,{topic:t,partitions:r})=>({...e,[t]:r}),{}),autoCommit:this.autoCommit,autoCommitInterval:this.autoCommitInterval,autoCommitThreshold:this.autoCommitThreshold,coordinator:c,groupId:t,generationId:r,memberId:s})}joinAndSync(){const e=Date.now();return this.retrier(async t=>{try{await this[ZT](),await this[JT]();const t=this.assigned().reduce((e,{topic:t,partitions:r})=>({...e,[t]:r}),{}),r={groupId:this.groupId,memberId:this.memberId,leaderId:this.leaderId,isLeader:this.isLeader(),memberAssignment:t,groupProtocol:this.groupProtocol,duration:Date.now()-e};this.instrumentationEmitter.emit(DT,r),this.logger.info("Consumer has joined the group",r)}catch(e){if(qT(e))throw new FT(e);if("UNKNOWN_MEMBER_ID"===e.type)throw this.memberId=null,new FT(e);t(e)}})}resetOffset({topic:e,partition:t}){this.offsetManager.resetOffset({topic:e,partition:t})}resolveOffset({topic:e,partition:t,offset:r}){this.offsetManager.resolveOffset({topic:e,partition:t,offset:r})}seek({topic:e,partition:t,offset:r}){this.seekOffset.set(e,t,r)}pause(e){this.logger.info(`Pausing fetching from ${e.length} topics`,{topicPartitions:e}),this.subscriptionState.pause(e)}resume(e){this.logger.info(`Resuming fetching from ${e.length} topics`,{topicPartitions:e}),this.subscriptionState.resume(e)}assigned(){return this.subscriptionState.assigned()}paused(){return this.subscriptionState.paused()}isPaused(e,t){return this.subscriptionState.isPaused(e,t)}async commitOffsetsIfNecessary(){await this.offsetManager.commitOffsetsIfNecessary()}async commitOffsets(e){await this.offsetManager.commitOffsets(e)}uncommittedOffsets(){return this.offsetManager.uncommittedOffsets()}async heartbeat({interval:e}){return this[XT]({interval:e})}async fetch(e){try{await this.cluster.refreshMetadataIfNecessary(),this.checkForStaleAssignment();let t=this.subscriptionState.assigned();t=this.filterPartitionsByNode(e,t),await this.seekOffsets(t);const r=this.offsetManager.committedOffsets(),s=this.getActiveTopicPartitions(),n=t.map(({topic:e,partitions:t})=>({topic:e,partitions:t.filter(t=>null!=r[e][t]&&s[e].has(t)).map(t=>({partition:t,fetchOffset:this.offsetManager.nextOffset(e,t).toString(),maxBytes:this.maxBytesPerPartition}))})).filter(({partitions:e})=>e.length);if(!n.length)return await NT(this.maxWaitTime),[];const i=await this.cluster.findBroker({nodeId:e}),{responses:o}=await i.fetch({maxWaitTime:this.maxWaitTime,minBytes:this.minBytes,maxBytes:this.maxBytes,isolationLevel:this.isolationLevel,topics:n,rackId:this.rackId});return o.flatMap(({topicName:e,partitions:t})=>{const r=n.find(({topic:t})=>t===e);let s=this.preferredReadReplicasPerTopicPartition[e];return s||(this.preferredReadReplicasPerTopicPartition[e]=s={}),t.filter(({partition:t})=>!this.seekOffset.has(e,t)&&!this.subscriptionState.isPaused(e,t)).map(t=>{const{partition:n,preferredReadReplica:i}=t;if(null!=i&&-1!==i){const{nodeId:t}=s[n]||{};t!==i&&this.logger.info(`Preferred read replica is now ${i}`,{groupId:this.groupId,memberId:this.memberId,topic:e,partition:n}),s[n]={nodeId:i,expireAt:Date.now()+this.metadataMaxAge}}const o=r.partitions.find(({partition:e})=>e===t.partition),a=o.fetchOffset;return new BT(e,a,t)})})}catch(e){return await this.recoverFromFetch(e),[]}}async recoverFromFetch(e){if(HT.includes(e.type)||"KafkaJSTopicMetadataNotLoaded"===e.name)return this.logger.debug("Stale cluster metadata, refreshing...",{groupId:this.groupId,memberId:this.memberId,error:e.message}),await this.cluster.refreshMetadata(),void await this.joinAndSync();if("KafkaJSStaleTopicMetadataAssignment"===e.name)return this.logger.warn(`${e.message}, resync group`,{groupId:this.groupId,memberId:this.memberId,topic:e.topic,unknownPartitions:e.unknownPartitions}),void await this.joinAndSync();if("KafkaJSOffsetOutOfRange"!==e.name){if("KafkaJSConnectionClosedError"!==e.name){if("KafkaJSBrokerNotFound"===e.name||"KafkaJSConnectionClosedError"===e.name)return this.logger.debug(`${e.message}, refreshing metadata and retrying...`),void await this.cluster.refreshMetadata();throw e}this.cluster.removeBroker({host:e.host,port:e.port})}else await this.recoverFromOffsetOutOfRange(e)}async recoverFromOffsetOutOfRange(e){const t=this.preferredReadReplicasPerTopicPartition[e.topic];t&&"number"==typeof t[e.partition]?(this.logger.info("Offset out of range while fetching from follower, retrying with leader",{topic:e.topic,partition:e.partition,groupId:this.groupId,memberId:this.memberId}),delete t[e.partition]):(this.logger.error("Offset out of range, resetting to default offset",{topic:e.topic,partition:e.partition,groupId:this.groupId,memberId:this.memberId}),await this.offsetManager.setDefaultOffset({topic:e.topic,partition:e.partition}))}generatePartitionsPerSubscribedTopic(){const e=new Map;for(const t of this.topicsSubscribed){const r=this.cluster.findTopicPartitionMetadata(t).map(e=>e.partitionId).sort();e.set(t,r)}return e}checkForStaleAssignment(){if(!this.partitionsPerSubscribedTopic)return;const e=this.generatePartitionsPerSubscribedTopic();for(const[t,r]of e){const e=CT(r,this.partitionsPerSubscribedTopic.get(t));if(e.length>0)throw new KT("Topic has been updated",{topic:t,unknownPartitions:e})}}async seekOffsets(e){for(const{topic:t,partitions:r}of e)for(const e of r){const r=this.seekOffset.pop(t,e);r&&(this.logger.debug("Seek offset",{groupId:this.groupId,memberId:this.memberId,seek:r}),await this.offsetManager.seek(r))}await this.offsetManager.resolveOffsets()}hasSeekOffset({topic:e,partition:t}){return this.seekOffset.has(e,t)}findReadReplicaForPartitions(e,t){const r=this.cluster.findTopicPartitionMetadata(e),s=this.preferredReadReplicasPerTopicPartition[e];return t.reduce((t,n)=>{const i=parseInt(n,10),o=r.find(e=>e.partitionId===i);if(!o)return t;if(null==o.leader)throw new FT("Invalid partition metadata",{topic:e,partitionId:i,metadata:o});let a=o.leader;if(s){const{nodeId:t,expireAt:r}=s[i]||{};if(Date.now()>=r)this.logger.debug("Preferred read replica information has expired, using leader",{topic:e,partitionId:i,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:t,leader:o.leader}),delete s[i];else if(null!=t){const r=o.offlineReplicas;Array.isArray(r)&&r.includes(a)?this.logger.debug("Preferred read replica is offline, using leader",{topic:e,partitionId:i,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:t,leader:o.leader}):a=t}}const c=t[a]||[];return{...t,[a]:[...c,i]}},{})}filterPartitionsByNode(e,t){return t.map(({topic:t,partitions:r})=>({topic:t,partitions:this.findReadReplicaForPartitions(t,r)[e]||[]}))}getActiveTopicPartitions(){const e=this.subscriptionState.active(),t={};return e.forEach(({topic:e,partitions:r})=>{t[e]=new Set(r)}),t}},RE=class extends uE{constructor({logger:e,consumerGroup:t,instrumentationEmitter:r,eachBatchAutoResolve:s=!0,concurrency:n,eachBatch:i,eachMessage:o,heartbeatInterval:a,onCrash:c,retry:u,autoCommit:l=!0}){super(),this.logger=e.namespace("Runner"),this.consumerGroup=t,this.instrumentationEmitter=r,this.eachBatchAutoResolve=s,this.eachBatch=i,this.eachMessage=o,this.heartbeatInterval=a,this.retrier=dE(Object.assign({},u)),this.onCrash=c,this.autoCommit=l,this.fetchManager=bE({logger:this.logger,getNodeIds:()=>this.consumerGroup.getNodeIds(),fetch:e=>this.fetch(e),handler:e=>this.handleBatch(e),concurrency:n}),this.running=!1,this.consuming=!1}get consuming(){return this._consuming}set consuming(e){this._consuming!==e&&(this._consuming=e,this.emit(e?"consuming-start":wE))}async start(){if(!this.running){try{await this.consumerGroup.connect(),await this.consumerGroup.joinAndSync()}catch(e){return this.onCrash(e)}this.running=!0,this.scheduleFetchManager()}}scheduleFetchManager(){if(!this.running)return this.consuming=!1,void this.logger.info("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId});this.consuming=!0,this.retrier(async(e,t,r)=>{if(this.running)try{await this.fetchManager.start()}catch(s){if(fE(s))return this.logger.warn("The group is rebalancing, re-joining",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:s.message}),this.instrumentationEmitter.emit(IE,{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),void await this.consumerGroup.joinAndSync();if("UNKNOWN_MEMBER_ID"===s.type)return this.logger.error("The coordinator is not aware of this member, re-joining the group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:s.message}),this.consumerGroup.memberId=null,void await this.consumerGroup.joinAndSync();if("KafkaJSNotImplemented"===s.name)return e(s);if("KafkaJSNoBrokerAvailableError"===s.name)return e(s);throw this.logger.debug("Error while scheduling fetch manager, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:s.message,stack:s.stack,retryCount:t,retryTime:r}),s}}).then(()=>{this.scheduleFetchManager()}).catch(e=>{this.onCrash(e),this.consuming=!1,this.running=!1})}async stop(){if(this.running){this.logger.debug("stop consumer group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.running=!1;try{await this.fetchManager.stop(),await this.waitForConsumer(),await this.consumerGroup.leave()}catch(e){}}}waitForConsumer(){return new Promise(e=>{if(!this.consuming)return e();this.logger.debug("waiting for consumer to finish...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.once(wE,()=>e())})}async heartbeat(){try{await this.consumerGroup.heartbeat({interval:this.heartbeatInterval})}catch(e){throw fE(e)&&await this.autoCommitOffsets(),e}}async processEachMessage(e){const{topic:t,partition:r}=e,s=()=>(this.consumerGroup.pause([{topic:t,partitions:[r]}]),()=>this.consumerGroup.resume([{topic:t,partitions:[r]}]));for(const n of e.messages){if(!this.running||this.consumerGroup.hasSeekOffset({topic:t,partition:r}))break;try{await this.eachMessage({topic:t,partition:r,message:n,heartbeat:()=>this.heartbeat(),pause:s})}catch(e){throw pE(e)||this.logger.error("Error when calling eachMessage",{topic:t,partition:r,offset:n.offset,stack:e.stack,error:e}),await this.autoCommitOffsets(),e}if(this.consumerGroup.resolveOffset({topic:t,partition:r,offset:n.offset}),await this.heartbeat(),await this.autoCommitOffsetsIfNecessary(),this.consumerGroup.isPaused(t,r))break}}async processEachBatch(e){const{topic:t,partition:r}=e,s=e.messages[e.messages.length-1],n=()=>(this.consumerGroup.pause([{topic:t,partitions:[r]}]),()=>this.consumerGroup.resume([{topic:t,partitions:[r]}]));try{await this.eachBatch({batch:e,resolveOffset:n=>{const i=s&&(o=n,a=s.offset,lE.fromValue(o).equals(lE.fromValue(a)))?e.lastOffset():n;var o,a;this.consumerGroup.resolveOffset({topic:t,partition:r,offset:i})},heartbeat:()=>this.heartbeat(),pause:n,commitOffsetsIfNecessary:async e=>e?this.consumerGroup.commitOffsets(e):this.consumerGroup.commitOffsetsIfNecessary(),uncommittedOffsets:()=>this.consumerGroup.uncommittedOffsets(),isRunning:()=>this.running,isStale:()=>this.consumerGroup.hasSeekOffset({topic:t,partition:r})})}catch(s){throw pE(s)||this.logger.error("Error when calling eachBatch",{topic:t,partition:r,offset:e.firstOffset(),stack:s.stack,error:s}),await this.autoCommitOffsets(),s}this.eachBatchAutoResolve&&this.consumerGroup.resolveOffset({topic:t,partition:r,offset:e.lastOffset()})}async fetch(e){if(!this.running)return this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),[];const t=Date.now();this.instrumentationEmitter.emit(mE,{nodeId:e});const r=await this.consumerGroup.fetch(e);return this.instrumentationEmitter.emit(hE,{numberOfBatches:0,duration:Date.now()-t,nodeId:e}),0===r.length&&await this.heartbeat(),r}async handleBatch(e){if(!this.running)return void this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId});await(async e=>{const t=Date.now(),r={topic:e.topic,partition:e.partition,highWatermark:e.highWatermark,offsetLag:e.offsetLag(),offsetLagLow:e.offsetLagLow(),batchSize:e.messages.length,firstOffset:e.firstOffset(),lastOffset:e.lastOffset()};if(e.isEmptyDueToFiltering())return this.instrumentationEmitter.emit(gE,r),this.consumerGroup.resolveOffset({topic:e.topic,partition:e.partition,offset:e.lastOffset()}),await this.autoCommitOffsetsIfNecessary(),this.instrumentationEmitter.emit(yE,{...r,duration:Date.now()-t}),void await this.heartbeat();e.isEmpty()||(this.instrumentationEmitter.emit(gE,r),this.eachMessage?await this.processEachMessage(e):this.eachBatch&&await this.processEachBatch(e),this.instrumentationEmitter.emit(yE,{...r,duration:Date.now()-t}),await this.autoCommitOffsets()),await this.heartbeat()})(e)}autoCommitOffsets(){if(this.autoCommit)return this.consumerGroup.commitOffsets()}autoCommitOffsetsIfNecessary(){if(this.autoCommit)return this.consumerGroup.commitOffsetsIfNecessary()}commitOffsets(e){if(this.running)return this.retrier(async(t,r,s)=>{try{await this.consumerGroup.commitOffsets(e)}catch(n){if(!this.running)return void this.logger.debug("consumer not running, exiting",{error:n.message,groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:e});if("KafkaJSNotImplemented"===n.name)return t(n);throw this.logger.debug("Error while committing offsets, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:n.message,stack:n.stack,retryCount:r,retryTime:s,offsets:e}),n}});this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:e})}},{events:CE,wrap:kE,unwrap:xE}=uT,LE=jn,{KafkaJSNonRetriableError:BE}=Mn,{roundRobin:PE}=_E,{EARLIEST_OFFSET:ME,LATEST_OFFSET:DE}=DI,$E=Xa,UE=PI,{keys:jE,values:GE}=Object,{CONNECT:FE,DISCONNECT:VE,STOP:KE,CRASH:qE}=CE,WE=GE(CE),HE=jE(CE).map(e=>`consumer.events.${e}`).join(", "),ZE=[AE.fromValue(ME).toString(),AE.fromValue(DE).toString()];var JE=({cluster:e,groupId:t,retry:r,logger:s,partitionAssigners:n=[PE],sessionTimeout:i=3e4,rebalanceTimeout:o=6e4,heartbeatInterval:a=3e3,maxBytesPerPartition:c=1048576,minBytes:u=1,maxBytes:l=10485760,maxWaitTimeInMs:d=5e3,isolationLevel:p=$E.READ_COMMITTED,rackId:f="",instrumentationEmitter:h,metadataMaxAge:m})=>{if(!t)throw new BE("Consumer groupId must be a non-empty string.");const g=s.namespace("Consumer"),y=h||new LE,I=n.map(r=>r({groupId:t,logger:g,cluster:e})),b={};let w=null,v=null,T=null;if(a>=i)throw new BE(`Consumer heartbeatInterval (${a}) must be lower than sessionTimeout (${i}). It is recommended to set heartbeatInterval to approximately a third of the sessionTimeout.`);const E=async()=>{try{await _(),g.debug("consumer has stopped, disconnecting",{groupId:t}),await e.disconnect(),y.emit(VE)}catch(e){throw g.error(`Caught error when disconnecting the consumer: ${e.message}`,{stack:e.stack,groupId:t}),e}},_=UE(async()=>{try{w&&(await w.stop(),w=null,v=null,y.emit(KE)),clearTimeout(T),g.info("Stopped",{groupId:t})}catch(e){throw g.error(`Caught error when stopping the consumer: ${e.message}`,{stack:e.stack,groupId:t}),e}});return{connect:async()=>{await e.connect(),y.emit(FE)},disconnect:E,subscribe:async({topic:r,topics:s,fromBeginning:n=!1})=>{if(v)throw new BE("Cannot subscribe to topic while consumer is running");if(!r&&!s)throw new BE('Missing required argument "topics"');if(null!=s&&!Array.isArray(s))throw new BE('Argument "topics" must be an array');const i=s||[r];for(const e of i)if("string"!=typeof e&&!(e instanceof RegExp))throw new BE(`Invalid topic ${e} (${typeof e}), the topic name has to be a String or a RegExp`);const o=i.some(e=>e instanceof RegExp)?await e.metadata():void 0,a=[];for(const e of i){if(e instanceof RegExp){const r=e,s=o.topicMetadata.map(({topic:e})=>e).filter(e=>r.test(e));g.debug("Subscription based on RegExp",{groupId:t,topicRegExp:r.toString(),matchedTopics:s}),a.push(...s)}else a.push(e)}for(const e of a)b[e]={fromBeginning:n};await e.addMultipleTargetTopics(a)},stop:_,run:async({autoCommit:n=!0,autoCommitInterval:h=null,autoCommitThreshold:_=null,eachBatchAutoResolve:A=!0,partitionsConsumedConcurrently:S=1,eachBatch:O=null,eachMessage:N=null}={})=>{if(v)return void g.warn("consumer#run was called, but the consumer is already running",{groupId:t});const R=async T=>{g.info("Starting",{groupId:t}),v=new NE({logger:s,topics:jE(b),topicConfigurations:b,retry:r,cluster:e,groupId:t,assigners:I,sessionTimeout:i,rebalanceTimeout:o,maxBytesPerPartition:c,minBytes:u,maxBytes:l,maxWaitTimeInMs:d,instrumentationEmitter:y,isolationLevel:p,rackId:f,metadataMaxAge:m,autoCommit:n,autoCommitInterval:h,autoCommitThreshold:_}),w=new RE({logger:s,consumerGroup:v,instrumentationEmitter:y,heartbeatInterval:a,retry:r,autoCommit:n,eachBatchAutoResolve:A,eachBatch:O,eachMessage:N,onCrash:T,concurrency:S}),await w.start()},C=async s=>{g.error(`Crash: ${s.name}: ${s.message}`,{groupId:t,retryCount:s.retryCount,stack:s.stack}),"KafkaJSConnectionClosedError"===s.name&&e.removeBroker({host:s.host,port:s.port}),await E();const n=e=>e.cause?n(e.cause):e,i=("KafkaJSNumberOfRetriesExceeded"===s.name||!0===n(s).retriable)&&(!r||!r.restartOnFailure||await r.restartOnFailure(s).catch(e=>(g.error('Caught error when invoking user-provided "restartOnFailure" callback. Defaulting to restarting.',{error:e.message||e,cause:s.message||s,groupId:t}),!0)));if(y.emit(qE,{error:s,groupId:t,restart:i}),i){const e=s.retryTime||r&&r.initialRetryTime||OE;g.error(`Restarting the consumer in ${e}ms`,{retryCount:s.retryCount,retryTime:e,groupId:t}),T=setTimeout(()=>R(C),e)}};await R(C)},commitOffsets:async(e=[])=>{const t=e.reduce((e,{topic:t,partition:r,offset:s,metadata:n=null})=>{if(!t)throw new BE(`Invalid topic ${t}`);if(isNaN(r))throw new BE(`Invalid partition, expected a number received ${r}`);let i;try{i=AE.fromValue(s)}catch(e){throw new BE(`Invalid offset, expected a long received ${s}`)}if(i.lessThan(0))throw new BE("Offset must not be a negative number");if(null!==n&&"string"!=typeof n)throw new BE(`Invalid offset metadata, expected string or null, received ${n}`);const o=e[t]||[];return o.push({partition:r,offset:i,metadata:n}),{...e,[t]:o}},{});if(!v)throw new BE("Consumer group was not initialized, consumer#run must be called first");const r=Object.keys(t);return w.commitOffsets({topics:r.map(e=>({topic:e,partitions:t[e]}))})},seek:({topic:e,partition:t,offset:r})=>{if(!e)throw new BE(`Invalid topic ${e}`);if(isNaN(t))throw new BE(`Invalid partition, expected a number received ${t}`);let s;try{s=AE.fromValue(r)}catch(e){throw new BE(`Invalid offset, expected a long received ${r}`)}if(s.lessThan(0)&&!ZE.includes(s.toString()))throw new BE("Offset must not be a negative number");if(!v)throw new BE("Consumer group was not initialized, consumer#run must be called first");v.seek({topic:e,partition:t,offset:s.toString()})},describeGroup:async()=>{const s=await e.findGroupCoordinator({groupId:t});return SE(r)(async()=>{const{groups:e}=await s.describeGroups({groupIds:[t]});return e.find(e=>e.groupId===t)})},pause:(e=[])=>{for(const t of e){if(!t||!t.topic)throw new BE(`Invalid topic ${t&&t.topic||t}`);if(void 0!==t.partitions&&(!Array.isArray(t.partitions)||t.partitions.some(isNaN)))throw new BE(`Array of valid partitions required to pause specific partitions instead of ${t.partitions}`)}if(!v)throw new BE("Consumer group was not initialized, consumer#run must be called first");v.pause(e)},paused:()=>v?v.paused():[],resume:(e=[])=>{for(const t of e){if(!t||!t.topic)throw new BE(`Invalid topic ${t&&t.topic||t}`);if(void 0!==t.partitions&&(!Array.isArray(t.partitions)||t.partitions.some(isNaN)))throw new BE(`Array of valid partitions required to resume specific partitions instead of ${t.partitions}`)}if(!v)throw new BE("Consumer group was not initialized, consumer#run must be called first");v.resume(e)},on:(e,t)=>{if(!WE.includes(e))throw new BE(`Event name should be one of ${HE}`);return y.addListener(xE(e),r=>{r.type=kE(r.type),Promise.resolve(t(r)).catch(t=>{g.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})})})},events:CE,logger:()=>g}};const XE=Jv,{KafkaJSTimeout:zE}=Mn;const YE=Av,QE=jI,e_=$I("admin"),t_={CONNECT:e_("connect"),DISCONNECT:e_("disconnect"),REQUEST:e_(QE.NETWORK_REQUEST),REQUEST_TIMEOUT:e_(QE.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:e_(QE.NETWORK_REQUEST_QUEUE_SIZE)},r_={[t_.REQUEST]:QE.NETWORK_REQUEST,[t_.REQUEST_TIMEOUT]:QE.NETWORK_REQUEST_TIMEOUT,[t_.REQUEST_QUEUE_SIZE]:QE.NETWORK_REQUEST_QUEUE_SIZE},s_=YE(r_);var n_={events:t_,wrap:e=>s_[e]||e,unwrap:e=>r_[e]||e},i_={UNKNOWN:0,ANY:1,TOPIC:2,GROUP:3,CLUSTER:4,TRANSACTIONAL_ID:5,DELEGATION_TOKEN:6},o_={UNKNOWN:0,ANY:1,ALL:2,READ:3,WRITE:4,CREATE:5,DELETE:6,ALTER:7,DESCRIBE:8,CLUSTER_ACTION:9,DESCRIBE_CONFIGS:10,ALTER_CONFIGS:11,IDEMPOTENT_WRITE:12},a_={UNKNOWN:0,ANY:1,DENY:2,ALLOW:3},c_={UNKNOWN:0,ANY:1,MATCH:2,LITERAL:3,PREFIXED:4};const u_=_I,l_=(e,{delay:t=50,maxWait:r=1e4,timeoutMessage:s="Timeout",ignoreTimeout:n=!1}={})=>{let i,o=0,a=!1;const c=async(r,s)=>{if(o+=t,!a){await XE(t);try{const t=await e(o);if(t)return a=!0,clearTimeout(i),r(t);c(r,s)}catch(e){a=!0,clearTimeout(i),s(e)}}};return new Promise((e,t)=>{c(e,t),n||(i=setTimeout(()=>{if(!a)return a=!0,t(new zE(s))},r))})},d_=async(e,t)=>{const r=new Map;for(const s of e){const e=await Promise.resolve(t(s));r.set(e,r.has(e)?[...r.get(e),s]:[s])}return r},p_=JE,f_=jn,{events:h_,wrap:m_,unwrap:g_}=n_,{LEVELS:y_}=Tn,{KafkaJSNonRetriableError:I_,KafkaJSDeleteGroupsError:b_,KafkaJSBrokerNotFound:w_,KafkaJSDeleteTopicRecordsError:v_,KafkaJSAggregateError:T_}=Mn,{staleMetadata:E_}=_o,__=Ug,A_=i_,S_=o_,O_=a_,N_=c_,{EARLIEST_OFFSET:R_,LATEST_OFFSET:C_}=DI,{CONNECT:k_,DISCONNECT:x_}=h_,{values:L_,keys:B_,entries:P_}=Object,M_=L_(h_),D_=B_(h_).map(e=>`admin.events.${e}`).join(", "),$_=async(e,t)=>(await e.addTargetTopic(t),await e.refreshMetadataIfNecessary(),e.findTopicPartitionMetadata(t).map(({partitionId:e})=>e).sort());const{createLogger:U_,LEVELS:{INFO:j_}}=Tn,G_=jn,F_=()=>({namespace:e,level:t,label:r,log:s})=>{const n=e?`[${e}] `:"",i=JSON.stringify(Object.assign({level:r},s,{message:`${n}${s.message}`}));switch(t){case Gn.INFO:return console.info(i);case Gn.ERROR:return console.error(i);case Gn.WARN:return console.warn(i);case Gn.DEBUG:return console.log(i)}},V_=class{constructor({logger:e,socketFactory:t,brokers:r,ssl:s,sasl:n,clientId:i,connectionTimeout:o,authenticationTimeout:a,reauthenticationThreshold:c,requestTimeout:u=3e4,enforceRequestTimeout:l,metadataMaxAge:d,retry:p,allowAutoTopicCreation:f,maxInFlightRequests:h,isolationLevel:m,instrumentationEmitter:g=null,offsets:y=new Map}){this.rootLogger=e,this.logger=e.namespace("Cluster"),this.retrier=Ew(p),this.connectionPoolBuilder=_w({logger:e,instrumentationEmitter:g,socketFactory:t,brokers:r,ssl:s,sasl:n,clientId:i,connectionTimeout:o,requestTimeout:u,enforceRequestTimeout:l,maxInFlightRequests:h,reauthenticationThreshold:c}),this.targetTopics=new Set,this.mutatingTargetTopics=new vw({description:"updating target topics",timeout:u}),this.isolationLevel=m,this.brokerPool=new ww({connectionPoolBuilder:this.connectionPoolBuilder,logger:this.rootLogger,retry:p,allowAutoTopicCreation:f,authenticationTimeout:a,metadataMaxAge:d}),this.committedOffsetsByGroup=y,this[Pw]=Tw(async()=>await this.brokerPool.connect()),this[Mw]=Tw(async()=>await this.brokerPool.refreshMetadata(Array.from(this.targetTopics))),this[Dw]=Tw(async()=>await this.brokerPool.refreshMetadataIfNecessary(Array.from(this.targetTopics))),this[$w]=Tw(async()=>{const{metadata:e}=this.brokerPool;if(!e||null==e.controllerId)throw new Rw("Topic metadata not loaded");const t=await this.findBroker({nodeId:e.controllerId});if(!t)throw new Nw(`Controller broker with id ${e.controllerId} not found in the cached metadata`);return t})}isConnected(){return this.brokerPool.hasConnectedBrokers()}async connect(){await this[Pw]()}async disconnect(){await this.brokerPool.disconnect()}removeBroker({host:e,port:t}){this.brokerPool.removeBroker({host:e,port:t})}async refreshMetadata(){await this[Mw]()}async refreshMetadataIfNecessary(){await this[Dw]()}async metadata({topics:e=[]}={}){return this.retrier(async(t,r,s)=>{try{return await this.brokerPool.refreshMetadataIfNecessary(e),this.brokerPool.withBroker(async({broker:t})=>t.metadata(e))}catch(e){if("LEADER_NOT_AVAILABLE"===e.type)throw e;t(e)}})}async addTargetTopic(e){return this.addMultipleTargetTopics([e])}async addMultipleTargetTopics(e){await this.mutatingTargetTopics.acquire();try{const t=this.targetTopics.size,r=new Set(this.targetTopics);for(const t of e)this.targetTopics.add(t);if(t!==this.targetTopics.size||!this.brokerPool.metadata)try{await this.refreshMetadata()}catch(e){throw"INVALID_TOPIC_EXCEPTION"!==e.type&&"UNKNOWN_TOPIC_OR_PARTITION"!==e.type&&"TOPIC_AUTHORIZATION_FAILED"!==e.type||(this.targetTopics=r),e}}finally{await this.mutatingTargetTopics.release()}}getNodeIds(){return this.brokerPool.getNodeIds()}async findBroker({nodeId:e}){try{return await this.brokerPool.findBroker({nodeId:e})}catch(e){throw"KafkaJSBrokerNotFound"!==e.name&&"KafkaJSLockTimeout"!==e.name&&"KafkaJSConnectionError"!==e.name||await this.refreshMetadata(),e}}async findControllerBroker(){return await this[$w]()}findTopicPartitionMetadata(e){const{metadata:t}=this.brokerPool;if(!t||!t.topicMetadata)throw new Cw("Topic metadata not loaded",{topic:e});const r=t.topicMetadata.find(t=>t.topic===e);return r?r.partitionMetadata:[]}findLeaderForPartitions(e,t){const r=this.findTopicPartitionMetadata(e);return t.reduce((t,s)=>{const n=parseInt(s,10),i=r.find(e=>e.partitionId===n);if(!i)return t;if(null===i.leader||void 0===i.leader)throw new Ow("Invalid partition metadata",{topic:e,partitionId:n,metadata:i});const{leader:o}=i,a=t[o]||[];return{...t,[o]:[...a,n]}},{})}async findGroupCoordinator({groupId:e,coordinatorType:t=xw.GROUP}){return this.retrier(async(r,s,n)=>{try{const{coordinator:r}=await this.findGroupCoordinatorMetadata({groupId:e,coordinatorType:t});return await this.findBroker({nodeId:r.nodeId})}catch(t){if("KafkaJSBrokerNotFound"===t.name||"GROUP_COORDINATOR_NOT_AVAILABLE"===t.type)throw this.logger.debug(`${t.message}, refreshing metadata and trying again...`,{groupId:e,retryCount:s,retryTime:n}),await this.refreshMetadata(),t;if("ECONNREFUSED"===t.code)throw t;r(t)}})}async findGroupCoordinatorMetadata({groupId:e,coordinatorType:t}){const r=await this.brokerPool.withBroker(async({nodeId:r,broker:s})=>await this.retrier(async(n,i,o)=>{try{const r=await s.findGroupCoordinator({groupId:e,coordinatorType:t});return this.logger.debug("Found group coordinator",{broker:r.host,nodeId:r.coordinator.nodeId}),r}catch(t){if(this.logger.debug("Tried to find group coordinator",{nodeId:r,groupId:e,error:t}),"GROUP_COORDINATOR_NOT_AVAILABLE"===t.type)throw this.logger.debug("Group coordinator not available, retrying...",{nodeId:r,retryCount:i,retryTime:o}),t;n(t)}}));if(r)return r;throw new kw("Failed to find group coordinator")}defaultOffset({fromBeginning:e}){return e?Aw:Sw}async fetchTopicsOffset(e){const t={},r={},s=e=>t=>{const{timestamp:s}=r[e];return{...t,timestamp:s}};for(const s of e){const{topic:e,partitions:n,fromBeginning:i,fromTimestamp:o}=s,a=this.findLeaderForPartitions(e,n.map(e=>e.partition)),c=null!=o?o:this.defaultOffset({fromBeginning:i});r[e]={timestamp:c},Lw(a).forEach(r=>{t[r]=t[r]||{},t[r][e]=n.filter(e=>a[r].includes(e.partition))})}const n=Lw(t).map(async e=>{const r=await this.findBroker({nodeId:e}),n=t[e],{responses:i}=await r.listOffsets({isolationLevel:this.isolationLevel,topics:Lw(n).map(e=>({topic:e,partitions:n[e].map(s(e))}))});return i}),i=(await Promise.all(n)).flat().reduce(Bw,{});return Lw(i).map(e=>({topic:e,partitions:i[e].map(({partition:e,offset:t})=>({partition:e,offset:t}))}))}committedOffsets({groupId:e}){return this.committedOffsetsByGroup.has(e)||this.committedOffsetsByGroup.set(e,{}),this.committedOffsetsByGroup.get(e)}markOffsetAsCommitted({groupId:e,topic:t,partition:r,offset:s}){const n=this.committedOffsets({groupId:e});n[t]=n[t]||{},n[t][r]=s}},K_=({cluster:e,logger:t,createPartitioner:r=Pv,retry:s,idempotent:n=!1,transactionalId:i,transactionTimeout:o,instrumentationEmitter:a})=>{let c=Bv.DISCONNECTED;if(s=s||{retries:n?Number.MAX_SAFE_INTEGER:5},n&&s.retries<1)throw new Fv("Idempotent producer must allow retries to protect against transient errors");const u=t.namespace("Producer");n&&s.retries<Number.MAX_SAFE_INTEGER&&u.warn("Limiting retries for the idempotent producer may invalidate EoS guarantees");const l=r(),d=Lv(Object.assign({},e.retry,s)),p=a||new Mv,f=Dv({logger:u,cluster:e,transactionTimeout:o,transactional:!1,transactionalId:i}),{send:h,sendBatch:m}=$v({logger:u,cluster:e,partitioner:l,eosManager:f,idempotent:n,retrier:d,getConnectionStatus:()=>c});let g;return{connect:async()=>{await e.connect(),c=Bv.CONNECTED,p.emit(Hv),n&&!f.isInitialized()&&await f.initProducerId()},disconnect:async()=>{c=Bv.DISCONNECTING,await e.disconnect(),c=Bv.DISCONNECTED,p.emit(Zv)},isIdempotent:()=>n,events:Uv,on:(e,t)=>{if(!qv.includes(e))throw new Fv(`Event name should be one of ${Wv}`);return p.addListener(Gv(e),r=>{r.type=jv(r.type),Promise.resolve(t(r)).catch(t=>{u.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})})})},send:h,sendBatch:m,transaction:async()=>{if(!i)throw new Fv("Must provide transactional id for transactional producer");let t=!1;if(g=g||Dv({logger:u,cluster:e,transactionTimeout:o,transactional:!0,transactionalId:i}),g.isInTransaction())throw new Fv("There is already an ongoing transaction for this producer. Please end the transaction before beginning another.");g.isInitialized()||await g.initProducerId(),g.beginTransaction();const{send:r,sendBatch:s}=$v({logger:u,cluster:e,partitioner:l,retrier:d,eosManager:g,idempotent:!0,getConnectionStatus:()=>c}),n=()=>g.isInTransaction()&&!t,a=e=>(...t)=>n()?e(...t):Promise.reject(new Fv("Cannot continue to use transaction once ended"));return{sendBatch:a(s),send:a(r),abort:a(async()=>{await g.abort(),t=!0}),commit:a(async()=>{await g.commit(),t=!0}),sendOffsets:a(async({consumerGroupId:t,topics:r})=>{await g.sendOffsets({consumerGroupId:t,topics:r});for(const s of r){const{topic:r,partitions:n}=s;for(const{partition:s,offset:i}of n)e.markOffsetAsCommitted({groupId:t,topic:r,partition:s,offset:i})}}),isActive:n}},logger:()=>u}},q_=JE,W_=({logger:e,instrumentationEmitter:t,retry:r,cluster:s})=>{const n=e.namespace("Admin"),i=t||new f_,o=async e=>{if(!e||"string"!=typeof e)throw new I_(`Invalid topic ${e}`);return u_(r)(async(t,r,n)=>{try{await s.addTargetTopic(e),await s.refreshMetadataIfNecessary();const t=s.findTopicPartitionMetadata(e),r=await s.fetchTopicsOffset([{topic:e,fromBeginning:!1,partitions:t.map(e=>({partition:e.partitionId}))}]),n=await s.fetchTopicsOffset([{topic:e,fromBeginning:!0,partitions:t.map(e=>({partition:e.partitionId}))}]),{partitions:i}=r.pop(),{partitions:o}=n.pop();return i.map(({partition:e,offset:t})=>({partition:e,offset:t,high:t,low:o.find(({partition:t})=>t===e).offset}))}catch(e){if("UNKNOWN_TOPIC_OR_PARTITION"===e.type)throw await s.refreshMetadata(),e;t(e)}})},a=async({groupId:t,topic:r,partitions:n})=>{if(!t)throw new I_(`Invalid groupId ${t}`);if(!r)throw new I_(`Invalid topic ${r}`);if(!n||0===n.length)throw new I_("Invalid partitions");const i=p_({logger:e.namespace("Admin",y_.NOTHING),cluster:s,groupId:t});await i.subscribe({topic:r,fromBeginning:!0});const o=await i.describeGroup();if(!(e=>["Empty","Dead"].includes(e.state))(o))throw new I_(`The consumer group must have no running instances, current state: ${o.state}`);return new Promise((e,t)=>{i.on(i.events.FETCH,async()=>i.stop().then(e).catch(t)),i.run({eachBatchAutoResolve:!1,eachBatch:async()=>!0}).catch(t),i.pause([{topic:r}]);for(const e of n)i.seek({topic:r,...e})})},c=({resources:e,defaultBroker:t})=>d_(e,async({type:e,name:r})=>(e=>[__.BROKER,__.BROKER_LOGGER].includes(e))(e)?await s.findBroker({nodeId:String(r)}):t);return{connect:async()=>{await s.connect(),i.emit(k_)},disconnect:async()=>{await s.disconnect(),i.emit(x_)},listTopics:async()=>{const{topicMetadata:e}=await s.metadata();return e.map(e=>e.topic)},createTopics:async({topics:e,validateOnly:t,timeout:i,waitForLeaders:o=!0})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid topics array ${e}`);if(e.filter(({topic:e})=>"string"!=typeof e).length>0)throw new I_("Invalid topics array, the topic names have to be a valid string");const a=new Set(e.map(({topic:e})=>e));if(a.size<e.length)throw new I_("Invalid topics array, it cannot have multiple entries for the same topic");for(const{topic:t,configEntries:r}of e)if(null!=r){if(!Array.isArray(r))throw new I_(`Invalid configEntries for topic "${t}", must be an array`);r.forEach((e,r)=>{if("object"!=typeof e||null==e)throw new I_(`Invalid configEntries for topic "${t}". Entry ${r} must be an object`);for(const s of["name","value"])if(!Object.prototype.hasOwnProperty.call(e,s)||"string"!=typeof e[s])throw new I_(`Invalid configEntries for topic "${t}". Entry ${r} must have a valid "${s}" property`)})}return u_(r)(async(r,c,u)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker();if(await r.createTopics({topics:e,validateOnly:t,timeout:i}),o){const e=Array.from(a.values());await((e,t={})=>l_(async()=>{try{return await e()}catch(e){if("LEADER_NOT_AVAILABLE"!==e.type)throw e;return!1}},t))(async()=>await r.metadata(e),{delay:100,maxWait:i,timeoutMessage:"Timed out while waiting for topic leaders"})}return!0}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not create topics",{error:e.message,retryCount:c,retryTime:u}),e;if(e instanceof T_&&e.errors.every(e=>"TOPIC_ALREADY_EXISTS"===e.type))return!1;r(e)}})},deleteTopics:async({topics:e,timeout:t})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid topics array ${e}`);if(e.filter(e=>"string"!=typeof e).length>0)throw new I_("Invalid topics array, the names must be a valid string");return u_(r)(async(r,i,o)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker();await r.deleteTopics({topics:e,timeout:t});for(const t of e)s.targetTopics.delete(t);await s.refreshMetadata()}catch(e){if(["NOT_CONTROLLER","UNKNOWN_TOPIC_OR_PARTITION"].includes(e.type))throw n.warn("Could not delete topics",{error:e.message,retryCount:i,retryTime:o}),e;"REQUEST_TIMED_OUT"===e.type&&n.error('Could not delete topics, check if "delete.topic.enable" is set to "true" (the default value is "false") or increase the timeout',{error:e.message,retryCount:i,retryTime:o}),r(e)}})},createPartitions:async({topicPartitions:e,validateOnly:t,timeout:i})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid topic partitions array ${e}`);if(0===e.length)throw new I_("Empty topic partitions array");if(e.filter(({topic:e})=>"string"!=typeof e).length>0)throw new I_("Invalid topic partitions array, the topic names have to be a valid string");if(new Set(e.map(({topic:e})=>e)).size<e.length)throw new I_("Invalid topic partitions array, it cannot have multiple entries for the same topic");return u_(r)(async(r,o,a)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker();await r.createPartitions({topicPartitions:e,validateOnly:t,timeout:i})}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not create topics",{error:e.message,retryCount:o,retryTime:a}),e;r(e)}})},fetchTopicMetadata:async({topics:e=[]}={})=>{e&&e.forEach(e=>{if(!e||"string"!=typeof e)throw new I_(`Invalid topic ${e}`)});return{topics:(await s.metadata({topics:e})).topicMetadata.map(e=>({name:e.topic,partitions:e.partitionMetadata}))}},describeCluster:async()=>{const{brokers:e,clusterId:t,controllerId:r}=await s.metadata({topics:[]});return{brokers:e.map(({nodeId:e,host:t,port:r})=>({nodeId:e,host:t,port:r})),controller:null==r||-1===r?null:r,clusterId:t}},events:h_,fetchOffsets:async({groupId:e,topics:t,resolveOffsets:r=!1})=>{if(!e)throw new I_(`Invalid groupId ${e}`);if(t||(t=[]),!Array.isArray(t))throw new I_("Expected topics array to be set");const n=await s.findGroupCoordinator({groupId:e}),i=await Promise.all(t.map(async e=>({topic:e,partitions:(await $_(s,e)).map(e=>({partition:e}))})));let{responses:c}=await n.offsetFetch({groupId:e,topics:i});return r&&(c=await Promise.all(c.map(async({topic:t,partitions:r})=>{const s=(e=>e.reduce((e,{partition:t,...r})=>Object.assign(e,{[t]:{...r}}),{}))(await o(t)),n=r.map(({offset:e,partition:t,...r})=>{let n=e;return Number(e)===R_&&(n=s[t].low),Number(e)===C_&&(n=s[t].high),{partition:t,offset:n,...r}});return await a({groupId:e,topic:t,partitions:n}),{topic:t,partitions:n}}))),c.map(({topic:e,partitions:t})=>{const r=t.map(({partition:e,offset:t,metadata:r})=>({partition:e,offset:t,metadata:r||null}));return{topic:e,partitions:r}})},fetchTopicOffsets:o,fetchTopicOffsetsByTimestamp:async(e,t)=>{if(!e||"string"!=typeof e)throw new I_(`Invalid topic ${e}`);return u_(r)(async(r,n,i)=>{try{await s.addTargetTopic(e),await s.refreshMetadataIfNecessary();const r=s.findTopicPartitionMetadata(e).map(e=>({partition:e.partitionId})),n=await s.fetchTopicsOffset([{topic:e,fromBeginning:!1,partitions:r}]),{partitions:i}=n.pop(),o=await s.fetchTopicsOffset([{topic:e,fromTimestamp:t,partitions:r}]),{partitions:a}=o.pop();return a.map(({partition:e,offset:t})=>({partition:e,offset:parseInt(t,10)>=0?t:i.find(({partition:t})=>t===e).offset}))}catch(e){if("UNKNOWN_TOPIC_OR_PARTITION"===e.type)throw await s.refreshMetadata(),e;r(e)}})},setOffsets:a,resetOffsets:async({groupId:e,topic:t,earliest:r=!1})=>{if(!e)throw new I_(`Invalid groupId ${e}`);if(!t)throw new I_(`Invalid topic ${t}`);const n=(await $_(s,t)).map(e=>({partition:e,offset:s.defaultOffset({fromBeginning:r})}));return a({groupId:e,topic:t,partitions:n})},describeConfigs:async({resources:e,includeSynonyms:t})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid resources array ${e}`);if(0===e.length)throw new I_("Resources array cannot be empty");const i=Object.values(__),o=e.find(e=>!i.includes(e.type));if(o)throw new I_(`Invalid resource type ${o.type}: ${JSON.stringify(o)}`);const a=e.find(e=>!e.name||"string"!=typeof e.name);if(a)throw new I_(`Invalid resource name ${a.name}: ${JSON.stringify(a)}`);const u=e.find(e=>!Array.isArray(e.configNames)&&null!=e.configNames);if(u){const{configNames:e}=u;throw new I_(`Invalid resource configNames ${e}: ${JSON.stringify(u)}`)}return u_(r)(async(r,i,o)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker(),n=await c({resources:e,defaultBroker:r}),i=async e=>{const s=e||r;return s.describeConfigs({resources:n.get(s),includeSynonyms:t})},o=Array.from(n.keys()),a=(await Promise.all(o.map(i))).reduce((e,{resources:t})=>[...e,...t],[]);return{resources:a}}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not describe configs",{error:e.message,retryCount:i,retryTime:o}),e;r(e)}})},alterConfigs:async({resources:e,validateOnly:t})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid resources array ${e}`);if(0===e.length)throw new I_("Resources array cannot be empty");const i=Object.values(__),o=e.find(e=>!i.includes(e.type));if(o)throw new I_(`Invalid resource type ${o.type}: ${JSON.stringify(o)}`);const a=e.find(e=>!e.name||"string"!=typeof e.name);if(a)throw new I_(`Invalid resource name ${a.name}: ${JSON.stringify(a)}`);const u=e.find(e=>!Array.isArray(e.configEntries));if(u){const{configEntries:e}=u;throw new I_(`Invalid resource configEntries ${e}: ${JSON.stringify(u)}`)}const l=e.find(e=>e.configEntries.some(e=>"string"!=typeof e.name||"string"!=typeof e.value));if(l)throw new I_(`Invalid resource config value: ${JSON.stringify(l)}`);return u_(r)(async(r,i,o)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker(),n=await c({resources:e,defaultBroker:r}),i=async e=>{const s=e||r;return s.alterConfigs({resources:n.get(s),validateOnly:!!t})},o=Array.from(n.keys()),a=(await Promise.all(o.map(i))).reduce((e,{resources:t})=>[...e,...t],[]);return{resources:a}}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not alter configs",{error:e.message,retryCount:i,retryTime:o}),e;r(e)}})},on:(e,t)=>{if(!M_.includes(e))throw new I_(`Event name should be one of ${D_}`);return i.addListener(g_(e),r=>{r.type=m_(r.type),Promise.resolve(t(r)).catch(t=>{n.error(`Failed to execute listener: ${t.message}`,{eventName:e,stack:t.stack})})})},logger:()=>n,listGroups:async()=>{await s.refreshMetadata();let e=[];for(var t in s.brokerPool.brokers){const r=await s.findBroker({nodeId:t}),n=await r.listGroups();e=e.concat(n.groups)}return{groups:e}},describeGroups:async e=>{const t=await Promise.all(e.map(async e=>({coordinator:await s.findGroupCoordinator({groupId:e}),groupId:e}))),n=Object.values(t.reduce((e,{coordinator:t,groupId:r})=>{const s=e[t.nodeId];return e[t.nodeId]=s?{...s,groupIds:[...s.groupIds,r]}:{coordinator:t,groupIds:[r]},e},{})),i=await Promise.all(n.map(async({coordinator:e,groupIds:t})=>{const s=u_(r),{groups:n}=await s(()=>e.describeGroups({groupIds:t}));return n}));return{groups:[].concat.apply([],i)}},deleteGroups:async e=>{if(!e||!Array.isArray(e))throw new I_(`Invalid groupIds array ${e}`);const t=e.some(e=>"string"!=typeof e);if(t)throw new I_(`Invalid groupId name: ${JSON.stringify(t)}`);const i=u_(r);let o=[],a=e.slice();return i(async(e,t,r)=>{try{if(0===a.length)return[];await s.refreshMetadata();const e={},t={};for(const r of a){const n=await s.findGroupCoordinator({groupId:r});void 0===e[n.nodeId]&&(e[n.nodeId]=[]),e[n.nodeId].push(r),t[n.nodeId]=n}const r=await Promise.all(Object.keys(t).map(async r=>await t[r].deleteGroups(e[r]))),n=r.flatMap(({results:e})=>e.map(({groupId:e,errorCode:t,error:r})=>({groupId:e,errorCode:t,error:r}))).filter(({errorCode:e})=>0!==e);if(a=n.map(({groupId:e})=>e),n.length>0)throw new b_("Error in DeleteGroups",n);return o=r.flatMap(({results:e})=>e),o}catch(s){if("NOT_CONTROLLER"===s.type||"COORDINATOR_NOT_AVAILABLE"===s.type)throw n.warn("Could not delete groups",{error:s.message,retryCount:t,retryTime:r}),s;e(s)}})},describeAcls:async({resourceType:e,resourceName:t,resourcePatternType:i,principal:o,host:a,operation:c,permissionType:u})=>{if("string"!=typeof o&&void 0!==o)throw new I_("Invalid principal, the principal have to be a valid string");if("string"!=typeof a&&void 0!==a)throw new I_("Invalid host, the host have to be a valid string");if("string"!=typeof t&&void 0!==t)throw new I_("Invalid resourceName, the resourceName have to be a valid string");if(!Object.values(S_).includes(c))throw new I_(`Invalid operation type ${c}`);if(!Object.values(N_).includes(i))throw new I_(`Invalid resource pattern filter type ${i}`);if(!Object.values(O_).includes(u))throw new I_(`Invalid permission type ${u}`);if(!Object.values(A_).includes(e))throw new I_(`Invalid resource type ${e}`);return u_(r)(async(r,l,d)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker(),{resources:n}=await r.describeAcls({resourceType:e,resourceName:t,resourcePatternType:i,principal:o,host:a,operation:c,permissionType:u});return{resources:n}}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not describe ACL",{error:e.message,retryCount:l,retryTime:d}),e;r(e)}})},deleteAcls:async({filters:e})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid ACL Filter array ${e}`);if(0===e.length)throw new I_("Empty ACL Filter array");if(e.some(({principal:e})=>"string"!=typeof e&&void 0!==e))throw new I_("Invalid ACL Filter array, the principals have to be a valid string");if(e.some(({host:e})=>"string"!=typeof e&&void 0!==e))throw new I_("Invalid ACL Filter array, the hosts have to be a valid string");if(e.some(({resourceName:e})=>"string"!=typeof e&&void 0!==e))throw new I_("Invalid ACL Filter array, the resourceNames have to be a valid string");let t;const i=Object.values(S_);if(t=e.find(e=>!i.includes(e.operation)),t)throw new I_(`Invalid operation type ${t.operation}: ${JSON.stringify(t)}`);const o=Object.values(N_);if(t=e.find(e=>!o.includes(e.resourcePatternType)),t)throw new I_(`Invalid resource pattern type ${t.resourcePatternType}: ${JSON.stringify(t)}`);const a=Object.values(O_);if(t=e.find(e=>!a.includes(e.permissionType)),t)throw new I_(`Invalid permission type ${t.permissionType}: ${JSON.stringify(t)}`);const c=Object.values(A_);if(t=e.find(e=>!c.includes(e.resourceType)),t)throw new I_(`Invalid resource type ${t.resourceType}: ${JSON.stringify(t)}`);return u_(r)(async(t,r,i)=>{try{await s.refreshMetadata();const t=await s.findControllerBroker(),{filterResponses:r}=await t.deleteAcls({filters:e});return{filterResponses:r}}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not delete ACL",{error:e.message,retryCount:r,retryTime:i}),e;t(e)}})},createAcls:async({acl:e})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid ACL array ${e}`);if(0===e.length)throw new I_("Empty ACL array");if(e.some(({principal:e})=>"string"!=typeof e))throw new I_("Invalid ACL array, the principals have to be a valid string");if(e.some(({host:e})=>"string"!=typeof e))throw new I_("Invalid ACL array, the hosts have to be a valid string");if(e.some(({resourceName:e})=>"string"!=typeof e))throw new I_("Invalid ACL array, the resourceNames have to be a valid string");let t;const i=Object.values(S_);if(t=e.find(e=>!i.includes(e.operation)),t)throw new I_(`Invalid operation type ${t.operation}: ${JSON.stringify(t)}`);const o=Object.values(N_);if(t=e.find(e=>!o.includes(e.resourcePatternType)),t)throw new I_(`Invalid resource pattern type ${t.resourcePatternType}: ${JSON.stringify(t)}`);const a=Object.values(O_);if(t=e.find(e=>!a.includes(e.permissionType)),t)throw new I_(`Invalid permission type ${t.permissionType}: ${JSON.stringify(t)}`);const c=Object.values(A_);if(t=e.find(e=>!c.includes(e.resourceType)),t)throw new I_(`Invalid resource type ${t.resourceType}: ${JSON.stringify(t)}`);return u_(r)(async(t,r,i)=>{try{await s.refreshMetadata();const t=await s.findControllerBroker();return await t.createAcls({acl:e}),!0}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not create ACL",{error:e.message,retryCount:r,retryTime:i}),e;t(e)}})},deleteTopicRecords:async({topic:e,partitions:t})=>{if(!e||"string"!=typeof e)throw new I_(`Invalid topic "${e}"`);if(!t||0===t.length)throw new I_("Invalid partitions");const i=s.findLeaderForPartitions(e,t.map(e=>e.partition)),a=L_(i).flat(),c=await o(e),u=[];if(t.forEach(({partition:t,offset:r})=>{if(!a.includes(t))return void u.push({partition:t,offset:r,error:new w_("Could not find the leader for the partition",{retriable:!1})});const{low:s}=c.find(e=>e.partition===t)||{high:void 0,low:void 0};parseInt(r)<parseInt(s)&&-1!==parseInt(r)&&n.warn("The requested offset is before the earliest offset maintained on the partition - no records will be deleted from this partition",{topic:e,partition:t,offset:r})}),u.length>0)throw new v_({topic:e,partitions:u});const l=P_(i).reduce((r,[s,n])=>(r[s]={topic:e,partitions:t.filter(e=>n.includes(e.partition))},r),{});return u_(r)(async t=>{try{const t=[],r=P_(l).map(([e,{topic:t,partitions:r}])=>async()=>{const n=await s.findBroker({nodeId:e});await n.deleteRecords({topics:[{topic:t,partitions:r}]}),delete l[e]});if(await Promise.all(r.map(e=>e().catch(e=>{if("KafkaJSDeleteTopicRecordsError"!==e.name)throw e;e.partitions.forEach(({partition:e,offset:r,error:s})=>{t.push({partition:e,offset:r,error:s})})}))),t.length>0)throw new v_({topic:e,partitions:t})}catch(e){throw e.retriable&&e.partitions.some(({error:e})=>E_(e)||"KafkaJSMetadataNotLoaded"===e.name)&&await s.refreshMetadata(),e}})},alterPartitionReassignments:async({topics:e,timeout:t})=>{if(!e||!Array.isArray(e))throw new I_(`Invalid topics array ${e}`);if(e.filter(({topic:e})=>"string"!=typeof e).length>0)throw new I_("Invalid topics array, the topic names have to be a valid string");if(new Set(e.map(({topic:e})=>e)).size<e.length)throw new I_("Invalid topics array, it cannot have multiple entries for the same topic");for(const{topic:t,partitionAssignment:r}of e){if(!r||!Array.isArray(r))throw new I_(`Invalid partitions array: ${r} for topic: ${t}`);for(const{partition:e,replicas:s}of r){if(null==e||"number"!=typeof e||e<0)throw new I_(`Invalid partitions index: ${e} for topic: ${t}`);if(!s||!Array.isArray(s))throw new I_(`Invalid replica assignment: ${s} for topic: ${t} on partition: ${e}`);if(s.filter(e=>"number"!=typeof e||e<0).length>=1)throw new I_(`Invalid replica assignment: ${s} for topic: ${t} on partition: ${e}. Replicas must be a non negative number`)}}return u_(r)(async(r,i,o)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker();await r.alterPartitionReassignments({topics:e,timeout:t})}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not reassign partitions",{error:e.message,retryCount:i,retryTime:o}),e;r(e)}})},listPartitionReassignments:async({topics:e=null,timeout:t})=>{if(e){if(!Array.isArray(e))throw new I_(`Invalid topics array ${e}`);if(e.filter(({topic:e})=>"string"!=typeof e).length>0)throw new I_("Invalid topics array, the topic names have to be a valid string");if(new Set(e.map(({topic:e})=>e)).size<e.length)throw new I_("Invalid topics array, it cannot have multiple entries for the same topic");for(const{topic:t,partitions:r}of e){if(!r||!Array.isArray(r))throw new I_(`Invalid partition array: ${r} for topic: ${t}`);if(r.filter(e=>"number"!=typeof e||e<0).length>=1)throw new I_(`Invalid partition array: ${r} for topic: ${t}. The partition indices have to be a valid number greater than 0.`)}}return u_(r)(async(r,i,o)=>{try{await s.refreshMetadata();const r=await s.findControllerBroker();return{topics:(await r.listPartitionReassignments({topics:e,timeout:t})).topics}}catch(e){if("NOT_CONTROLLER"===e.type)throw n.warn("Could not reassign partitions",{error:e.message,retryCount:i,retryTime:o}),e;r(e)}})}}},H_=Xa,Z_=()=>{const e=u,t=l;return({host:r,port:s,ssl:n,onConnect:i})=>{const o=n?t.connect(Object.assign({host:r,port:s},e.isIP(r)?{}:{servername:r},n),i):e.connect({host:r,port:s},i);return o.setKeepAlive(!0,6e4),o}},J_=e=>{let t=!1;return(...r)=>{if(!t)return t=!0,e(...r)}},X_=xi,z_=Symbol("private:Kafka:createCluster"),Y_=Symbol("private:Kafka:clusterRetry"),Q_=Symbol("private:Kafka:logger"),eA=Symbol("private:Kafka:offsets"),tA=J_(e=>{null==process.env.KAFKAJS_NO_PARTITIONER_WARNING&&e.warn(`KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option "createPartitioner: Partitioners.LegacyPartitioner". See the migration guide at ${X_("docs/migration-guide-v2.0.0","producer-new-default-partitioner")} for details. Silence this warning by setting the environment variable "KAFKAJS_NO_PARTITIONER_WARNING=1"`)});const rA=class{constructor({brokers:e,ssl:t,sasl:r,clientId:s,connectionTimeout:n=1e3,authenticationTimeout:i,reauthenticationThreshold:o,requestTimeout:a,enforceRequestTimeout:c=!0,retry:u,socketFactory:l=Z_(),logLevel:d=j_,logCreator:p=F_}){this[eA]=new Map,this[Q_]=U_({level:d,logCreator:p}),this[Y_]=u,this[z_]=({metadataMaxAge:u,allowAutoTopicCreation:d=!0,maxInFlightRequests:p=null,instrumentationEmitter:f=null,isolationLevel:h})=>new V_({logger:this[Q_],retry:this[Y_],offsets:this[eA],socketFactory:l,brokers:e,ssl:t,sasl:r,clientId:s,connectionTimeout:n,authenticationTimeout:i,reauthenticationThreshold:o,requestTimeout:a,enforceRequestTimeout:c,metadataMaxAge:u,instrumentationEmitter:f,allowAutoTopicCreation:d,maxInFlightRequests:p,isolationLevel:h})}producer({createPartitioner:e,retry:t,metadataMaxAge:r=3e5,allowAutoTopicCreation:s,idempotent:n,transactionalId:i,transactionTimeout:o,maxInFlightRequests:a}={}){const c=new G_,u=this[z_]({metadataMaxAge:r,allowAutoTopicCreation:s,maxInFlightRequests:a,instrumentationEmitter:c});return null==e&&tA(this[Q_]),K_({retry:{...this[Y_],...t},logger:this[Q_],cluster:u,createPartitioner:e,idempotent:n,transactionalId:i,transactionTimeout:o,instrumentationEmitter:c})}consumer({groupId:e,partitionAssigners:t,metadataMaxAge:r=3e5,sessionTimeout:s,rebalanceTimeout:n,heartbeatInterval:i,maxBytesPerPartition:o,minBytes:a,maxBytes:c,maxWaitTimeInMs:u,retry:l={retries:5},allowAutoTopicCreation:d,maxInFlightRequests:p,readUncommitted:f=!1,rackId:h=""}={}){const m=f?H_.READ_UNCOMMITTED:H_.READ_COMMITTED,g=new G_,y=this[z_]({metadataMaxAge:r,allowAutoTopicCreation:d,maxInFlightRequests:p,isolationLevel:m,instrumentationEmitter:g});return q_({retry:{...this[Y_],...l},logger:this[Q_],cluster:y,groupId:e,partitionAssigners:t,sessionTimeout:s,rebalanceTimeout:n,heartbeatInterval:i,maxBytesPerPartition:o,minBytes:a,maxBytes:c,maxWaitTimeInMs:u,isolationLevel:m,instrumentationEmitter:g,rackId:h,metadataMaxAge:r})}admin({retry:e}={}){const t=new G_,r=this[z_]({allowAutoTopicCreation:!1,instrumentationEmitter:t});return W_({retry:{...this[Y_],...e},logger:this[Q_],instrumentationEmitter:t,cluster:r})}logger(){return this[Q_]}},sA=_E,nA=OT,iA=zw,oA=ei,aA=Ug,cA=$g,uA=i_,lA=o_,dA=a_,pA=c_,{isRebalancing:fA,isKafkaJSError:hA,...mA}=Mn,{LEVELS:gA}=Tn;var yA={Kafka:rA,PartitionAssigners:sA,AssignerProtocol:nA,Partitioners:iA,logLevel:gA,CompressionTypes:oA.Types,CompressionCodecs:oA.Codecs,ConfigResourceTypes:aA,AclResourceTypes:uA,AclOperationTypes:lA,AclPermissionTypes:dA,ResourcePatternTypes:pA,ConfigSource:cA,...mA},IA={id:"kafka-operation",handler:async({operation:e,host:t,port:r,topic:s,message:n,key:i,partition:o,headers:a,groupId:c,fromBeginning:u,maxMessages:l,transform:d})=>{const p=new yA.Kafka({clientId:"directus-kafka-operation",brokers:[`${t}:${r}`]});if("produce"===e){const e=p.producer();await e.connect();let t=n;if(d)try{t=new Function("data",d)(n)}catch(e){throw new Error(`Transform function error: ${e}`)}const r={topic:s,messages:[{key:i||null,value:JSON.stringify(t),partition:o||0,headers:a||{}}]};return await e.send(r),await e.disconnect(),{success:!0,operation:"produce",topic:s,message:t}}if("consume"===e){const e=p.consumer({groupId:c||"directus-kafka-group"});await e.connect(),await e.subscribe({topic:s,fromBeginning:u||!1});const t=[];let r=0;return await e.run({eachMessage:async({message:s})=>{var n;const i=s.value?JSON.parse(s.value.toString()):null;let o=i;if(d)try{o=new Function("data",d)(i)}catch(e){console.error("Transform function error:",e)}t.push({key:null==(n=s.key)?void 0:n.toString(),value:o,headers:s.headers,timestamp:s.timestamp}),r++,l&&r>=l&&await e.stop()}}),await new Promise(e=>setTimeout(e,1e3)),await e.disconnect(),{success:!0,operation:"consume",topic:s,messages:t,count:t.length}}throw new Error('Invalid operation type. Use "produce" or "consume".')}};module.exports=IA;
